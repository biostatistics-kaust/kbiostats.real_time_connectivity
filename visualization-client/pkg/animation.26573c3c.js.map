{"version":3,"sources":["../../node_modules/kefir/dist/kefir.esm.js","../../node_modules/jstat/dist/jstat.js","dataprovider.js","../../node_modules/konva/lib/Global.js","../../node_modules/konva/lib/Util.js","../../node_modules/konva/lib/Validators.js","../../node_modules/konva/lib/Factory.js","../../node_modules/konva/lib/Context.js","../../node_modules/konva/lib/Canvas.js","../../node_modules/konva/lib/DragAndDrop.js","../../node_modules/konva/lib/Node.js","../../node_modules/konva/lib/Container.js","../../node_modules/konva/lib/PointerEvents.js","../../node_modules/konva/lib/Stage.js","../../node_modules/konva/lib/BaseLayer.js","../../node_modules/konva/lib/Shape.js","../../node_modules/konva/lib/Layer.js","../../node_modules/konva/lib/FastLayer.js","../../node_modules/konva/lib/Group.js","../../node_modules/konva/lib/Animation.js","../../node_modules/konva/lib/Tween.js","../../node_modules/konva/lib/_CoreInternals.js","../../node_modules/konva/lib/shapes/Arc.js","../../node_modules/konva/lib/shapes/Line.js","../../node_modules/konva/lib/shapes/Arrow.js","../../node_modules/konva/lib/shapes/Circle.js","../../node_modules/konva/lib/shapes/Ellipse.js","../../node_modules/konva/lib/shapes/Image.js","../../node_modules/konva/lib/shapes/Label.js","../../node_modules/konva/lib/shapes/Path.js","../../node_modules/konva/lib/shapes/Rect.js","../../node_modules/konva/lib/shapes/RegularPolygon.js","../../node_modules/konva/lib/shapes/Ring.js","../../node_modules/konva/lib/shapes/Sprite.js","../../node_modules/konva/lib/shapes/Star.js","../../node_modules/konva/lib/shapes/Text.js","../../node_modules/konva/lib/shapes/TextPath.js","../../node_modules/konva/lib/shapes/Transformer.js","../../node_modules/konva/lib/shapes/Wedge.js","../../node_modules/konva/lib/filters/Blur.js","../../node_modules/konva/lib/filters/Brighten.js","../../node_modules/konva/lib/filters/Contrast.js","../../node_modules/konva/lib/filters/Emboss.js","../../node_modules/konva/lib/filters/Enhance.js","../../node_modules/konva/lib/filters/Grayscale.js","../../node_modules/konva/lib/filters/HSL.js","../../node_modules/konva/lib/filters/HSV.js","../../node_modules/konva/lib/filters/Invert.js","../../node_modules/konva/lib/filters/Kaleidoscope.js","../../node_modules/konva/lib/filters/Mask.js","../../node_modules/konva/lib/filters/Noise.js","../../node_modules/konva/lib/filters/Pixelate.js","../../node_modules/konva/lib/filters/Posterize.js","../../node_modules/konva/lib/filters/RGB.js","../../node_modules/konva/lib/filters/RGBA.js","../../node_modules/konva/lib/filters/Sepia.js","../../node_modules/konva/lib/filters/Solarize.js","../../node_modules/konva/lib/filters/Threshold.js","../../node_modules/konva/lib/_FullInternals.js","../../node_modules/konva/lib/index.js","../opc-eeg-positions@1.0.0/eeg2D.js","../../node_modules/colormap/colorScale.js","../../node_modules/lerp/index.js","../../node_modules/colormap/index.js","color_utils.js","basic_layout.js","eeg_layout.js","animation.js","node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["createObj","proto","F","prototype","extend","target","length","arguments","i","prop","inherit","Child","Parent","constructor","NOTHING","END","VALUE","ERROR","ANY","concat","a","b","result","j","Array","find","arr","value","findByPred","pred","cloneArray","input","remove","index","map","fn","forEach","fillArray","contains","slide","cur","next","max","Math","min","offset","callSubscriber","type","event","Dispatcher","_items","_spies","_inLoop","_removedItems","add","x","push","addSpy","removeSpy","indexOf","dispatch","spies","_i","items","cleanup","Observable","_dispatcher","_active","_alive","_activating","_logHandlers","_spyHandlers","_name","_onActivation","_onDeactivation","_setActive","active","_clear","_emit","_emitValue","_emitError","_emitEnd","_on","_off","count","onValue","onError","onEnd","onAny","offValue","offError","offEnd","offAny","observe","observerOrOnValue","_this","closed","observer","error","end","handler","unsubscribe","_ofSameType","A","B","getType","setName","sourceObs","selfName","log","name","undefined","toString","isCurrent","console","offLog","handlerIndex","obj","splice","spy","offSpy","Stream","call","Property","_currentEvent","neverS","never","timeBased","mixin","AnonymousStream","wait","options","_wait","_intervalId","_$onTick","_onTick","_init","_free","setInterval","clearInterval","S","_ref","_x","later","S$1","interval","S$2","xs","_xs","shift","sequentially","S$3","_fn","fromPoll","emitter","obs","e","emit","emitEvent","S$4","_emitter","withInterval","S$5","_unsubscribe","_callUnsubscribe","stream","fromCallback","callbackConsumer","called","fromNodeCallback","spread","apply","c","aLength","fromSubUnsub","sub","unsub","transformer","pairs","fromEvents","eventName","Error","P","current","constant","P$1","constantError","createConstructor","BaseClass","AnonymousObservable","source","_source","_$handleAny","_handleAny","createClassMethods","_handleValue","_handleError","_handleEnd","createStream","createProperty","P$2","_getInitialCurrent","getInitial","toProperty","S$6","changes","fromPromise","promise","_promise","then","done","getGlodalPromise","Promise","toPromise","last","resolve","reject","symbolObservablePonyfill","root","Symbol","observable","self","window","global","module","Function","$$observable","default","fromESObservable","_observable","subscribe","complete","ESObservable","takeErrors","observerOrOnNext","onComplete","subscription","toESObservable","collect","keys","values","hasOwnProperty","defaultErrorsCombinator","errors","latestError","Combine","passive","combinator","_activeCount","_sources","_combinator","_aliveCount","_latestValues","_latestErrors","_emitAfterActivation","_endAfterActivation","_latestErrorIndex","_$handlers","_loop","_emitIfFull","hasAllValues","hasErrors","valuesCopy","errorsCopy","combineAsArray","isArray","combineAsObject","activeObservables","passiveObservables","objectify","combine","Observable$2","empty","merge","of","bimap","fnErr","fnVal","mapErrors","ap","obsFn","obsVal","val","chain","flatMap","staticLand","Object","freeze","S$7","P$3","id","map$1","mixin$1","S$8","P$4","id$1","filter","mixin$2","n","_n","S$9","P$5","take","mixin$3","S$10","P$6","mixin$4","S$11","P$7","id$2","takeWhile","mixin$5","_lastValue","S$12","P$8","mixin$6","S$13","P$9","skip","mixin$7","S$14","P$10","id$3","skipWhile","mixin$8","_prev","S$15","P$11","eq","skipDuplicates","mixin$9","seed","S$16","P$12","defaultFn","diff","P$13","_seed","scan","mixin$10","S$17","id$4","flatten","END_MARKER","mixin$11","_buff","_$shiftBuff","setTimeout","S$18","P$14","delay","now","Date","getTime","mixin$12","leading","trailing","_leading","_trailing","_trailingValue","_timeoutId","_endLater","_lastCallTime","_$trailingCall","_trailingCall","curTime","remaining","_cancelTrailing","clearTimeout","S$19","P$15","throttle","_ref2","_ref2$leading","_ref2$trailing","mixin$13","immediate","_immediate","_lastAttempt","_laterValue","_$later","_later","S$20","P$16","debounce","_ref2$immediate","mixin$14","S$21","P$17","id$5","mixin$15","S$22","P$18","id$6","filterErrors","mixin$16","S$23","P$19","ignoreValues","mixin$17","S$24","P$20","ignoreErrors","mixin$18","S$25","P$21","ignoreEnd","mixin$19","S$26","P$22","beforeEnd","mixin$20","_max","_min","S$27","P$23","slidingWindow","mixin$21","flushOnEnd","_flushOnEnd","_flush","S$28","P$24","id$7","bufferWhile","_ref2$flushOnEnd","mixin$22","_count","S$29","P$25","bufferWhile$1","mixin$23","S$30","P$26","bufferWithTimeOrCount","xformForObs","res","mixin$24","transducer","_xform","S$31","P$27","transduce","mixin$25","_handler","S$32","P$28","withHandler","Zip","sources","_buffers","_isFull","zip","observables","id$8","AbstractPool","_ref$queueLim","queueLim","_ref$concurLim","concurLim","_ref$drop","drop","_queueLim","_concurLim","_drop","_queue","_curSources","_$handleSubAny","_handleSubAny","_$endHandlers","_currentlyAdding","_add","toObs","_addToCur","_addToQueue","_removeOldest","_addAll","obss","_this2","_remove","_removeCur","_removeQueue","_pullQueue","_onEmpty","_subToEnd","_this3","_subscribe","onEndI","_isEmpty","Merge","_initialised","S$33","generator","_generator","_iteration","_getSource","repeat","concat$1","Pool","plug","unplug","FlatMap","_mainEnded","_lastCurrent","_$handleMain","_handleMain","_hadNoEvSinceDeact","sameCurr","FlatMapErrors","createConstructor$1","primary","secondary","_primary","_secondary","_lastSecondary","_$handleSecondaryAny","_handleSecondaryAny","_$handlePrimaryAny","_handlePrimaryAny","createClassMethods$1","_handlePrimaryValue","_handlePrimaryError","_handlePrimaryEnd","_handleSecondaryValue","_handleSecondaryError","_handleSecondaryEnd","_removeSecondary","createStream$1","createProperty$1","mixin$26","S$34","P$29","filterBy","id2","_","sampledBy","mixin$27","S$35","P$30","skipUntilBy","mixin$28","S$36","P$31","takeUntilBy","mixin$29","_ref$flushOnEnd","S$37","P$32","bufferBy","mixin$30","_ref$flushOnChange","flushOnChange","_flushOnChange","S$38","P$33","bufferWhileBy","f","t","awaiting","mixin$31","convert","S$39","P$34","defFn","valuesToErrors","mixin$32","S$40","P$35","defFn$1","errorsToValues","mixin$33","S$41","P$36","endOnError","bufferWithCount","thru","other","pool","flatMapLatest","flatMapFirst","flatMapConcat","flatMapConcurLimit","limit","flatMapErrors","DEPRECATION_WARNINGS","dissableDeprecationWarnings","warn","msg","msg2","Kefir","random_connection","onstart","onmessage","onerror","retrieve_continue","configure","cmd","send","start","caller","data","random_data_generator","JSON","stringify","random_frequency","frequency","jStat","normal","sample","channels","timepoint","from","v","connectivity","floor","websocket_connection","server","port","socket","WebSocket","socket_","d","onopen","command","close","repetitions","includes","ready","readyState","dataprovider","connection","properties","subscribers","subscription_type","subscriber","execute","raw_value","parse","proper_start","EEG2DPositions","Nz","Iz","Cz","T9","T10","NFpz","Fpz","AFpz","AFz","AFFz","Fz","FFCz","FCz","FCCz","CCPz","CPz","CPPz","Pz","PPOz","POz","POOz","Oz","OIz","N2h","N2","AFp10","AF10","AFF10","F10","FFT10","FT10","FTT10","TTP10","TP10","TPP10","P10","PPO10","PO10","POO10","I2","I2h","N1h","N1","AFp9","AF9","AFF9","F9","FFT9","FT9","FTT9","TTP9","TP9","TPP9","P9","PPO9","PO9","POO9","I1","I1h","T9h","T7","T7h","C5","C5h","C3","C3h","C1","C1h","C2h","C2","C4h","C4","C6h","C6","T8h","T8","T10h","NFp2h","NFp2","AFp10h","AF10h","AFF10h","F10h","FFT10h","FT10h","FTT10h","TTP10h","TP10h","TPP10h","P10h","PPO10h","PO10h","POO10h","OI2","OI2h","NFp1h","NFp1","AFp9h","AF9h","AFF9h","F9h","FFT9h","FT9h","FTT9h","TTP9h","TP9h","TPP9h","P9h","PPO9h","PO9h","POO9h","OI1","OI1h","Fp2h","Fp2","AFp8","AF8","AFF8","F8","FFT8","FT8","FTT8","TTP8","TP8","TPP8","P8","PPO8","PO8","POO8","O2","O2h","Fp1h","Fp1","AFp7","AF7","AFF7","F7","FFT7","FT7","FTT7","TTP7","TP7","TPP7","P7","PPO7","PO7","POO7","O1","O1h","AFp7h","AFp5","AFp5h","AFp3","AFp3h","AFp1","AFp1h","AFp2h","AFp2","AFp4h","AFp4","AFp6h","AFp6","AFp8h","AF7h","AF5","AF5h","AF3","AF3h","AF1","AF1h","AF2h","AF2","AF4h","AF4","AF6h","AF6","AF8h","AFF7h","AFF5","AFF5h","AFF3","AFF3h","AFF1","AFF1h","AFF2h","AFF2","AFF4h","AFF4","AFF6h","AFF6","AFF8h","F7h","F5","F5h","F3","F3h","F1","F1h","F2h","F2","F4h","F4","F6h","F6","F8h","FFT7h","FFC5","FFC5h","FFC3","FFC3h","FFC1","FFC1h","FFC2h","FFC2","FFC4h","FFC4","FFC6h","FFC6","FFT8h","FT7h","FC5","FC5h","FC3","FC3h","FC1","FC1h","FC2h","FC2","FC4h","FC4","FC6h","FC6","FT8h","FTT7h","FCC5","FCC5h","FCC3","FCC3h","FCC1","FCC1h","FCC2h","FCC2","FCC4h","FCC4","FCC6h","FCC6","FTT8h","TTP7h","CCP5","CCP5h","CCP3","CCP3h","CCP1","CCP1h","CCP2h","CCP2","CCP4h","CCP4","CCP6h","CCP6","TTP8h","TP7h","CP5","CP5h","CP3","CP3h","CP1","CP1h","CP2h","CP2","CP4h","CP4","CP6h","CP6","TP8h","TPP7h","CPP5","CPP5h","CPP3","CPP3h","CPP1","CPP1h","CPP2h","CPP2","CPP4h","CPP4","CPP6h","CPP6","TPP8h","P7h","P5","P5h","P3","P3h","P1","P1h","P2h","P2","P4h","P4","P6h","P6","P8h","PPO7h","PPO5","PPO5h","PPO3","PPO3h","PPO1","PPO1h","PPO2h","PPO2","PPO4h","PPO4","PPO6h","PPO6","PPO8h","PO7h","PO5","PO5h","PO3","PO3h","PO1","PO1h","PO2h","PO2","PO4h","PO4","PO6h","PO6","PO8h","POO7h","POO5","POO5h","POO3","POO3h","POO1","POO1h","POO2h","POO2","POO4h","POO4","POO6h","POO6","POO8h","rescaledEEGLocations2D","width","height","left","top","invertY","zoom","adjWidth","adjHeight","rescaled","m","to_bin_hex","hex_string","Number","isSafeInteger","startsWith","substr","parseInt","colormap","color_scale","cmap","levels","true_cmap","replace","my_colormap","nshades","format","endsWith","reverse","getInt","getScale","getHex","ceil","has_layers","app","getLayers","drawPointsEEG","locations","border_color","fill_color","radius","alpha","layer","Konva","Layer","circle","Circle","y","perfectDrawEnabled","opacity","fill","stroke","strokeWidth","drawLabelsEEG","data_positions","text","Text","toUpperCase","fontSize","fontFamily","drawMatrix","matrix","layout","title","cmap_levels","cmap_max","cmap_min","cmap_autolevel","size","pos_x","pos_y","border_width","label_color","replace_diagonals","is_new_layout","p","round","sqrt","ordered_matrix","copyWithin","sort","percentile_95","percentile_5","restrict","NaN","__matrix","colscale","colscale_","colscale_matrix","total_width","cell_width","cell_border_width","k","x0","y0","rect","Rect","text_height","rotation","title_text","fontStyle","fontVariant","drawMatrices","matrices","layouts","titles","shift_x","update","new_matrix","batchDraw","drawLine","line_color","max_points","scale_x","scale_y","line_width","spline_tension","points","Line","_true_points","move","tension","true_points","mean_y","mean2_y","std_y","drawLines","signal_timepoint","labels","shift_y","is_new","update_all","multitimepoint","drawArrow","link","positions","value_levels","value_max","value_min","line_width_max","line_width_min","alpha_max","alpha_min","Arrow","src","dst","lag","n0","x1","y1","n1","relative_val","pointerLength","pointerWidth","drawArrows","links","value_autolevel","link_number","animate","anim","Animation","frame","_base_points","period","w","cos","time","PI","new_link","total_links","new_links","filter_links","L","_new_links","_new_links_a","percentile_threshold","drawScale","colscale_levels","cell_height","col","min_label","max_label","update_range","to_scientific_notation","toExponential","zero_matrix","M","matrix2","random_matrix","random_point","random_links","number_links","uniform","bindRaf","isRunning","that","args","run","requestAnimationFrame","create_links","link_arrows","settings","animation","mainmap_number_links","arrow_cmap","arrow_value_levels","arrow_value_max","arrow_value_min","arrow_line_width_max","arrow_line_width_min","arrow_line_alpha_max","arrow_line_alpha_min","create_lines","new_timepoint","lines","timeseries_cmap","timeseries_max_points","timeseries_scale_y","timeseries_pos_x","timeseries_pos_y","timeseries_width","timeseries_height","timeseries_line_width","timeseries_alpha","timeseries_spline_tension","objectKeysToLowerCase","key","newobj","toLowerCase","getMinMaxInMatrix","link_matrix","draw_animation","canvas_element","canvas_params","Stage","container","_app","image_background","getComputedStyle","querySelector","backgroundImage","had_layer","shape","_shape","Image","fromURL","imgNode","fillPatternImage","image","eeg_locations","brain_width","brain_height","brain_top","brain_left","timeseries","_data_positions","brain_nodes_border_color","brain_nodes_fill_color","brain_nodes_radius","connectivity_matrix","mainmap_cmap","mainmap_cmap_levels","mainmap_cmap_max","mainmap_cmap_min","mainmap_size","mainmap_left","mainmap_top","mainmap_border_color","mainmap_border_width","mainmap_label_color","connectivity_matrix_scale","lag_dependency_matrix","lagmap_cmap","lagmap_cmap_levels","lagmap_cmap_max","lagmap_cmap_min","lagmap_size","lagmap_left","lagmap_top","lagmap_border_color","lagmap_border_width","lagmap_label_color","lag_dependency_matrix_scale","spectral_connectivity_matrices","minimap_cmap","minimap_cmap_levels","minimap_cmap_max","minimap_cmap_min","minimap_size","minimap_left","minimap_top","minimap_separation_x","minimap_border_color","minimap_border_width","minimap_label_color","connectivity_arrows","connectivity_arrows_scale","fill_matrix","X","X1","update_connectivity","ranges","update_lag_dependency","update_connectivity_delta","update_connectivity_theta","update_connectivity_alpha","update_connectivity_beta","update_connectivity_gamma","update_connectivity_arrows","update_timeseries","showWarnings","server_settings","server_config","app_provider","document","getElementById","_animation","_links","export_canvas_animation","target_element","body","show_video","canvas","_canvas","rec","stop","chunks","captureStream","MediaRecorder","ondataavailable","onstop","show","Blob","blob","classList","vid","createElement","URL","createObjectURL","controls","download","href","textContent","appendChild","video_recording","OVERLAY_ID","OldModule","bundle","Module","moduleName","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","hostname","location","protocol","ws","handled","assets","asset","isNew","didAccept","hmrAcceptCheck","parcelRequire","every","generated","js","clear","hmrApply","hmrAcceptRun","reload","onclose","removeErrorOverlay","message","stack","overlay","createErrorOverlay","stackTrace","innerText","innerHTML","getParents","modules","parents","dep","deps","cached","cache","some","cb"],"mappings":"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,GAAcA,KAAd;eAE8UA;;;;ACxjH9U;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC94JA;;AACA;;;;AAEO,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AACrC,MAAMC,OAAO,GAAG,SAAVA,OAAU,GAAM,CAAE,CAAxB;;AACA,MAAMC,SAAS,GAAG,SAA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ALD,MAKO;AACL3P,MAAAA,UAAU,CAACmS,YAAD,EAAe,GAAf,CAAV;AACD;AACF,GATD;;AAUAA,EAAAA,YAAY;AAEZ,SAAO;AAAExZ,IAAAA,SAAS,EAATA,SAAF;AAAaqZ,IAAAA,OAAO,EAAPA;AAAb,GAAP;AACD,CAzCM;;;;;AC3IP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1gBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACr2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9vBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACngBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3VA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3rBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACtIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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A;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3FA;AACA;AACA;AACA;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AC/IA;;;;AAEO,IAAME,UAAU,GAAG,SAAbA,UAAa,CAACC,UAAD,EAAgB;AACxC,MAAIC,MAAM,CAACC,aAAP,CAAqBF,UAArB,CAAJ,EACE,OAAOA,UAAP;AACF,MAAIA,UAAU,CAACG,UAAX,CAAsB,GAAtB,CAAJ,EACEH,UAAU,GAAGA,UAAU,CAACI,MAAX,CAAkB,CAAlB,CAAb;AACF,SAAOC,QAAQ,CAACL,UAAD,EAAa,EAAb,C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","file":"animation.26573c3c.js","sourceRoot":"..","sourcesContent":["/*! Kefir.js v3.8.8\n *  https://github.com/kefirjs/kefir\n */\n\nfunction createObj(proto) {\n  var F = function () {};\n  F.prototype = proto;\n  return new F();\n}\n\nfunction extend(target /*, mixin1, mixin2...*/) {\n  var length = arguments.length,\n      i = void 0,\n      prop = void 0;\n  for (i = 1; i < length; i++) {\n    for (prop in arguments[i]) {\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n}\n\nfunction inherit(Child, Parent /*, mixin1, mixin2...*/) {\n  var length = arguments.length,\n      i = void 0;\n  Child.prototype = createObj(Parent.prototype);\n  Child.prototype.constructor = Child;\n  for (i = 2; i < length; i++) {\n    extend(Child.prototype, arguments[i]);\n  }\n  return Child;\n}\n\nvar NOTHING = ['<nothing>'];\nvar END = 'end';\nvar VALUE = 'value';\nvar ERROR = 'error';\nvar ANY = 'any';\n\nfunction concat(a, b) {\n  var result = void 0,\n      length = void 0,\n      i = void 0,\n      j = void 0;\n  if (a.length === 0) {\n    return b;\n  }\n  if (b.length === 0) {\n    return a;\n  }\n  j = 0;\n  result = new Array(a.length + b.length);\n  length = a.length;\n  for (i = 0; i < length; i++, j++) {\n    result[j] = a[i];\n  }\n  length = b.length;\n  for (i = 0; i < length; i++, j++) {\n    result[j] = b[i];\n  }\n  return result;\n}\n\nfunction find(arr, value) {\n  var length = arr.length,\n      i = void 0;\n  for (i = 0; i < length; i++) {\n    if (arr[i] === value) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nfunction findByPred(arr, pred) {\n  var length = arr.length,\n      i = void 0;\n  for (i = 0; i < length; i++) {\n    if (pred(arr[i])) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nfunction cloneArray(input) {\n  var length = input.length,\n      result = new Array(length),\n      i = void 0;\n  for (i = 0; i < length; i++) {\n    result[i] = input[i];\n  }\n  return result;\n}\n\nfunction remove(input, index) {\n  var length = input.length,\n      result = void 0,\n      i = void 0,\n      j = void 0;\n  if (index >= 0 && index < length) {\n    if (length === 1) {\n      return [];\n    } else {\n      result = new Array(length - 1);\n      for (i = 0, j = 0; i < length; i++) {\n        if (i !== index) {\n          result[j] = input[i];\n          j++;\n        }\n      }\n      return result;\n    }\n  } else {\n    return input;\n  }\n}\n\nfunction map(input, fn) {\n  var length = input.length,\n      result = new Array(length),\n      i = void 0;\n  for (i = 0; i < length; i++) {\n    result[i] = fn(input[i]);\n  }\n  return result;\n}\n\nfunction forEach(arr, fn) {\n  var length = arr.length,\n      i = void 0;\n  for (i = 0; i < length; i++) {\n    fn(arr[i]);\n  }\n}\n\nfunction fillArray(arr, value) {\n  var length = arr.length,\n      i = void 0;\n  for (i = 0; i < length; i++) {\n    arr[i] = value;\n  }\n}\n\nfunction contains(arr, value) {\n  return find(arr, value) !== -1;\n}\n\nfunction slide(cur, next, max) {\n  var length = Math.min(max, cur.length + 1),\n      offset = cur.length - length + 1,\n      result = new Array(length),\n      i = void 0;\n  for (i = offset; i < length; i++) {\n    result[i - offset] = cur[i];\n  }\n  result[length - 1] = next;\n  return result;\n}\n\nfunction callSubscriber(type, fn, event) {\n  if (type === ANY) {\n    fn(event);\n  } else if (type === event.type) {\n    if (type === VALUE || type === ERROR) {\n      fn(event.value);\n    } else {\n      fn();\n    }\n  }\n}\n\nfunction Dispatcher() {\n  this._items = [];\n  this._spies = [];\n  this._inLoop = 0;\n  this._removedItems = null;\n}\n\nextend(Dispatcher.prototype, {\n  add: function (type, fn) {\n    this._items = concat(this._items, [{ type: type, fn: fn }]);\n    return this._items.length;\n  },\n  remove: function (type, fn) {\n    var index = findByPred(this._items, function (x) {\n      return x.type === type && x.fn === fn;\n    });\n\n    // if we're currently in a notification loop,\n    // remember this subscriber was removed\n    if (this._inLoop !== 0 && index !== -1) {\n      if (this._removedItems === null) {\n        this._removedItems = [];\n      }\n      this._removedItems.push(this._items[index]);\n    }\n\n    this._items = remove(this._items, index);\n    return this._items.length;\n  },\n  addSpy: function (fn) {\n    this._spies = concat(this._spies, [fn]);\n    return this._spies.length;\n  },\n\n\n  // Because spies are only ever a function that perform logging as\n  // their only side effect, we don't need the same complicated\n  // removal logic like in remove()\n  removeSpy: function (fn) {\n    this._spies = remove(this._spies, this._spies.indexOf(fn));\n    return this._spies.length;\n  },\n  dispatch: function (event) {\n    this._inLoop++;\n    for (var i = 0, spies = this._spies; this._spies !== null && i < spies.length; i++) {\n      spies[i](event);\n    }\n\n    for (var _i = 0, items = this._items; _i < items.length; _i++) {\n      // cleanup was called\n      if (this._items === null) {\n        break;\n      }\n\n      // this subscriber was removed\n      if (this._removedItems !== null && contains(this._removedItems, items[_i])) {\n        continue;\n      }\n\n      callSubscriber(items[_i].type, items[_i].fn, event);\n    }\n    this._inLoop--;\n    if (this._inLoop === 0) {\n      this._removedItems = null;\n    }\n  },\n  cleanup: function () {\n    this._items = null;\n    this._spies = null;\n  }\n});\n\nfunction Observable() {\n  this._dispatcher = new Dispatcher();\n  this._active = false;\n  this._alive = true;\n  this._activating = false;\n  this._logHandlers = null;\n  this._spyHandlers = null;\n}\n\nextend(Observable.prototype, {\n  _name: 'observable',\n\n  _onActivation: function () {},\n  _onDeactivation: function () {},\n  _setActive: function (active) {\n    if (this._active !== active) {\n      this._active = active;\n      if (active) {\n        this._activating = true;\n        this._onActivation();\n        this._activating = false;\n      } else {\n        this._onDeactivation();\n      }\n    }\n  },\n  _clear: function () {\n    this._setActive(false);\n    this._dispatcher.cleanup();\n    this._dispatcher = null;\n    this._logHandlers = null;\n  },\n  _emit: function (type, x) {\n    switch (type) {\n      case VALUE:\n        return this._emitValue(x);\n      case ERROR:\n        return this._emitError(x);\n      case END:\n        return this._emitEnd();\n    }\n  },\n  _emitValue: function (value) {\n    if (this._alive) {\n      this._dispatcher.dispatch({ type: VALUE, value: value });\n    }\n  },\n  _emitError: function (value) {\n    if (this._alive) {\n      this._dispatcher.dispatch({ type: ERROR, value: value });\n    }\n  },\n  _emitEnd: function () {\n    if (this._alive) {\n      this._alive = false;\n      this._dispatcher.dispatch({ type: END });\n      this._clear();\n    }\n  },\n  _on: function (type, fn) {\n    if (this._alive) {\n      this._dispatcher.add(type, fn);\n      this._setActive(true);\n    } else {\n      callSubscriber(type, fn, { type: END });\n    }\n    return this;\n  },\n  _off: function (type, fn) {\n    if (this._alive) {\n      var count = this._dispatcher.remove(type, fn);\n      if (count === 0) {\n        this._setActive(false);\n      }\n    }\n    return this;\n  },\n  onValue: function (fn) {\n    return this._on(VALUE, fn);\n  },\n  onError: function (fn) {\n    return this._on(ERROR, fn);\n  },\n  onEnd: function (fn) {\n    return this._on(END, fn);\n  },\n  onAny: function (fn) {\n    return this._on(ANY, fn);\n  },\n  offValue: function (fn) {\n    return this._off(VALUE, fn);\n  },\n  offError: function (fn) {\n    return this._off(ERROR, fn);\n  },\n  offEnd: function (fn) {\n    return this._off(END, fn);\n  },\n  offAny: function (fn) {\n    return this._off(ANY, fn);\n  },\n  observe: function (observerOrOnValue, onError, onEnd) {\n    var _this = this;\n    var closed = false;\n\n    var observer = !observerOrOnValue || typeof observerOrOnValue === 'function' ? { value: observerOrOnValue, error: onError, end: onEnd } : observerOrOnValue;\n\n    var handler = function (event) {\n      if (event.type === END) {\n        closed = true;\n      }\n      if (event.type === VALUE && observer.value) {\n        observer.value(event.value);\n      } else if (event.type === ERROR && observer.error) {\n        observer.error(event.value);\n      } else if (event.type === END && observer.end) {\n        observer.end(event.value);\n      }\n    };\n\n    this.onAny(handler);\n\n    return {\n      unsubscribe: function () {\n        if (!closed) {\n          _this.offAny(handler);\n          closed = true;\n        }\n      },\n\n      get closed() {\n        return closed;\n      }\n    };\n  },\n\n\n  // A and B must be subclasses of Stream and Property (order doesn't matter)\n  _ofSameType: function (A, B) {\n    return A.prototype.getType() === this.getType() ? A : B;\n  },\n  setName: function (sourceObs /* optional */, selfName) {\n    this._name = selfName ? sourceObs._name + '.' + selfName : sourceObs;\n    return this;\n  },\n  log: function () {\n    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.toString();\n\n    var isCurrent = void 0;\n    var handler = function (event) {\n      var type = '<' + event.type + (isCurrent ? ':current' : '') + '>';\n      if (event.type === END) {\n        console.log(name, type);\n      } else {\n        console.log(name, type, event.value);\n      }\n    };\n\n    if (this._alive) {\n      if (!this._logHandlers) {\n        this._logHandlers = [];\n      }\n      this._logHandlers.push({ name: name, handler: handler });\n    }\n\n    isCurrent = true;\n    this.onAny(handler);\n    isCurrent = false;\n\n    return this;\n  },\n  offLog: function () {\n    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.toString();\n\n    if (this._logHandlers) {\n      var handlerIndex = findByPred(this._logHandlers, function (obj) {\n        return obj.name === name;\n      });\n      if (handlerIndex !== -1) {\n        this.offAny(this._logHandlers[handlerIndex].handler);\n        this._logHandlers.splice(handlerIndex, 1);\n      }\n    }\n\n    return this;\n  },\n  spy: function () {\n    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.toString();\n\n    var handler = function (event) {\n      var type = '<' + event.type + '>';\n      if (event.type === END) {\n        console.log(name, type);\n      } else {\n        console.log(name, type, event.value);\n      }\n    };\n    if (this._alive) {\n      if (!this._spyHandlers) {\n        this._spyHandlers = [];\n      }\n      this._spyHandlers.push({ name: name, handler: handler });\n      this._dispatcher.addSpy(handler);\n    }\n    return this;\n  },\n  offSpy: function () {\n    var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.toString();\n\n    if (this._spyHandlers) {\n      var handlerIndex = findByPred(this._spyHandlers, function (obj) {\n        return obj.name === name;\n      });\n      if (handlerIndex !== -1) {\n        this._dispatcher.removeSpy(this._spyHandlers[handlerIndex].handler);\n        this._spyHandlers.splice(handlerIndex, 1);\n      }\n    }\n    return this;\n  }\n});\n\n// extend() can't handle `toString` in IE8\nObservable.prototype.toString = function () {\n  return '[' + this._name + ']';\n};\n\nfunction Stream() {\n  Observable.call(this);\n}\n\ninherit(Stream, Observable, {\n  _name: 'stream',\n\n  getType: function () {\n    return 'stream';\n  }\n});\n\nfunction Property() {\n  Observable.call(this);\n  this._currentEvent = null;\n}\n\ninherit(Property, Observable, {\n  _name: 'property',\n\n  _emitValue: function (value) {\n    if (this._alive) {\n      this._currentEvent = { type: VALUE, value: value };\n      if (!this._activating) {\n        this._dispatcher.dispatch({ type: VALUE, value: value });\n      }\n    }\n  },\n  _emitError: function (value) {\n    if (this._alive) {\n      this._currentEvent = { type: ERROR, value: value };\n      if (!this._activating) {\n        this._dispatcher.dispatch({ type: ERROR, value: value });\n      }\n    }\n  },\n  _emitEnd: function () {\n    if (this._alive) {\n      this._alive = false;\n      if (!this._activating) {\n        this._dispatcher.dispatch({ type: END });\n      }\n      this._clear();\n    }\n  },\n  _on: function (type, fn) {\n    if (this._alive) {\n      this._dispatcher.add(type, fn);\n      this._setActive(true);\n    }\n    if (this._currentEvent !== null) {\n      callSubscriber(type, fn, this._currentEvent);\n    }\n    if (!this._alive) {\n      callSubscriber(type, fn, { type: END });\n    }\n    return this;\n  },\n  getType: function () {\n    return 'property';\n  }\n});\n\nvar neverS = new Stream();\nneverS._emitEnd();\nneverS._name = 'never';\n\nfunction never() {\n  return neverS;\n}\n\nfunction timeBased(mixin) {\n  function AnonymousStream(wait, options) {\n    var _this = this;\n\n    Stream.call(this);\n    this._wait = wait;\n    this._intervalId = null;\n    this._$onTick = function () {\n      return _this._onTick();\n    };\n    this._init(options);\n  }\n\n  inherit(AnonymousStream, Stream, {\n    _init: function () {},\n    _free: function () {},\n    _onTick: function () {},\n    _onActivation: function () {\n      this._intervalId = setInterval(this._$onTick, this._wait);\n    },\n    _onDeactivation: function () {\n      if (this._intervalId !== null) {\n        clearInterval(this._intervalId);\n        this._intervalId = null;\n      }\n    },\n    _clear: function () {\n      Stream.prototype._clear.call(this);\n      this._$onTick = null;\n      this._free();\n    }\n  }, mixin);\n\n  return AnonymousStream;\n}\n\nvar S = timeBased({\n  _name: 'later',\n\n  _init: function (_ref) {\n    var x = _ref.x;\n\n    this._x = x;\n  },\n  _free: function () {\n    this._x = null;\n  },\n  _onTick: function () {\n    this._emitValue(this._x);\n    this._emitEnd();\n  }\n});\n\nfunction later(wait, x) {\n  return new S(wait, { x: x });\n}\n\nvar S$1 = timeBased({\n  _name: 'interval',\n\n  _init: function (_ref) {\n    var x = _ref.x;\n\n    this._x = x;\n  },\n  _free: function () {\n    this._x = null;\n  },\n  _onTick: function () {\n    this._emitValue(this._x);\n  }\n});\n\nfunction interval(wait, x) {\n  return new S$1(wait, { x: x });\n}\n\nvar S$2 = timeBased({\n  _name: 'sequentially',\n\n  _init: function (_ref) {\n    var xs = _ref.xs;\n\n    this._xs = cloneArray(xs);\n  },\n  _free: function () {\n    this._xs = null;\n  },\n  _onTick: function () {\n    if (this._xs.length === 1) {\n      this._emitValue(this._xs[0]);\n      this._emitEnd();\n    } else {\n      this._emitValue(this._xs.shift());\n    }\n  }\n});\n\nfunction sequentially(wait, xs) {\n  return xs.length === 0 ? never() : new S$2(wait, { xs: xs });\n}\n\nvar S$3 = timeBased({\n  _name: 'fromPoll',\n\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _onTick: function () {\n    var fn = this._fn;\n    this._emitValue(fn());\n  }\n});\n\nfunction fromPoll(wait, fn) {\n  return new S$3(wait, { fn: fn });\n}\n\nfunction emitter(obs) {\n  function value(x) {\n    obs._emitValue(x);\n    return obs._active;\n  }\n\n  function error(x) {\n    obs._emitError(x);\n    return obs._active;\n  }\n\n  function end() {\n    obs._emitEnd();\n    return obs._active;\n  }\n\n  function event(e) {\n    obs._emit(e.type, e.value);\n    return obs._active;\n  }\n\n  return {\n    value: value,\n    error: error,\n    end: end,\n    event: event,\n\n    // legacy\n    emit: value,\n    emitEvent: event\n  };\n}\n\nvar S$4 = timeBased({\n  _name: 'withInterval',\n\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n    this._emitter = emitter(this);\n  },\n  _free: function () {\n    this._fn = null;\n    this._emitter = null;\n  },\n  _onTick: function () {\n    var fn = this._fn;\n    fn(this._emitter);\n  }\n});\n\nfunction withInterval(wait, fn) {\n  return new S$4(wait, { fn: fn });\n}\n\nfunction S$5(fn) {\n  Stream.call(this);\n  this._fn = fn;\n  this._unsubscribe = null;\n}\n\ninherit(S$5, Stream, {\n  _name: 'stream',\n\n  _onActivation: function () {\n    var fn = this._fn;\n    var unsubscribe = fn(emitter(this));\n    this._unsubscribe = typeof unsubscribe === 'function' ? unsubscribe : null;\n\n    // fix https://github.com/kefirjs/kefir/issues/35\n    if (!this._active) {\n      this._callUnsubscribe();\n    }\n  },\n  _callUnsubscribe: function () {\n    if (this._unsubscribe !== null) {\n      this._unsubscribe();\n      this._unsubscribe = null;\n    }\n  },\n  _onDeactivation: function () {\n    this._callUnsubscribe();\n  },\n  _clear: function () {\n    Stream.prototype._clear.call(this);\n    this._fn = null;\n  }\n});\n\nfunction stream(fn) {\n  return new S$5(fn);\n}\n\nfunction fromCallback(callbackConsumer) {\n  var called = false;\n\n  return stream(function (emitter) {\n    if (!called) {\n      callbackConsumer(function (x) {\n        emitter.emit(x);\n        emitter.end();\n      });\n      called = true;\n    }\n  }).setName('fromCallback');\n}\n\nfunction fromNodeCallback(callbackConsumer) {\n  var called = false;\n\n  return stream(function (emitter) {\n    if (!called) {\n      callbackConsumer(function (error, x) {\n        if (error) {\n          emitter.error(error);\n        } else {\n          emitter.emit(x);\n        }\n        emitter.end();\n      });\n      called = true;\n    }\n  }).setName('fromNodeCallback');\n}\n\nfunction spread(fn, length) {\n  switch (length) {\n    case 0:\n      return function () {\n        return fn();\n      };\n    case 1:\n      return function (a) {\n        return fn(a[0]);\n      };\n    case 2:\n      return function (a) {\n        return fn(a[0], a[1]);\n      };\n    case 3:\n      return function (a) {\n        return fn(a[0], a[1], a[2]);\n      };\n    case 4:\n      return function (a) {\n        return fn(a[0], a[1], a[2], a[3]);\n      };\n    default:\n      return function (a) {\n        return fn.apply(null, a);\n      };\n  }\n}\n\nfunction apply(fn, c, a) {\n  var aLength = a ? a.length : 0;\n  if (c == null) {\n    switch (aLength) {\n      case 0:\n        return fn();\n      case 1:\n        return fn(a[0]);\n      case 2:\n        return fn(a[0], a[1]);\n      case 3:\n        return fn(a[0], a[1], a[2]);\n      case 4:\n        return fn(a[0], a[1], a[2], a[3]);\n      default:\n        return fn.apply(null, a);\n    }\n  } else {\n    switch (aLength) {\n      case 0:\n        return fn.call(c);\n      default:\n        return fn.apply(c, a);\n    }\n  }\n}\n\nfunction fromSubUnsub(sub, unsub, transformer /* Function | falsey */) {\n  return stream(function (emitter) {\n    var handler = transformer ? function () {\n      emitter.emit(apply(transformer, this, arguments));\n    } : function (x) {\n      emitter.emit(x);\n    };\n\n    sub(handler);\n    return function () {\n      return unsub(handler);\n    };\n  }).setName('fromSubUnsub');\n}\n\nvar pairs = [['addEventListener', 'removeEventListener'], ['addListener', 'removeListener'], ['on', 'off']];\n\nfunction fromEvents(target, eventName, transformer) {\n  var sub = void 0,\n      unsub = void 0;\n\n  for (var i = 0; i < pairs.length; i++) {\n    if (typeof target[pairs[i][0]] === 'function' && typeof target[pairs[i][1]] === 'function') {\n      sub = pairs[i][0];\n      unsub = pairs[i][1];\n      break;\n    }\n  }\n\n  if (sub === undefined) {\n    throw new Error(\"target don't support any of \" + 'addEventListener/removeEventListener, addListener/removeListener, on/off method pair');\n  }\n\n  return fromSubUnsub(function (handler) {\n    return target[sub](eventName, handler);\n  }, function (handler) {\n    return target[unsub](eventName, handler);\n  }, transformer).setName('fromEvents');\n}\n\n// HACK:\n//   We don't call parent Class constructor, but instead putting all necessary\n//   properties into prototype to simulate ended Property\n//   (see Propperty and Observable classes).\n\nfunction P(value) {\n  this._currentEvent = { type: 'value', value: value, current: true };\n}\n\ninherit(P, Property, {\n  _name: 'constant',\n  _active: false,\n  _activating: false,\n  _alive: false,\n  _dispatcher: null,\n  _logHandlers: null\n});\n\nfunction constant(x) {\n  return new P(x);\n}\n\n// HACK:\n//   We don't call parent Class constructor, but instead putting all necessary\n//   properties into prototype to simulate ended Property\n//   (see Propperty and Observable classes).\n\nfunction P$1(value) {\n  this._currentEvent = { type: 'error', value: value, current: true };\n}\n\ninherit(P$1, Property, {\n  _name: 'constantError',\n  _active: false,\n  _activating: false,\n  _alive: false,\n  _dispatcher: null,\n  _logHandlers: null\n});\n\nfunction constantError(x) {\n  return new P$1(x);\n}\n\nfunction createConstructor(BaseClass, name) {\n  return function AnonymousObservable(source, options) {\n    var _this = this;\n\n    BaseClass.call(this);\n    this._source = source;\n    this._name = source._name + '.' + name;\n    this._init(options);\n    this._$handleAny = function (event) {\n      return _this._handleAny(event);\n    };\n  };\n}\n\nfunction createClassMethods(BaseClass) {\n  return {\n    _init: function () {},\n    _free: function () {},\n    _handleValue: function (x) {\n      this._emitValue(x);\n    },\n    _handleError: function (x) {\n      this._emitError(x);\n    },\n    _handleEnd: function () {\n      this._emitEnd();\n    },\n    _handleAny: function (event) {\n      switch (event.type) {\n        case VALUE:\n          return this._handleValue(event.value);\n        case ERROR:\n          return this._handleError(event.value);\n        case END:\n          return this._handleEnd();\n      }\n    },\n    _onActivation: function () {\n      this._source.onAny(this._$handleAny);\n    },\n    _onDeactivation: function () {\n      this._source.offAny(this._$handleAny);\n    },\n    _clear: function () {\n      BaseClass.prototype._clear.call(this);\n      this._source = null;\n      this._$handleAny = null;\n      this._free();\n    }\n  };\n}\n\nfunction createStream(name, mixin) {\n  var S = createConstructor(Stream, name);\n  inherit(S, Stream, createClassMethods(Stream), mixin);\n  return S;\n}\n\nfunction createProperty(name, mixin) {\n  var P = createConstructor(Property, name);\n  inherit(P, Property, createClassMethods(Property), mixin);\n  return P;\n}\n\nvar P$2 = createProperty('toProperty', {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._getInitialCurrent = fn;\n  },\n  _onActivation: function () {\n    if (this._getInitialCurrent !== null) {\n      var getInitial = this._getInitialCurrent;\n      this._emitValue(getInitial());\n    }\n    this._source.onAny(this._$handleAny); // copied from patterns/one-source\n  }\n});\n\nfunction toProperty(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n\n  if (fn !== null && typeof fn !== 'function') {\n    throw new Error('You should call toProperty() with a function or no arguments.');\n  }\n  return new P$2(obs, { fn: fn });\n}\n\nvar S$6 = createStream('changes', {\n  _handleValue: function (x) {\n    if (!this._activating) {\n      this._emitValue(x);\n    }\n  },\n  _handleError: function (x) {\n    if (!this._activating) {\n      this._emitError(x);\n    }\n  }\n});\n\nfunction changes(obs) {\n  return new S$6(obs);\n}\n\nfunction fromPromise(promise) {\n  var called = false;\n\n  var result = stream(function (emitter) {\n    if (!called) {\n      var onValue = function (x) {\n        emitter.emit(x);\n        emitter.end();\n      };\n      var onError = function (x) {\n        emitter.error(x);\n        emitter.end();\n      };\n      var _promise = promise.then(onValue, onError);\n\n      // prevent libraries like 'Q' or 'when' from swallowing exceptions\n      if (_promise && typeof _promise.done === 'function') {\n        _promise.done();\n      }\n\n      called = true;\n    }\n  });\n\n  return toProperty(result, null).setName('fromPromise');\n}\n\nfunction getGlodalPromise() {\n  if (typeof Promise === 'function') {\n    return Promise;\n  } else {\n    throw new Error(\"There isn't default Promise, use shim or parameter\");\n  }\n}\n\nvar toPromise = function (obs) {\n  var Promise = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getGlodalPromise();\n\n  var last = null;\n  return new Promise(function (resolve, reject) {\n    obs.onAny(function (event) {\n      if (event.type === END && last !== null) {\n        (last.type === VALUE ? resolve : reject)(last.value);\n        last = null;\n      } else {\n        last = event;\n      }\n    });\n  });\n};\n\nfunction symbolObservablePonyfill(root) {\n\tvar result;\n\tvar Symbol = root.Symbol;\n\n\tif (typeof Symbol === 'function') {\n\t\tif (Symbol.observable) {\n\t\t\tresult = Symbol.observable;\n\t\t} else {\n\t\t\tresult = Symbol('observable');\n\t\t\tSymbol.observable = result;\n\t\t}\n\t} else {\n\t\tresult = '@@observable';\n\t}\n\n\treturn result;\n}\n\n/* global window */\nvar root;\n\nif (typeof self !== 'undefined') {\n  root = self;\n} else if (typeof window !== 'undefined') {\n  root = window;\n} else if (typeof global !== 'undefined') {\n  root = global;\n} else if (typeof module !== 'undefined') {\n  root = module;\n} else {\n  root = Function('return this')();\n}\n\nvar result = symbolObservablePonyfill(root);\n\n// this file contains some hot JS modules systems stuff\n\nvar $$observable = result.default ? result.default : result;\n\nfunction fromESObservable(_observable) {\n  var observable = _observable[$$observable] ? _observable[$$observable]() : _observable;\n  return stream(function (emitter) {\n    var unsub = observable.subscribe({\n      error: function (error) {\n        emitter.error(error);\n        emitter.end();\n      },\n      next: function (value) {\n        emitter.emit(value);\n      },\n      complete: function () {\n        emitter.end();\n      }\n    });\n\n    if (unsub.unsubscribe) {\n      return function () {\n        unsub.unsubscribe();\n      };\n    } else {\n      return unsub;\n    }\n  }).setName('fromESObservable');\n}\n\nfunction ESObservable(observable) {\n  this._observable = observable.takeErrors(1);\n}\n\nextend(ESObservable.prototype, {\n  subscribe: function (observerOrOnNext, onError, onComplete) {\n    var _this = this;\n\n    var observer = typeof observerOrOnNext === 'function' ? { next: observerOrOnNext, error: onError, complete: onComplete } : observerOrOnNext;\n\n    var fn = function (event) {\n      if (event.type === END) {\n        closed = true;\n      }\n\n      if (event.type === VALUE && observer.next) {\n        observer.next(event.value);\n      } else if (event.type === ERROR && observer.error) {\n        observer.error(event.value);\n      } else if (event.type === END && observer.complete) {\n        observer.complete(event.value);\n      }\n    };\n\n    this._observable.onAny(fn);\n    var closed = false;\n\n    var subscription = {\n      unsubscribe: function () {\n        closed = true;\n        _this._observable.offAny(fn);\n      },\n      get closed() {\n        return closed;\n      }\n    };\n    return subscription;\n  }\n});\n\n// Need to assign directly b/c Symbols aren't enumerable.\nESObservable.prototype[$$observable] = function () {\n  return this;\n};\n\nfunction toESObservable() {\n  return new ESObservable(this);\n}\n\nfunction collect(source, keys, values) {\n  for (var prop in source) {\n    if (source.hasOwnProperty(prop)) {\n      keys.push(prop);\n      values.push(source[prop]);\n    }\n  }\n}\n\nfunction defaultErrorsCombinator(errors) {\n  var latestError = void 0;\n  for (var i = 0; i < errors.length; i++) {\n    if (errors[i] !== undefined) {\n      if (latestError === undefined || latestError.index < errors[i].index) {\n        latestError = errors[i];\n      }\n    }\n  }\n  return latestError.error;\n}\n\nfunction Combine(active, passive, combinator) {\n  var _this = this;\n\n  Stream.call(this);\n  this._activeCount = active.length;\n  this._sources = concat(active, passive);\n  this._combinator = combinator;\n  this._aliveCount = 0;\n  this._latestValues = new Array(this._sources.length);\n  this._latestErrors = new Array(this._sources.length);\n  fillArray(this._latestValues, NOTHING);\n  this._emitAfterActivation = false;\n  this._endAfterActivation = false;\n  this._latestErrorIndex = 0;\n\n  this._$handlers = [];\n\n  var _loop = function (i) {\n    _this._$handlers.push(function (event) {\n      return _this._handleAny(i, event);\n    });\n  };\n\n  for (var i = 0; i < this._sources.length; i++) {\n    _loop(i);\n  }\n}\n\ninherit(Combine, Stream, {\n  _name: 'combine',\n\n  _onActivation: function () {\n    this._aliveCount = this._activeCount;\n\n    // we need to suscribe to _passive_ sources before _active_\n    // (see https://github.com/kefirjs/kefir/issues/98)\n    for (var i = this._activeCount; i < this._sources.length; i++) {\n      this._sources[i].onAny(this._$handlers[i]);\n    }\n    for (var _i = 0; _i < this._activeCount; _i++) {\n      this._sources[_i].onAny(this._$handlers[_i]);\n    }\n\n    if (this._emitAfterActivation) {\n      this._emitAfterActivation = false;\n      this._emitIfFull();\n    }\n    if (this._endAfterActivation) {\n      this._emitEnd();\n    }\n  },\n  _onDeactivation: function () {\n    var length = this._sources.length,\n        i = void 0;\n    for (i = 0; i < length; i++) {\n      this._sources[i].offAny(this._$handlers[i]);\n    }\n  },\n  _emitIfFull: function () {\n    var hasAllValues = true;\n    var hasErrors = false;\n    var length = this._latestValues.length;\n    var valuesCopy = new Array(length);\n    var errorsCopy = new Array(length);\n\n    for (var i = 0; i < length; i++) {\n      valuesCopy[i] = this._latestValues[i];\n      errorsCopy[i] = this._latestErrors[i];\n\n      if (valuesCopy[i] === NOTHING) {\n        hasAllValues = false;\n      }\n\n      if (errorsCopy[i] !== undefined) {\n        hasErrors = true;\n      }\n    }\n\n    if (hasAllValues) {\n      var combinator = this._combinator;\n      this._emitValue(combinator(valuesCopy));\n    }\n    if (hasErrors) {\n      this._emitError(defaultErrorsCombinator(errorsCopy));\n    }\n  },\n  _handleAny: function (i, event) {\n    if (event.type === VALUE || event.type === ERROR) {\n      if (event.type === VALUE) {\n        this._latestValues[i] = event.value;\n        this._latestErrors[i] = undefined;\n      }\n      if (event.type === ERROR) {\n        this._latestValues[i] = NOTHING;\n        this._latestErrors[i] = {\n          index: this._latestErrorIndex++,\n          error: event.value\n        };\n      }\n\n      if (i < this._activeCount) {\n        if (this._activating) {\n          this._emitAfterActivation = true;\n        } else {\n          this._emitIfFull();\n        }\n      }\n    } else {\n      // END\n\n      if (i < this._activeCount) {\n        this._aliveCount--;\n        if (this._aliveCount === 0) {\n          if (this._activating) {\n            this._endAfterActivation = true;\n          } else {\n            this._emitEnd();\n          }\n        }\n      }\n    }\n  },\n  _clear: function () {\n    Stream.prototype._clear.call(this);\n    this._sources = null;\n    this._latestValues = null;\n    this._latestErrors = null;\n    this._combinator = null;\n    this._$handlers = null;\n  }\n});\n\nfunction combineAsArray(active) {\n  var passive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n  var combinator = arguments[2];\n\n  if (!Array.isArray(passive)) {\n    throw new Error('Combine can only combine active and passive collections of the same type.');\n  }\n\n  combinator = combinator ? spread(combinator, active.length + passive.length) : function (x) {\n    return x;\n  };\n  return active.length === 0 ? never() : new Combine(active, passive, combinator);\n}\n\nfunction combineAsObject(active) {\n  var passive = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var combinator = arguments[2];\n\n  if (typeof passive !== 'object' || Array.isArray(passive)) {\n    throw new Error('Combine can only combine active and passive collections of the same type.');\n  }\n\n  var keys = [],\n      activeObservables = [],\n      passiveObservables = [];\n\n  collect(active, keys, activeObservables);\n  collect(passive, keys, passiveObservables);\n\n  var objectify = function (values) {\n    var event = {};\n    for (var i = values.length - 1; 0 <= i; i--) {\n      event[keys[i]] = values[i];\n    }\n    return combinator ? combinator(event) : event;\n  };\n\n  return activeObservables.length === 0 ? never() : new Combine(activeObservables, passiveObservables, objectify);\n}\n\nfunction combine(active, passive, combinator) {\n  if (typeof passive === 'function') {\n    combinator = passive;\n    passive = undefined;\n  }\n\n  return Array.isArray(active) ? combineAsArray(active, passive, combinator) : combineAsObject(active, passive, combinator);\n}\n\nvar Observable$2 = {\n  empty: function () {\n    return never();\n  },\n\n\n  // Monoid based on merge() seems more useful than one based on concat().\n  concat: function (a, b) {\n    return a.merge(b);\n  },\n  of: function (x) {\n    return constant(x);\n  },\n  map: function (fn, obs) {\n    return obs.map(fn);\n  },\n  bimap: function (fnErr, fnVal, obs) {\n    return obs.mapErrors(fnErr).map(fnVal);\n  },\n\n\n  // This ap strictly speaking incompatible with chain. If we derive ap from chain we get\n  // different (not very useful) behavior. But spec requires that if method can be derived\n  // it must have the same behavior as hand-written method. We intentionally violate the spec\n  // in hope that it won't cause many troubles in practice. And in return we have more useful type.\n  ap: function (obsFn, obsVal) {\n    return combine([obsFn, obsVal], function (fn, val) {\n      return fn(val);\n    });\n  },\n  chain: function (fn, obs) {\n    return obs.flatMap(fn);\n  }\n};\n\n\n\nvar staticLand = Object.freeze({\n\tObservable: Observable$2\n});\n\nvar mixin = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    this._emitValue(fn(x));\n  }\n};\n\nvar S$7 = createStream('map', mixin);\nvar P$3 = createProperty('map', mixin);\n\nvar id = function (x) {\n  return x;\n};\n\nfunction map$1(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : id;\n\n  return new (obs._ofSameType(S$7, P$3))(obs, { fn: fn });\n}\n\nvar mixin$1 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    if (fn(x)) {\n      this._emitValue(x);\n    }\n  }\n};\n\nvar S$8 = createStream('filter', mixin$1);\nvar P$4 = createProperty('filter', mixin$1);\n\nvar id$1 = function (x) {\n  return x;\n};\n\nfunction filter(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : id$1;\n\n  return new (obs._ofSameType(S$8, P$4))(obs, { fn: fn });\n}\n\nvar mixin$2 = {\n  _init: function (_ref) {\n    var n = _ref.n;\n\n    this._n = n;\n    if (n <= 0) {\n      this._emitEnd();\n    }\n  },\n  _handleValue: function (x) {\n    if (this._n === 0) {\n      return;\n    }\n    this._n--;\n    this._emitValue(x);\n    if (this._n === 0) {\n      this._emitEnd();\n    }\n  }\n};\n\nvar S$9 = createStream('take', mixin$2);\nvar P$5 = createProperty('take', mixin$2);\n\nfunction take(obs, n) {\n  return new (obs._ofSameType(S$9, P$5))(obs, { n: n });\n}\n\nvar mixin$3 = {\n  _init: function (_ref) {\n    var n = _ref.n;\n\n    this._n = n;\n    if (n <= 0) {\n      this._emitEnd();\n    }\n  },\n  _handleError: function (x) {\n    if (this._n === 0) {\n      return;\n    }\n    this._n--;\n    this._emitError(x);\n    if (this._n === 0) {\n      this._emitEnd();\n    }\n  }\n};\n\nvar S$10 = createStream('takeErrors', mixin$3);\nvar P$6 = createProperty('takeErrors', mixin$3);\n\nfunction takeErrors(obs, n) {\n  return new (obs._ofSameType(S$10, P$6))(obs, { n: n });\n}\n\nvar mixin$4 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    if (fn(x)) {\n      this._emitValue(x);\n    } else {\n      this._emitEnd();\n    }\n  }\n};\n\nvar S$11 = createStream('takeWhile', mixin$4);\nvar P$7 = createProperty('takeWhile', mixin$4);\n\nvar id$2 = function (x) {\n  return x;\n};\n\nfunction takeWhile(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : id$2;\n\n  return new (obs._ofSameType(S$11, P$7))(obs, { fn: fn });\n}\n\nvar mixin$5 = {\n  _init: function () {\n    this._lastValue = NOTHING;\n  },\n  _free: function () {\n    this._lastValue = null;\n  },\n  _handleValue: function (x) {\n    this._lastValue = x;\n  },\n  _handleEnd: function () {\n    if (this._lastValue !== NOTHING) {\n      this._emitValue(this._lastValue);\n    }\n    this._emitEnd();\n  }\n};\n\nvar S$12 = createStream('last', mixin$5);\nvar P$8 = createProperty('last', mixin$5);\n\nfunction last(obs) {\n  return new (obs._ofSameType(S$12, P$8))(obs);\n}\n\nvar mixin$6 = {\n  _init: function (_ref) {\n    var n = _ref.n;\n\n    this._n = Math.max(0, n);\n  },\n  _handleValue: function (x) {\n    if (this._n === 0) {\n      this._emitValue(x);\n    } else {\n      this._n--;\n    }\n  }\n};\n\nvar S$13 = createStream('skip', mixin$6);\nvar P$9 = createProperty('skip', mixin$6);\n\nfunction skip(obs, n) {\n  return new (obs._ofSameType(S$13, P$9))(obs, { n: n });\n}\n\nvar mixin$7 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    if (this._fn !== null && !fn(x)) {\n      this._fn = null;\n    }\n    if (this._fn === null) {\n      this._emitValue(x);\n    }\n  }\n};\n\nvar S$14 = createStream('skipWhile', mixin$7);\nvar P$10 = createProperty('skipWhile', mixin$7);\n\nvar id$3 = function (x) {\n  return x;\n};\n\nfunction skipWhile(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : id$3;\n\n  return new (obs._ofSameType(S$14, P$10))(obs, { fn: fn });\n}\n\nvar mixin$8 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n    this._prev = NOTHING;\n  },\n  _free: function () {\n    this._fn = null;\n    this._prev = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    if (this._prev === NOTHING || !fn(this._prev, x)) {\n      this._prev = x;\n      this._emitValue(x);\n    }\n  }\n};\n\nvar S$15 = createStream('skipDuplicates', mixin$8);\nvar P$11 = createProperty('skipDuplicates', mixin$8);\n\nvar eq = function (a, b) {\n  return a === b;\n};\n\nfunction skipDuplicates(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : eq;\n\n  return new (obs._ofSameType(S$15, P$11))(obs, { fn: fn });\n}\n\nvar mixin$9 = {\n  _init: function (_ref) {\n    var fn = _ref.fn,\n        seed = _ref.seed;\n\n    this._fn = fn;\n    this._prev = seed;\n  },\n  _free: function () {\n    this._prev = null;\n    this._fn = null;\n  },\n  _handleValue: function (x) {\n    if (this._prev !== NOTHING) {\n      var fn = this._fn;\n      this._emitValue(fn(this._prev, x));\n    }\n    this._prev = x;\n  }\n};\n\nvar S$16 = createStream('diff', mixin$9);\nvar P$12 = createProperty('diff', mixin$9);\n\nfunction defaultFn(a, b) {\n  return [a, b];\n}\n\nfunction diff(obs, fn) {\n  var seed = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : NOTHING;\n\n  return new (obs._ofSameType(S$16, P$12))(obs, { fn: fn || defaultFn, seed: seed });\n}\n\nvar P$13 = createProperty('scan', {\n  _init: function (_ref) {\n    var fn = _ref.fn,\n        seed = _ref.seed;\n\n    this._fn = fn;\n    this._seed = seed;\n    if (seed !== NOTHING) {\n      this._emitValue(seed);\n    }\n  },\n  _free: function () {\n    this._fn = null;\n    this._seed = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    if (this._currentEvent === null || this._currentEvent.type === ERROR) {\n      this._emitValue(this._seed === NOTHING ? x : fn(this._seed, x));\n    } else {\n      this._emitValue(fn(this._currentEvent.value, x));\n    }\n  }\n});\n\nfunction scan(obs, fn) {\n  var seed = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : NOTHING;\n\n  return new P$13(obs, { fn: fn, seed: seed });\n}\n\nvar mixin$10 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    var xs = fn(x);\n    for (var i = 0; i < xs.length; i++) {\n      this._emitValue(xs[i]);\n    }\n  }\n};\n\nvar S$17 = createStream('flatten', mixin$10);\n\nvar id$4 = function (x) {\n  return x;\n};\n\nfunction flatten(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : id$4;\n\n  return new S$17(obs, { fn: fn });\n}\n\nvar END_MARKER = {};\n\nvar mixin$11 = {\n  _init: function (_ref) {\n    var _this = this;\n\n    var wait = _ref.wait;\n\n    this._wait = Math.max(0, wait);\n    this._buff = [];\n    this._$shiftBuff = function () {\n      var value = _this._buff.shift();\n      if (value === END_MARKER) {\n        _this._emitEnd();\n      } else {\n        _this._emitValue(value);\n      }\n    };\n  },\n  _free: function () {\n    this._buff = null;\n    this._$shiftBuff = null;\n  },\n  _handleValue: function (x) {\n    if (this._activating) {\n      this._emitValue(x);\n    } else {\n      this._buff.push(x);\n      setTimeout(this._$shiftBuff, this._wait);\n    }\n  },\n  _handleEnd: function () {\n    if (this._activating) {\n      this._emitEnd();\n    } else {\n      this._buff.push(END_MARKER);\n      setTimeout(this._$shiftBuff, this._wait);\n    }\n  }\n};\n\nvar S$18 = createStream('delay', mixin$11);\nvar P$14 = createProperty('delay', mixin$11);\n\nfunction delay(obs, wait) {\n  return new (obs._ofSameType(S$18, P$14))(obs, { wait: wait });\n}\n\nvar now = Date.now ? function () {\n  return Date.now();\n} : function () {\n  return new Date().getTime();\n};\n\nvar mixin$12 = {\n  _init: function (_ref) {\n    var _this = this;\n\n    var wait = _ref.wait,\n        leading = _ref.leading,\n        trailing = _ref.trailing;\n\n    this._wait = Math.max(0, wait);\n    this._leading = leading;\n    this._trailing = trailing;\n    this._trailingValue = null;\n    this._timeoutId = null;\n    this._endLater = false;\n    this._lastCallTime = 0;\n    this._$trailingCall = function () {\n      return _this._trailingCall();\n    };\n  },\n  _free: function () {\n    this._trailingValue = null;\n    this._$trailingCall = null;\n  },\n  _handleValue: function (x) {\n    if (this._activating) {\n      this._emitValue(x);\n    } else {\n      var curTime = now();\n      if (this._lastCallTime === 0 && !this._leading) {\n        this._lastCallTime = curTime;\n      }\n      var remaining = this._wait - (curTime - this._lastCallTime);\n      if (remaining <= 0) {\n        this._cancelTrailing();\n        this._lastCallTime = curTime;\n        this._emitValue(x);\n      } else if (this._trailing) {\n        this._cancelTrailing();\n        this._trailingValue = x;\n        this._timeoutId = setTimeout(this._$trailingCall, remaining);\n      }\n    }\n  },\n  _handleEnd: function () {\n    if (this._activating) {\n      this._emitEnd();\n    } else {\n      if (this._timeoutId) {\n        this._endLater = true;\n      } else {\n        this._emitEnd();\n      }\n    }\n  },\n  _cancelTrailing: function () {\n    if (this._timeoutId !== null) {\n      clearTimeout(this._timeoutId);\n      this._timeoutId = null;\n    }\n  },\n  _trailingCall: function () {\n    this._emitValue(this._trailingValue);\n    this._timeoutId = null;\n    this._trailingValue = null;\n    this._lastCallTime = !this._leading ? 0 : now();\n    if (this._endLater) {\n      this._emitEnd();\n    }\n  }\n};\n\nvar S$19 = createStream('throttle', mixin$12);\nvar P$15 = createProperty('throttle', mixin$12);\n\nfunction throttle(obs, wait) {\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$leading = _ref2.leading,\n      leading = _ref2$leading === undefined ? true : _ref2$leading,\n      _ref2$trailing = _ref2.trailing,\n      trailing = _ref2$trailing === undefined ? true : _ref2$trailing;\n\n  return new (obs._ofSameType(S$19, P$15))(obs, { wait: wait, leading: leading, trailing: trailing });\n}\n\nvar mixin$13 = {\n  _init: function (_ref) {\n    var _this = this;\n\n    var wait = _ref.wait,\n        immediate = _ref.immediate;\n\n    this._wait = Math.max(0, wait);\n    this._immediate = immediate;\n    this._lastAttempt = 0;\n    this._timeoutId = null;\n    this._laterValue = null;\n    this._endLater = false;\n    this._$later = function () {\n      return _this._later();\n    };\n  },\n  _free: function () {\n    this._laterValue = null;\n    this._$later = null;\n  },\n  _handleValue: function (x) {\n    if (this._activating) {\n      this._emitValue(x);\n    } else {\n      this._lastAttempt = now();\n      if (this._immediate && !this._timeoutId) {\n        this._emitValue(x);\n      }\n      if (!this._timeoutId) {\n        this._timeoutId = setTimeout(this._$later, this._wait);\n      }\n      if (!this._immediate) {\n        this._laterValue = x;\n      }\n    }\n  },\n  _handleEnd: function () {\n    if (this._activating) {\n      this._emitEnd();\n    } else {\n      if (this._timeoutId && !this._immediate) {\n        this._endLater = true;\n      } else {\n        this._emitEnd();\n      }\n    }\n  },\n  _later: function () {\n    var last = now() - this._lastAttempt;\n    if (last < this._wait && last >= 0) {\n      this._timeoutId = setTimeout(this._$later, this._wait - last);\n    } else {\n      this._timeoutId = null;\n      if (!this._immediate) {\n        var _laterValue = this._laterValue;\n        this._laterValue = null;\n        this._emitValue(_laterValue);\n      }\n      if (this._endLater) {\n        this._emitEnd();\n      }\n    }\n  }\n};\n\nvar S$20 = createStream('debounce', mixin$13);\nvar P$16 = createProperty('debounce', mixin$13);\n\nfunction debounce(obs, wait) {\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$immediate = _ref2.immediate,\n      immediate = _ref2$immediate === undefined ? false : _ref2$immediate;\n\n  return new (obs._ofSameType(S$20, P$16))(obs, { wait: wait, immediate: immediate });\n}\n\nvar mixin$14 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleError: function (x) {\n    var fn = this._fn;\n    this._emitError(fn(x));\n  }\n};\n\nvar S$21 = createStream('mapErrors', mixin$14);\nvar P$17 = createProperty('mapErrors', mixin$14);\n\nvar id$5 = function (x) {\n  return x;\n};\n\nfunction mapErrors(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : id$5;\n\n  return new (obs._ofSameType(S$21, P$17))(obs, { fn: fn });\n}\n\nvar mixin$15 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleError: function (x) {\n    var fn = this._fn;\n    if (fn(x)) {\n      this._emitError(x);\n    }\n  }\n};\n\nvar S$22 = createStream('filterErrors', mixin$15);\nvar P$18 = createProperty('filterErrors', mixin$15);\n\nvar id$6 = function (x) {\n  return x;\n};\n\nfunction filterErrors(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : id$6;\n\n  return new (obs._ofSameType(S$22, P$18))(obs, { fn: fn });\n}\n\nvar mixin$16 = {\n  _handleValue: function () {}\n};\n\nvar S$23 = createStream('ignoreValues', mixin$16);\nvar P$19 = createProperty('ignoreValues', mixin$16);\n\nfunction ignoreValues(obs) {\n  return new (obs._ofSameType(S$23, P$19))(obs);\n}\n\nvar mixin$17 = {\n  _handleError: function () {}\n};\n\nvar S$24 = createStream('ignoreErrors', mixin$17);\nvar P$20 = createProperty('ignoreErrors', mixin$17);\n\nfunction ignoreErrors(obs) {\n  return new (obs._ofSameType(S$24, P$20))(obs);\n}\n\nvar mixin$18 = {\n  _handleEnd: function () {}\n};\n\nvar S$25 = createStream('ignoreEnd', mixin$18);\nvar P$21 = createProperty('ignoreEnd', mixin$18);\n\nfunction ignoreEnd(obs) {\n  return new (obs._ofSameType(S$25, P$21))(obs);\n}\n\nvar mixin$19 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleEnd: function () {\n    var fn = this._fn;\n    this._emitValue(fn());\n    this._emitEnd();\n  }\n};\n\nvar S$26 = createStream('beforeEnd', mixin$19);\nvar P$22 = createProperty('beforeEnd', mixin$19);\n\nfunction beforeEnd(obs, fn) {\n  return new (obs._ofSameType(S$26, P$22))(obs, { fn: fn });\n}\n\nvar mixin$20 = {\n  _init: function (_ref) {\n    var min = _ref.min,\n        max = _ref.max;\n\n    this._max = max;\n    this._min = min;\n    this._buff = [];\n  },\n  _free: function () {\n    this._buff = null;\n  },\n  _handleValue: function (x) {\n    this._buff = slide(this._buff, x, this._max);\n    if (this._buff.length >= this._min) {\n      this._emitValue(this._buff);\n    }\n  }\n};\n\nvar S$27 = createStream('slidingWindow', mixin$20);\nvar P$23 = createProperty('slidingWindow', mixin$20);\n\nfunction slidingWindow(obs, max) {\n  var min = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n  return new (obs._ofSameType(S$27, P$23))(obs, { min: min, max: max });\n}\n\nvar mixin$21 = {\n  _init: function (_ref) {\n    var fn = _ref.fn,\n        flushOnEnd = _ref.flushOnEnd;\n\n    this._fn = fn;\n    this._flushOnEnd = flushOnEnd;\n    this._buff = [];\n  },\n  _free: function () {\n    this._buff = null;\n  },\n  _flush: function () {\n    if (this._buff !== null && this._buff.length !== 0) {\n      this._emitValue(this._buff);\n      this._buff = [];\n    }\n  },\n  _handleValue: function (x) {\n    this._buff.push(x);\n    var fn = this._fn;\n    if (!fn(x)) {\n      this._flush();\n    }\n  },\n  _handleEnd: function () {\n    if (this._flushOnEnd) {\n      this._flush();\n    }\n    this._emitEnd();\n  }\n};\n\nvar S$28 = createStream('bufferWhile', mixin$21);\nvar P$24 = createProperty('bufferWhile', mixin$21);\n\nvar id$7 = function (x) {\n  return x;\n};\n\nfunction bufferWhile(obs, fn) {\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$flushOnEnd = _ref2.flushOnEnd,\n      flushOnEnd = _ref2$flushOnEnd === undefined ? true : _ref2$flushOnEnd;\n\n  return new (obs._ofSameType(S$28, P$24))(obs, { fn: fn || id$7, flushOnEnd: flushOnEnd });\n}\n\nvar mixin$22 = {\n  _init: function (_ref) {\n    var count = _ref.count,\n        flushOnEnd = _ref.flushOnEnd;\n\n    this._count = count;\n    this._flushOnEnd = flushOnEnd;\n    this._buff = [];\n  },\n  _free: function () {\n    this._buff = null;\n  },\n  _flush: function () {\n    if (this._buff !== null && this._buff.length !== 0) {\n      this._emitValue(this._buff);\n      this._buff = [];\n    }\n  },\n  _handleValue: function (x) {\n    this._buff.push(x);\n    if (this._buff.length >= this._count) {\n      this._flush();\n    }\n  },\n  _handleEnd: function () {\n    if (this._flushOnEnd) {\n      this._flush();\n    }\n    this._emitEnd();\n  }\n};\n\nvar S$29 = createStream('bufferWithCount', mixin$22);\nvar P$25 = createProperty('bufferWithCount', mixin$22);\n\nfunction bufferWhile$1(obs, count) {\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$flushOnEnd = _ref2.flushOnEnd,\n      flushOnEnd = _ref2$flushOnEnd === undefined ? true : _ref2$flushOnEnd;\n\n  return new (obs._ofSameType(S$29, P$25))(obs, { count: count, flushOnEnd: flushOnEnd });\n}\n\nvar mixin$23 = {\n  _init: function (_ref) {\n    var _this = this;\n\n    var wait = _ref.wait,\n        count = _ref.count,\n        flushOnEnd = _ref.flushOnEnd;\n\n    this._wait = wait;\n    this._count = count;\n    this._flushOnEnd = flushOnEnd;\n    this._intervalId = null;\n    this._$onTick = function () {\n      return _this._flush();\n    };\n    this._buff = [];\n  },\n  _free: function () {\n    this._$onTick = null;\n    this._buff = null;\n  },\n  _flush: function () {\n    if (this._buff !== null) {\n      this._emitValue(this._buff);\n      this._buff = [];\n    }\n  },\n  _handleValue: function (x) {\n    this._buff.push(x);\n    if (this._buff.length >= this._count) {\n      clearInterval(this._intervalId);\n      this._flush();\n      this._intervalId = setInterval(this._$onTick, this._wait);\n    }\n  },\n  _handleEnd: function () {\n    if (this._flushOnEnd && this._buff.length !== 0) {\n      this._flush();\n    }\n    this._emitEnd();\n  },\n  _onActivation: function () {\n    this._intervalId = setInterval(this._$onTick, this._wait);\n    this._source.onAny(this._$handleAny); // copied from patterns/one-source\n  },\n  _onDeactivation: function () {\n    if (this._intervalId !== null) {\n      clearInterval(this._intervalId);\n      this._intervalId = null;\n    }\n    this._source.offAny(this._$handleAny); // copied from patterns/one-source\n  }\n};\n\nvar S$30 = createStream('bufferWithTimeOrCount', mixin$23);\nvar P$26 = createProperty('bufferWithTimeOrCount', mixin$23);\n\nfunction bufferWithTimeOrCount(obs, wait, count) {\n  var _ref2 = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},\n      _ref2$flushOnEnd = _ref2.flushOnEnd,\n      flushOnEnd = _ref2$flushOnEnd === undefined ? true : _ref2$flushOnEnd;\n\n  return new (obs._ofSameType(S$30, P$26))(obs, { wait: wait, count: count, flushOnEnd: flushOnEnd });\n}\n\nfunction xformForObs(obs) {\n  return {\n    '@@transducer/step': function (res, input) {\n      obs._emitValue(input);\n      return null;\n    },\n    '@@transducer/result': function () {\n      obs._emitEnd();\n      return null;\n    }\n  };\n}\n\nvar mixin$24 = {\n  _init: function (_ref) {\n    var transducer = _ref.transducer;\n\n    this._xform = transducer(xformForObs(this));\n  },\n  _free: function () {\n    this._xform = null;\n  },\n  _handleValue: function (x) {\n    if (this._xform['@@transducer/step'](null, x) !== null) {\n      this._xform['@@transducer/result'](null);\n    }\n  },\n  _handleEnd: function () {\n    this._xform['@@transducer/result'](null);\n  }\n};\n\nvar S$31 = createStream('transduce', mixin$24);\nvar P$27 = createProperty('transduce', mixin$24);\n\nfunction transduce(obs, transducer) {\n  return new (obs._ofSameType(S$31, P$27))(obs, { transducer: transducer });\n}\n\nvar mixin$25 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._handler = fn;\n    this._emitter = emitter(this);\n  },\n  _free: function () {\n    this._handler = null;\n    this._emitter = null;\n  },\n  _handleAny: function (event) {\n    this._handler(this._emitter, event);\n  }\n};\n\nvar S$32 = createStream('withHandler', mixin$25);\nvar P$28 = createProperty('withHandler', mixin$25);\n\nfunction withHandler(obs, fn) {\n  return new (obs._ofSameType(S$32, P$28))(obs, { fn: fn });\n}\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction Zip(sources, combinator) {\n  var _this = this;\n\n  Stream.call(this);\n\n  this._buffers = map(sources, function (source) {\n    return isArray(source) ? cloneArray(source) : [];\n  });\n  this._sources = map(sources, function (source) {\n    return isArray(source) ? never() : source;\n  });\n\n  this._combinator = combinator ? spread(combinator, this._sources.length) : function (x) {\n    return x;\n  };\n  this._aliveCount = 0;\n\n  this._$handlers = [];\n\n  var _loop = function (i) {\n    _this._$handlers.push(function (event) {\n      return _this._handleAny(i, event);\n    });\n  };\n\n  for (var i = 0; i < this._sources.length; i++) {\n    _loop(i);\n  }\n}\n\ninherit(Zip, Stream, {\n  _name: 'zip',\n\n  _onActivation: function () {\n    // if all sources are arrays\n    while (this._isFull()) {\n      this._emit();\n    }\n\n    var length = this._sources.length;\n    this._aliveCount = length;\n    for (var i = 0; i < length && this._active; i++) {\n      this._sources[i].onAny(this._$handlers[i]);\n    }\n  },\n  _onDeactivation: function () {\n    for (var i = 0; i < this._sources.length; i++) {\n      this._sources[i].offAny(this._$handlers[i]);\n    }\n  },\n  _emit: function () {\n    var values = new Array(this._buffers.length);\n    for (var i = 0; i < this._buffers.length; i++) {\n      values[i] = this._buffers[i].shift();\n    }\n    var combinator = this._combinator;\n    this._emitValue(combinator(values));\n  },\n  _isFull: function () {\n    for (var i = 0; i < this._buffers.length; i++) {\n      if (this._buffers[i].length === 0) {\n        return false;\n      }\n    }\n    return true;\n  },\n  _handleAny: function (i, event) {\n    if (event.type === VALUE) {\n      this._buffers[i].push(event.value);\n      if (this._isFull()) {\n        this._emit();\n      }\n    }\n    if (event.type === ERROR) {\n      this._emitError(event.value);\n    }\n    if (event.type === END) {\n      this._aliveCount--;\n      if (this._aliveCount === 0) {\n        this._emitEnd();\n      }\n    }\n  },\n  _clear: function () {\n    Stream.prototype._clear.call(this);\n    this._sources = null;\n    this._buffers = null;\n    this._combinator = null;\n    this._$handlers = null;\n  }\n});\n\nfunction zip(observables, combinator /* Function | falsey */) {\n  return observables.length === 0 ? never() : new Zip(observables, combinator);\n}\n\nvar id$8 = function (x) {\n  return x;\n};\n\nfunction AbstractPool() {\n  var _this = this;\n\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref$queueLim = _ref.queueLim,\n      queueLim = _ref$queueLim === undefined ? 0 : _ref$queueLim,\n      _ref$concurLim = _ref.concurLim,\n      concurLim = _ref$concurLim === undefined ? -1 : _ref$concurLim,\n      _ref$drop = _ref.drop,\n      drop = _ref$drop === undefined ? 'new' : _ref$drop;\n\n  Stream.call(this);\n\n  this._queueLim = queueLim < 0 ? -1 : queueLim;\n  this._concurLim = concurLim < 0 ? -1 : concurLim;\n  this._drop = drop;\n  this._queue = [];\n  this._curSources = [];\n  this._$handleSubAny = function (event) {\n    return _this._handleSubAny(event);\n  };\n  this._$endHandlers = [];\n  this._currentlyAdding = null;\n\n  if (this._concurLim === 0) {\n    this._emitEnd();\n  }\n}\n\ninherit(AbstractPool, Stream, {\n  _name: 'abstractPool',\n\n  _add: function (obj, toObs /* Function | falsey */) {\n    toObs = toObs || id$8;\n    if (this._concurLim === -1 || this._curSources.length < this._concurLim) {\n      this._addToCur(toObs(obj));\n    } else {\n      if (this._queueLim === -1 || this._queue.length < this._queueLim) {\n        this._addToQueue(toObs(obj));\n      } else if (this._drop === 'old') {\n        this._removeOldest();\n        this._add(obj, toObs);\n      }\n    }\n  },\n  _addAll: function (obss) {\n    var _this2 = this;\n\n    forEach(obss, function (obs) {\n      return _this2._add(obs);\n    });\n  },\n  _remove: function (obs) {\n    if (this._removeCur(obs) === -1) {\n      this._removeQueue(obs);\n    }\n  },\n  _addToQueue: function (obs) {\n    this._queue = concat(this._queue, [obs]);\n  },\n  _addToCur: function (obs) {\n    if (this._active) {\n      // HACK:\n      //\n      // We have two optimizations for cases when `obs` is ended. We don't want\n      // to add such observable to the list, but only want to emit events\n      // from it (if it has some).\n      //\n      // Instead of this hacks, we could just did following,\n      // but it would be 5-8 times slower:\n      //\n      //     this._curSources = concat(this._curSources, [obs]);\n      //     this._subscribe(obs);\n      //\n\n      // #1\n      // This one for cases when `obs` already ended\n      // e.g., Kefir.constant() or Kefir.never()\n      if (!obs._alive) {\n        if (obs._currentEvent) {\n          this._emit(obs._currentEvent.type, obs._currentEvent.value);\n        }\n        // The _emit above could have caused this stream to end.\n        if (this._active) {\n          if (this._queue.length !== 0) {\n            this._pullQueue();\n          } else if (this._curSources.length === 0) {\n            this._onEmpty();\n          }\n        }\n        return;\n      }\n\n      // #2\n      // This one is for cases when `obs` going to end synchronously on\n      // first subscriber e.g., Kefir.stream(em => {em.emit(1); em.end()})\n      this._currentlyAdding = obs;\n      obs.onAny(this._$handleSubAny);\n      this._currentlyAdding = null;\n      if (obs._alive) {\n        this._curSources = concat(this._curSources, [obs]);\n        if (this._active) {\n          this._subToEnd(obs);\n        }\n      } else {\n        if (this._queue.length !== 0) {\n          this._pullQueue();\n        } else if (this._curSources.length === 0) {\n          this._onEmpty();\n        }\n      }\n    } else {\n      this._curSources = concat(this._curSources, [obs]);\n    }\n  },\n  _subToEnd: function (obs) {\n    var _this3 = this;\n\n    var onEnd = function () {\n      return _this3._removeCur(obs);\n    };\n    this._$endHandlers.push({ obs: obs, handler: onEnd });\n    obs.onEnd(onEnd);\n  },\n  _subscribe: function (obs) {\n    obs.onAny(this._$handleSubAny);\n\n    // it can become inactive in responce of subscribing to `obs.onAny` above\n    if (this._active) {\n      this._subToEnd(obs);\n    }\n  },\n  _unsubscribe: function (obs) {\n    obs.offAny(this._$handleSubAny);\n\n    var onEndI = findByPred(this._$endHandlers, function (obj) {\n      return obj.obs === obs;\n    });\n    if (onEndI !== -1) {\n      obs.offEnd(this._$endHandlers[onEndI].handler);\n      this._$endHandlers.splice(onEndI, 1);\n    }\n  },\n  _handleSubAny: function (event) {\n    if (event.type === VALUE) {\n      this._emitValue(event.value);\n    } else if (event.type === ERROR) {\n      this._emitError(event.value);\n    }\n  },\n  _removeQueue: function (obs) {\n    var index = find(this._queue, obs);\n    this._queue = remove(this._queue, index);\n    return index;\n  },\n  _removeCur: function (obs) {\n    if (this._active) {\n      this._unsubscribe(obs);\n    }\n    var index = find(this._curSources, obs);\n    this._curSources = remove(this._curSources, index);\n    if (index !== -1) {\n      if (this._queue.length !== 0) {\n        this._pullQueue();\n      } else if (this._curSources.length === 0) {\n        this._onEmpty();\n      }\n    }\n    return index;\n  },\n  _removeOldest: function () {\n    this._removeCur(this._curSources[0]);\n  },\n  _pullQueue: function () {\n    if (this._queue.length !== 0) {\n      this._queue = cloneArray(this._queue);\n      this._addToCur(this._queue.shift());\n    }\n  },\n  _onActivation: function () {\n    for (var i = 0, sources = this._curSources; i < sources.length && this._active; i++) {\n      this._subscribe(sources[i]);\n    }\n  },\n  _onDeactivation: function () {\n    for (var i = 0, sources = this._curSources; i < sources.length; i++) {\n      this._unsubscribe(sources[i]);\n    }\n    if (this._currentlyAdding !== null) {\n      this._unsubscribe(this._currentlyAdding);\n    }\n  },\n  _isEmpty: function () {\n    return this._curSources.length === 0;\n  },\n  _onEmpty: function () {},\n  _clear: function () {\n    Stream.prototype._clear.call(this);\n    this._queue = null;\n    this._curSources = null;\n    this._$handleSubAny = null;\n    this._$endHandlers = null;\n  }\n});\n\nfunction Merge(sources) {\n  AbstractPool.call(this);\n  this._addAll(sources);\n  this._initialised = true;\n}\n\ninherit(Merge, AbstractPool, {\n  _name: 'merge',\n\n  _onEmpty: function () {\n    if (this._initialised) {\n      this._emitEnd();\n    }\n  }\n});\n\nfunction merge(observables) {\n  return observables.length === 0 ? never() : new Merge(observables);\n}\n\nfunction S$33(generator) {\n  var _this = this;\n\n  Stream.call(this);\n  this._generator = generator;\n  this._source = null;\n  this._inLoop = false;\n  this._iteration = 0;\n  this._$handleAny = function (event) {\n    return _this._handleAny(event);\n  };\n}\n\ninherit(S$33, Stream, {\n  _name: 'repeat',\n\n  _handleAny: function (event) {\n    if (event.type === END) {\n      this._source = null;\n      this._getSource();\n    } else {\n      this._emit(event.type, event.value);\n    }\n  },\n  _getSource: function () {\n    if (!this._inLoop) {\n      this._inLoop = true;\n      var generator = this._generator;\n      while (this._source === null && this._alive && this._active) {\n        this._source = generator(this._iteration++);\n        if (this._source) {\n          this._source.onAny(this._$handleAny);\n        } else {\n          this._emitEnd();\n        }\n      }\n      this._inLoop = false;\n    }\n  },\n  _onActivation: function () {\n    if (this._source) {\n      this._source.onAny(this._$handleAny);\n    } else {\n      this._getSource();\n    }\n  },\n  _onDeactivation: function () {\n    if (this._source) {\n      this._source.offAny(this._$handleAny);\n    }\n  },\n  _clear: function () {\n    Stream.prototype._clear.call(this);\n    this._generator = null;\n    this._source = null;\n    this._$handleAny = null;\n  }\n});\n\nvar repeat = function (generator) {\n  return new S$33(generator);\n};\n\nfunction concat$1(observables) {\n  return repeat(function (index) {\n    return observables.length > index ? observables[index] : false;\n  }).setName('concat');\n}\n\nfunction Pool() {\n  AbstractPool.call(this);\n}\n\ninherit(Pool, AbstractPool, {\n  _name: 'pool',\n\n  plug: function (obs) {\n    this._add(obs);\n    return this;\n  },\n  unplug: function (obs) {\n    this._remove(obs);\n    return this;\n  }\n});\n\nfunction FlatMap(source, fn, options) {\n  var _this = this;\n\n  AbstractPool.call(this, options);\n  this._source = source;\n  this._fn = fn;\n  this._mainEnded = false;\n  this._lastCurrent = null;\n  this._$handleMain = function (event) {\n    return _this._handleMain(event);\n  };\n}\n\ninherit(FlatMap, AbstractPool, {\n  _onActivation: function () {\n    AbstractPool.prototype._onActivation.call(this);\n    if (this._active) {\n      this._source.onAny(this._$handleMain);\n    }\n  },\n  _onDeactivation: function () {\n    AbstractPool.prototype._onDeactivation.call(this);\n    this._source.offAny(this._$handleMain);\n    this._hadNoEvSinceDeact = true;\n  },\n  _handleMain: function (event) {\n    if (event.type === VALUE) {\n      // Is latest value before deactivation survived, and now is 'current' on this activation?\n      // We don't want to handle such values, to prevent to constantly add\n      // same observale on each activation/deactivation when our main source\n      // is a `Kefir.conatant()` for example.\n      var sameCurr = this._activating && this._hadNoEvSinceDeact && this._lastCurrent === event.value;\n      if (!sameCurr) {\n        this._add(event.value, this._fn);\n      }\n      this._lastCurrent = event.value;\n      this._hadNoEvSinceDeact = false;\n    }\n\n    if (event.type === ERROR) {\n      this._emitError(event.value);\n    }\n\n    if (event.type === END) {\n      if (this._isEmpty()) {\n        this._emitEnd();\n      } else {\n        this._mainEnded = true;\n      }\n    }\n  },\n  _onEmpty: function () {\n    if (this._mainEnded) {\n      this._emitEnd();\n    }\n  },\n  _clear: function () {\n    AbstractPool.prototype._clear.call(this);\n    this._source = null;\n    this._lastCurrent = null;\n    this._$handleMain = null;\n  }\n});\n\nfunction FlatMapErrors(source, fn) {\n  FlatMap.call(this, source, fn);\n}\n\ninherit(FlatMapErrors, FlatMap, {\n  // Same as in FlatMap, only VALUE/ERROR flipped\n  _handleMain: function (event) {\n    if (event.type === ERROR) {\n      var sameCurr = this._activating && this._hadNoEvSinceDeact && this._lastCurrent === event.value;\n      if (!sameCurr) {\n        this._add(event.value, this._fn);\n      }\n      this._lastCurrent = event.value;\n      this._hadNoEvSinceDeact = false;\n    }\n\n    if (event.type === VALUE) {\n      this._emitValue(event.value);\n    }\n\n    if (event.type === END) {\n      if (this._isEmpty()) {\n        this._emitEnd();\n      } else {\n        this._mainEnded = true;\n      }\n    }\n  }\n});\n\nfunction createConstructor$1(BaseClass, name) {\n  return function AnonymousObservable(primary, secondary, options) {\n    var _this = this;\n\n    BaseClass.call(this);\n    this._primary = primary;\n    this._secondary = secondary;\n    this._name = primary._name + '.' + name;\n    this._lastSecondary = NOTHING;\n    this._$handleSecondaryAny = function (event) {\n      return _this._handleSecondaryAny(event);\n    };\n    this._$handlePrimaryAny = function (event) {\n      return _this._handlePrimaryAny(event);\n    };\n    this._init(options);\n  };\n}\n\nfunction createClassMethods$1(BaseClass) {\n  return {\n    _init: function () {},\n    _free: function () {},\n    _handlePrimaryValue: function (x) {\n      this._emitValue(x);\n    },\n    _handlePrimaryError: function (x) {\n      this._emitError(x);\n    },\n    _handlePrimaryEnd: function () {\n      this._emitEnd();\n    },\n    _handleSecondaryValue: function (x) {\n      this._lastSecondary = x;\n    },\n    _handleSecondaryError: function (x) {\n      this._emitError(x);\n    },\n    _handleSecondaryEnd: function () {},\n    _handlePrimaryAny: function (event) {\n      switch (event.type) {\n        case VALUE:\n          return this._handlePrimaryValue(event.value);\n        case ERROR:\n          return this._handlePrimaryError(event.value);\n        case END:\n          return this._handlePrimaryEnd(event.value);\n      }\n    },\n    _handleSecondaryAny: function (event) {\n      switch (event.type) {\n        case VALUE:\n          return this._handleSecondaryValue(event.value);\n        case ERROR:\n          return this._handleSecondaryError(event.value);\n        case END:\n          this._handleSecondaryEnd(event.value);\n          this._removeSecondary();\n      }\n    },\n    _removeSecondary: function () {\n      if (this._secondary !== null) {\n        this._secondary.offAny(this._$handleSecondaryAny);\n        this._$handleSecondaryAny = null;\n        this._secondary = null;\n      }\n    },\n    _onActivation: function () {\n      if (this._secondary !== null) {\n        this._secondary.onAny(this._$handleSecondaryAny);\n      }\n      if (this._active) {\n        this._primary.onAny(this._$handlePrimaryAny);\n      }\n    },\n    _onDeactivation: function () {\n      if (this._secondary !== null) {\n        this._secondary.offAny(this._$handleSecondaryAny);\n      }\n      this._primary.offAny(this._$handlePrimaryAny);\n    },\n    _clear: function () {\n      BaseClass.prototype._clear.call(this);\n      this._primary = null;\n      this._secondary = null;\n      this._lastSecondary = null;\n      this._$handleSecondaryAny = null;\n      this._$handlePrimaryAny = null;\n      this._free();\n    }\n  };\n}\n\nfunction createStream$1(name, mixin) {\n  var S = createConstructor$1(Stream, name);\n  inherit(S, Stream, createClassMethods$1(Stream), mixin);\n  return S;\n}\n\nfunction createProperty$1(name, mixin) {\n  var P = createConstructor$1(Property, name);\n  inherit(P, Property, createClassMethods$1(Property), mixin);\n  return P;\n}\n\nvar mixin$26 = {\n  _handlePrimaryValue: function (x) {\n    if (this._lastSecondary !== NOTHING && this._lastSecondary) {\n      this._emitValue(x);\n    }\n  },\n  _handleSecondaryEnd: function () {\n    if (this._lastSecondary === NOTHING || !this._lastSecondary) {\n      this._emitEnd();\n    }\n  }\n};\n\nvar S$34 = createStream$1('filterBy', mixin$26);\nvar P$29 = createProperty$1('filterBy', mixin$26);\n\nfunction filterBy(primary, secondary) {\n  return new (primary._ofSameType(S$34, P$29))(primary, secondary);\n}\n\nvar id2 = function (_, x) {\n  return x;\n};\n\nfunction sampledBy(passive, active, combinator) {\n  var _combinator = combinator ? function (a, b) {\n    return combinator(b, a);\n  } : id2;\n  return combine([active], [passive], _combinator).setName(passive, 'sampledBy');\n}\n\nvar mixin$27 = {\n  _handlePrimaryValue: function (x) {\n    if (this._lastSecondary !== NOTHING) {\n      this._emitValue(x);\n    }\n  },\n  _handleSecondaryEnd: function () {\n    if (this._lastSecondary === NOTHING) {\n      this._emitEnd();\n    }\n  }\n};\n\nvar S$35 = createStream$1('skipUntilBy', mixin$27);\nvar P$30 = createProperty$1('skipUntilBy', mixin$27);\n\nfunction skipUntilBy(primary, secondary) {\n  return new (primary._ofSameType(S$35, P$30))(primary, secondary);\n}\n\nvar mixin$28 = {\n  _handleSecondaryValue: function () {\n    this._emitEnd();\n  }\n};\n\nvar S$36 = createStream$1('takeUntilBy', mixin$28);\nvar P$31 = createProperty$1('takeUntilBy', mixin$28);\n\nfunction takeUntilBy(primary, secondary) {\n  return new (primary._ofSameType(S$36, P$31))(primary, secondary);\n}\n\nvar mixin$29 = {\n  _init: function () {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$flushOnEnd = _ref.flushOnEnd,\n        flushOnEnd = _ref$flushOnEnd === undefined ? true : _ref$flushOnEnd;\n\n    this._buff = [];\n    this._flushOnEnd = flushOnEnd;\n  },\n  _free: function () {\n    this._buff = null;\n  },\n  _flush: function () {\n    if (this._buff !== null) {\n      this._emitValue(this._buff);\n      this._buff = [];\n    }\n  },\n  _handlePrimaryEnd: function () {\n    if (this._flushOnEnd) {\n      this._flush();\n    }\n    this._emitEnd();\n  },\n  _onActivation: function () {\n    this._primary.onAny(this._$handlePrimaryAny);\n    if (this._alive && this._secondary !== null) {\n      this._secondary.onAny(this._$handleSecondaryAny);\n    }\n  },\n  _handlePrimaryValue: function (x) {\n    this._buff.push(x);\n  },\n  _handleSecondaryValue: function () {\n    this._flush();\n  },\n  _handleSecondaryEnd: function () {\n    if (!this._flushOnEnd) {\n      this._emitEnd();\n    }\n  }\n};\n\nvar S$37 = createStream$1('bufferBy', mixin$29);\nvar P$32 = createProperty$1('bufferBy', mixin$29);\n\nfunction bufferBy(primary, secondary, options /* optional */) {\n  return new (primary._ofSameType(S$37, P$32))(primary, secondary, options);\n}\n\nvar mixin$30 = {\n  _init: function () {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$flushOnEnd = _ref.flushOnEnd,\n        flushOnEnd = _ref$flushOnEnd === undefined ? true : _ref$flushOnEnd,\n        _ref$flushOnChange = _ref.flushOnChange,\n        flushOnChange = _ref$flushOnChange === undefined ? false : _ref$flushOnChange;\n\n    this._buff = [];\n    this._flushOnEnd = flushOnEnd;\n    this._flushOnChange = flushOnChange;\n  },\n  _free: function () {\n    this._buff = null;\n  },\n  _flush: function () {\n    if (this._buff !== null) {\n      this._emitValue(this._buff);\n      this._buff = [];\n    }\n  },\n  _handlePrimaryEnd: function () {\n    if (this._flushOnEnd) {\n      this._flush();\n    }\n    this._emitEnd();\n  },\n  _handlePrimaryValue: function (x) {\n    this._buff.push(x);\n    if (this._lastSecondary !== NOTHING && !this._lastSecondary) {\n      this._flush();\n    }\n  },\n  _handleSecondaryEnd: function () {\n    if (!this._flushOnEnd && (this._lastSecondary === NOTHING || this._lastSecondary)) {\n      this._emitEnd();\n    }\n  },\n  _handleSecondaryValue: function (x) {\n    if (this._flushOnChange && !x) {\n      this._flush();\n    }\n\n    // from default _handleSecondaryValue\n    this._lastSecondary = x;\n  }\n};\n\nvar S$38 = createStream$1('bufferWhileBy', mixin$30);\nvar P$33 = createProperty$1('bufferWhileBy', mixin$30);\n\nfunction bufferWhileBy(primary, secondary, options /* optional */) {\n  return new (primary._ofSameType(S$38, P$33))(primary, secondary, options);\n}\n\nvar f = function () {\n  return false;\n};\nvar t = function () {\n  return true;\n};\n\nfunction awaiting(a, b) {\n  var result = merge([map$1(a, t), map$1(b, f)]);\n  result = skipDuplicates(result);\n  result = toProperty(result, f);\n  return result.setName(a, 'awaiting');\n}\n\nvar mixin$31 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleValue: function (x) {\n    var fn = this._fn;\n    var result = fn(x);\n    if (result.convert) {\n      this._emitError(result.error);\n    } else {\n      this._emitValue(x);\n    }\n  }\n};\n\nvar S$39 = createStream('valuesToErrors', mixin$31);\nvar P$34 = createProperty('valuesToErrors', mixin$31);\n\nvar defFn = function (x) {\n  return { convert: true, error: x };\n};\n\nfunction valuesToErrors(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defFn;\n\n  return new (obs._ofSameType(S$39, P$34))(obs, { fn: fn });\n}\n\nvar mixin$32 = {\n  _init: function (_ref) {\n    var fn = _ref.fn;\n\n    this._fn = fn;\n  },\n  _free: function () {\n    this._fn = null;\n  },\n  _handleError: function (x) {\n    var fn = this._fn;\n    var result = fn(x);\n    if (result.convert) {\n      this._emitValue(result.value);\n    } else {\n      this._emitError(x);\n    }\n  }\n};\n\nvar S$40 = createStream('errorsToValues', mixin$32);\nvar P$35 = createProperty('errorsToValues', mixin$32);\n\nvar defFn$1 = function (x) {\n  return { convert: true, value: x };\n};\n\nfunction errorsToValues(obs) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : defFn$1;\n\n  return new (obs._ofSameType(S$40, P$35))(obs, { fn: fn });\n}\n\nvar mixin$33 = {\n  _handleError: function (x) {\n    this._emitError(x);\n    this._emitEnd();\n  }\n};\n\nvar S$41 = createStream('endOnError', mixin$33);\nvar P$36 = createProperty('endOnError', mixin$33);\n\nfunction endOnError(obs) {\n  return new (obs._ofSameType(S$41, P$36))(obs);\n}\n\n// Create a stream\n// -----------------------------------------------------------------------------\n\n// () -> Stream\n// (number, any) -> Stream\n// (number, any) -> Stream\n// (number, Array<any>) -> Stream\n// (number, Function) -> Stream\n// (number, Function) -> Stream\n// (Function) -> Stream\n// (Function) -> Stream\n// Target = {addEventListener, removeEventListener}|{addListener, removeListener}|{on, off}\n// (Target, string, Function|undefined) -> Stream\n// (Function) -> Stream\n// Create a property\n// -----------------------------------------------------------------------------\n\n// (any) -> Property\n// (any) -> Property\n// Convert observables\n// -----------------------------------------------------------------------------\n\n// (Stream|Property, Function|undefined) -> Property\nObservable.prototype.toProperty = function (fn) {\n  return toProperty(this, fn);\n};\n\n// (Stream|Property) -> Stream\nObservable.prototype.changes = function () {\n  return changes(this);\n};\n\n// Interoperation with other implimentations\n// -----------------------------------------------------------------------------\n\n// (Promise) -> Property\n// (Stream|Property, Function|undefined) -> Promise\nObservable.prototype.toPromise = function (Promise) {\n  return toPromise(this, Promise);\n};\n\n// (ESObservable) -> Stream\n// (Stream|Property) -> ES7 Observable\nObservable.prototype.toESObservable = toESObservable;\nObservable.prototype[$$observable] = toESObservable;\n\n// Modify an observable\n// -----------------------------------------------------------------------------\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.map = function (fn) {\n  return map$1(this, fn);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.filter = function (fn) {\n  return filter(this, fn);\n};\n\n// (Stream, number) -> Stream\n// (Property, number) -> Property\nObservable.prototype.take = function (n) {\n  return take(this, n);\n};\n\n// (Stream, number) -> Stream\n// (Property, number) -> Property\nObservable.prototype.takeErrors = function (n) {\n  return takeErrors(this, n);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.takeWhile = function (fn) {\n  return takeWhile(this, fn);\n};\n\n// (Stream) -> Stream\n// (Property) -> Property\nObservable.prototype.last = function () {\n  return last(this);\n};\n\n// (Stream, number) -> Stream\n// (Property, number) -> Property\nObservable.prototype.skip = function (n) {\n  return skip(this, n);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.skipWhile = function (fn) {\n  return skipWhile(this, fn);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.skipDuplicates = function (fn) {\n  return skipDuplicates(this, fn);\n};\n\n// (Stream, Function|falsey, any|undefined) -> Stream\n// (Property, Function|falsey, any|undefined) -> Property\nObservable.prototype.diff = function (fn, seed) {\n  return diff(this, fn, seed);\n};\n\n// (Stream|Property, Function, any|undefined) -> Property\nObservable.prototype.scan = function (fn, seed) {\n  return scan(this, fn, seed);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.flatten = function (fn) {\n  return flatten(this, fn);\n};\n\n// (Stream, number) -> Stream\n// (Property, number) -> Property\nObservable.prototype.delay = function (wait) {\n  return delay(this, wait);\n};\n\n// Options = {leading: boolean|undefined, trailing: boolean|undefined}\n// (Stream, number, Options|undefined) -> Stream\n// (Property, number, Options|undefined) -> Property\nObservable.prototype.throttle = function (wait, options) {\n  return throttle(this, wait, options);\n};\n\n// Options = {immediate: boolean|undefined}\n// (Stream, number, Options|undefined) -> Stream\n// (Property, number, Options|undefined) -> Property\nObservable.prototype.debounce = function (wait, options) {\n  return debounce(this, wait, options);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.mapErrors = function (fn) {\n  return mapErrors(this, fn);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.filterErrors = function (fn) {\n  return filterErrors(this, fn);\n};\n\n// (Stream) -> Stream\n// (Property) -> Property\nObservable.prototype.ignoreValues = function () {\n  return ignoreValues(this);\n};\n\n// (Stream) -> Stream\n// (Property) -> Property\nObservable.prototype.ignoreErrors = function () {\n  return ignoreErrors(this);\n};\n\n// (Stream) -> Stream\n// (Property) -> Property\nObservable.prototype.ignoreEnd = function () {\n  return ignoreEnd(this);\n};\n\n// (Stream, Function) -> Stream\n// (Property, Function) -> Property\nObservable.prototype.beforeEnd = function (fn) {\n  return beforeEnd(this, fn);\n};\n\n// (Stream, number, number|undefined) -> Stream\n// (Property, number, number|undefined) -> Property\nObservable.prototype.slidingWindow = function (max, min) {\n  return slidingWindow(this, max, min);\n};\n\n// Options = {flushOnEnd: boolean|undefined}\n// (Stream, Function|falsey, Options|undefined) -> Stream\n// (Property, Function|falsey, Options|undefined) -> Property\nObservable.prototype.bufferWhile = function (fn, options) {\n  return bufferWhile(this, fn, options);\n};\n\n// (Stream, number) -> Stream\n// (Property, number) -> Property\nObservable.prototype.bufferWithCount = function (count, options) {\n  return bufferWhile$1(this, count, options);\n};\n\n// Options = {flushOnEnd: boolean|undefined}\n// (Stream, number, number, Options|undefined) -> Stream\n// (Property, number, number, Options|undefined) -> Property\nObservable.prototype.bufferWithTimeOrCount = function (wait, count, options) {\n  return bufferWithTimeOrCount(this, wait, count, options);\n};\n\n// (Stream, Function) -> Stream\n// (Property, Function) -> Property\nObservable.prototype.transduce = function (transducer) {\n  return transduce(this, transducer);\n};\n\n// (Stream, Function) -> Stream\n// (Property, Function) -> Property\nObservable.prototype.withHandler = function (fn) {\n  return withHandler(this, fn);\n};\n\n// (Stream, Stream -> a) -> a\n// (Property, Property -> a) -> a\nObservable.prototype.thru = function (fn) {\n  return fn(this);\n};\n\n// Combine observables\n// -----------------------------------------------------------------------------\n\n// (Array<Stream|Property>, Function|undefiend) -> Stream\n// (Array<Stream|Property>, Array<Stream|Property>, Function|undefiend) -> Stream\nObservable.prototype.combine = function (other, combinator) {\n  return combine([this, other], combinator);\n};\n\n// (Array<Stream|Property>, Function|undefiend) -> Stream\nObservable.prototype.zip = function (other, combinator) {\n  return zip([this, other], combinator);\n};\n\n// (Array<Stream|Property>) -> Stream\nObservable.prototype.merge = function (other) {\n  return merge([this, other]);\n};\n\n// (Array<Stream|Property>) -> Stream\nObservable.prototype.concat = function (other) {\n  return concat$1([this, other]);\n};\n\n// () -> Pool\nvar pool = function () {\n  return new Pool();\n};\n\n// (Function) -> Stream\n// Options = {concurLim: number|undefined, queueLim: number|undefined, drop: 'old'|'new'|undefiend}\n// (Stream|Property, Function|falsey, Options|undefined) -> Stream\nObservable.prototype.flatMap = function (fn) {\n  return new FlatMap(this, fn).setName(this, 'flatMap');\n};\nObservable.prototype.flatMapLatest = function (fn) {\n  return new FlatMap(this, fn, { concurLim: 1, drop: 'old' }).setName(this, 'flatMapLatest');\n};\nObservable.prototype.flatMapFirst = function (fn) {\n  return new FlatMap(this, fn, { concurLim: 1 }).setName(this, 'flatMapFirst');\n};\nObservable.prototype.flatMapConcat = function (fn) {\n  return new FlatMap(this, fn, { queueLim: -1, concurLim: 1 }).setName(this, 'flatMapConcat');\n};\nObservable.prototype.flatMapConcurLimit = function (fn, limit) {\n  return new FlatMap(this, fn, { queueLim: -1, concurLim: limit }).setName(this, 'flatMapConcurLimit');\n};\n\n// (Stream|Property, Function|falsey) -> Stream\nObservable.prototype.flatMapErrors = function (fn) {\n  return new FlatMapErrors(this, fn).setName(this, 'flatMapErrors');\n};\n\n// Combine two observables\n// -----------------------------------------------------------------------------\n\n// (Stream, Stream|Property) -> Stream\n// (Property, Stream|Property) -> Property\nObservable.prototype.filterBy = function (other) {\n  return filterBy(this, other);\n};\n\n// (Stream, Stream|Property, Function|undefiend) -> Stream\n// (Property, Stream|Property, Function|undefiend) -> Property\nObservable.prototype.sampledBy = function (other, combinator) {\n  return sampledBy(this, other, combinator);\n};\n\n// (Stream, Stream|Property) -> Stream\n// (Property, Stream|Property) -> Property\nObservable.prototype.skipUntilBy = function (other) {\n  return skipUntilBy(this, other);\n};\n\n// (Stream, Stream|Property) -> Stream\n// (Property, Stream|Property) -> Property\nObservable.prototype.takeUntilBy = function (other) {\n  return takeUntilBy(this, other);\n};\n\n// Options = {flushOnEnd: boolean|undefined}\n// (Stream, Stream|Property, Options|undefined) -> Stream\n// (Property, Stream|Property, Options|undefined) -> Property\nObservable.prototype.bufferBy = function (other, options) {\n  return bufferBy(this, other, options);\n};\n\n// Options = {flushOnEnd: boolean|undefined}\n// (Stream, Stream|Property, Options|undefined) -> Stream\n// (Property, Stream|Property, Options|undefined) -> Property\nObservable.prototype.bufferWhileBy = function (other, options) {\n  return bufferWhileBy(this, other, options);\n};\n\n// Deprecated\n// -----------------------------------------------------------------------------\n\nvar DEPRECATION_WARNINGS = true;\nfunction dissableDeprecationWarnings() {\n  DEPRECATION_WARNINGS = false;\n}\n\nfunction warn(msg) {\n  if (DEPRECATION_WARNINGS && console && typeof console.warn === 'function') {\n    var msg2 = '\\nHere is an Error object for you containing the call stack:';\n    console.warn(msg, msg2, new Error());\n  }\n}\n\n// (Stream|Property, Stream|Property) -> Property\nObservable.prototype.awaiting = function (other) {\n  warn('You are using deprecated .awaiting() method, see https://github.com/kefirjs/kefir/issues/145');\n  return awaiting(this, other);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.valuesToErrors = function (fn) {\n  warn('You are using deprecated .valuesToErrors() method, see https://github.com/kefirjs/kefir/issues/149');\n  return valuesToErrors(this, fn);\n};\n\n// (Stream, Function|undefined) -> Stream\n// (Property, Function|undefined) -> Property\nObservable.prototype.errorsToValues = function (fn) {\n  warn('You are using deprecated .errorsToValues() method, see https://github.com/kefirjs/kefir/issues/149');\n  return errorsToValues(this, fn);\n};\n\n// (Stream) -> Stream\n// (Property) -> Property\nObservable.prototype.endOnError = function () {\n  warn('You are using deprecated .endOnError() method, see https://github.com/kefirjs/kefir/issues/150');\n  return endOnError(this);\n};\n\n// Exports\n// --------------------------------------------------------------------------\n\nvar Kefir = {\n  Observable: Observable,\n  Stream: Stream,\n  Property: Property,\n  never: never,\n  later: later,\n  interval: interval,\n  sequentially: sequentially,\n  fromPoll: fromPoll,\n  withInterval: withInterval,\n  fromCallback: fromCallback,\n  fromNodeCallback: fromNodeCallback,\n  fromEvents: fromEvents,\n  stream: stream,\n  constant: constant,\n  constantError: constantError,\n  fromPromise: fromPromise,\n  fromESObservable: fromESObservable,\n  combine: combine,\n  zip: zip,\n  merge: merge,\n  concat: concat$1,\n  Pool: Pool,\n  pool: pool,\n  repeat: repeat,\n  staticLand: staticLand\n};\n\nKefir.Kefir = Kefir;\n\nexport { dissableDeprecationWarnings, Kefir, Observable, Stream, Property, never, later, interval, sequentially, fromPoll, withInterval, fromCallback, fromNodeCallback, fromEvents, stream, constant, constantError, fromPromise, fromESObservable, combine, zip, merge, concat$1 as concat, Pool, pool, repeat, staticLand };export default Kefir;\n","(function (window, factory) {\n    if (typeof exports === 'object') {\n        module.exports = factory();\n    } else if (typeof define === 'function' && define.amd) {\n        define(factory);\n    } else {\n        window.jStat = factory();\n    }\n})(this, function () {\nvar jStat = (function(Math, undefined) {\n\n// For quick reference.\nvar concat = Array.prototype.concat;\nvar slice = Array.prototype.slice;\nvar toString = Object.prototype.toString;\n\n// Calculate correction for IEEE error\n// TODO: This calculation can be improved.\nfunction calcRdx(n, m) {\n  var val = n > m ? n : m;\n  return Math.pow(10,\n                  17 - ~~(Math.log(((val > 0) ? val : -val)) * Math.LOG10E));\n}\n\n\nvar isArray = Array.isArray || function isArray(arg) {\n  return toString.call(arg) === '[object Array]';\n};\n\n\nfunction isFunction(arg) {\n  return toString.call(arg) === '[object Function]';\n}\n\n\nfunction isNumber(num) {\n  return (typeof num === 'number') ? num - num === 0 : false;\n}\n\n\n// Converts the jStat matrix to vector.\nfunction toVector(arr) {\n  return concat.apply([], arr);\n}\n\n\n// The one and only jStat constructor.\nfunction jStat() {\n  return new jStat._init(arguments);\n}\n\n\n// TODO: Remove after all references in src files have been removed.\njStat.fn = jStat.prototype;\n\n\n// By separating the initializer from the constructor it's easier to handle\n// always returning a new instance whether \"new\" was used or not.\njStat._init = function _init(args) {\n  // If first argument is an array, must be vector or matrix.\n  if (isArray(args[0])) {\n    // Check if matrix.\n    if (isArray(args[0][0])) {\n      // See if a mapping function was also passed.\n      if (isFunction(args[1]))\n        args[0] = jStat.map(args[0], args[1]);\n      // Iterate over each is faster than this.push.apply(this, args[0].\n      for (var i = 0; i < args[0].length; i++)\n        this[i] = args[0][i];\n      this.length = args[0].length;\n\n    // Otherwise must be a vector.\n    } else {\n      this[0] = isFunction(args[1]) ? jStat.map(args[0], args[1]) : args[0];\n      this.length = 1;\n    }\n\n  // If first argument is number, assume creation of sequence.\n  } else if (isNumber(args[0])) {\n    this[0] = jStat.seq.apply(null, args);\n    this.length = 1;\n\n  // Handle case when jStat object is passed to jStat.\n  } else if (args[0] instanceof jStat) {\n    // Duplicate the object and pass it back.\n    return jStat(args[0].toArray());\n\n  // Unexpected argument value, return empty jStat object.\n  // TODO: This is strange behavior. Shouldn't this throw or some such to let\n  // the user know they had bad arguments?\n  } else {\n    this[0] = [];\n    this.length = 1;\n  }\n\n  return this;\n};\njStat._init.prototype = jStat.prototype;\njStat._init.constructor = jStat;\n\n\n// Utility functions.\n// TODO: for internal use only?\njStat.utils = {\n  calcRdx: calcRdx,\n  isArray: isArray,\n  isFunction: isFunction,\n  isNumber: isNumber,\n  toVector: toVector\n};\n\n\njStat._random_fn = Math.random;\njStat.setRandom = function setRandom(fn) {\n  if (typeof fn !== 'function')\n    throw new TypeError('fn is not a function');\n  jStat._random_fn = fn;\n};\n\n\n// Easily extend the jStat object.\n// TODO: is this seriously necessary?\njStat.extend = function extend(obj) {\n  var i, j;\n\n  if (arguments.length === 1) {\n    for (j in obj)\n      jStat[j] = obj[j];\n    return this;\n  }\n\n  for (i = 1; i < arguments.length; i++) {\n    for (j in arguments[i])\n      obj[j] = arguments[i][j];\n  }\n\n  return obj;\n};\n\n\n// Returns the number of rows in the matrix.\njStat.rows = function rows(arr) {\n  return arr.length || 1;\n};\n\n\n// Returns the number of columns in the matrix.\njStat.cols = function cols(arr) {\n  return arr[0].length || 1;\n};\n\n\n// Returns the dimensions of the object { rows: i, cols: j }\njStat.dimensions = function dimensions(arr) {\n  return {\n    rows: jStat.rows(arr),\n    cols: jStat.cols(arr)\n  };\n};\n\n\n// Returns a specified row as a vector or return a sub matrix by pick some rows\njStat.row = function row(arr, index) {\n  if (isArray(index)) {\n    return index.map(function(i) {\n      return jStat.row(arr, i);\n    })\n  }\n  return arr[index];\n};\n\n\n// return row as array\n// rowa([[1,2],[3,4]],0) -> [1,2]\njStat.rowa = function rowa(arr, i) {\n  return jStat.row(arr, i);\n};\n\n\n// Returns the specified column as a vector or return a sub matrix by pick some\n// columns\njStat.col = function col(arr, index) {\n  if (isArray(index)) {\n    var submat = jStat.arange(arr.length).map(function() {\n      return new Array(index.length);\n    });\n    index.forEach(function(ind, i){\n      jStat.arange(arr.length).forEach(function(j) {\n        submat[j][i] = arr[j][ind];\n      });\n    });\n    return submat;\n  }\n  var column = new Array(arr.length);\n  for (var i = 0; i < arr.length; i++)\n    column[i] = [arr[i][index]];\n  return column;\n};\n\n\n// return column as array\n// cola([[1,2],[3,4]],0) -> [1,3]\njStat.cola = function cola(arr, i) {\n  return jStat.col(arr, i).map(function(a){ return a[0] });\n};\n\n\n// Returns the diagonal of the matrix\njStat.diag = function diag(arr) {\n  var nrow = jStat.rows(arr);\n  var res = new Array(nrow);\n  for (var row = 0; row < nrow; row++)\n    res[row] = [arr[row][row]];\n  return res;\n};\n\n\n// Returns the anti-diagonal of the matrix\njStat.antidiag = function antidiag(arr) {\n  var nrow = jStat.rows(arr) - 1;\n  var res = new Array(nrow);\n  for (var i = 0; nrow >= 0; nrow--, i++)\n    res[i] = [arr[i][nrow]];\n  return res;\n};\n\n// Transpose a matrix or array.\njStat.transpose = function transpose(arr) {\n  var obj = [];\n  var objArr, rows, cols, j, i;\n\n  // Make sure arr is in matrix format.\n  if (!isArray(arr[0]))\n    arr = [arr];\n\n  rows = arr.length;\n  cols = arr[0].length;\n\n  for (i = 0; i < cols; i++) {\n    objArr = new Array(rows);\n    for (j = 0; j < rows; j++)\n      objArr[j] = arr[j][i];\n    obj.push(objArr);\n  }\n\n  // If obj is vector, return only single array.\n  return obj.length === 1 ? obj[0] : obj;\n};\n\n\n// Map a function to an array or array of arrays.\n// \"toAlter\" is an internal variable.\njStat.map = function map(arr, func, toAlter) {\n  var row, nrow, ncol, res, col;\n\n  if (!isArray(arr[0]))\n    arr = [arr];\n\n  nrow = arr.length;\n  ncol = arr[0].length;\n  res = toAlter ? arr : new Array(nrow);\n\n  for (row = 0; row < nrow; row++) {\n    // if the row doesn't exist, create it\n    if (!res[row])\n      res[row] = new Array(ncol);\n    for (col = 0; col < ncol; col++)\n      res[row][col] = func(arr[row][col], row, col);\n  }\n\n  return res.length === 1 ? res[0] : res;\n};\n\n\n// Cumulatively combine the elements of an array or array of arrays using a function.\njStat.cumreduce = function cumreduce(arr, func, toAlter) {\n  var row, nrow, ncol, res, col;\n\n  if (!isArray(arr[0]))\n    arr = [arr];\n\n  nrow = arr.length;\n  ncol = arr[0].length;\n  res = toAlter ? arr : new Array(nrow);\n\n  for (row = 0; row < nrow; row++) {\n    // if the row doesn't exist, create it\n    if (!res[row])\n      res[row] = new Array(ncol);\n    if (ncol > 0)\n      res[row][0] = arr[row][0];\n    for (col = 1; col < ncol; col++)\n      res[row][col] = func(res[row][col-1], arr[row][col]);\n  }\n  return res.length === 1 ? res[0] : res;\n};\n\n\n// Destructively alter an array.\njStat.alter = function alter(arr, func) {\n  return jStat.map(arr, func, true);\n};\n\n\n// Generate a rows x cols matrix according to the supplied function.\njStat.create = function  create(rows, cols, func) {\n  var res = new Array(rows);\n  var i, j;\n\n  if (isFunction(cols)) {\n    func = cols;\n    cols = rows;\n  }\n\n  for (i = 0; i < rows; i++) {\n    res[i] = new Array(cols);\n    for (j = 0; j < cols; j++)\n      res[i][j] = func(i, j);\n  }\n\n  return res;\n};\n\n\nfunction retZero() { return 0; }\n\n\n// Generate a rows x cols matrix of zeros.\njStat.zeros = function zeros(rows, cols) {\n  if (!isNumber(cols))\n    cols = rows;\n  return jStat.create(rows, cols, retZero);\n};\n\n\nfunction retOne() { return 1; }\n\n\n// Generate a rows x cols matrix of ones.\njStat.ones = function ones(rows, cols) {\n  if (!isNumber(cols))\n    cols = rows;\n  return jStat.create(rows, cols, retOne);\n};\n\n\n// Generate a rows x cols matrix of uniformly random numbers.\njStat.rand = function rand(rows, cols) {\n  if (!isNumber(cols))\n    cols = rows;\n  return jStat.create(rows, cols, jStat._random_fn);\n};\n\n\nfunction retIdent(i, j) { return i === j ? 1 : 0; }\n\n\n// Generate an identity matrix of size row x cols.\njStat.identity = function identity(rows, cols) {\n  if (!isNumber(cols))\n    cols = rows;\n  return jStat.create(rows, cols, retIdent);\n};\n\n\n// Tests whether a matrix is symmetric\njStat.symmetric = function symmetric(arr) {\n  var size = arr.length;\n  var row, col;\n\n  if (arr.length !== arr[0].length)\n    return false;\n\n  for (row = 0; row < size; row++) {\n    for (col = 0; col < size; col++)\n      if (arr[col][row] !== arr[row][col])\n        return false;\n  }\n\n  return true;\n};\n\n\n// Set all values to zero.\njStat.clear = function clear(arr) {\n  return jStat.alter(arr, retZero);\n};\n\n\n// Generate sequence.\njStat.seq = function seq(min, max, length, func) {\n  if (!isFunction(func))\n    func = false;\n\n  var arr = [];\n  var hival = calcRdx(min, max);\n  var step = (max * hival - min * hival) / ((length - 1) * hival);\n  var current = min;\n  var cnt;\n\n  // Current is assigned using a technique to compensate for IEEE error.\n  // TODO: Needs better implementation.\n  for (cnt = 0;\n       current <= max && cnt < length;\n       cnt++, current = (min * hival + step * hival * cnt) / hival) {\n    arr.push((func ? func(current, cnt) : current));\n  }\n\n  return arr;\n};\n\n\n// arange(5) -> [0,1,2,3,4]\n// arange(1,5) -> [1,2,3,4]\n// arange(5,1,-1) -> [5,4,3,2]\njStat.arange = function arange(start, end, step) {\n  var rl = [];\n  var i;\n  step = step || 1;\n  if (end === undefined) {\n    end = start;\n    start = 0;\n  }\n  if (start === end || step === 0) {\n    return [];\n  }\n  if (start < end && step < 0) {\n    return [];\n  }\n  if (start > end && step > 0) {\n    return [];\n  }\n  if (step > 0) {\n    for (i = start; i < end; i += step) {\n      rl.push(i);\n    }\n  } else {\n    for (i = start; i > end; i += step) {\n      rl.push(i);\n    }\n  }\n  return rl;\n};\n\n\n// A=[[1,2,3],[4,5,6],[7,8,9]]\n// slice(A,{row:{end:2},col:{start:1}}) -> [[2,3],[5,6]]\n// slice(A,1,{start:1}) -> [5,6]\n// as numpy code A[:2,1:]\njStat.slice = (function(){\n  function _slice(list, start, end, step) {\n    // note it's not equal to range.map mode it's a bug\n    var i;\n    var rl = [];\n    var length = list.length;\n    if (start === undefined && end === undefined && step === undefined) {\n      return jStat.copy(list);\n    }\n\n    start = start || 0;\n    end = end || list.length;\n    start = start >= 0 ? start : length + start;\n    end = end >= 0 ? end : length + end;\n    step = step || 1;\n    if (start === end || step === 0) {\n      return [];\n    }\n    if (start < end && step < 0) {\n      return [];\n    }\n    if (start > end && step > 0) {\n      return [];\n    }\n    if (step > 0) {\n      for (i = start; i < end; i += step) {\n        rl.push(list[i]);\n      }\n    } else {\n      for (i = start; i > end;i += step) {\n        rl.push(list[i]);\n      }\n    }\n    return rl;\n  }\n\n  function slice(list, rcSlice) {\n    var colSlice, rowSlice;\n    rcSlice = rcSlice || {};\n    if (isNumber(rcSlice.row)) {\n      if (isNumber(rcSlice.col))\n        return list[rcSlice.row][rcSlice.col];\n      var row = jStat.rowa(list, rcSlice.row);\n      colSlice = rcSlice.col || {};\n      return _slice(row, colSlice.start, colSlice.end, colSlice.step);\n    }\n\n    if (isNumber(rcSlice.col)) {\n      var col = jStat.cola(list, rcSlice.col);\n      rowSlice = rcSlice.row || {};\n      return _slice(col, rowSlice.start, rowSlice.end, rowSlice.step);\n    }\n\n    rowSlice = rcSlice.row || {};\n    colSlice = rcSlice.col || {};\n    var rows = _slice(list, rowSlice.start, rowSlice.end, rowSlice.step);\n    return rows.map(function(row) {\n      return _slice(row, colSlice.start, colSlice.end, colSlice.step);\n    });\n  }\n\n  return slice;\n}());\n\n\n// A=[[1,2,3],[4,5,6],[7,8,9]]\n// sliceAssign(A,{row:{start:1},col:{start:1}},[[0,0],[0,0]])\n// A=[[1,2,3],[4,0,0],[7,0,0]]\njStat.sliceAssign = function sliceAssign(A, rcSlice, B) {\n  var nl, ml;\n  if (isNumber(rcSlice.row)) {\n    if (isNumber(rcSlice.col))\n      return A[rcSlice.row][rcSlice.col] = B;\n    rcSlice.col = rcSlice.col || {};\n    rcSlice.col.start = rcSlice.col.start || 0;\n    rcSlice.col.end = rcSlice.col.end || A[0].length;\n    rcSlice.col.step = rcSlice.col.step || 1;\n    nl = jStat.arange(rcSlice.col.start,\n                          Math.min(A.length, rcSlice.col.end),\n                          rcSlice.col.step);\n    var m = rcSlice.row;\n    nl.forEach(function(n, i) {\n      A[m][n] = B[i];\n    });\n    return A;\n  }\n\n  if (isNumber(rcSlice.col)) {\n    rcSlice.row = rcSlice.row || {};\n    rcSlice.row.start = rcSlice.row.start || 0;\n    rcSlice.row.end = rcSlice.row.end || A.length;\n    rcSlice.row.step = rcSlice.row.step || 1;\n    ml = jStat.arange(rcSlice.row.start,\n                          Math.min(A[0].length, rcSlice.row.end),\n                          rcSlice.row.step);\n    var n = rcSlice.col;\n    ml.forEach(function(m, j) {\n      A[m][n] = B[j];\n    });\n    return A;\n  }\n\n  if (B[0].length === undefined) {\n    B = [B];\n  }\n  rcSlice.row.start = rcSlice.row.start || 0;\n  rcSlice.row.end = rcSlice.row.end || A.length;\n  rcSlice.row.step = rcSlice.row.step || 1;\n  rcSlice.col.start = rcSlice.col.start || 0;\n  rcSlice.col.end = rcSlice.col.end || A[0].length;\n  rcSlice.col.step = rcSlice.col.step || 1;\n  ml = jStat.arange(rcSlice.row.start,\n                        Math.min(A.length, rcSlice.row.end),\n                        rcSlice.row.step);\n  nl = jStat.arange(rcSlice.col.start,\n                        Math.min(A[0].length, rcSlice.col.end),\n                        rcSlice.col.step);\n  ml.forEach(function(m, i) {\n    nl.forEach(function(n, j) {\n      A[m][n] = B[i][j];\n    });\n  });\n  return A;\n};\n\n\n// [1,2,3] ->\n// [[1,0,0],[0,2,0],[0,0,3]]\njStat.diagonal = function diagonal(diagArray) {\n  var mat = jStat.zeros(diagArray.length, diagArray.length);\n  diagArray.forEach(function(t, i) {\n    mat[i][i] = t;\n  });\n  return mat;\n};\n\n\n// return copy of A\njStat.copy = function copy(A) {\n  return A.map(function(row) {\n    if (isNumber(row))\n      return row;\n    return row.map(function(t) {\n      return t;\n    });\n  });\n};\n\n\n// TODO: Go over this entire implementation. Seems a tragic waste of resources\n// doing all this work. Instead, and while ugly, use new Function() to generate\n// a custom function for each static method.\n\n// Quick reference.\nvar jProto = jStat.prototype;\n\n// Default length.\njProto.length = 0;\n\n// For internal use only.\n// TODO: Check if they're actually used, and if they are then rename them\n// to _*\njProto.push = Array.prototype.push;\njProto.sort = Array.prototype.sort;\njProto.splice = Array.prototype.splice;\njProto.slice = Array.prototype.slice;\n\n\n// Return a clean array.\njProto.toArray = function toArray() {\n  return this.length > 1 ? slice.call(this) : slice.call(this)[0];\n};\n\n\n// Map a function to a matrix or vector.\njProto.map = function map(func, toAlter) {\n  return jStat(jStat.map(this, func, toAlter));\n};\n\n\n// Cumulatively combine the elements of a matrix or vector using a function.\njProto.cumreduce = function cumreduce(func, toAlter) {\n  return jStat(jStat.cumreduce(this, func, toAlter));\n};\n\n\n// Destructively alter an array.\njProto.alter = function alter(func) {\n  jStat.alter(this, func);\n  return this;\n};\n\n\n// Extend prototype with methods that have no argument.\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    jProto[passfunc] = function(func) {\n      var self = this,\n      results;\n      // Check for callback.\n      if (func) {\n        setTimeout(function() {\n          func.call(self, jProto[passfunc].call(self));\n        });\n        return this;\n      }\n      results = jStat[passfunc](this);\n      return isArray(results) ? jStat(results) : results;\n    };\n  })(funcs[i]);\n})('transpose clear symmetric rows cols dimensions diag antidiag'.split(' '));\n\n\n// Extend prototype with methods that have one argument.\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    jProto[passfunc] = function(index, func) {\n      var self = this;\n      // check for callback\n      if (func) {\n        setTimeout(function() {\n          func.call(self, jProto[passfunc].call(self, index));\n        });\n        return this;\n      }\n      return jStat(jStat[passfunc](this, index));\n    };\n  })(funcs[i]);\n})('row col'.split(' '));\n\n\n// Extend prototype with simple shortcut methods.\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    jProto[passfunc] = function() {\n      return jStat(jStat[passfunc].apply(null, arguments));\n    };\n  })(funcs[i]);\n})('create zeros ones rand identity'.split(' '));\n\n\n// Exposing jStat.\nreturn jStat;\n\n}(Math));\n(function(jStat, Math) {\n\nvar isFunction = jStat.utils.isFunction;\n\n// Ascending functions for sort\nfunction ascNum(a, b) { return a - b; }\n\nfunction clip(arg, min, max) {\n  return Math.max(min, Math.min(arg, max));\n}\n\n\n// sum of an array\njStat.sum = function sum(arr) {\n  var sum = 0;\n  var i = arr.length;\n  while (--i >= 0)\n    sum += arr[i];\n  return sum;\n};\n\n\n// sum squared\njStat.sumsqrd = function sumsqrd(arr) {\n  var sum = 0;\n  var i = arr.length;\n  while (--i >= 0)\n    sum += arr[i] * arr[i];\n  return sum;\n};\n\n\n// sum of squared errors of prediction (SSE)\njStat.sumsqerr = function sumsqerr(arr) {\n  var mean = jStat.mean(arr);\n  var sum = 0;\n  var i = arr.length;\n  var tmp;\n  while (--i >= 0) {\n    tmp = arr[i] - mean;\n    sum += tmp * tmp;\n  }\n  return sum;\n};\n\n// sum of an array in each row\njStat.sumrow = function sumrow(arr) {\n  var sum = 0;\n  var i = arr.length;\n  while (--i >= 0)\n    sum += arr[i];\n  return sum;\n};\n\n// product of an array\njStat.product = function product(arr) {\n  var prod = 1;\n  var i = arr.length;\n  while (--i >= 0)\n    prod *= arr[i];\n  return prod;\n};\n\n\n// minimum value of an array\njStat.min = function min(arr) {\n  var low = arr[0];\n  var i = 0;\n  while (++i < arr.length)\n    if (arr[i] < low)\n      low = arr[i];\n  return low;\n};\n\n\n// maximum value of an array\njStat.max = function max(arr) {\n  var high = arr[0];\n  var i = 0;\n  while (++i < arr.length)\n    if (arr[i] > high)\n      high = arr[i];\n  return high;\n};\n\n\n// unique values of an array\njStat.unique = function unique(arr) {\n  var hash = {}, _arr = [];\n  for(var i = 0; i < arr.length; i++) {\n    if (!hash[arr[i]]) {\n      hash[arr[i]] = true;\n      _arr.push(arr[i]);\n    }\n  }\n  return _arr;\n};\n\n\n// mean value of an array\njStat.mean = function mean(arr) {\n  return jStat.sum(arr) / arr.length;\n};\n\n\n// mean squared error (MSE)\njStat.meansqerr = function meansqerr(arr) {\n  return jStat.sumsqerr(arr) / arr.length;\n};\n\n\n// geometric mean of an array\njStat.geomean = function geomean(arr) {\n  return Math.pow(jStat.product(arr), 1 / arr.length);\n};\n\n\n// median of an array\njStat.median = function median(arr) {\n  var arrlen = arr.length;\n  var _arr = arr.slice().sort(ascNum);\n  // check if array is even or odd, then return the appropriate\n  return !(arrlen & 1)\n    ? (_arr[(arrlen / 2) - 1 ] + _arr[(arrlen / 2)]) / 2\n    : _arr[(arrlen / 2) | 0 ];\n};\n\n\n// cumulative sum of an array\njStat.cumsum = function cumsum(arr) {\n  return jStat.cumreduce(arr, function (a, b) { return a + b; });\n};\n\n\n// cumulative product of an array\njStat.cumprod = function cumprod(arr) {\n  return jStat.cumreduce(arr, function (a, b) { return a * b; });\n};\n\n\n// successive differences of a sequence\njStat.diff = function diff(arr) {\n  var diffs = [];\n  var arrLen = arr.length;\n  var i;\n  for (i = 1; i < arrLen; i++)\n    diffs.push(arr[i] - arr[i - 1]);\n  return diffs;\n};\n\n\n// ranks of an array\njStat.rank = function (arr) {\n  var i;\n  var distinctNumbers = [];\n  var numberCounts = {};\n  for (i = 0; i < arr.length; i++) {\n    var number = arr[i];\n    if (numberCounts[number]) {\n      numberCounts[number]++;\n    } else {\n      numberCounts[number] = 1;\n      distinctNumbers.push(number);\n    }\n  }\n\n  var sortedDistinctNumbers = distinctNumbers.sort(ascNum);\n  var numberRanks = {};\n  var currentRank = 1;\n  for (i = 0; i < sortedDistinctNumbers.length; i++) {\n    var number = sortedDistinctNumbers[i];\n    var count = numberCounts[number];\n    var first = currentRank;\n    var last = currentRank + count - 1;\n    var rank = (first + last) / 2;\n    numberRanks[number] = rank;\n    currentRank += count;\n  }\n\n  return arr.map(function (number) {\n    return numberRanks[number];\n  });\n};\n\n\n// mode of an array\n// if there are multiple modes of an array, return all of them\n// is this the appropriate way of handling it?\njStat.mode = function mode(arr) {\n  var arrLen = arr.length;\n  var _arr = arr.slice().sort(ascNum);\n  var count = 1;\n  var maxCount = 0;\n  var numMaxCount = 0;\n  var mode_arr = [];\n  var i;\n\n  for (i = 0; i < arrLen; i++) {\n    if (_arr[i] === _arr[i + 1]) {\n      count++;\n    } else {\n      if (count > maxCount) {\n        mode_arr = [_arr[i]];\n        maxCount = count;\n        numMaxCount = 0;\n      }\n      // are there multiple max counts\n      else if (count === maxCount) {\n        mode_arr.push(_arr[i]);\n        numMaxCount++;\n      }\n      // resetting count for new value in array\n      count = 1;\n    }\n  }\n\n  return numMaxCount === 0 ? mode_arr[0] : mode_arr;\n};\n\n\n// range of an array\njStat.range = function range(arr) {\n  return jStat.max(arr) - jStat.min(arr);\n};\n\n// variance of an array\n// flag = true indicates sample instead of population\njStat.variance = function variance(arr, flag) {\n  return jStat.sumsqerr(arr) / (arr.length - (flag ? 1 : 0));\n};\n\n// pooled variance of an array of arrays\njStat.pooledvariance = function pooledvariance(arr) {\n  var sumsqerr = arr.reduce(function (a, samples) {return a + jStat.sumsqerr(samples);}, 0);\n  var count = arr.reduce(function (a, samples) {return a + samples.length;}, 0);\n  return sumsqerr / (count - arr.length);\n};\n\n// deviation of an array\njStat.deviation = function (arr) {\n  var mean = jStat.mean(arr);\n  var arrlen = arr.length;\n  var dev = new Array(arrlen);\n  for (var i = 0; i < arrlen; i++) {\n    dev[i] = arr[i] - mean;\n  }\n  return dev;\n};\n\n// standard deviation of an array\n// flag = true indicates sample instead of population\njStat.stdev = function stdev(arr, flag) {\n  return Math.sqrt(jStat.variance(arr, flag));\n};\n\n// pooled standard deviation of an array of arrays\njStat.pooledstdev = function pooledstdev(arr) {\n  return Math.sqrt(jStat.pooledvariance(arr));\n};\n\n// mean deviation (mean absolute deviation) of an array\njStat.meandev = function meandev(arr) {\n  var mean = jStat.mean(arr);\n  var a = [];\n  for (var i = arr.length - 1; i >= 0; i--) {\n    a.push(Math.abs(arr[i] - mean));\n  }\n  return jStat.mean(a);\n};\n\n\n// median deviation (median absolute deviation) of an array\njStat.meddev = function meddev(arr) {\n  var median = jStat.median(arr);\n  var a = [];\n  for (var i = arr.length - 1; i >= 0; i--) {\n    a.push(Math.abs(arr[i] - median));\n  }\n  return jStat.median(a);\n};\n\n\n// coefficient of variation\njStat.coeffvar = function coeffvar(arr) {\n  return jStat.stdev(arr) / jStat.mean(arr);\n};\n\n\n// quartiles of an array\njStat.quartiles = function quartiles(arr) {\n  var arrlen = arr.length;\n  var _arr = arr.slice().sort(ascNum);\n  return [\n    _arr[ Math.round((arrlen) / 4) - 1 ],\n    _arr[ Math.round((arrlen) / 2) - 1 ],\n    _arr[ Math.round((arrlen) * 3 / 4) - 1 ]\n  ];\n};\n\n\n// Arbitary quantiles of an array. Direct port of the scipy.stats\n// implementation by Pierre GF Gerard-Marchant.\njStat.quantiles = function quantiles(arr, quantilesArray, alphap, betap) {\n  var sortedArray = arr.slice().sort(ascNum);\n  var quantileVals = [quantilesArray.length];\n  var n = arr.length;\n  var i, p, m, aleph, k, gamma;\n\n  if (typeof alphap === 'undefined')\n    alphap = 3 / 8;\n  if (typeof betap === 'undefined')\n    betap = 3 / 8;\n\n  for (i = 0; i < quantilesArray.length; i++) {\n    p = quantilesArray[i];\n    m = alphap + p * (1 - alphap - betap);\n    aleph = n * p + m;\n    k = Math.floor(clip(aleph, 1, n - 1));\n    gamma = clip(aleph - k, 0, 1);\n    quantileVals[i] = (1 - gamma) * sortedArray[k - 1] + gamma * sortedArray[k];\n  }\n\n  return quantileVals;\n};\n\n// Return the k-th percentile of values in a range, where k is in the range 0..1, inclusive.\n// Passing true for the exclusive parameter excludes both endpoints of the range.\njStat.percentile = function percentile(arr, k, exclusive) {\n  var _arr = arr.slice().sort(ascNum);\n  var realIndex = k * (_arr.length + (exclusive ? 1 : -1)) + (exclusive ? 0 : 1);\n  var index = parseInt(realIndex);\n  var frac = realIndex - index;\n  if (index + 1 < _arr.length) {\n    return _arr[index - 1] + frac * (_arr[index] - _arr[index - 1]);\n  } else {\n    return _arr[index - 1];\n  }\n}\n\n// The percentile rank of score in a given array. Returns the percentage\n// of all values in the input array that are less than (kind='strict') or\n// less or equal than (kind='weak') score. Default is weak.\njStat.percentileOfScore = function percentileOfScore(arr, score, kind) {\n  var counter = 0;\n  var len = arr.length;\n  var strict = false;\n  var value, i;\n\n  if (kind === 'strict')\n    strict = true;\n\n  for (i = 0; i < len; i++) {\n    value = arr[i];\n    if ((strict && value < score) ||\n        (!strict && value <= score)) {\n      counter++;\n    }\n  }\n\n  return counter / len;\n};\n\n\n// Histogram (bin count) data\njStat.histogram = function histogram(arr, binCnt) {\n  binCnt = binCnt || 4;\n  var first = jStat.min(arr);\n  var binWidth = (jStat.max(arr) - first) / binCnt;\n  var len = arr.length;\n  var bins = [];\n  var i;\n\n  for (i = 0; i < binCnt; i++)\n    bins[i] = 0;\n  for (i = 0; i < len; i++)\n    bins[Math.min(Math.floor(((arr[i] - first) / binWidth)), binCnt - 1)] += 1;\n\n  return bins;\n};\n\n\n// covariance of two arrays\njStat.covariance = function covariance(arr1, arr2) {\n  var u = jStat.mean(arr1);\n  var v = jStat.mean(arr2);\n  var arr1Len = arr1.length;\n  var sq_dev = new Array(arr1Len);\n  var i;\n\n  for (i = 0; i < arr1Len; i++)\n    sq_dev[i] = (arr1[i] - u) * (arr2[i] - v);\n\n  return jStat.sum(sq_dev) / (arr1Len - 1);\n};\n\n\n// (pearson's) population correlation coefficient, rho\njStat.corrcoeff = function corrcoeff(arr1, arr2) {\n  return jStat.covariance(arr1, arr2) /\n      jStat.stdev(arr1, 1) /\n      jStat.stdev(arr2, 1);\n};\n\n  // (spearman's) rank correlation coefficient, sp\njStat.spearmancoeff =  function (arr1, arr2) {\n  arr1 = jStat.rank(arr1);\n  arr2 = jStat.rank(arr2);\n  //return pearson's correlation of the ranks:\n  return jStat.corrcoeff(arr1, arr2);\n}\n\n\n// statistical standardized moments (general form of skew/kurt)\njStat.stanMoment = function stanMoment(arr, n) {\n  var mu = jStat.mean(arr);\n  var sigma = jStat.stdev(arr);\n  var len = arr.length;\n  var skewSum = 0;\n\n  for (var i = 0; i < len; i++)\n    skewSum += Math.pow((arr[i] - mu) / sigma, n);\n\n  return skewSum / arr.length;\n};\n\n// (pearson's) moment coefficient of skewness\njStat.skewness = function skewness(arr) {\n  return jStat.stanMoment(arr, 3);\n};\n\n// (pearson's) (excess) kurtosis\njStat.kurtosis = function kurtosis(arr) {\n  return jStat.stanMoment(arr, 4) - 3;\n};\n\n\nvar jProto = jStat.prototype;\n\n\n// Extend jProto with method for calculating cumulative sums and products.\n// This differs from the similar extension below as cumsum and cumprod should\n// not be run again in the case fullbool === true.\n// If a matrix is passed, automatically assume operation should be done on the\n// columns.\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    // If a matrix is passed, automatically assume operation should be done on\n    // the columns.\n    jProto[passfunc] = function(fullbool, func) {\n      var arr = [];\n      var i = 0;\n      var tmpthis = this;\n      // Assignment reassignation depending on how parameters were passed in.\n      if (isFunction(fullbool)) {\n        func = fullbool;\n        fullbool = false;\n      }\n      // Check if a callback was passed with the function.\n      if (func) {\n        setTimeout(function() {\n          func.call(tmpthis, jProto[passfunc].call(tmpthis, fullbool));\n        });\n        return this;\n      }\n      // Check if matrix and run calculations.\n      if (this.length > 1) {\n        tmpthis = fullbool === true ? this : this.transpose();\n        for (; i < tmpthis.length; i++)\n          arr[i] = jStat[passfunc](tmpthis[i]);\n        return arr;\n      }\n      // Pass fullbool if only vector, not a matrix. for variance and stdev.\n      return jStat[passfunc](this[0], fullbool);\n    };\n  })(funcs[i]);\n})(('cumsum cumprod').split(' '));\n\n\n// Extend jProto with methods which don't require arguments and work on columns.\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    // If a matrix is passed, automatically assume operation should be done on\n    // the columns.\n    jProto[passfunc] = function(fullbool, func) {\n      var arr = [];\n      var i = 0;\n      var tmpthis = this;\n      // Assignment reassignation depending on how parameters were passed in.\n      if (isFunction(fullbool)) {\n        func = fullbool;\n        fullbool = false;\n      }\n      // Check if a callback was passed with the function.\n      if (func) {\n        setTimeout(function() {\n          func.call(tmpthis, jProto[passfunc].call(tmpthis, fullbool));\n        });\n        return this;\n      }\n      // Check if matrix and run calculations.\n      if (this.length > 1) {\n        if (passfunc !== 'sumrow')\n          tmpthis = fullbool === true ? this : this.transpose();\n        for (; i < tmpthis.length; i++)\n          arr[i] = jStat[passfunc](tmpthis[i]);\n        return fullbool === true\n            ? jStat[passfunc](jStat.utils.toVector(arr))\n            : arr;\n      }\n      // Pass fullbool if only vector, not a matrix. for variance and stdev.\n      return jStat[passfunc](this[0], fullbool);\n    };\n  })(funcs[i]);\n})(('sum sumsqrd sumsqerr sumrow product min max unique mean meansqerr ' +\n    'geomean median diff rank mode range variance deviation stdev meandev ' +\n    'meddev coeffvar quartiles histogram skewness kurtosis').split(' '));\n\n\n// Extend jProto with functions that take arguments. Operations on matrices are\n// done on columns.\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    jProto[passfunc] = function() {\n      var arr = [];\n      var i = 0;\n      var tmpthis = this;\n      var args = Array.prototype.slice.call(arguments);\n      var callbackFunction;\n\n      // If the last argument is a function, we assume it's a callback; we\n      // strip the callback out and call the function again.\n      if (isFunction(args[args.length - 1])) {\n        callbackFunction = args[args.length - 1];\n        var argsToPass = args.slice(0, args.length - 1);\n\n        setTimeout(function() {\n          callbackFunction.call(tmpthis,\n                                jProto[passfunc].apply(tmpthis, argsToPass));\n        });\n        return this;\n\n      // Otherwise we curry the function args and call normally.\n      } else {\n        callbackFunction = undefined;\n        var curriedFunction = function curriedFunction(vector) {\n          return jStat[passfunc].apply(tmpthis, [vector].concat(args));\n        }\n      }\n\n      // If this is a matrix, run column-by-column.\n      if (this.length > 1) {\n        tmpthis = tmpthis.transpose();\n        for (; i < tmpthis.length; i++)\n          arr[i] = curriedFunction(tmpthis[i]);\n        return arr;\n      }\n\n      // Otherwise run on the vector.\n      return curriedFunction(this[0]);\n    };\n  })(funcs[i]);\n})('quantiles percentileOfScore'.split(' '));\n\n}(jStat, Math));\n// Special functions //\n(function(jStat, Math) {\n\n// Log-gamma function\njStat.gammaln = function gammaln(x) {\n  var j = 0;\n  var cof = [\n    76.18009172947146, -86.50532032941677, 24.01409824083091,\n    -1.231739572450155, 0.1208650973866179e-2, -0.5395239384953e-5\n  ];\n  var ser = 1.000000000190015;\n  var xx, y, tmp;\n  tmp = (y = xx = x) + 5.5;\n  tmp -= (xx + 0.5) * Math.log(tmp);\n  for (; j < 6; j++)\n    ser += cof[j] / ++y;\n  return Math.log(2.5066282746310005 * ser / xx) - tmp;\n};\n\n/*\n * log-gamma function to support poisson distribution sampling. The\n * algorithm comes from SPECFUN by Shanjie Zhang and Jianming Jin and their\n * book \"Computation of Special Functions\", 1996, John Wiley & Sons, Inc.\n */\njStat.loggam = function loggam(x) {\n  var x0, x2, xp, gl, gl0;\n  var k, n;\n\n  var a = [8.333333333333333e-02, -2.777777777777778e-03,\n          7.936507936507937e-04, -5.952380952380952e-04,\n          8.417508417508418e-04, -1.917526917526918e-03,\n          6.410256410256410e-03, -2.955065359477124e-02,\n          1.796443723688307e-01, -1.39243221690590e+00];\n  x0 = x;\n  n = 0;\n  if ((x == 1.0) || (x == 2.0)) {\n      return 0.0;\n  }\n  if (x <= 7.0) {\n      n = Math.floor(7 - x);\n      x0 = x + n;\n  }\n  x2 = 1.0 / (x0 * x0);\n  xp = 2 * Math.PI;\n  gl0 = a[9];\n  for (k = 8; k >= 0; k--) {\n      gl0 *= x2;\n      gl0 += a[k];\n  }\n  gl = gl0 / x0 + 0.5 * Math.log(xp) + (x0 - 0.5) * Math.log(x0) - x0;\n  if (x <= 7.0) {\n      for (k = 1; k <= n; k++) {\n          gl -= Math.log(x0 - 1.0);\n          x0 -= 1.0;\n      }\n  }\n  return gl;\n}\n\n// gamma of x\njStat.gammafn = function gammafn(x) {\n  var p = [-1.716185138865495, 24.76565080557592, -379.80425647094563,\n           629.3311553128184, 866.9662027904133, -31451.272968848367,\n           -36144.413418691176, 66456.14382024054\n  ];\n  var q = [-30.8402300119739, 315.35062697960416, -1015.1563674902192,\n           -3107.771671572311, 22538.118420980151, 4755.8462775278811,\n           -134659.9598649693, -115132.2596755535];\n  var fact = false;\n  var n = 0;\n  var xden = 0;\n  var xnum = 0;\n  var y = x;\n  var i, z, yi, res;\n  if (x > 171.6243769536076) {\n    return Infinity;\n  }\n  if (y <= 0) {\n    res = y % 1 + 3.6e-16;\n    if (res) {\n      fact = (!(y & 1) ? 1 : -1) * Math.PI / Math.sin(Math.PI * res);\n      y = 1 - y;\n    } else {\n      return Infinity;\n    }\n  }\n  yi = y;\n  if (y < 1) {\n    z = y++;\n  } else {\n    z = (y -= n = (y | 0) - 1) - 1;\n  }\n  for (i = 0; i < 8; ++i) {\n    xnum = (xnum + p[i]) * z;\n    xden = xden * z + q[i];\n  }\n  res = xnum / xden + 1;\n  if (yi < y) {\n    res /= yi;\n  } else if (yi > y) {\n    for (i = 0; i < n; ++i) {\n      res *= y;\n      y++;\n    }\n  }\n  if (fact) {\n    res = fact / res;\n  }\n  return res;\n};\n\n\n// lower incomplete gamma function, which is usually typeset with a\n// lower-case greek gamma as the function symbol\njStat.gammap = function gammap(a, x) {\n  return jStat.lowRegGamma(a, x) * jStat.gammafn(a);\n};\n\n\n// The lower regularized incomplete gamma function, usually written P(a,x)\njStat.lowRegGamma = function lowRegGamma(a, x) {\n  var aln = jStat.gammaln(a);\n  var ap = a;\n  var sum = 1 / a;\n  var del = sum;\n  var b = x + 1 - a;\n  var c = 1 / 1.0e-30;\n  var d = 1 / b;\n  var h = d;\n  var i = 1;\n  // calculate maximum number of itterations required for a\n  var ITMAX = -~(Math.log((a >= 1) ? a : 1 / a) * 8.5 + a * 0.4 + 17);\n  var an;\n\n  if (x < 0 || a <= 0) {\n    return NaN;\n  } else if (x < a + 1) {\n    for (; i <= ITMAX; i++) {\n      sum += del *= x / ++ap;\n    }\n    return (sum * Math.exp(-x + a * Math.log(x) - (aln)));\n  }\n\n  for (; i <= ITMAX; i++) {\n    an = -i * (i - a);\n    b += 2;\n    d = an * d + b;\n    c = b + an / c;\n    d = 1 / d;\n    h *= d * c;\n  }\n\n  return (1 - h * Math.exp(-x + a * Math.log(x) - (aln)));\n};\n\n// natural log factorial of n\njStat.factorialln = function factorialln(n) {\n  return n < 0 ? NaN : jStat.gammaln(n + 1);\n};\n\n// factorial of n\njStat.factorial = function factorial(n) {\n  return n < 0 ? NaN : jStat.gammafn(n + 1);\n};\n\n// combinations of n, m\njStat.combination = function combination(n, m) {\n  // make sure n or m don't exceed the upper limit of usable values\n  return (n > 170 || m > 170)\n      ? Math.exp(jStat.combinationln(n, m))\n      : (jStat.factorial(n) / jStat.factorial(m)) / jStat.factorial(n - m);\n};\n\n\njStat.combinationln = function combinationln(n, m){\n  return jStat.factorialln(n) - jStat.factorialln(m) - jStat.factorialln(n - m);\n};\n\n\n// permutations of n, m\njStat.permutation = function permutation(n, m) {\n  return jStat.factorial(n) / jStat.factorial(n - m);\n};\n\n\n// beta function\njStat.betafn = function betafn(x, y) {\n  // ensure arguments are positive\n  if (x <= 0 || y <= 0)\n    return undefined;\n  // make sure x + y doesn't exceed the upper limit of usable values\n  return (x + y > 170)\n      ? Math.exp(jStat.betaln(x, y))\n      : jStat.gammafn(x) * jStat.gammafn(y) / jStat.gammafn(x + y);\n};\n\n\n// natural logarithm of beta function\njStat.betaln = function betaln(x, y) {\n  return jStat.gammaln(x) + jStat.gammaln(y) - jStat.gammaln(x + y);\n};\n\n\n// Evaluates the continued fraction for incomplete beta function by modified\n// Lentz's method.\njStat.betacf = function betacf(x, a, b) {\n  var fpmin = 1e-30;\n  var m = 1;\n  var qab = a + b;\n  var qap = a + 1;\n  var qam = a - 1;\n  var c = 1;\n  var d = 1 - qab * x / qap;\n  var m2, aa, del, h;\n\n  // These q's will be used in factors that occur in the coefficients\n  if (Math.abs(d) < fpmin)\n    d = fpmin;\n  d = 1 / d;\n  h = d;\n\n  for (; m <= 100; m++) {\n    m2 = 2 * m;\n    aa = m * (b - m) * x / ((qam + m2) * (a + m2));\n    // One step (the even one) of the recurrence\n    d = 1 + aa * d;\n    if (Math.abs(d) < fpmin)\n      d = fpmin;\n    c = 1 + aa / c;\n    if (Math.abs(c) < fpmin)\n      c = fpmin;\n    d = 1 / d;\n    h *= d * c;\n    aa = -(a + m) * (qab + m) * x / ((a + m2) * (qap + m2));\n    // Next step of the recurrence (the odd one)\n    d = 1 + aa * d;\n    if (Math.abs(d) < fpmin)\n      d = fpmin;\n    c = 1 + aa / c;\n    if (Math.abs(c) < fpmin)\n      c = fpmin;\n    d = 1 / d;\n    del = d * c;\n    h *= del;\n    if (Math.abs(del - 1.0) < 3e-7)\n      break;\n  }\n\n  return h;\n};\n\n\n// Returns the inverse of the lower regularized inomplete gamma function\njStat.gammapinv = function gammapinv(p, a) {\n  var j = 0;\n  var a1 = a - 1;\n  var EPS = 1e-8;\n  var gln = jStat.gammaln(a);\n  var x, err, t, u, pp, lna1, afac;\n\n  if (p >= 1)\n    return Math.max(100, a + 100 * Math.sqrt(a));\n  if (p <= 0)\n    return 0;\n  if (a > 1) {\n    lna1 = Math.log(a1);\n    afac = Math.exp(a1 * (lna1 - 1) - gln);\n    pp = (p < 0.5) ? p : 1 - p;\n    t = Math.sqrt(-2 * Math.log(pp));\n    x = (2.30753 + t * 0.27061) / (1 + t * (0.99229 + t * 0.04481)) - t;\n    if (p < 0.5)\n      x = -x;\n    x = Math.max(1e-3,\n                 a * Math.pow(1 - 1 / (9 * a) - x / (3 * Math.sqrt(a)), 3));\n  } else {\n    t = 1 - a * (0.253 + a * 0.12);\n    if (p < t)\n      x = Math.pow(p / t, 1 / a);\n    else\n      x = 1 - Math.log(1 - (p - t) / (1 - t));\n  }\n\n  for(; j < 12; j++) {\n    if (x <= 0)\n      return 0;\n    err = jStat.lowRegGamma(a, x) - p;\n    if (a > 1)\n      t = afac * Math.exp(-(x - a1) + a1 * (Math.log(x) - lna1));\n    else\n      t = Math.exp(-x + a1 * Math.log(x) - gln);\n    u = err / t;\n    x -= (t = u / (1 - 0.5 * Math.min(1, u * ((a - 1) / x - 1))));\n    if (x <= 0)\n      x = 0.5 * (x + t);\n    if (Math.abs(t) < EPS * x)\n      break;\n  }\n\n  return x;\n};\n\n\n// Returns the error function erf(x)\njStat.erf = function erf(x) {\n  var cof = [-1.3026537197817094, 6.4196979235649026e-1, 1.9476473204185836e-2,\n             -9.561514786808631e-3, -9.46595344482036e-4, 3.66839497852761e-4,\n             4.2523324806907e-5, -2.0278578112534e-5, -1.624290004647e-6,\n             1.303655835580e-6, 1.5626441722e-8, -8.5238095915e-8,\n             6.529054439e-9, 5.059343495e-9, -9.91364156e-10,\n             -2.27365122e-10, 9.6467911e-11, 2.394038e-12,\n             -6.886027e-12, 8.94487e-13, 3.13092e-13,\n             -1.12708e-13, 3.81e-16, 7.106e-15,\n             -1.523e-15, -9.4e-17, 1.21e-16,\n             -2.8e-17];\n  var j = cof.length - 1;\n  var isneg = false;\n  var d = 0;\n  var dd = 0;\n  var t, ty, tmp, res;\n\n  if (x < 0) {\n    x = -x;\n    isneg = true;\n  }\n\n  t = 2 / (2 + x);\n  ty = 4 * t - 2;\n\n  for(; j > 0; j--) {\n    tmp = d;\n    d = ty * d - dd + cof[j];\n    dd = tmp;\n  }\n\n  res = t * Math.exp(-x * x + 0.5 * (cof[0] + ty * d) - dd);\n  return isneg ? res - 1 : 1 - res;\n};\n\n\n// Returns the complmentary error function erfc(x)\njStat.erfc = function erfc(x) {\n  return 1 - jStat.erf(x);\n};\n\n\n// Returns the inverse of the complementary error function\njStat.erfcinv = function erfcinv(p) {\n  var j = 0;\n  var x, err, t, pp;\n  if (p >= 2)\n    return -100;\n  if (p <= 0)\n    return 100;\n  pp = (p < 1) ? p : 2 - p;\n  t = Math.sqrt(-2 * Math.log(pp / 2));\n  x = -0.70711 * ((2.30753 + t * 0.27061) /\n                  (1 + t * (0.99229 + t * 0.04481)) - t);\n  for (; j < 2; j++) {\n    err = jStat.erfc(x) - pp;\n    x += err / (1.12837916709551257 * Math.exp(-x * x) - x * err);\n  }\n  return (p < 1) ? x : -x;\n};\n\n\n// Returns the inverse of the incomplete beta function\njStat.ibetainv = function ibetainv(p, a, b) {\n  var EPS = 1e-8;\n  var a1 = a - 1;\n  var b1 = b - 1;\n  var j = 0;\n  var lna, lnb, pp, t, u, err, x, al, h, w, afac;\n  if (p <= 0)\n    return 0;\n  if (p >= 1)\n    return 1;\n  if (a >= 1 && b >= 1) {\n    pp = (p < 0.5) ? p : 1 - p;\n    t = Math.sqrt(-2 * Math.log(pp));\n    x = (2.30753 + t * 0.27061) / (1 + t* (0.99229 + t * 0.04481)) - t;\n    if (p < 0.5)\n      x = -x;\n    al = (x * x - 3) / 6;\n    h = 2 / (1 / (2 * a - 1)  + 1 / (2 * b - 1));\n    w = (x * Math.sqrt(al + h) / h) - (1 / (2 * b - 1) - 1 / (2 * a - 1)) *\n        (al + 5 / 6 - 2 / (3 * h));\n    x = a / (a + b * Math.exp(2 * w));\n  } else {\n    lna = Math.log(a / (a + b));\n    lnb = Math.log(b / (a + b));\n    t = Math.exp(a * lna) / a;\n    u = Math.exp(b * lnb) / b;\n    w = t + u;\n    if (p < t / w)\n      x = Math.pow(a * w * p, 1 / a);\n    else\n      x = 1 - Math.pow(b * w * (1 - p), 1 / b);\n  }\n  afac = -jStat.gammaln(a) - jStat.gammaln(b) + jStat.gammaln(a + b);\n  for(; j < 10; j++) {\n    if (x === 0 || x === 1)\n      return x;\n    err = jStat.ibeta(x, a, b) - p;\n    t = Math.exp(a1 * Math.log(x) + b1 * Math.log(1 - x) + afac);\n    u = err / t;\n    x -= (t = u / (1 - 0.5 * Math.min(1, u * (a1 / x - b1 / (1 - x)))));\n    if (x <= 0)\n      x = 0.5 * (x + t);\n    if (x >= 1)\n      x = 0.5 * (x + t + 1);\n    if (Math.abs(t) < EPS * x && j > 0)\n      break;\n  }\n  return x;\n};\n\n\n// Returns the incomplete beta function I_x(a,b)\njStat.ibeta = function ibeta(x, a, b) {\n  // Factors in front of the continued fraction.\n  var bt = (x === 0 || x === 1) ?  0 :\n    Math.exp(jStat.gammaln(a + b) - jStat.gammaln(a) -\n             jStat.gammaln(b) + a * Math.log(x) + b *\n             Math.log(1 - x));\n  if (x < 0 || x > 1)\n    return false;\n  if (x < (a + 1) / (a + b + 2))\n    // Use continued fraction directly.\n    return bt * jStat.betacf(x, a, b) / a;\n  // else use continued fraction after making the symmetry transformation.\n  return 1 - bt * jStat.betacf(1 - x, b, a) / b;\n};\n\n\n// Returns a normal deviate (mu=0, sigma=1).\n// If n and m are specified it returns a object of normal deviates.\njStat.randn = function randn(n, m) {\n  var u, v, x, y, q;\n  if (!m)\n    m = n;\n  if (n)\n    return jStat.create(n, m, function() { return jStat.randn(); });\n  do {\n    u = jStat._random_fn();\n    v = 1.7156 * (jStat._random_fn() - 0.5);\n    x = u - 0.449871;\n    y = Math.abs(v) + 0.386595;\n    q = x * x + y * (0.19600 * y - 0.25472 * x);\n  } while (q > 0.27597 && (q > 0.27846 || v * v > -4 * Math.log(u) * u * u));\n  return v / u;\n};\n\n\n// Returns a gamma deviate by the method of Marsaglia and Tsang.\njStat.randg = function randg(shape, n, m) {\n  var oalph = shape;\n  var a1, a2, u, v, x, mat;\n  if (!m)\n    m = n;\n  if (!shape)\n    shape = 1;\n  if (n) {\n    mat = jStat.zeros(n,m);\n    mat.alter(function() { return jStat.randg(shape); });\n    return mat;\n  }\n  if (shape < 1)\n    shape += 1;\n  a1 = shape - 1 / 3;\n  a2 = 1 / Math.sqrt(9 * a1);\n  do {\n    do {\n      x = jStat.randn();\n      v = 1 + a2 * x;\n    } while(v <= 0);\n    v = v * v * v;\n    u = jStat._random_fn();\n  } while(u > 1 - 0.331 * Math.pow(x, 4) &&\n          Math.log(u) > 0.5 * x*x + a1 * (1 - v + Math.log(v)));\n  // alpha > 1\n  if (shape == oalph)\n    return a1 * v;\n  // alpha < 1\n  do {\n    u = jStat._random_fn();\n  } while(u === 0);\n  return Math.pow(u, 1 / oalph) * a1 * v;\n};\n\n\n// making use of static methods on the instance\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    jStat.fn[passfunc] = function() {\n      return jStat(\n          jStat.map(this, function(value) { return jStat[passfunc](value); }));\n    }\n  })(funcs[i]);\n})('gammaln gammafn factorial factorialln'.split(' '));\n\n\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    jStat.fn[passfunc] = function() {\n      return jStat(jStat[passfunc].apply(null, arguments));\n    };\n  })(funcs[i]);\n})('randn'.split(' '));\n\n}(jStat, Math));\n(function(jStat, Math) {\n\n// generate all distribution instance methods\n(function(list) {\n  for (var i = 0; i < list.length; i++) (function(func) {\n    // distribution instance method\n    jStat[func] = function f(a, b, c) {\n      if (!(this instanceof f))\n        return new f(a, b, c);\n      this._a = a;\n      this._b = b;\n      this._c = c;\n      return this;\n    };\n    // distribution method to be used on a jStat instance\n    jStat.fn[func] = function(a, b, c) {\n      var newthis = jStat[func](a, b, c);\n      newthis.data = this;\n      return newthis;\n    };\n    // sample instance method\n    jStat[func].prototype.sample = function(arr) {\n      var a = this._a;\n      var b = this._b;\n      var c = this._c;\n      if (arr)\n        return jStat.alter(arr, function() {\n          return jStat[func].sample(a, b, c);\n        });\n      else\n        return jStat[func].sample(a, b, c);\n    };\n    // generate the pdf, cdf and inv instance methods\n    (function(vals) {\n      for (var i = 0; i < vals.length; i++) (function(fnfunc) {\n        jStat[func].prototype[fnfunc] = function(x) {\n          var a = this._a;\n          var b = this._b;\n          var c = this._c;\n          if (!x && x !== 0)\n            x = this.data;\n          if (typeof x !== 'number') {\n            return jStat.fn.map.call(x, function(x) {\n              return jStat[func][fnfunc](x, a, b, c);\n            });\n          }\n          return jStat[func][fnfunc](x, a, b, c);\n        };\n      })(vals[i]);\n    })('pdf cdf inv'.split(' '));\n    // generate the mean, median, mode and variance instance methods\n    (function(vals) {\n      for (var i = 0; i < vals.length; i++) (function(fnfunc) {\n        jStat[func].prototype[fnfunc] = function() {\n          return jStat[func][fnfunc](this._a, this._b, this._c);\n        };\n      })(vals[i]);\n    })('mean median mode variance'.split(' '));\n  })(list[i]);\n})((\n  'beta centralF cauchy chisquare exponential gamma invgamma kumaraswamy ' +\n  'laplace lognormal noncentralt normal pareto studentt weibull uniform ' +\n  'binomial negbin hypgeom poisson triangular tukey arcsine'\n).split(' '));\n\n\n\n// extend beta function with static methods\njStat.extend(jStat.beta, {\n  pdf: function pdf(x, alpha, beta) {\n    // PDF is zero outside the support\n    if (x > 1 || x < 0)\n      return 0;\n    // PDF is one for the uniform case\n    if (alpha == 1 && beta == 1)\n      return 1;\n\n    if (alpha < 512 && beta < 512) {\n      return (Math.pow(x, alpha - 1) * Math.pow(1 - x, beta - 1)) /\n          jStat.betafn(alpha, beta);\n    } else {\n      return Math.exp((alpha - 1) * Math.log(x) +\n                      (beta - 1) * Math.log(1 - x) -\n                      jStat.betaln(alpha, beta));\n    }\n  },\n\n  cdf: function cdf(x, alpha, beta) {\n    return (x > 1 || x < 0) ? (x > 1) * 1 : jStat.ibeta(x, alpha, beta);\n  },\n\n  inv: function inv(x, alpha, beta) {\n    return jStat.ibetainv(x, alpha, beta);\n  },\n\n  mean: function mean(alpha, beta) {\n    return alpha / (alpha + beta);\n  },\n\n  median: function median(alpha, beta) {\n    return jStat.ibetainv(0.5, alpha, beta);\n  },\n\n  mode: function mode(alpha, beta) {\n    return (alpha - 1 ) / ( alpha + beta - 2);\n  },\n\n  // return a random sample\n  sample: function sample(alpha, beta) {\n    var u = jStat.randg(alpha);\n    return u / (u + jStat.randg(beta));\n  },\n\n  variance: function variance(alpha, beta) {\n    return (alpha * beta) / (Math.pow(alpha + beta, 2) * (alpha + beta + 1));\n  }\n});\n\n// extend F function with static methods\njStat.extend(jStat.centralF, {\n  // This implementation of the pdf function avoids float overflow\n  // See the way that R calculates this value:\n  // https://svn.r-project.org/R/trunk/src/nmath/df.c\n  pdf: function pdf(x, df1, df2) {\n    var p, q, f;\n\n    if (x < 0)\n      return 0;\n\n    if (df1 <= 2) {\n      if (x === 0 && df1 < 2) {\n        return Infinity;\n      }\n      if (x === 0 && df1 === 2) {\n        return 1;\n      }\n      return (1 / jStat.betafn(df1 / 2, df2 / 2)) *\n              Math.pow(df1 / df2, df1 / 2) *\n              Math.pow(x, (df1/2) - 1) *\n              Math.pow((1 + (df1 / df2) * x), -(df1 + df2) / 2);\n    }\n\n    p = (df1 * x) / (df2 + x * df1);\n    q = df2 / (df2 + x * df1);\n    f = df1 * q / 2.0;\n    return f * jStat.binomial.pdf((df1 - 2) / 2, (df1 + df2 - 2) / 2, p);\n  },\n\n  cdf: function cdf(x, df1, df2) {\n    if (x < 0)\n      return 0;\n    return jStat.ibeta((df1 * x) / (df1 * x + df2), df1 / 2, df2 / 2);\n  },\n\n  inv: function inv(x, df1, df2) {\n    return df2 / (df1 * (1 / jStat.ibetainv(x, df1 / 2, df2 / 2) - 1));\n  },\n\n  mean: function mean(df1, df2) {\n    return (df2 > 2) ? df2 / (df2 - 2) : undefined;\n  },\n\n  mode: function mode(df1, df2) {\n    return (df1 > 2) ? (df2 * (df1 - 2)) / (df1 * (df2 + 2)) : undefined;\n  },\n\n  // return a random sample\n  sample: function sample(df1, df2) {\n    var x1 = jStat.randg(df1 / 2) * 2;\n    var x2 = jStat.randg(df2 / 2) * 2;\n    return (x1 / df1) / (x2 / df2);\n  },\n\n  variance: function variance(df1, df2) {\n    if (df2 <= 4)\n      return undefined;\n    return 2 * df2 * df2 * (df1 + df2 - 2) /\n        (df1 * (df2 - 2) * (df2 - 2) * (df2 - 4));\n  }\n});\n\n\n// extend cauchy function with static methods\njStat.extend(jStat.cauchy, {\n  pdf: function pdf(x, local, scale) {\n    if (scale < 0) { return 0; }\n\n    return (scale / (Math.pow(x - local, 2) + Math.pow(scale, 2))) / Math.PI;\n  },\n\n  cdf: function cdf(x, local, scale) {\n    return Math.atan((x - local) / scale) / Math.PI + 0.5;\n  },\n\n  inv: function(p, local, scale) {\n    return local + scale * Math.tan(Math.PI * (p - 0.5));\n  },\n\n  median: function median(local/*, scale*/) {\n    return local;\n  },\n\n  mode: function mode(local/*, scale*/) {\n    return local;\n  },\n\n  sample: function sample(local, scale) {\n    return jStat.randn() *\n        Math.sqrt(1 / (2 * jStat.randg(0.5))) * scale + local;\n  }\n});\n\n\n\n// extend chisquare function with static methods\njStat.extend(jStat.chisquare, {\n  pdf: function pdf(x, dof) {\n    if (x < 0)\n      return 0;\n    return (x === 0 && dof === 2) ? 0.5 :\n        Math.exp((dof / 2 - 1) * Math.log(x) - x / 2 - (dof / 2) *\n                 Math.log(2) - jStat.gammaln(dof / 2));\n  },\n\n  cdf: function cdf(x, dof) {\n    if (x < 0)\n      return 0;\n    return jStat.lowRegGamma(dof / 2, x / 2);\n  },\n\n  inv: function(p, dof) {\n    return 2 * jStat.gammapinv(p, 0.5 * dof);\n  },\n\n  mean : function(dof) {\n    return dof;\n  },\n\n  // TODO: this is an approximation (is there a better way?)\n  median: function median(dof) {\n    return dof * Math.pow(1 - (2 / (9 * dof)), 3);\n  },\n\n  mode: function mode(dof) {\n    return (dof - 2 > 0) ? dof - 2 : 0;\n  },\n\n  sample: function sample(dof) {\n    return jStat.randg(dof / 2) * 2;\n  },\n\n  variance: function variance(dof) {\n    return 2 * dof;\n  }\n});\n\n\n\n// extend exponential function with static methods\njStat.extend(jStat.exponential, {\n  pdf: function pdf(x, rate) {\n    return x < 0 ? 0 : rate * Math.exp(-rate * x);\n  },\n\n  cdf: function cdf(x, rate) {\n    return x < 0 ? 0 : 1 - Math.exp(-rate * x);\n  },\n\n  inv: function(p, rate) {\n    return -Math.log(1 - p) / rate;\n  },\n\n  mean : function(rate) {\n    return 1 / rate;\n  },\n\n  median: function (rate) {\n    return (1 / rate) * Math.log(2);\n  },\n\n  mode: function mode(/*rate*/) {\n    return 0;\n  },\n\n  sample: function sample(rate) {\n    return -1 / rate * Math.log(jStat._random_fn());\n  },\n\n  variance : function(rate) {\n    return Math.pow(rate, -2);\n  }\n});\n\n\n\n// extend gamma function with static methods\njStat.extend(jStat.gamma, {\n  pdf: function pdf(x, shape, scale) {\n    if (x < 0)\n      return 0;\n    return (x === 0 && shape === 1) ? 1 / scale :\n            Math.exp((shape - 1) * Math.log(x) - x / scale -\n                    jStat.gammaln(shape) - shape * Math.log(scale));\n  },\n\n  cdf: function cdf(x, shape, scale) {\n    if (x < 0)\n      return 0;\n    return jStat.lowRegGamma(shape, x / scale);\n  },\n\n  inv: function(p, shape, scale) {\n    return jStat.gammapinv(p, shape) * scale;\n  },\n\n  mean : function(shape, scale) {\n    return shape * scale;\n  },\n\n  mode: function mode(shape, scale) {\n    if(shape > 1) return (shape - 1) * scale;\n    return undefined;\n  },\n\n  sample: function sample(shape, scale) {\n    return jStat.randg(shape) * scale;\n  },\n\n  variance: function variance(shape, scale) {\n    return shape * scale * scale;\n  }\n});\n\n// extend inverse gamma function with static methods\njStat.extend(jStat.invgamma, {\n  pdf: function pdf(x, shape, scale) {\n    if (x <= 0)\n      return 0;\n    return Math.exp(-(shape + 1) * Math.log(x) - scale / x -\n                    jStat.gammaln(shape) + shape * Math.log(scale));\n  },\n\n  cdf: function cdf(x, shape, scale) {\n    if (x <= 0)\n      return 0;\n    return 1 - jStat.lowRegGamma(shape, scale / x);\n  },\n\n  inv: function(p, shape, scale) {\n    return scale / jStat.gammapinv(1 - p, shape);\n  },\n\n  mean : function(shape, scale) {\n    return (shape > 1) ? scale / (shape - 1) : undefined;\n  },\n\n  mode: function mode(shape, scale) {\n    return scale / (shape + 1);\n  },\n\n  sample: function sample(shape, scale) {\n    return scale / jStat.randg(shape);\n  },\n\n  variance: function variance(shape, scale) {\n    if (shape <= 2)\n      return undefined;\n    return scale * scale / ((shape - 1) * (shape - 1) * (shape - 2));\n  }\n});\n\n\n// extend kumaraswamy function with static methods\njStat.extend(jStat.kumaraswamy, {\n  pdf: function pdf(x, alpha, beta) {\n    if (x === 0 && alpha === 1)\n      return beta;\n    else if (x === 1 && beta === 1)\n      return alpha;\n    return Math.exp(Math.log(alpha) + Math.log(beta) + (alpha - 1) *\n                    Math.log(x) + (beta - 1) *\n                    Math.log(1 - Math.pow(x, alpha)));\n  },\n\n  cdf: function cdf(x, alpha, beta) {\n    if (x < 0)\n      return 0;\n    else if (x > 1)\n      return 1;\n    return (1 - Math.pow(1 - Math.pow(x, alpha), beta));\n  },\n\n  inv: function inv(p, alpha, beta) {\n    return Math.pow(1 - Math.pow(1 - p, 1 / beta), 1 / alpha);\n  },\n\n  mean : function(alpha, beta) {\n    return (beta * jStat.gammafn(1 + 1 / alpha) *\n            jStat.gammafn(beta)) / (jStat.gammafn(1 + 1 / alpha + beta));\n  },\n\n  median: function median(alpha, beta) {\n    return Math.pow(1 - Math.pow(2, -1 / beta), 1 / alpha);\n  },\n\n  mode: function mode(alpha, beta) {\n    if (!(alpha >= 1 && beta >= 1 && (alpha !== 1 && beta !== 1)))\n      return undefined;\n    return Math.pow((alpha - 1) / (alpha * beta - 1), 1 / alpha);\n  },\n\n  variance: function variance(/*alpha, beta*/) {\n    throw new Error('variance not yet implemented');\n    // TODO: complete this\n  }\n});\n\n\n\n// extend lognormal function with static methods\njStat.extend(jStat.lognormal, {\n  pdf: function pdf(x, mu, sigma) {\n    if (x <= 0)\n      return 0;\n    return Math.exp(-Math.log(x) - 0.5 * Math.log(2 * Math.PI) -\n                    Math.log(sigma) - Math.pow(Math.log(x) - mu, 2) /\n                    (2 * sigma * sigma));\n  },\n\n  cdf: function cdf(x, mu, sigma) {\n    if (x < 0)\n      return 0;\n    return 0.5 +\n        (0.5 * jStat.erf((Math.log(x) - mu) / Math.sqrt(2 * sigma * sigma)));\n  },\n\n  inv: function(p, mu, sigma) {\n    return Math.exp(-1.41421356237309505 * sigma * jStat.erfcinv(2 * p) + mu);\n  },\n\n  mean: function mean(mu, sigma) {\n    return Math.exp(mu + sigma * sigma / 2);\n  },\n\n  median: function median(mu/*, sigma*/) {\n    return Math.exp(mu);\n  },\n\n  mode: function mode(mu, sigma) {\n    return Math.exp(mu - sigma * sigma);\n  },\n\n  sample: function sample(mu, sigma) {\n    return Math.exp(jStat.randn() * sigma + mu);\n  },\n\n  variance: function variance(mu, sigma) {\n    return (Math.exp(sigma * sigma) - 1) * Math.exp(2 * mu + sigma * sigma);\n  }\n});\n\n\n\n// extend noncentralt function with static methods\njStat.extend(jStat.noncentralt, {\n  pdf: function pdf(x, dof, ncp) {\n    var tol = 1e-14;\n    if (Math.abs(ncp) < tol)  // ncp approx 0; use student-t\n      return jStat.studentt.pdf(x, dof)\n\n    if (Math.abs(x) < tol) {  // different formula for x == 0\n      return Math.exp(jStat.gammaln((dof + 1) / 2) - ncp * ncp / 2 -\n                      0.5 * Math.log(Math.PI * dof) - jStat.gammaln(dof / 2));\n    }\n\n    // formula for x != 0\n    return dof / x *\n        (jStat.noncentralt.cdf(x * Math.sqrt(1 + 2 / dof), dof+2, ncp) -\n         jStat.noncentralt.cdf(x, dof, ncp));\n  },\n\n  cdf: function cdf(x, dof, ncp) {\n    var tol = 1e-14;\n    var min_iterations = 200;\n\n    if (Math.abs(ncp) < tol)  // ncp approx 0; use student-t\n      return jStat.studentt.cdf(x, dof);\n\n    // turn negative x into positive and flip result afterwards\n    var flip = false;\n    if (x < 0) {\n      flip = true;\n      ncp = -ncp;\n    }\n\n    var prob = jStat.normal.cdf(-ncp, 0, 1);\n    var value = tol + 1;\n    // use value at last two steps to determine convergence\n    var lastvalue = value;\n    var y = x * x / (x * x + dof);\n    var j = 0;\n    var p = Math.exp(-ncp * ncp / 2);\n    var q = Math.exp(-ncp * ncp / 2 - 0.5 * Math.log(2) -\n                     jStat.gammaln(3 / 2)) * ncp;\n    while (j < min_iterations || lastvalue > tol || value > tol) {\n      lastvalue = value;\n      if (j > 0) {\n        p *= (ncp * ncp) / (2 * j);\n        q *= (ncp * ncp) / (2 * (j + 1 / 2));\n      }\n      value = p * jStat.beta.cdf(y, j + 0.5, dof / 2) +\n          q * jStat.beta.cdf(y, j+1, dof/2);\n      prob += 0.5 * value;\n      j++;\n    }\n\n    return flip ? (1 - prob) : prob;\n  }\n});\n\n\n// extend normal function with static methods\njStat.extend(jStat.normal, {\n  pdf: function pdf(x, mean, std) {\n    return Math.exp(-0.5 * Math.log(2 * Math.PI) -\n                    Math.log(std) - Math.pow(x - mean, 2) / (2 * std * std));\n  },\n\n  cdf: function cdf(x, mean, std) {\n    return 0.5 * (1 + jStat.erf((x - mean) / Math.sqrt(2 * std * std)));\n  },\n\n  inv: function(p, mean, std) {\n    return -1.41421356237309505 * std * jStat.erfcinv(2 * p) + mean;\n  },\n\n  mean : function(mean/*, std*/) {\n    return mean;\n  },\n\n  median: function median(mean/*, std*/) {\n    return mean;\n  },\n\n  mode: function (mean/*, std*/) {\n    return mean;\n  },\n\n  sample: function sample(mean, std) {\n    return jStat.randn() * std + mean;\n  },\n\n  variance : function(mean, std) {\n    return std * std;\n  }\n});\n\n\n\n// extend pareto function with static methods\njStat.extend(jStat.pareto, {\n  pdf: function pdf(x, scale, shape) {\n    if (x < scale)\n      return 0;\n    return (shape * Math.pow(scale, shape)) / Math.pow(x, shape + 1);\n  },\n\n  cdf: function cdf(x, scale, shape) {\n    if (x < scale)\n      return 0;\n    return 1 - Math.pow(scale / x, shape);\n  },\n\n  inv: function inv(p, scale, shape) {\n    return scale / Math.pow(1 - p, 1 / shape);\n  },\n\n  mean: function mean(scale, shape) {\n    if (shape <= 1)\n      return undefined;\n    return (shape * Math.pow(scale, shape)) / (shape - 1);\n  },\n\n  median: function median(scale, shape) {\n    return scale * (shape * Math.SQRT2);\n  },\n\n  mode: function mode(scale/*, shape*/) {\n    return scale;\n  },\n\n  variance : function(scale, shape) {\n    if (shape <= 2)\n      return undefined;\n    return (scale*scale * shape) / (Math.pow(shape - 1, 2) * (shape - 2));\n  }\n});\n\n\n\n// extend studentt function with static methods\njStat.extend(jStat.studentt, {\n  pdf: function pdf(x, dof) {\n    dof = dof > 1e100 ? 1e100 : dof;\n    return (1/(Math.sqrt(dof) * jStat.betafn(0.5, dof/2))) *\n        Math.pow(1 + ((x * x) / dof), -((dof + 1) / 2));\n  },\n\n  cdf: function cdf(x, dof) {\n    var dof2 = dof / 2;\n    return jStat.ibeta((x + Math.sqrt(x * x + dof)) /\n                       (2 * Math.sqrt(x * x + dof)), dof2, dof2);\n  },\n\n  inv: function(p, dof) {\n    var x = jStat.ibetainv(2 * Math.min(p, 1 - p), 0.5 * dof, 0.5);\n    x = Math.sqrt(dof * (1 - x) / x);\n    return (p > 0.5) ? x : -x;\n  },\n\n  mean: function mean(dof) {\n    return (dof > 1) ? 0 : undefined;\n  },\n\n  median: function median(/*dof*/) {\n    return 0;\n  },\n\n  mode: function mode(/*dof*/) {\n    return 0;\n  },\n\n  sample: function sample(dof) {\n    return jStat.randn() * Math.sqrt(dof / (2 * jStat.randg(dof / 2)));\n  },\n\n  variance: function variance(dof) {\n    return (dof  > 2) ? dof / (dof - 2) : (dof > 1) ? Infinity : undefined;\n  }\n});\n\n\n\n// extend weibull function with static methods\njStat.extend(jStat.weibull, {\n  pdf: function pdf(x, scale, shape) {\n    if (x < 0 || scale < 0 || shape < 0)\n      return 0;\n    return (shape / scale) * Math.pow((x / scale), (shape - 1)) *\n        Math.exp(-(Math.pow((x / scale), shape)));\n  },\n\n  cdf: function cdf(x, scale, shape) {\n    return x < 0 ? 0 : 1 - Math.exp(-Math.pow((x / scale), shape));\n  },\n\n  inv: function(p, scale, shape) {\n    return scale * Math.pow(-Math.log(1 - p), 1 / shape);\n  },\n\n  mean : function(scale, shape) {\n    return scale * jStat.gammafn(1 + 1 / shape);\n  },\n\n  median: function median(scale, shape) {\n    return scale * Math.pow(Math.log(2), 1 / shape);\n  },\n\n  mode: function mode(scale, shape) {\n    if (shape <= 1)\n      return 0;\n    return scale * Math.pow((shape - 1) / shape, 1 / shape);\n  },\n\n  sample: function sample(scale, shape) {\n    return scale * Math.pow(-Math.log(jStat._random_fn()), 1 / shape);\n  },\n\n  variance: function variance(scale, shape) {\n    return scale * scale * jStat.gammafn(1 + 2 / shape) -\n        Math.pow(jStat.weibull.mean(scale, shape), 2);\n  }\n});\n\n\n\n// extend uniform function with static methods\njStat.extend(jStat.uniform, {\n  pdf: function pdf(x, a, b) {\n    return (x < a || x > b) ? 0 : 1 / (b - a);\n  },\n\n  cdf: function cdf(x, a, b) {\n    if (x < a)\n      return 0;\n    else if (x < b)\n      return (x - a) / (b - a);\n    return 1;\n  },\n\n  inv: function(p, a, b) {\n    return a + (p * (b - a));\n  },\n\n  mean: function mean(a, b) {\n    return 0.5 * (a + b);\n  },\n\n  median: function median(a, b) {\n    return jStat.mean(a, b);\n  },\n\n  mode: function mode(/*a, b*/) {\n    throw new Error('mode is not yet implemented');\n  },\n\n  sample: function sample(a, b) {\n    return (a / 2 + b / 2) + (b / 2 - a / 2) * (2 * jStat._random_fn() - 1);\n  },\n\n  variance: function variance(a, b) {\n    return Math.pow(b - a, 2) / 12;\n  }\n});\n\n\n// Got this from http://www.math.ucla.edu/~tom/distributions/binomial.html\nfunction betinc(x, a, b, eps) {\n  var a0 = 0;\n  var b0 = 1;\n  var a1 = 1;\n  var b1 = 1;\n  var m9 = 0;\n  var a2 = 0;\n  var c9;\n\n  while (Math.abs((a1 - a2) / a1) > eps) {\n    a2 = a1;\n    c9 = -(a + m9) * (a + b + m9) * x / (a + 2 * m9) / (a + 2 * m9 + 1);\n    a0 = a1 + c9 * a0;\n    b0 = b1 + c9 * b0;\n    m9 = m9 + 1;\n    c9 = m9 * (b - m9) * x / (a + 2 * m9 - 1) / (a + 2 * m9);\n    a1 = a0 + c9 * a1;\n    b1 = b0 + c9 * b1;\n    a0 = a0 / b1;\n    b0 = b0 / b1;\n    a1 = a1 / b1;\n    b1 = 1;\n  }\n\n  return a1 / a;\n}\n\n\n// extend uniform function with static methods\njStat.extend(jStat.binomial, {\n  pdf: function pdf(k, n, p) {\n    return (p === 0 || p === 1) ?\n      ((n * p) === k ? 1 : 0) :\n      jStat.combination(n, k) * Math.pow(p, k) * Math.pow(1 - p, n - k);\n  },\n\n  cdf: function cdf(x, n, p) {\n    var betacdf;\n    var eps = 1e-10;\n\n    if (x < 0)\n      return 0;\n    if (x >= n)\n      return 1;\n    if (p < 0 || p > 1 || n <= 0)\n      return NaN;\n\n    x = Math.floor(x);\n    var z = p;\n    var a = x + 1;\n    var b = n - x;\n    var s = a + b;\n    var bt = Math.exp(jStat.gammaln(s) - jStat.gammaln(b) -\n                      jStat.gammaln(a) + a * Math.log(z) + b * Math.log(1 - z));\n\n    if (z < (a + 1) / (s + 2))\n      betacdf = bt * betinc(z, a, b, eps);\n    else\n      betacdf = 1 - bt * betinc(1 - z, b, a, eps);\n\n    return Math.round((1 - betacdf) * (1 / eps)) / (1 / eps);\n  }\n});\n\n\n\n// extend uniform function with static methods\njStat.extend(jStat.negbin, {\n  pdf: function pdf(k, r, p) {\n    if (k !== k >>> 0)\n      return false;\n    if (k < 0)\n      return 0;\n    return jStat.combination(k + r - 1, r - 1) *\n        Math.pow(1 - p, k) * Math.pow(p, r);\n  },\n\n  cdf: function cdf(x, r, p) {\n    var sum = 0,\n    k = 0;\n    if (x < 0) return 0;\n    for (; k <= x; k++) {\n      sum += jStat.negbin.pdf(k, r, p);\n    }\n    return sum;\n  }\n});\n\n\n\n// extend uniform function with static methods\njStat.extend(jStat.hypgeom, {\n  pdf: function pdf(k, N, m, n) {\n    // Hypergeometric PDF.\n\n    // A simplification of the CDF algorithm below.\n\n    // k = number of successes drawn\n    // N = population size\n    // m = number of successes in population\n    // n = number of items drawn from population\n\n    if(k !== k | 0) {\n      return false;\n    } else if(k < 0 || k < m - (N - n)) {\n      // It's impossible to have this few successes drawn.\n      return 0;\n    } else if(k > n || k > m) {\n      // It's impossible to have this many successes drawn.\n      return 0;\n    } else if (m * 2 > N) {\n      // More than half the population is successes.\n\n      if(n * 2 > N) {\n        // More than half the population is sampled.\n\n        return jStat.hypgeom.pdf(N - m - n + k, N, N - m, N - n)\n      } else {\n        // Half or less of the population is sampled.\n\n        return jStat.hypgeom.pdf(n - k, N, N - m, n);\n      }\n\n    } else if(n * 2 > N) {\n      // Half or less is successes.\n\n      return jStat.hypgeom.pdf(m - k, N, m, N - n);\n\n    } else if(m < n) {\n      // We want to have the number of things sampled to be less than the\n      // successes available. So swap the definitions of successful and sampled.\n      return jStat.hypgeom.pdf(k, N, n, m);\n    } else {\n      // If we get here, half or less of the population was sampled, half or\n      // less of it was successes, and we had fewer sampled things than\n      // successes. Now we can do this complicated iterative algorithm in an\n      // efficient way.\n\n      // The basic premise of the algorithm is that we partially normalize our\n      // intermediate product to keep it in a numerically good region, and then\n      // finish the normalization at the end.\n\n      // This variable holds the scaled probability of the current number of\n      // successes.\n      var scaledPDF = 1;\n\n      // This keeps track of how much we have normalized.\n      var samplesDone = 0;\n\n      for(var i = 0; i < k; i++) {\n        // For every possible number of successes up to that observed...\n\n        while(scaledPDF > 1 && samplesDone < n) {\n          // Intermediate result is growing too big. Apply some of the\n          // normalization to shrink everything.\n\n          scaledPDF *= 1 - (m / (N - samplesDone));\n\n          // Say we've normalized by this sample already.\n          samplesDone++;\n        }\n\n        // Work out the partially-normalized hypergeometric PDF for the next\n        // number of successes\n        scaledPDF *= (n - i) * (m - i) / ((i + 1) * (N - m - n + i + 1));\n      }\n\n      for(; samplesDone < n; samplesDone++) {\n        // Apply all the rest of the normalization\n        scaledPDF *= 1 - (m / (N - samplesDone));\n      }\n\n      // Bound answer sanely before returning.\n      return Math.min(1, Math.max(0, scaledPDF));\n    }\n  },\n\n  cdf: function cdf(x, N, m, n) {\n    // Hypergeometric CDF.\n\n    // This algorithm is due to Prof. Thomas S. Ferguson, <tom@math.ucla.edu>,\n    // and comes from his hypergeometric test calculator at\n    // <http://www.math.ucla.edu/~tom/distributions/Hypergeometric.html>.\n\n    // x = number of successes drawn\n    // N = population size\n    // m = number of successes in population\n    // n = number of items drawn from population\n\n    if(x < 0 || x < m - (N - n)) {\n      // It's impossible to have this few successes drawn or fewer.\n      return 0;\n    } else if(x >= n || x >= m) {\n      // We will always have this many successes or fewer.\n      return 1;\n    } else if (m * 2 > N) {\n      // More than half the population is successes.\n\n      if(n * 2 > N) {\n        // More than half the population is sampled.\n\n        return jStat.hypgeom.cdf(N - m - n + x, N, N - m, N - n)\n      } else {\n        // Half or less of the population is sampled.\n\n        return 1 - jStat.hypgeom.cdf(n - x - 1, N, N - m, n);\n      }\n\n    } else if(n * 2 > N) {\n      // Half or less is successes.\n\n      return 1 - jStat.hypgeom.cdf(m - x - 1, N, m, N - n);\n\n    } else if(m < n) {\n      // We want to have the number of things sampled to be less than the\n      // successes available. So swap the definitions of successful and sampled.\n      return jStat.hypgeom.cdf(x, N, n, m);\n    } else {\n      // If we get here, half or less of the population was sampled, half or\n      // less of it was successes, and we had fewer sampled things than\n      // successes. Now we can do this complicated iterative algorithm in an\n      // efficient way.\n\n      // The basic premise of the algorithm is that we partially normalize our\n      // intermediate sum to keep it in a numerically good region, and then\n      // finish the normalization at the end.\n\n      // Holds the intermediate, scaled total CDF.\n      var scaledCDF = 1;\n\n      // This variable holds the scaled probability of the current number of\n      // successes.\n      var scaledPDF = 1;\n\n      // This keeps track of how much we have normalized.\n      var samplesDone = 0;\n\n      for(var i = 0; i < x; i++) {\n        // For every possible number of successes up to that observed...\n\n        while(scaledCDF > 1 && samplesDone < n) {\n          // Intermediate result is growing too big. Apply some of the\n          // normalization to shrink everything.\n\n          var factor = 1 - (m / (N - samplesDone));\n\n          scaledPDF *= factor;\n          scaledCDF *= factor;\n\n          // Say we've normalized by this sample already.\n          samplesDone++;\n        }\n\n        // Work out the partially-normalized hypergeometric PDF for the next\n        // number of successes\n        scaledPDF *= (n - i) * (m - i) / ((i + 1) * (N - m - n + i + 1));\n\n        // Add to the CDF answer.\n        scaledCDF += scaledPDF;\n      }\n\n      for(; samplesDone < n; samplesDone++) {\n        // Apply all the rest of the normalization\n        scaledCDF *= 1 - (m / (N - samplesDone));\n      }\n\n      // Bound answer sanely before returning.\n      return Math.min(1, Math.max(0, scaledCDF));\n    }\n  }\n});\n\n\n\n// extend uniform function with static methods\njStat.extend(jStat.poisson, {\n  pdf: function pdf(k, l) {\n    if (l < 0 || (k % 1) !== 0 || k < 0) {\n      return 0;\n    }\n\n    return Math.pow(l, k) * Math.exp(-l) / jStat.factorial(k);\n  },\n\n  cdf: function cdf(x, l) {\n    var sumarr = [],\n    k = 0;\n    if (x < 0) return 0;\n    for (; k <= x; k++) {\n      sumarr.push(jStat.poisson.pdf(k, l));\n    }\n    return jStat.sum(sumarr);\n  },\n\n  mean : function(l) {\n    return l;\n  },\n\n  variance : function(l) {\n    return l;\n  },\n\n  sampleSmall: function sampleSmall(l) {\n    var p = 1, k = 0, L = Math.exp(-l);\n    do {\n      k++;\n      p *= jStat._random_fn();\n    } while (p > L);\n    return k - 1;\n  },\n\n  sampleLarge: function sampleLarge(l) {\n    var lam = l;\n    var k;\n    var U, V, slam, loglam, a, b, invalpha, vr, us;\n\n    slam = Math.sqrt(lam);\n    loglam = Math.log(lam);\n    b = 0.931 + 2.53 * slam;\n    a = -0.059 + 0.02483 * b;\n    invalpha = 1.1239 + 1.1328 / (b - 3.4);\n    vr = 0.9277 - 3.6224 / (b - 2);\n\n    while (1) {\n      U = Math.random() - 0.5;\n      V = Math.random();\n      us = 0.5 - Math.abs(U);\n      k = Math.floor((2 * a / us + b) * U + lam + 0.43);\n      if ((us >= 0.07) && (V <= vr)) {\n          return k;\n      }\n      if ((k < 0) || ((us < 0.013) && (V > us))) {\n          continue;\n      }\n      /* log(V) == log(0.0) ok here */\n      /* if U==0.0 so that us==0.0, log is ok since always returns */\n      if ((Math.log(V) + Math.log(invalpha) - Math.log(a / (us * us) + b)) <= (-lam + k * loglam - jStat.loggam(k + 1))) {\n          return k;\n      }\n    }\n  },\n\n  sample: function sample(l) {\n    if (l < 10)\n      return this.sampleSmall(l);\n    else\n      return this.sampleLarge(l);\n  }\n});\n\n// extend triangular function with static methods\njStat.extend(jStat.triangular, {\n  pdf: function pdf(x, a, b, c) {\n    if (b <= a || c < a || c > b) {\n      return NaN;\n    } else {\n      if (x < a || x > b) {\n        return 0;\n      } else if (x < c) {\n          return (2 * (x - a)) / ((b - a) * (c - a));\n      } else if (x === c) {\n          return (2 / (b - a));\n      } else { // x > c\n          return (2 * (b - x)) / ((b - a) * (b - c));\n      }\n    }\n  },\n\n  cdf: function cdf(x, a, b, c) {\n    if (b <= a || c < a || c > b)\n      return NaN;\n    if (x <= a)\n      return 0;\n    else if (x >= b)\n      return 1;\n    if (x <= c)\n      return Math.pow(x - a, 2) / ((b - a) * (c - a));\n    else // x > c\n      return 1 - Math.pow(b - x, 2) / ((b - a) * (b - c));\n  },\n\n  inv: function inv(p, a, b, c) {\n    if (b <= a || c < a || c > b) {\n      return NaN;\n    } else {\n      if (p <= ((c - a) / (b - a))) {\n        return a + (b - a) * Math.sqrt(p * ((c - a) / (b - a)));\n      } else { // p > ((c - a) / (b - a))\n        return a + (b - a) * (1 - Math.sqrt((1 - p) * (1 - ((c - a) / (b - a)))));\n      }\n    }\n  },\n\n  mean: function mean(a, b, c) {\n    return (a + b + c) / 3;\n  },\n\n  median: function median(a, b, c) {\n    if (c <= (a + b) / 2) {\n      return b - Math.sqrt((b - a) * (b - c)) / Math.sqrt(2);\n    } else if (c > (a + b) / 2) {\n      return a + Math.sqrt((b - a) * (c - a)) / Math.sqrt(2);\n    }\n  },\n\n  mode: function mode(a, b, c) {\n    return c;\n  },\n\n  sample: function sample(a, b, c) {\n    var u = jStat._random_fn();\n    if (u < ((c - a) / (b - a)))\n      return a + Math.sqrt(u * (b - a) * (c - a))\n    return b - Math.sqrt((1 - u) * (b - a) * (b - c));\n  },\n\n  variance: function variance(a, b, c) {\n    return (a * a + b * b + c * c - a * b - a * c - b * c) / 18;\n  }\n});\n\n\n// extend arcsine function with static methods\njStat.extend(jStat.arcsine, {\n  pdf: function pdf(x, a, b) {\n    if (b <= a) return NaN;\n\n    return (x <= a || x >= b) ? 0 :\n      (2 / Math.PI) *\n        Math.pow(Math.pow(b - a, 2) -\n                  Math.pow(2 * x - a - b, 2), -0.5);\n  },\n\n  cdf: function cdf(x, a, b) {\n    if (x < a)\n      return 0;\n    else if (x < b)\n      return (2 / Math.PI) * Math.asin(Math.sqrt((x - a)/(b - a)));\n    return 1;\n  },\n\n  inv: function(p, a, b) {\n    return a + (0.5 - 0.5 * Math.cos(Math.PI * p)) * (b - a);\n  },\n\n  mean: function mean(a, b) {\n    if (b <= a) return NaN;\n    return (a + b) / 2;\n  },\n\n  median: function median(a, b) {\n    if (b <= a) return NaN;\n    return (a + b) / 2;\n  },\n\n  mode: function mode(/*a, b*/) {\n    throw new Error('mode is not yet implemented');\n  },\n\n  sample: function sample(a, b) {\n    return ((a + b) / 2) + ((b - a) / 2) *\n      Math.sin(2 * Math.PI * jStat.uniform.sample(0, 1));\n  },\n\n  variance: function variance(a, b) {\n    if (b <= a) return NaN;\n    return Math.pow(b - a, 2) / 8;\n  }\n});\n\n\nfunction laplaceSign(x) { return x / Math.abs(x); }\n\njStat.extend(jStat.laplace, {\n  pdf: function pdf(x, mu, b) {\n    return (b <= 0) ? 0 : (Math.exp(-Math.abs(x - mu) / b)) / (2 * b);\n  },\n\n  cdf: function cdf(x, mu, b) {\n    if (b <= 0) { return 0; }\n\n    if(x < mu) {\n      return 0.5 * Math.exp((x - mu) / b);\n    } else {\n      return 1 - 0.5 * Math.exp(- (x - mu) / b);\n    }\n  },\n\n  mean: function(mu/*, b*/) {\n    return mu;\n  },\n\n  median: function(mu/*, b*/) {\n    return mu;\n  },\n\n  mode: function(mu/*, b*/) {\n    return mu;\n  },\n\n  variance: function(mu, b) {\n    return 2 * b * b;\n  },\n\n  sample: function sample(mu, b) {\n    var u = jStat._random_fn() - 0.5;\n\n    return mu - (b * laplaceSign(u) * Math.log(1 - (2 * Math.abs(u))));\n  }\n});\n\nfunction tukeyWprob(w, rr, cc) {\n  var nleg = 12;\n  var ihalf = 6;\n\n  var C1 = -30;\n  var C2 = -50;\n  var C3 = 60;\n  var bb   = 8;\n  var wlar = 3;\n  var wincr1 = 2;\n  var wincr2 = 3;\n  var xleg = [\n    0.981560634246719250690549090149,\n    0.904117256370474856678465866119,\n    0.769902674194304687036893833213,\n    0.587317954286617447296702418941,\n    0.367831498998180193752691536644,\n    0.125233408511468915472441369464\n  ];\n  var aleg = [\n    0.047175336386511827194615961485,\n    0.106939325995318430960254718194,\n    0.160078328543346226334652529543,\n    0.203167426723065921749064455810,\n    0.233492536538354808760849898925,\n    0.249147045813402785000562436043\n  ];\n\n  var qsqz = w * 0.5;\n\n  // if w >= 16 then the integral lower bound (occurs for c=20)\n  // is 0.99999999999995 so return a value of 1.\n\n  if (qsqz >= bb)\n    return 1.0;\n\n  // find (f(w/2) - 1) ^ cc\n  // (first term in integral of hartley's form).\n\n  var pr_w = 2 * jStat.normal.cdf(qsqz, 0, 1, 1, 0) - 1; // erf(qsqz / M_SQRT2)\n  // if pr_w ^ cc < 2e-22 then set pr_w = 0\n  if (pr_w >= Math.exp(C2 / cc))\n    pr_w = Math.pow(pr_w, cc);\n  else\n    pr_w = 0.0;\n\n  // if w is large then the second component of the\n  // integral is small, so fewer intervals are needed.\n\n  var wincr;\n  if (w > wlar)\n    wincr = wincr1;\n  else\n    wincr = wincr2;\n\n  // find the integral of second term of hartley's form\n  // for the integral of the range for equal-length\n  // intervals using legendre quadrature.  limits of\n  // integration are from (w/2, 8).  two or three\n  // equal-length intervals are used.\n\n  // blb and bub are lower and upper limits of integration.\n\n  var blb = qsqz;\n  var binc = (bb - qsqz) / wincr;\n  var bub = blb + binc;\n  var einsum = 0.0;\n\n  // integrate over each interval\n\n  var cc1 = cc - 1.0;\n  for (var wi = 1; wi <= wincr; wi++) {\n    var elsum = 0.0;\n    var a = 0.5 * (bub + blb);\n\n    // legendre quadrature with order = nleg\n\n    var b = 0.5 * (bub - blb);\n\n    for (var jj = 1; jj <= nleg; jj++) {\n      var j, xx;\n      if (ihalf < jj) {\n        j = (nleg - jj) + 1;\n        xx = xleg[j-1];\n      } else {\n        j = jj;\n        xx = -xleg[j-1];\n      }\n      var c = b * xx;\n      var ac = a + c;\n\n      // if exp(-qexpo/2) < 9e-14,\n      // then doesn't contribute to integral\n\n      var qexpo = ac * ac;\n      if (qexpo > C3)\n        break;\n\n      var pplus = 2 * jStat.normal.cdf(ac, 0, 1, 1, 0);\n      var pminus= 2 * jStat.normal.cdf(ac, w, 1, 1, 0);\n\n      // if rinsum ^ (cc-1) < 9e-14,\n      // then doesn't contribute to integral\n\n      var rinsum = (pplus * 0.5) - (pminus * 0.5);\n      if (rinsum >= Math.exp(C1 / cc1)) {\n        rinsum = (aleg[j-1] * Math.exp(-(0.5 * qexpo))) * Math.pow(rinsum, cc1);\n        elsum += rinsum;\n      }\n    }\n    elsum *= (((2.0 * b) * cc) / Math.sqrt(2 * Math.PI));\n    einsum += elsum;\n    blb = bub;\n    bub += binc;\n  }\n\n  // if pr_w ^ rr < 9e-14, then return 0\n  pr_w += einsum;\n  if (pr_w <= Math.exp(C1 / rr))\n    return 0;\n\n  pr_w = Math.pow(pr_w, rr);\n  if (pr_w >= 1) // 1 was iMax was eps\n    return 1;\n  return pr_w;\n}\n\nfunction tukeyQinv(p, c, v) {\n  var p0 = 0.322232421088;\n  var q0 = 0.993484626060e-01;\n  var p1 = -1.0;\n  var q1 = 0.588581570495;\n  var p2 = -0.342242088547;\n  var q2 = 0.531103462366;\n  var p3 = -0.204231210125;\n  var q3 = 0.103537752850;\n  var p4 = -0.453642210148e-04;\n  var q4 = 0.38560700634e-02;\n  var c1 = 0.8832;\n  var c2 = 0.2368;\n  var c3 = 1.214;\n  var c4 = 1.208;\n  var c5 = 1.4142;\n  var vmax = 120.0;\n\n  var ps = 0.5 - 0.5 * p;\n  var yi = Math.sqrt(Math.log(1.0 / (ps * ps)));\n  var t = yi + (((( yi * p4 + p3) * yi + p2) * yi + p1) * yi + p0)\n     / (((( yi * q4 + q3) * yi + q2) * yi + q1) * yi + q0);\n  if (v < vmax) t += (t * t * t + t) / v / 4.0;\n  var q = c1 - c2 * t;\n  if (v < vmax) q += -c3 / v + c4 * t / v;\n  return t * (q * Math.log(c - 1.0) + c5);\n}\n\njStat.extend(jStat.tukey, {\n  cdf: function cdf(q, nmeans, df) {\n    // Identical implementation as the R ptukey() function as of commit 68947\n    var rr = 1;\n    var cc = nmeans;\n\n    var nlegq = 16;\n    var ihalfq = 8;\n\n    var eps1 = -30.0;\n    var eps2 = 1.0e-14;\n    var dhaf  = 100.0;\n    var dquar = 800.0;\n    var deigh = 5000.0;\n    var dlarg = 25000.0;\n    var ulen1 = 1.0;\n    var ulen2 = 0.5;\n    var ulen3 = 0.25;\n    var ulen4 = 0.125;\n    var xlegq = [\n      0.989400934991649932596154173450,\n      0.944575023073232576077988415535,\n      0.865631202387831743880467897712,\n      0.755404408355003033895101194847,\n      0.617876244402643748446671764049,\n      0.458016777657227386342419442984,\n      0.281603550779258913230460501460,\n      0.950125098376374401853193354250e-1\n    ];\n    var alegq = [\n      0.271524594117540948517805724560e-1,\n      0.622535239386478928628438369944e-1,\n      0.951585116824927848099251076022e-1,\n      0.124628971255533872052476282192,\n      0.149595988816576732081501730547,\n      0.169156519395002538189312079030,\n      0.182603415044923588866763667969,\n      0.189450610455068496285396723208\n    ];\n\n    if (q <= 0)\n      return 0;\n\n    // df must be > 1\n    // there must be at least two values\n\n    if (df < 2 || rr < 1 || cc < 2) return NaN;\n\n    if (!Number.isFinite(q))\n      return 1;\n\n    if (df > dlarg)\n      return tukeyWprob(q, rr, cc);\n\n    // calculate leading constant\n\n    var f2 = df * 0.5;\n    var f2lf = ((f2 * Math.log(df)) - (df * Math.log(2))) - jStat.gammaln(f2);\n    var f21 = f2 - 1.0;\n\n    // integral is divided into unit, half-unit, quarter-unit, or\n    // eighth-unit length intervals depending on the value of the\n    // degrees of freedom.\n\n    var ff4 = df * 0.25;\n    var ulen;\n    if      (df <= dhaf)  ulen = ulen1;\n    else if (df <= dquar) ulen = ulen2;\n    else if (df <= deigh) ulen = ulen3;\n    else                  ulen = ulen4;\n\n    f2lf += Math.log(ulen);\n\n    // integrate over each subinterval\n\n    var ans = 0.0;\n\n    for (var i = 1; i <= 50; i++) {\n      var otsum = 0.0;\n\n      // legendre quadrature with order = nlegq\n      // nodes (stored in xlegq) are symmetric around zero.\n\n      var twa1 = (2 * i - 1) * ulen;\n\n      for (var jj = 1; jj <= nlegq; jj++) {\n        var j, t1;\n        if (ihalfq < jj) {\n          j = jj - ihalfq - 1;\n          t1 = (f2lf + (f21 * Math.log(twa1 + (xlegq[j] * ulen))))\n              - (((xlegq[j] * ulen) + twa1) * ff4);\n        } else {\n          j = jj - 1;\n          t1 = (f2lf + (f21 * Math.log(twa1 - (xlegq[j] * ulen))))\n              + (((xlegq[j] * ulen) - twa1) * ff4);\n        }\n\n        // if exp(t1) < 9e-14, then doesn't contribute to integral\n        var qsqz;\n        if (t1 >= eps1) {\n          if (ihalfq < jj) {\n            qsqz = q * Math.sqrt(((xlegq[j] * ulen) + twa1) * 0.5);\n          } else {\n            qsqz = q * Math.sqrt(((-(xlegq[j] * ulen)) + twa1) * 0.5);\n          }\n\n          // call wprob to find integral of range portion\n\n          var wprb = tukeyWprob(qsqz, rr, cc);\n          var rotsum = (wprb * alegq[j]) * Math.exp(t1);\n          otsum += rotsum;\n        }\n        // end legendre integral for interval i\n        // L200:\n      }\n\n      // if integral for interval i < 1e-14, then stop.\n      // However, in order to avoid small area under left tail,\n      // at least  1 / ulen  intervals are calculated.\n      if (i * ulen >= 1.0 && otsum <= eps2)\n        break;\n\n      // end of interval i\n      // L330:\n\n      ans += otsum;\n    }\n\n    if (otsum > eps2) { // not converged\n      throw new Error('tukey.cdf failed to converge');\n    }\n    if (ans > 1)\n      ans = 1;\n    return ans;\n  },\n\n  inv: function(p, nmeans, df) {\n    // Identical implementation as the R qtukey() function as of commit 68947\n    var rr = 1;\n    var cc = nmeans;\n\n    var eps = 0.0001;\n    var maxiter = 50;\n\n    // df must be > 1 ; there must be at least two values\n    if (df < 2 || rr < 1 || cc < 2) return NaN;\n\n    if (p < 0 || p > 1) return NaN;\n    if (p === 0) return 0;\n    if (p === 1) return Infinity;\n\n    // Initial value\n\n    var x0 = tukeyQinv(p, cc, df);\n\n    // Find prob(value < x0)\n\n    var valx0 = jStat.tukey.cdf(x0, nmeans, df) - p;\n\n    // Find the second iterate and prob(value < x1).\n    // If the first iterate has probability value\n    // exceeding p then second iterate is 1 less than\n    // first iterate; otherwise it is 1 greater.\n\n    var x1;\n    if (valx0 > 0.0)\n      x1 = Math.max(0.0, x0 - 1.0);\n    else\n      x1 = x0 + 1.0;\n    var valx1 = jStat.tukey.cdf(x1, nmeans, df) - p;\n\n    // Find new iterate\n\n    var ans;\n    for(var iter = 1; iter < maxiter; iter++) {\n      ans = x1 - ((valx1 * (x1 - x0)) / (valx1 - valx0));\n      valx0 = valx1;\n\n      // New iterate must be >= 0\n\n      x0 = x1;\n      if (ans < 0.0) {\n        ans = 0.0;\n        valx1 = -p;\n      }\n      // Find prob(value < new iterate)\n\n      valx1 = jStat.tukey.cdf(ans, nmeans, df) - p;\n      x1 = ans;\n\n      // If the difference between two successive\n      // iterates is less than eps, stop\n\n      var xabs = Math.abs(x1 - x0);\n      if (xabs < eps)\n        return ans;\n    }\n\n    throw new Error('tukey.inv failed to converge');\n  }\n});\n\n}(jStat, Math));\n/* Provides functions for the solution of linear system of equations, integration, extrapolation,\n * interpolation, eigenvalue problems, differential equations and PCA analysis. */\n\n(function(jStat, Math) {\n\nvar push = Array.prototype.push;\nvar isArray = jStat.utils.isArray;\n\nfunction isUsable(arg) {\n  return isArray(arg) || arg instanceof jStat;\n}\n\njStat.extend({\n\n  // add a vector/matrix to a vector/matrix or scalar\n  add: function add(arr, arg) {\n    // check if arg is a vector or scalar\n    if (isUsable(arg)) {\n      if (!isUsable(arg[0])) arg = [ arg ];\n      return jStat.map(arr, function(value, row, col) {\n        return value + arg[row][col];\n      });\n    }\n    return jStat.map(arr, function(value) { return value + arg; });\n  },\n\n  // subtract a vector or scalar from the vector\n  subtract: function subtract(arr, arg) {\n    // check if arg is a vector or scalar\n    if (isUsable(arg)) {\n      if (!isUsable(arg[0])) arg = [ arg ];\n      return jStat.map(arr, function(value, row, col) {\n        return value - arg[row][col] || 0;\n      });\n    }\n    return jStat.map(arr, function(value) { return value - arg; });\n  },\n\n  // matrix division\n  divide: function divide(arr, arg) {\n    if (isUsable(arg)) {\n      if (!isUsable(arg[0])) arg = [ arg ];\n      return jStat.multiply(arr, jStat.inv(arg));\n    }\n    return jStat.map(arr, function(value) { return value / arg; });\n  },\n\n  // matrix multiplication\n  multiply: function multiply(arr, arg) {\n    var row, col, nrescols, sum, nrow, ncol, res, rescols;\n    // eg: arr = 2 arg = 3 -> 6 for res[0][0] statement closure\n    if (arr.length === undefined && arg.length === undefined) {\n      return arr * arg;\n    }\n    nrow = arr.length,\n    ncol = arr[0].length,\n    res = jStat.zeros(nrow, nrescols = (isUsable(arg)) ? arg[0].length : ncol),\n    rescols = 0;\n    if (isUsable(arg)) {\n      for (; rescols < nrescols; rescols++) {\n        for (row = 0; row < nrow; row++) {\n          sum = 0;\n          for (col = 0; col < ncol; col++)\n          sum += arr[row][col] * arg[col][rescols];\n          res[row][rescols] = sum;\n        }\n      }\n      return (nrow === 1 && rescols === 1) ? res[0][0] : res;\n    }\n    return jStat.map(arr, function(value) { return value * arg; });\n  },\n\n  // outer([1,2,3],[4,5,6])\n  // ===\n  // [[1],[2],[3]] times [[4,5,6]]\n  // ->\n  // [[4,5,6],[8,10,12],[12,15,18]]\n  outer:function outer(A, B) {\n    return jStat.multiply(A.map(function(t){ return [t] }), [B]);\n  },\n\n\n  // Returns the dot product of two matricies\n  dot: function dot(arr, arg) {\n    if (!isUsable(arr[0])) arr = [ arr ];\n    if (!isUsable(arg[0])) arg = [ arg ];\n    // convert column to row vector\n    var left = (arr[0].length === 1 && arr.length !== 1) ? jStat.transpose(arr) : arr,\n    right = (arg[0].length === 1 && arg.length !== 1) ? jStat.transpose(arg) : arg,\n    res = [],\n    row = 0,\n    nrow = left.length,\n    ncol = left[0].length,\n    sum, col;\n    for (; row < nrow; row++) {\n      res[row] = [];\n      sum = 0;\n      for (col = 0; col < ncol; col++)\n      sum += left[row][col] * right[row][col];\n      res[row] = sum;\n    }\n    return (res.length === 1) ? res[0] : res;\n  },\n\n  // raise every element by a scalar\n  pow: function pow(arr, arg) {\n    return jStat.map(arr, function(value) { return Math.pow(value, arg); });\n  },\n\n  // exponentiate every element\n  exp: function exp(arr) {\n    return jStat.map(arr, function(value) { return Math.exp(value); });\n  },\n\n  // generate the natural log of every element\n  log: function exp(arr) {\n    return jStat.map(arr, function(value) { return Math.log(value); });\n  },\n\n  // generate the absolute values of the vector\n  abs: function abs(arr) {\n    return jStat.map(arr, function(value) { return Math.abs(value); });\n  },\n\n  // computes the p-norm of the vector\n  // In the case that a matrix is passed, uses the first row as the vector\n  norm: function norm(arr, p) {\n    var nnorm = 0,\n    i = 0;\n    // check the p-value of the norm, and set for most common case\n    if (isNaN(p)) p = 2;\n    // check if multi-dimensional array, and make vector correction\n    if (isUsable(arr[0])) arr = arr[0];\n    // vector norm\n    for (; i < arr.length; i++) {\n      nnorm += Math.pow(Math.abs(arr[i]), p);\n    }\n    return Math.pow(nnorm, 1 / p);\n  },\n\n  // computes the angle between two vectors in rads\n  // In case a matrix is passed, this uses the first row as the vector\n  angle: function angle(arr, arg) {\n    return Math.acos(jStat.dot(arr, arg) / (jStat.norm(arr) * jStat.norm(arg)));\n  },\n\n  // augment one matrix by another\n  // Note: this function returns a matrix, not a jStat object\n  aug: function aug(a, b) {\n    var newarr = [];\n    var i;\n    for (i = 0; i < a.length; i++) {\n      newarr.push(a[i].slice());\n    }\n    for (i = 0; i < newarr.length; i++) {\n      push.apply(newarr[i], b[i]);\n    }\n    return newarr;\n  },\n\n  // The inv() function calculates the inverse of a matrix\n  // Create the inverse by augmenting the matrix by the identity matrix of the\n  // appropriate size, and then use G-J elimination on the augmented matrix.\n  inv: function inv(a) {\n    var rows = a.length;\n    var cols = a[0].length;\n    var b = jStat.identity(rows, cols);\n    var c = jStat.gauss_jordan(a, b);\n    var result = [];\n    var i = 0;\n    var j;\n\n    //We need to copy the inverse portion to a new matrix to rid G-J artifacts\n    for (; i < rows; i++) {\n      result[i] = [];\n      for (j = cols; j < c[0].length; j++)\n        result[i][j - cols] = c[i][j];\n    }\n    return result;\n  },\n\n  // calculate the determinant of a matrix\n  det: function det(a) {\n    var alen = a.length,\n    alend = alen * 2,\n    vals = new Array(alend),\n    rowshift = alen - 1,\n    colshift = alend - 1,\n    mrow = rowshift - alen + 1,\n    mcol = colshift,\n    i = 0,\n    result = 0,\n    j;\n    // check for special 2x2 case\n    if (alen === 2) {\n      return a[0][0] * a[1][1] - a[0][1] * a[1][0];\n    }\n    for (; i < alend; i++) {\n      vals[i] = 1;\n    }\n    for (i = 0; i < alen; i++) {\n      for (j = 0; j < alen; j++) {\n        vals[(mrow < 0) ? mrow + alen : mrow ] *= a[i][j];\n        vals[(mcol < alen) ? mcol + alen : mcol ] *= a[i][j];\n        mrow++;\n        mcol--;\n      }\n      mrow = --rowshift - alen + 1;\n      mcol = --colshift;\n    }\n    for (i = 0; i < alen; i++) {\n      result += vals[i];\n    }\n    for (; i < alend; i++) {\n      result -= vals[i];\n    }\n    return result;\n  },\n\n  gauss_elimination: function gauss_elimination(a, b) {\n    var i = 0,\n    j = 0,\n    n = a.length,\n    m = a[0].length,\n    factor = 1,\n    sum = 0,\n    x = [],\n    maug, pivot, temp, k;\n    a = jStat.aug(a, b);\n    maug = a[0].length;\n    for(i = 0; i < n; i++) {\n      pivot = a[i][i];\n      j = i;\n      for (k = i + 1; k < m; k++) {\n        if (pivot < Math.abs(a[k][i])) {\n          pivot = a[k][i];\n          j = k;\n        }\n      }\n      if (j != i) {\n        for(k = 0; k < maug; k++) {\n          temp = a[i][k];\n          a[i][k] = a[j][k];\n          a[j][k] = temp;\n        }\n      }\n      for (j = i + 1; j < n; j++) {\n        factor = a[j][i] / a[i][i];\n        for(k = i; k < maug; k++) {\n          a[j][k] = a[j][k] - factor * a[i][k];\n        }\n      }\n    }\n    for (i = n - 1; i >= 0; i--) {\n      sum = 0;\n      for (j = i + 1; j<= n - 1; j++) {\n        sum = sum + x[j] * a[i][j];\n      }\n      x[i] =(a[i][maug - 1] - sum) / a[i][i];\n    }\n    return x;\n  },\n\n  gauss_jordan: function gauss_jordan(a, b) {\n    var m = jStat.aug(a, b);\n    var h = m.length;\n    var w = m[0].length;\n    var c = 0;\n    var x, y, y2;\n    // find max pivot\n    for (y = 0; y < h; y++) {\n      var maxrow = y;\n      for (y2 = y+1; y2 < h; y2++) {\n        if (Math.abs(m[y2][y]) > Math.abs(m[maxrow][y]))\n          maxrow = y2;\n      }\n      var tmp = m[y];\n      m[y] = m[maxrow];\n      m[maxrow] = tmp\n      for (y2 = y+1; y2 < h; y2++) {\n        c = m[y2][y] / m[y][y];\n        for (x = y; x < w; x++) {\n          m[y2][x] -= m[y][x] * c;\n        }\n      }\n    }\n    // backsubstitute\n    for (y = h-1; y >= 0; y--) {\n      c = m[y][y];\n      for (y2 = 0; y2 < y; y2++) {\n        for (x = w-1; x > y-1; x--) {\n          m[y2][x] -= m[y][x] * m[y2][y] / c;\n        }\n      }\n      m[y][y] /= c;\n      for (x = h; x < w; x++) {\n        m[y][x] /= c;\n      }\n    }\n    return m;\n  },\n\n  // solve equation\n  // Ax=b\n  // A is upper triangular matrix\n  // A=[[1,2,3],[0,4,5],[0,6,7]]\n  // b=[1,2,3]\n  // triaUpSolve(A,b) // -> [2.666,0.1666,1.666]\n  // if you use matrix style\n  // A=[[1,2,3],[0,4,5],[0,6,7]]\n  // b=[[1],[2],[3]]\n  // will return [[2.666],[0.1666],[1.666]]\n  triaUpSolve: function triaUpSolve(A, b) {\n    var size = A[0].length;\n    var x = jStat.zeros(1, size)[0];\n    var parts;\n    var matrix_mode = false;\n\n    if (b[0].length != undefined) {\n      b = b.map(function(i){ return i[0] });\n      matrix_mode = true;\n    }\n\n    jStat.arange(size - 1, -1, -1).forEach(function(i) {\n      parts = jStat.arange(i + 1, size).map(function(j) {\n        return x[j] * A[i][j];\n      });\n      x[i] = (b[i] - jStat.sum(parts)) / A[i][i];\n    });\n\n    if (matrix_mode)\n      return x.map(function(i){ return [i] });\n    return x;\n  },\n\n  triaLowSolve: function triaLowSolve(A, b) {\n    // like to triaUpSolve but A is lower triangular matrix\n    var size = A[0].length;\n    var x = jStat.zeros(1, size)[0];\n    var parts;\n\n    var matrix_mode=false;\n    if (b[0].length != undefined) {\n      b = b.map(function(i){ return i[0] });\n      matrix_mode = true;\n    }\n\n    jStat.arange(size).forEach(function(i) {\n      parts = jStat.arange(i).map(function(j) {\n        return A[i][j] * x[j];\n      });\n      x[i] = (b[i] - jStat.sum(parts)) / A[i][i];\n    })\n\n    if (matrix_mode)\n      return x.map(function(i){ return [i] });\n    return x;\n  },\n\n\n  // A -> [L,U]\n  // A=LU\n  // L is lower triangular matrix\n  // U is upper triangular matrix\n  lu: function lu(A) {\n    var size = A.length;\n    //var L=jStat.diagonal(jStat.ones(1,size)[0]);\n    var L = jStat.identity(size);\n    var R = jStat.zeros(A.length, A[0].length);\n    var parts;\n    jStat.arange(size).forEach(function(t) {\n      R[0][t] = A[0][t];\n    });\n    jStat.arange(1, size).forEach(function(l) {\n      jStat.arange(l).forEach(function(i) {\n        parts = jStat.arange(i).map(function(jj) {\n          return L[l][jj] * R[jj][i];\n        });\n        L[l][i] = (A[l][i] - jStat.sum(parts)) / R[i][i];\n      });\n      jStat.arange(l, size).forEach(function(j) {\n        parts = jStat.arange(l).map(function(jj) {\n          return L[l][jj] * R[jj][j];\n        });\n        R[l][j] = A[parts.length][j] - jStat.sum(parts);\n      });\n    });\n    return [L, R];\n  },\n\n  // A -> T\n  // A=TT'\n  // T is lower triangular matrix\n  cholesky: function cholesky(A) {\n    var size = A.length;\n    var T = jStat.zeros(A.length, A[0].length);\n    var parts;\n    jStat.arange(size).forEach(function(i) {\n      parts = jStat.arange(i).map(function(t) {\n        return Math.pow(T[i][t],2);\n      });\n      T[i][i] = Math.sqrt(A[i][i] - jStat.sum(parts));\n      jStat.arange(i + 1, size).forEach(function(j) {\n        parts = jStat.arange(i).map(function(t) {\n          return T[i][t] * T[j][t];\n        });\n        T[j][i] = (A[i][j] - jStat.sum(parts)) / T[i][i];\n      });\n    });\n    return T;\n  },\n\n\n  gauss_jacobi: function gauss_jacobi(a, b, x, r) {\n    var i = 0;\n    var j = 0;\n    var n = a.length;\n    var l = [];\n    var u = [];\n    var d = [];\n    var xv, c, h, xk;\n    for (; i < n; i++) {\n      l[i] = [];\n      u[i] = [];\n      d[i] = [];\n      for (j = 0; j < n; j++) {\n        if (i > j) {\n          l[i][j] = a[i][j];\n          u[i][j] = d[i][j] = 0;\n        } else if (i < j) {\n          u[i][j] = a[i][j];\n          l[i][j] = d[i][j] = 0;\n        } else {\n          d[i][j] = a[i][j];\n          l[i][j] = u[i][j] = 0;\n        }\n      }\n    }\n    h = jStat.multiply(jStat.multiply(jStat.inv(d), jStat.add(l, u)), -1);\n    c = jStat.multiply(jStat.inv(d), b);\n    xv = x;\n    xk = jStat.add(jStat.multiply(h, x), c);\n    i = 2;\n    while (Math.abs(jStat.norm(jStat.subtract(xk,xv))) > r) {\n      xv = xk;\n      xk = jStat.add(jStat.multiply(h, xv), c);\n      i++;\n    }\n    return xk;\n  },\n\n  gauss_seidel: function gauss_seidel(a, b, x, r) {\n    var i = 0;\n    var n = a.length;\n    var l = [];\n    var u = [];\n    var d = [];\n    var j, xv, c, h, xk;\n    for (; i < n; i++) {\n      l[i] = [];\n      u[i] = [];\n      d[i] = [];\n      for (j = 0; j < n; j++) {\n        if (i > j) {\n          l[i][j] = a[i][j];\n          u[i][j] = d[i][j] = 0;\n        } else if (i < j) {\n          u[i][j] = a[i][j];\n          l[i][j] = d[i][j] = 0;\n        } else {\n          d[i][j] = a[i][j];\n          l[i][j] = u[i][j] = 0;\n        }\n      }\n    }\n    h = jStat.multiply(jStat.multiply(jStat.inv(jStat.add(d, l)), u), -1);\n    c = jStat.multiply(jStat.inv(jStat.add(d, l)), b);\n    xv = x;\n    xk = jStat.add(jStat.multiply(h, x), c);\n    i = 2;\n    while (Math.abs(jStat.norm(jStat.subtract(xk, xv))) > r) {\n      xv = xk;\n      xk = jStat.add(jStat.multiply(h, xv), c);\n      i = i + 1;\n    }\n    return xk;\n  },\n\n  SOR: function SOR(a, b, x, r, w) {\n    var i = 0;\n    var n = a.length;\n    var l = [];\n    var u = [];\n    var d = [];\n    var j, xv, c, h, xk;\n    for (; i < n; i++) {\n      l[i] = [];\n      u[i] = [];\n      d[i] = [];\n      for (j = 0; j < n; j++) {\n        if (i > j) {\n          l[i][j] = a[i][j];\n          u[i][j] = d[i][j] = 0;\n        } else if (i < j) {\n          u[i][j] = a[i][j];\n          l[i][j] = d[i][j] = 0;\n        } else {\n          d[i][j] = a[i][j];\n          l[i][j] = u[i][j] = 0;\n        }\n      }\n    }\n    h = jStat.multiply(jStat.inv(jStat.add(d, jStat.multiply(l, w))),\n                       jStat.subtract(jStat.multiply(d, 1 - w),\n                                      jStat.multiply(u, w)));\n    c = jStat.multiply(jStat.multiply(jStat.inv(jStat.add(d,\n        jStat.multiply(l, w))), b), w);\n    xv = x;\n    xk = jStat.add(jStat.multiply(h, x), c);\n    i = 2;\n    while (Math.abs(jStat.norm(jStat.subtract(xk, xv))) > r) {\n      xv = xk;\n      xk = jStat.add(jStat.multiply(h, xv), c);\n      i++;\n    }\n    return xk;\n  },\n\n  householder: function householder(a) {\n    var m = a.length;\n    var n = a[0].length;\n    var i = 0;\n    var w = [];\n    var p = [];\n    var alpha, r, k, j, factor;\n    for (; i < m - 1; i++) {\n      alpha = 0;\n      for (j = i + 1; j < n; j++)\n      alpha += (a[j][i] * a[j][i]);\n      factor = (a[i + 1][i] > 0) ? -1 : 1;\n      alpha = factor * Math.sqrt(alpha);\n      r = Math.sqrt((((alpha * alpha) - a[i + 1][i] * alpha) / 2));\n      w = jStat.zeros(m, 1);\n      w[i + 1][0] = (a[i + 1][i] - alpha) / (2 * r);\n      for (k = i + 2; k < m; k++) w[k][0] = a[k][i] / (2 * r);\n      p = jStat.subtract(jStat.identity(m, n),\n          jStat.multiply(jStat.multiply(w, jStat.transpose(w)), 2));\n      a = jStat.multiply(p, jStat.multiply(a, p));\n    }\n    return a;\n  },\n\n  // A -> [Q,R]\n  // Q is orthogonal matrix\n  // R is upper triangular\n  QR: (function() {\n    // x -> Q\n    // find a orthogonal matrix Q st.\n    // Qx=y\n    // y is [||x||,0,0,...]\n\n    // quick ref\n    var sum   = jStat.sum;\n    var range = jStat.arange;\n\n    function qr2(x) {\n      // quick impletation\n      // https://www.stat.wisc.edu/~larget/math496/qr.html\n\n      var n = x.length;\n      var p = x[0].length;\n\n      var r = jStat.zeros(p, p);\n      x = jStat.copy(x);\n\n      var i,j,k;\n      for(j = 0; j < p; j++){\n        r[j][j] = Math.sqrt(sum(range(n).map(function(i){\n          return x[i][j] * x[i][j];\n        })));\n        for(i = 0; i < n; i++){\n          x[i][j] = x[i][j] / r[j][j];\n        }\n        for(k = j+1; k < p; k++){\n          r[j][k] = sum(range(n).map(function(i){\n            return x[i][j] * x[i][k];\n          }));\n          for(i = 0; i < n; i++){\n            x[i][k] = x[i][k] - x[i][j]*r[j][k];\n          }\n        }\n      }\n      return [x, r];\n    }\n\n    return qr2;\n  }()),\n\n  lstsq: (function() {\n    // solve least squard problem for Ax=b as QR decomposition way if b is\n    // [[b1],[b2],[b3]] form will return [[x1],[x2],[x3]] array form solution\n    // else b is [b1,b2,b3] form will return [x1,x2,x3] array form solution\n    function R_I(A) {\n      A = jStat.copy(A);\n      var size = A.length;\n      var I = jStat.identity(size);\n      jStat.arange(size - 1, -1, -1).forEach(function(i) {\n        jStat.sliceAssign(\n            I, { row: i }, jStat.divide(jStat.slice(I, { row: i }), A[i][i]));\n        jStat.sliceAssign(\n            A, { row: i }, jStat.divide(jStat.slice(A, { row: i }), A[i][i]));\n        jStat.arange(i).forEach(function(j) {\n          var c = jStat.multiply(A[j][i], -1);\n          var Aj = jStat.slice(A, { row: j });\n          var cAi = jStat.multiply(jStat.slice(A, { row: i }), c);\n          jStat.sliceAssign(A, { row: j }, jStat.add(Aj, cAi));\n          var Ij = jStat.slice(I, { row: j });\n          var cIi = jStat.multiply(jStat.slice(I, { row: i }), c);\n          jStat.sliceAssign(I, { row: j }, jStat.add(Ij, cIi));\n        })\n      });\n      return I;\n    }\n\n    function qr_solve(A, b){\n      var array_mode = false;\n      if (b[0].length === undefined) {\n        // [c1,c2,c3] mode\n        b = b.map(function(x){ return [x] });\n        array_mode = true;\n      }\n      var QR = jStat.QR(A);\n      var Q = QR[0];\n      var R = QR[1];\n      var attrs = A[0].length;\n      var Q1 = jStat.slice(Q,{col:{end:attrs}});\n      var R1 = jStat.slice(R,{row:{end:attrs}});\n      var RI = R_I(R1);\n      var Q2 = jStat.transpose(Q1);\n\n      if(Q2[0].length === undefined){\n        Q2 = [Q2]; // The confusing jStat.multifly implementation threat nature process again.\n      }\n\n      var x = jStat.multiply(jStat.multiply(RI, Q2), b);\n\n      if(x.length === undefined){\n        x = [[x]]; // The confusing jStat.multifly implementation threat nature process again.\n      }\n\n\n      if (array_mode)\n        return x.map(function(i){ return i[0] });\n      return x;\n    }\n\n    return qr_solve;\n  }()),\n\n  jacobi: function jacobi(a) {\n    var condition = 1;\n    var n = a.length;\n    var e = jStat.identity(n, n);\n    var ev = [];\n    var b, i, j, p, q, maxim, theta, s;\n    // condition === 1 only if tolerance is not reached\n    while (condition === 1) {\n      maxim = a[0][1];\n      p = 0;\n      q = 1;\n      for (i = 0; i < n; i++) {\n        for (j = 0; j < n; j++) {\n          if (i != j) {\n            if (maxim < Math.abs(a[i][j])) {\n              maxim = Math.abs(a[i][j]);\n              p = i;\n              q = j;\n            }\n          }\n        }\n      }\n      if (a[p][p] === a[q][q])\n        theta = (a[p][q] > 0) ? Math.PI / 4 : -Math.PI / 4;\n      else\n        theta = Math.atan(2 * a[p][q] / (a[p][p] - a[q][q])) / 2;\n      s = jStat.identity(n, n);\n      s[p][p] = Math.cos(theta);\n      s[p][q] = -Math.sin(theta);\n      s[q][p] = Math.sin(theta);\n      s[q][q] = Math.cos(theta);\n      // eigen vector matrix\n      e = jStat.multiply(e, s);\n      b = jStat.multiply(jStat.multiply(jStat.inv(s), a), s);\n      a = b;\n      condition = 0;\n      for (i = 1; i < n; i++) {\n        for (j = 1; j < n; j++) {\n          if (i != j && Math.abs(a[i][j]) > 0.001) {\n            condition = 1;\n          }\n        }\n      }\n    }\n    for (i = 0; i < n; i++) ev.push(a[i][i]);\n    //returns both the eigenvalue and eigenmatrix\n    return [e, ev];\n  },\n\n  rungekutta: function rungekutta(f, h, p, t_j, u_j, order) {\n    var k1, k2, u_j1, k3, k4;\n    if (order === 2) {\n      while (t_j <= p) {\n        k1 = h * f(t_j, u_j);\n        k2 = h * f(t_j + h, u_j + k1);\n        u_j1 = u_j + (k1 + k2) / 2;\n        u_j = u_j1;\n        t_j = t_j + h;\n      }\n    }\n    if (order === 4) {\n      while (t_j <= p) {\n        k1 = h * f(t_j, u_j);\n        k2 = h * f(t_j + h / 2, u_j + k1 / 2);\n        k3 = h * f(t_j + h / 2, u_j + k2 / 2);\n        k4 = h * f(t_j +h, u_j + k3);\n        u_j1 = u_j + (k1 + 2 * k2 + 2 * k3 + k4) / 6;\n        u_j = u_j1;\n        t_j = t_j + h;\n      }\n    }\n    return u_j;\n  },\n\n  romberg: function romberg(f, a, b, order) {\n    var i = 0;\n    var h = (b - a) / 2;\n    var x = [];\n    var h1 = [];\n    var g = [];\n    var m, a1, j, k, I;\n    while (i < order / 2) {\n      I = f(a);\n      for (j = a, k = 0; j <= b; j = j + h, k++) x[k] = j;\n      m = x.length;\n      for (j = 1; j < m - 1; j++) {\n        I += (((j % 2) !== 0) ? 4 : 2) * f(x[j]);\n      }\n      I = (h / 3) * (I + f(b));\n      g[i] = I;\n      h /= 2;\n      i++;\n    }\n    a1 = g.length;\n    m = 1;\n    while (a1 !== 1) {\n      for (j = 0; j < a1 - 1; j++)\n      h1[j] = ((Math.pow(4, m)) * g[j + 1] - g[j]) / (Math.pow(4, m) - 1);\n      a1 = h1.length;\n      g = h1;\n      h1 = [];\n      m++;\n    }\n    return g;\n  },\n\n  richardson: function richardson(X, f, x, h) {\n    function pos(X, x) {\n      var i = 0;\n      var n = X.length;\n      var p;\n      for (; i < n; i++)\n        if (X[i] === x) p = i;\n      return p;\n    }\n    var h_min = Math.abs(x - X[pos(X, x) + 1]);\n    var i = 0;\n    var g = [];\n    var h1 = [];\n    var y1, y2, m, a, j;\n    while (h >= h_min) {\n      y1 = pos(X, x + h);\n      y2 = pos(X, x);\n      g[i] = (f[y1] - 2 * f[y2] + f[2 * y2 - y1]) / (h * h);\n      h /= 2;\n      i++;\n    }\n    a = g.length;\n    m = 1;\n    while (a != 1) {\n      for (j = 0; j < a - 1; j++)\n        h1[j] = ((Math.pow(4, m)) * g[j + 1] - g[j]) / (Math.pow(4, m) - 1);\n      a = h1.length;\n      g = h1;\n      h1 = [];\n      m++;\n    }\n    return g;\n  },\n\n  simpson: function simpson(f, a, b, n) {\n    var h = (b - a) / n;\n    var I = f(a);\n    var x = [];\n    var j = a;\n    var k = 0;\n    var i = 1;\n    var m;\n    for (; j <= b; j = j + h, k++)\n      x[k] = j;\n    m = x.length;\n    for (; i < m - 1; i++) {\n      I += ((i % 2 !== 0) ? 4 : 2) * f(x[i]);\n    }\n    return (h / 3) * (I + f(b));\n  },\n\n  hermite: function hermite(X, F, dF, value) {\n    var n = X.length;\n    var p = 0;\n    var i = 0;\n    var l = [];\n    var dl = [];\n    var A = [];\n    var B = [];\n    var j;\n    for (; i < n; i++) {\n      l[i] = 1;\n      for (j = 0; j < n; j++) {\n        if (i != j) l[i] *= (value - X[j]) / (X[i] - X[j]);\n      }\n      dl[i] = 0;\n      for (j = 0; j < n; j++) {\n        if (i != j) dl[i] += 1 / (X [i] - X[j]);\n      }\n      A[i] = (1 - 2 * (value - X[i]) * dl[i]) * (l[i] * l[i]);\n      B[i] = (value - X[i]) * (l[i] * l[i]);\n      p += (A[i] * F[i] + B[i] * dF[i]);\n    }\n    return p;\n  },\n\n  lagrange: function lagrange(X, F, value) {\n    var p = 0;\n    var i = 0;\n    var j, l;\n    var n = X.length;\n    for (; i < n; i++) {\n      l = F[i];\n      for (j = 0; j < n; j++) {\n        // calculating the lagrange polynomial L_i\n        if (i != j) l *= (value - X[j]) / (X[i] - X[j]);\n      }\n      // adding the lagrange polynomials found above\n      p += l;\n    }\n    return p;\n  },\n\n  cubic_spline: function cubic_spline(X, F, value) {\n    var n = X.length;\n    var i = 0, j;\n    var A = [];\n    var B = [];\n    var alpha = [];\n    var c = [];\n    var h = [];\n    var b = [];\n    var d = [];\n    for (; i < n - 1; i++)\n      h[i] = X[i + 1] - X[i];\n    alpha[0] = 0;\n    for (i = 1; i < n - 1; i++) {\n      alpha[i] = (3 / h[i]) * (F[i + 1] - F[i]) -\n          (3 / h[i-1]) * (F[i] - F[i-1]);\n    }\n    for (i = 1; i < n - 1; i++) {\n      A[i] = [];\n      B[i] = [];\n      A[i][i-1] = h[i-1];\n      A[i][i] = 2 * (h[i - 1] + h[i]);\n      A[i][i+1] = h[i];\n      B[i][0] = alpha[i];\n    }\n    c = jStat.multiply(jStat.inv(A), B);\n    for (j = 0; j < n - 1; j++) {\n      b[j] = (F[j + 1] - F[j]) / h[j] - h[j] * (c[j + 1][0] + 2 * c[j][0]) / 3;\n      d[j] = (c[j + 1][0] - c[j][0]) / (3 * h[j]);\n    }\n    for (j = 0; j < n; j++) {\n      if (X[j] > value) break;\n    }\n    j -= 1;\n    return F[j] + (value - X[j]) * b[j] + jStat.sq(value-X[j]) *\n        c[j] + (value - X[j]) * jStat.sq(value - X[j]) * d[j];\n  },\n\n  gauss_quadrature: function gauss_quadrature() {\n    throw new Error('gauss_quadrature not yet implemented');\n  },\n\n  PCA: function PCA(X) {\n    var m = X.length;\n    var n = X[0].length;\n    var i = 0;\n    var j, temp1;\n    var u = [];\n    var D = [];\n    var result = [];\n    var temp2 = [];\n    var Y = [];\n    var Bt = [];\n    var B = [];\n    var C = [];\n    var V = [];\n    var Vt = [];\n    for (i = 0; i < m; i++) {\n      u[i] = jStat.sum(X[i]) / n;\n    }\n    for (i = 0; i < n; i++) {\n      B[i] = [];\n      for(j = 0; j < m; j++) {\n        B[i][j] = X[j][i] - u[j];\n      }\n    }\n    B = jStat.transpose(B);\n    for (i = 0; i < m; i++) {\n      C[i] = [];\n      for (j = 0; j < m; j++) {\n        C[i][j] = (jStat.dot([B[i]], [B[j]])) / (n - 1);\n      }\n    }\n    result = jStat.jacobi(C);\n    V = result[0];\n    D = result[1];\n    Vt = jStat.transpose(V);\n    for (i = 0; i < D.length; i++) {\n      for (j = i; j < D.length; j++) {\n        if(D[i] < D[j])  {\n          temp1 = D[i];\n          D[i] = D[j];\n          D[j] = temp1;\n          temp2 = Vt[i];\n          Vt[i] = Vt[j];\n          Vt[j] = temp2;\n        }\n      }\n    }\n    Bt = jStat.transpose(B);\n    for (i = 0; i < m; i++) {\n      Y[i] = [];\n      for (j = 0; j < Bt.length; j++) {\n        Y[i][j] = jStat.dot([Vt[i]], [Bt[j]]);\n      }\n    }\n    return [X, D, Vt, Y];\n  }\n});\n\n// extend jStat.fn with methods that require one argument\n(function(funcs) {\n  for (var i = 0; i < funcs.length; i++) (function(passfunc) {\n    jStat.fn[passfunc] = function(arg, func) {\n      var tmpthis = this;\n      // check for callback\n      if (func) {\n        setTimeout(function() {\n          func.call(tmpthis, jStat.fn[passfunc].call(tmpthis, arg));\n        }, 15);\n        return this;\n      }\n      if (typeof jStat[passfunc](this, arg) === 'number')\n        return jStat[passfunc](this, arg);\n      else\n        return jStat(jStat[passfunc](this, arg));\n    };\n  }(funcs[i]));\n}('add divide multiply subtract dot pow exp log abs norm angle'.split(' ')));\n\n}(jStat, Math));\n(function(jStat, Math) {\n\nvar slice = [].slice;\nvar isNumber = jStat.utils.isNumber;\nvar isArray = jStat.utils.isArray;\n\n// flag==true denotes use of sample standard deviation\n// Z Statistics\njStat.extend({\n  // 2 different parameter lists:\n  // (value, mean, sd)\n  // (value, array, flag)\n  zscore: function zscore() {\n    var args = slice.call(arguments);\n    if (isNumber(args[1])) {\n      return (args[0] - args[1]) / args[2];\n    }\n    return (args[0] - jStat.mean(args[1])) / jStat.stdev(args[1], args[2]);\n  },\n\n  // 3 different paramter lists:\n  // (value, mean, sd, sides)\n  // (zscore, sides)\n  // (value, array, sides, flag)\n  ztest: function ztest() {\n    var args = slice.call(arguments);\n    var z;\n    if (isArray(args[1])) {\n      // (value, array, sides, flag)\n      z = jStat.zscore(args[0],args[1],args[3]);\n      return (args[2] === 1) ?\n        (jStat.normal.cdf(-Math.abs(z), 0, 1)) :\n        (jStat.normal.cdf(-Math.abs(z), 0, 1)*2);\n    } else {\n      if (args.length > 2) {\n        // (value, mean, sd, sides)\n        z = jStat.zscore(args[0],args[1],args[2]);\n        return (args[3] === 1) ?\n          (jStat.normal.cdf(-Math.abs(z),0,1)) :\n          (jStat.normal.cdf(-Math.abs(z),0,1)* 2);\n      } else {\n        // (zscore, sides)\n        z = args[0];\n        return (args[1] === 1) ?\n          (jStat.normal.cdf(-Math.abs(z),0,1)) :\n          (jStat.normal.cdf(-Math.abs(z),0,1)*2);\n      }\n    }\n  }\n});\n\njStat.extend(jStat.fn, {\n  zscore: function zscore(value, flag) {\n    return (value - this.mean()) / this.stdev(flag);\n  },\n\n  ztest: function ztest(value, sides, flag) {\n    var zscore = Math.abs(this.zscore(value, flag));\n    return (sides === 1) ?\n      (jStat.normal.cdf(-zscore, 0, 1)) :\n      (jStat.normal.cdf(-zscore, 0, 1) * 2);\n  }\n});\n\n// T Statistics\njStat.extend({\n  // 2 parameter lists\n  // (value, mean, sd, n)\n  // (value, array)\n  tscore: function tscore() {\n    var args = slice.call(arguments);\n    return (args.length === 4) ?\n      ((args[0] - args[1]) / (args[2] / Math.sqrt(args[3]))) :\n      ((args[0] - jStat.mean(args[1])) /\n       (jStat.stdev(args[1], true) / Math.sqrt(args[1].length)));\n  },\n\n  // 3 different paramter lists:\n  // (value, mean, sd, n, sides)\n  // (tscore, n, sides)\n  // (value, array, sides)\n  ttest: function ttest() {\n    var args = slice.call(arguments);\n    var tscore;\n    if (args.length === 5) {\n      tscore = Math.abs(jStat.tscore(args[0], args[1], args[2], args[3]));\n      return (args[4] === 1) ?\n        (jStat.studentt.cdf(-tscore, args[3]-1)) :\n        (jStat.studentt.cdf(-tscore, args[3]-1)*2);\n    }\n    if (isNumber(args[1])) {\n      tscore = Math.abs(args[0])\n      return (args[2] == 1) ?\n        (jStat.studentt.cdf(-tscore, args[1]-1)) :\n        (jStat.studentt.cdf(-tscore, args[1]-1) * 2);\n    }\n    tscore = Math.abs(jStat.tscore(args[0], args[1]))\n    return (args[2] == 1) ?\n      (jStat.studentt.cdf(-tscore, args[1].length-1)) :\n      (jStat.studentt.cdf(-tscore, args[1].length-1) * 2);\n  }\n});\n\njStat.extend(jStat.fn, {\n  tscore: function tscore(value) {\n    return (value - this.mean()) / (this.stdev(true) / Math.sqrt(this.cols()));\n  },\n\n  ttest: function ttest(value, sides) {\n    return (sides === 1) ?\n      (1 - jStat.studentt.cdf(Math.abs(this.tscore(value)), this.cols()-1)) :\n      (jStat.studentt.cdf(-Math.abs(this.tscore(value)), this.cols()-1)*2);\n  }\n});\n\n// F Statistics\njStat.extend({\n  // Paramter list is as follows:\n  // (array1, array2, array3, ...)\n  // or it is an array of arrays\n  // array of arrays conversion\n  anovafscore: function anovafscore() {\n    var args = slice.call(arguments),\n    expVar, sample, sampMean, sampSampMean, tmpargs, unexpVar, i, j;\n    if (args.length === 1) {\n      tmpargs = new Array(args[0].length);\n      for (i = 0; i < args[0].length; i++) {\n        tmpargs[i] = args[0][i];\n      }\n      args = tmpargs;\n    }\n    // Builds sample array\n    sample = new Array();\n    for (i = 0; i < args.length; i++) {\n      sample = sample.concat(args[i]);\n    }\n    sampMean = jStat.mean(sample);\n    // Computes the explained variance\n    expVar = 0;\n    for (i = 0; i < args.length; i++) {\n      expVar = expVar + args[i].length * Math.pow(jStat.mean(args[i]) - sampMean, 2);\n    }\n    expVar /= (args.length - 1);\n    // Computes unexplained variance\n    unexpVar = 0;\n    for (i = 0; i < args.length; i++) {\n      sampSampMean = jStat.mean(args[i]);\n      for (j = 0; j < args[i].length; j++) {\n        unexpVar += Math.pow(args[i][j] - sampSampMean, 2);\n      }\n    }\n    unexpVar /= (sample.length - args.length);\n    return expVar / unexpVar;\n  },\n\n  // 2 different paramter setups\n  // (array1, array2, array3, ...)\n  // (anovafscore, df1, df2)\n  anovaftest: function anovaftest() {\n    var args = slice.call(arguments),\n    df1, df2, n, i;\n    if (isNumber(args[0])) {\n      return 1 - jStat.centralF.cdf(args[0], args[1], args[2]);\n    }\n    var anovafscore = jStat.anovafscore(args);\n    df1 = args.length - 1;\n    n = 0;\n    for (i = 0; i < args.length; i++) {\n      n = n + args[i].length;\n    }\n    df2 = n - df1 - 1;\n    return 1 - jStat.centralF.cdf(anovafscore, df1, df2);\n  },\n\n  ftest: function ftest(fscore, df1, df2) {\n    return 1 - jStat.centralF.cdf(fscore, df1, df2);\n  }\n});\n\njStat.extend(jStat.fn, {\n  anovafscore: function anovafscore() {\n    return jStat.anovafscore(this.toArray());\n  },\n\n  anovaftes: function anovaftes() {\n    var n = 0;\n    var i;\n    for (i = 0; i < this.length; i++) {\n      n = n + this[i].length;\n    }\n    return jStat.ftest(this.anovafscore(), this.length - 1, n - this.length);\n  }\n});\n\n// Tukey's range test\njStat.extend({\n  // 2 parameter lists\n  // (mean1, mean2, n1, n2, sd)\n  // (array1, array2, sd)\n  qscore: function qscore() {\n    var args = slice.call(arguments);\n    var mean1, mean2, n1, n2, sd;\n    if (isNumber(args[0])) {\n        mean1 = args[0];\n        mean2 = args[1];\n        n1 = args[2];\n        n2 = args[3];\n        sd = args[4];\n    } else {\n        mean1 = jStat.mean(args[0]);\n        mean2 = jStat.mean(args[1]);\n        n1 = args[0].length;\n        n2 = args[1].length;\n        sd = args[2];\n    }\n    return Math.abs(mean1 - mean2) / (sd * Math.sqrt((1 / n1 + 1 / n2) / 2));\n  },\n\n  // 3 different parameter lists:\n  // (qscore, n, k)\n  // (mean1, mean2, n1, n2, sd, n, k)\n  // (array1, array2, sd, n, k)\n  qtest: function qtest() {\n    var args = slice.call(arguments);\n\n    var qscore;\n    if (args.length === 3) {\n      qscore = args[0];\n      args = args.slice(1);\n    } else if (args.length === 7) {\n      qscore = jStat.qscore(args[0], args[1], args[2], args[3], args[4]);\n      args = args.slice(5);\n    } else {\n      qscore = jStat.qscore(args[0], args[1], args[2]);\n      args = args.slice(3);\n    }\n\n    var n = args[0];\n    var k = args[1];\n\n    return 1 - jStat.tukey.cdf(qscore, k, n - k);\n  },\n\n  tukeyhsd: function tukeyhsd(arrays) {\n    var sd = jStat.pooledstdev(arrays);\n    var means = arrays.map(function (arr) {return jStat.mean(arr);});\n    var n = arrays.reduce(function (n, arr) {return n + arr.length;}, 0);\n\n    var results = [];\n    for (var i = 0; i < arrays.length; ++i) {\n        for (var j = i + 1; j < arrays.length; ++j) {\n            var p = jStat.qtest(means[i], means[j], arrays[i].length, arrays[j].length, sd, n, arrays.length);\n            results.push([[i, j], p]);\n        }\n    }\n\n    return results;\n  }\n});\n\n// Error Bounds\njStat.extend({\n  // 2 different parameter setups\n  // (value, alpha, sd, n)\n  // (value, alpha, array)\n  normalci: function normalci() {\n    var args = slice.call(arguments),\n    ans = new Array(2),\n    change;\n    if (args.length === 4) {\n      change = Math.abs(jStat.normal.inv(args[1] / 2, 0, 1) *\n                        args[2] / Math.sqrt(args[3]));\n    } else {\n      change = Math.abs(jStat.normal.inv(args[1] / 2, 0, 1) *\n                        jStat.stdev(args[2]) / Math.sqrt(args[2].length));\n    }\n    ans[0] = args[0] - change;\n    ans[1] = args[0] + change;\n    return ans;\n  },\n\n  // 2 different parameter setups\n  // (value, alpha, sd, n)\n  // (value, alpha, array)\n  tci: function tci() {\n    var args = slice.call(arguments),\n    ans = new Array(2),\n    change;\n    if (args.length === 4) {\n      change = Math.abs(jStat.studentt.inv(args[1] / 2, args[3] - 1) *\n                        args[2] / Math.sqrt(args[3]));\n    } else {\n      change = Math.abs(jStat.studentt.inv(args[1] / 2, args[2].length - 1) *\n                        jStat.stdev(args[2], true) / Math.sqrt(args[2].length));\n    }\n    ans[0] = args[0] - change;\n    ans[1] = args[0] + change;\n    return ans;\n  },\n\n  significant: function significant(pvalue, alpha) {\n    return pvalue < alpha;\n  }\n});\n\njStat.extend(jStat.fn, {\n  normalci: function normalci(value, alpha) {\n    return jStat.normalci(value, alpha, this.toArray());\n  },\n\n  tci: function tci(value, alpha) {\n    return jStat.tci(value, alpha, this.toArray());\n  }\n});\n\n// internal method for calculating the z-score for a difference of proportions test\nfunction differenceOfProportions(p1, n1, p2, n2) {\n  if (p1 > 1 || p2 > 1 || p1 <= 0 || p2 <= 0) {\n    throw new Error(\"Proportions should be greater than 0 and less than 1\")\n  }\n  var pooled = (p1 * n1 + p2 * n2) / (n1 + n2);\n  var se = Math.sqrt(pooled * (1 - pooled) * ((1/n1) + (1/n2)));\n  return (p1 - p2) / se;\n}\n\n// Difference of Proportions\njStat.extend(jStat.fn, {\n  oneSidedDifferenceOfProportions: function oneSidedDifferenceOfProportions(p1, n1, p2, n2) {\n    var z = differenceOfProportions(p1, n1, p2, n2);\n    return jStat.ztest(z, 1);\n  },\n\n  twoSidedDifferenceOfProportions: function twoSidedDifferenceOfProportions(p1, n1, p2, n2) {\n    var z = differenceOfProportions(p1, n1, p2, n2);\n    return jStat.ztest(z, 2);\n  }\n});\n\n}(jStat, Math));\njStat.models = (function(){\n  function sub_regress(exog) {\n    var var_count = exog[0].length;\n    var modelList = jStat.arange(var_count).map(function(endog_index) {\n      var exog_index =\n          jStat.arange(var_count).filter(function(i){return i!==endog_index});\n      return ols(jStat.col(exog, endog_index).map(function(x){ return x[0] }),\n                 jStat.col(exog, exog_index))\n    });\n    return modelList;\n  }\n\n  // do OLS model regress\n  // exog have include const columns ,it will not generate it .In fact, exog is\n  // \"design matrix\" look at\n  //https://en.wikipedia.org/wiki/Design_matrix\n  function ols(endog, exog) {\n    var nobs = endog.length;\n    var df_model = exog[0].length - 1;\n    var df_resid = nobs-df_model - 1;\n    var coef = jStat.lstsq(exog, endog);\n    var predict =\n        jStat.multiply(exog, coef.map(function(x) { return [x] }))\n            .map(function(p) { return p[0] });\n    var resid = jStat.subtract(endog, predict);\n    var ybar = jStat.mean(endog);\n    // constant cause problem\n    // var SST = jStat.sum(endog.map(function(y) {\n    //   return Math.pow(y-ybar,2);\n    // }));\n    var SSE = jStat.sum(predict.map(function(f) {\n      return Math.pow(f - ybar, 2);\n    }));\n    var SSR = jStat.sum(endog.map(function(y, i) {\n      return Math.pow(y - predict[i], 2);\n    }));\n    var SST = SSE + SSR;\n    var R2 = (SSE / SST);\n    return {\n        exog:exog,\n        endog:endog,\n        nobs:nobs,\n        df_model:df_model,\n        df_resid:df_resid,\n        coef:coef,\n        predict:predict,\n        resid:resid,\n        ybar:ybar,\n        SST:SST,\n        SSE:SSE,\n        SSR:SSR,\n        R2:R2\n    };\n  }\n\n  // H0: b_I=0\n  // H1: b_I!=0\n  function t_test(model) {\n    var subModelList = sub_regress(model.exog);\n    //var sigmaHat=jStat.stdev(model.resid);\n    var sigmaHat = Math.sqrt(model.SSR / (model.df_resid));\n    var seBetaHat = subModelList.map(function(mod) {\n      var SST = mod.SST;\n      var R2 = mod.R2;\n      return sigmaHat / Math.sqrt(SST * (1 - R2));\n    });\n    var tStatistic = model.coef.map(function(coef, i) {\n      return (coef - 0) / seBetaHat[i];\n    });\n    var pValue = tStatistic.map(function(t) {\n      var leftppf = jStat.studentt.cdf(t, model.df_resid);\n      return (leftppf > 0.5 ? 1 - leftppf : leftppf) * 2;\n    });\n    var c = jStat.studentt.inv(0.975, model.df_resid);\n    var interval95 = model.coef.map(function(coef, i) {\n      var d = c * seBetaHat[i];\n      return [coef - d, coef + d];\n    })\n    return {\n        se: seBetaHat,\n        t: tStatistic,\n        p: pValue,\n        sigmaHat: sigmaHat,\n        interval95: interval95\n    };\n  }\n\n  function F_test(model) {\n    var F_statistic =\n        (model.R2 / model.df_model) / ((1 - model.R2) / model.df_resid);\n    var fcdf = function(x, n1, n2) {\n      return jStat.beta.cdf(x / (n2 / n1 + x), n1 / 2, n2 / 2)\n    }\n    var pvalue = 1 - fcdf(F_statistic, model.df_model, model.df_resid);\n    return { F_statistic: F_statistic, pvalue: pvalue };\n  }\n\n  function ols_wrap(endog, exog) {\n    var model = ols(endog,exog);\n    var ttest = t_test(model);\n    var ftest = F_test(model);\n    // Provide the Wherry / Ezekiel / McNemar / Cohen Adjusted R^2\n    // Which matches the 'adjusted R^2' provided by R's lm package\n    var adjust_R2 =\n        1 - (1 - model.R2) * ((model.nobs - 1) / (model.df_resid));\n    model.t = ttest;\n    model.f = ftest;\n    model.adjust_R2 = adjust_R2;\n    return model;\n  }\n\n  return { ols: ols_wrap };\n})();\n//To regress, simply build X matrix\n//(append column of 1's) using\n//buildxmatrix and build the Y\n//matrix using buildymatrix\n//(simply the transpose)\n//and run regress.\n\n\n\n//Regressions\n\njStat.extend({\n  buildxmatrix: function buildxmatrix(){\n    //Parameters will be passed in as such\n    //(array1,array2,array3,...)\n    //as (x1,x2,x3,...)\n    //needs to be (1,x1,x2,x3,...)\n    var matrixRows = new Array(arguments.length);\n    for(var i=0;i<arguments.length;i++){\n      var array = [1];\n      matrixRows[i]= array.concat(arguments[i]);\n    }\n    return jStat(matrixRows);\n\n  },\n\n  builddxmatrix: function builddxmatrix() {\n    //Paramters will be passed in as such\n    //([array1,array2,...]\n    var matrixRows = new Array(arguments[0].length);\n    for(var i=0;i<arguments[0].length;i++){\n      var array = [1]\n      matrixRows[i]= array.concat(arguments[0][i]);\n    }\n    return jStat(matrixRows);\n\n  },\n\n  buildjxmatrix: function buildjxmatrix(jMat) {\n    //Builds from jStat Matrix\n    var pass = new Array(jMat.length)\n    for(var i=0;i<jMat.length;i++){\n      pass[i] = jMat[i];\n    }\n    return jStat.builddxmatrix(pass);\n\n  },\n\n  buildymatrix: function buildymatrix(array){\n    return jStat(array).transpose();\n  },\n\n  buildjymatrix: function buildjymatrix(jMat){\n    return jMat.transpose();\n  },\n\n  matrixmult: function matrixmult(A,B){\n    var i, j, k, result, sum;\n    if (A.cols() == B.rows()) {\n      if(B.rows()>1){\n        result = [];\n        for (i = 0; i < A.rows(); i++) {\n          result[i] = [];\n          for (j = 0; j < B.cols(); j++) {\n            sum = 0;\n            for (k = 0; k < A.cols(); k++) {\n              sum += A.toArray()[i][k] * B.toArray()[k][j];\n            }\n            result[i][j] = sum;\n          }\n        }\n        return jStat(result);\n      }\n      result = [];\n      for (i = 0; i < A.rows(); i++) {\n        result[i] = [];\n        for (j = 0; j < B.cols(); j++) {\n          sum = 0;\n          for (k = 0; k < A.cols(); k++) {\n            sum += A.toArray()[i][k] * B.toArray()[j];\n          }\n          result[i][j] = sum;\n        }\n      }\n      return jStat(result);\n    }\n  },\n\n  //regress and regresst to be fixed\n\n  regress: function regress(jMatX,jMatY){\n    //print(\"regressin!\");\n    //print(jMatX.toArray());\n    var innerinv = jStat.xtranspxinv(jMatX);\n    //print(innerinv);\n    var xtransp = jMatX.transpose();\n    var next = jStat.matrixmult(jStat(innerinv),xtransp);\n    return jStat.matrixmult(next,jMatY);\n\n  },\n\n  regresst: function regresst(jMatX,jMatY,sides){\n    var beta = jStat.regress(jMatX,jMatY);\n\n    var compile = {};\n    compile.anova = {};\n    var jMatYBar = jStat.jMatYBar(jMatX, beta);\n    compile.yBar = jMatYBar;\n    var yAverage = jMatY.mean();\n    compile.anova.residuals = jStat.residuals(jMatY, jMatYBar);\n\n    compile.anova.ssr = jStat.ssr(jMatYBar, yAverage);\n    compile.anova.msr = compile.anova.ssr / (jMatX[0].length - 1);\n\n    compile.anova.sse = jStat.sse(jMatY, jMatYBar);\n    compile.anova.mse =\n        compile.anova.sse / (jMatY.length - (jMatX[0].length - 1) - 1);\n\n    compile.anova.sst = jStat.sst(jMatY, yAverage);\n    compile.anova.mst = compile.anova.sst / (jMatY.length - 1);\n\n    compile.anova.r2 = 1 - (compile.anova.sse / compile.anova.sst);\n    if (compile.anova.r2 < 0) compile.anova.r2 = 0;\n\n    compile.anova.fratio = compile.anova.msr / compile.anova.mse;\n    compile.anova.pvalue =\n        jStat.anovaftest(compile.anova.fratio,\n                         jMatX[0].length - 1,\n                         jMatY.length - (jMatX[0].length - 1) - 1);\n\n    compile.anova.rmse = Math.sqrt(compile.anova.mse);\n\n    compile.anova.r2adj = 1 - (compile.anova.mse / compile.anova.mst);\n    if (compile.anova.r2adj < 0) compile.anova.r2adj = 0;\n\n    compile.stats = new Array(jMatX[0].length);\n    var covar = jStat.xtranspxinv(jMatX);\n    var sds, ts, ps;\n\n    for(var i=0; i<beta.length;i++){\n      sds=Math.sqrt(compile.anova.mse * Math.abs(covar[i][i]));\n      ts= Math.abs(beta[i] / sds);\n      ps= jStat.ttest(ts, jMatY.length - jMatX[0].length - 1, sides);\n\n      compile.stats[i]=[beta[i], sds, ts, ps];\n    }\n\n    compile.regress = beta;\n    return compile;\n  },\n\n  xtranspx: function xtranspx(jMatX){\n    return jStat.matrixmult(jMatX.transpose(),jMatX);\n  },\n\n\n  xtranspxinv: function xtranspxinv(jMatX){\n    var inner = jStat.matrixmult(jMatX.transpose(),jMatX);\n    var innerinv = jStat.inv(inner);\n    return innerinv;\n  },\n\n  jMatYBar: function jMatYBar(jMatX, beta) {\n    var yBar = jStat.matrixmult(jMatX, beta);\n    return new jStat(yBar);\n  },\n\n  residuals: function residuals(jMatY, jMatYBar) {\n    return jStat.matrixsubtract(jMatY, jMatYBar);\n  },\n\n  ssr: function ssr(jMatYBar, yAverage) {\n    var ssr = 0;\n    for(var i = 0; i < jMatYBar.length; i++) {\n      ssr += Math.pow(jMatYBar[i] - yAverage, 2);\n    }\n    return ssr;\n  },\n\n  sse: function sse(jMatY, jMatYBar) {\n    var sse = 0;\n    for(var i = 0; i < jMatY.length; i++) {\n      sse += Math.pow(jMatY[i] - jMatYBar[i], 2);\n    }\n    return sse;\n  },\n\n  sst: function sst(jMatY, yAverage) {\n    var sst = 0;\n    for(var i = 0; i < jMatY.length; i++) {\n      sst += Math.pow(jMatY[i] - yAverage, 2);\n    }\n    return sst;\n  },\n\n  matrixsubtract: function matrixsubtract(A,B){\n    var ans = new Array(A.length);\n    for(var i=0;i<A.length;i++){\n      ans[i] = new Array(A[i].length);\n      for(var j=0;j<A[i].length;j++){\n        ans[i][j]=A[i][j]-B[i][j];\n      }\n    }\n    return jStat(ans);\n  }\n});\n  // Make it compatible with previous version.\n  jStat.jStat = jStat;\n\n  return jStat;\n});\n","import Kefir from \"kefir\";\r\nimport jStat from \"jstat\";\r\n\r\nexport const random_connection = () => {\r\n  const onstart = () => {}\r\n  const onmessage = (value) => {}\r\n  const onerror = (msg) => {}\r\n\r\n  let retrieve_continue = true;\r\n  const configure = (cmd, value) => {\r\n    console.log(\"Send cmd:\", cmd, \" value:\", value);\r\n  }\r\n  const send = (cmd) => {\r\n    if (cmd == \"stop\") {\r\n      retrieve_continue = false;\r\n    }\r\n  }\r\n  const start = () => {\r\n    self.onstart();\r\n    let index = 0;\r\n    const caller = () => {\r\n      const data = random_data_generator();\r\n      const value = {}\r\n      if (index == 0) {\r\n        value.type = \"channels\";\r\n        value.value = data[\"channels\"];\r\n      } else {\r\n        value.type = index % 2 == 1 ? \"timepoint\" : \"connectivity\";\r\n        value.value = data[value.type];\r\n      }\r\n      self.onmessage(JSON.stringify(value));\r\n      index++;\r\n      if (retrieve_continue) setTimeout(caller, random_frequency());\r\n    }\r\n    setTimeout(caller, frequency);\r\n  }\r\n\r\n  const frequency = 500;\r\n  const random_frequency = () => Math.max(300, Math.min(2000, frequency + jStat.normal.sample(0, 0.1)))\r\n  const random_data_generator = () => ({\r\n    channels: [\"T3\", \"T4\", \"F3\", \"F4\"],\r\n    timepoint: [\r\n      Array.from({ length: 4 }, (v, i) => jStat.normal.sample(0, 1))\r\n    ],\r\n    connectivity: [\r\n      Array.from({ length: 16 }, (v, i) => [Math.floor(i / 4), i % 4, jStat.normal.sample(0, 1)])\r\n    ],\r\n  })\r\n  let self = { configure, start, send, onstart, onmessage, onerror };\r\n  return self;\r\n};\r\n\r\nexport const websocket_connection = ({ server = \"localhost\", port = 9120 }) => {\r\n  let socket = new WebSocket(`ws://${server}:${port}`, \"ovar-protocol\");\r\n  window.socket_ = socket\r\n  socket.onmessage = function(event) {\r\n    try {\r\n      self.onmessage(event.data);\r\n    } catch (e) {\r\n      console.error(e);\r\n      console.error(\"#\" + event.data);\r\n    }\r\n  }\r\n  socket.onerror = (d) => self.onerror(d);\r\n  socket.onopen = function(event) {\r\n    self.onstart()\r\n  };\r\n  const onstart = () => {}\r\n  const onmessage = (value) => {}\r\n  const onerror = (msg) => {}\r\n\r\n  const configure = (cmd, value = \"\") => {\r\n    if (cmd == \"close\") {\r\n      socket.send(JSON.stringify({\r\n        command: cmd,\r\n        value: value,\r\n      }));\r\n      setTimeout(() => socket.close(), 200);\r\n    }\r\n    const repetitions = [\"pause\", \"stop\"].includes(cmd) ? 1000 : 1;\r\n    for (let i = 0; i < repetitions; i++) {\r\n      socket.send(JSON.stringify({\r\n        command: cmd,\r\n        value: value,\r\n      }));\r\n    }\r\n    if ([\"pause\", \"stop\"].includes(cmd)) {\r\n      setTimeout(() => {\r\n        for (let i = 0; i < repetitions; i++) {\r\n          socket.send(JSON.stringify({\r\n            command: cmd,\r\n            value: value,\r\n          }));\r\n        }\r\n      }, 100);\r\n      setTimeout(() => {\r\n        for (let i = 0; i < repetitions; i++) {\r\n          socket.send(JSON.stringify({\r\n            command: cmd,\r\n            value: value,\r\n          }));\r\n        }\r\n      }, 150);\r\n      setTimeout(() => {\r\n        for (let i = 0; i < repetitions; i++) {\r\n          socket.send(JSON.stringify({\r\n            command: cmd,\r\n            value: value,\r\n          }));\r\n        }\r\n      }, 200);\r\n      setTimeout(() => {\r\n        for (let i = 0; i < repetitions; i++) {\r\n          socket.send(JSON.stringify({\r\n            command: cmd,\r\n            value: value,\r\n          }));\r\n        }\r\n      }, 250);\r\n    }\r\n    console.log(\"====CONFIG====\")\r\n    for (let i = 0; i < 100; i++)\r\n      console.log(JSON.stringify({\r\n        command: cmd,\r\n        value: value,\r\n      }))\r\n\r\n  }\r\n  const send = (cmd) => configure(cmd, \"\");\r\n  const start = () => {\r\n    send(\"start\")\r\n  }\r\n  const ready = () => {\r\n    return socket.readyState == 1\r\n  }\r\n  let self = { configure, start, send, onstart, onmessage, onerror, ready };\r\n  return self;\r\n};\r\n\r\nexport const dataprovider = (connection, properties = {}) => {\r\n  const subscribers = {};\r\n  subscribers[\"channels\"] = [];\r\n  subscribers[\"timepoint\"] = [];\r\n  subscribers[\"connectivity\"] = [];\r\n\r\n  const subscribe = (subscription_type, subscriber) => {\r\n    console.log(\"subscribing\", subscription_type, subscriber)\r\n    if (!subscribers[subscription_type]) {\r\n      subscribers[subscription_type] = []\r\n    }\r\n    subscribers[subscription_type].push(subscriber);\r\n    return { subscribe, execute }\r\n  }\r\n\r\n  const execute = (cmd) => {\r\n    connection.send(cmd);\r\n  };\r\n\r\n  connection.onmessage = (raw_value) => {\r\n    const value = JSON.parse(raw_value);\r\n    if (!subscribers[value.type]) {\r\n      subscribers[value.type] = []\r\n    }\r\n    subscribers[value.type].forEach((v) => v(value.value))\r\n    //console.log(\"Received\", value);\r\n  };\r\n\r\n  const proper_start = () => {\r\n    if (connection.ready()) {\r\n      Object.keys(properties).forEach((prop) =>\r\n        connection.configure(prop, properties[prop])\r\n      )\r\n      connection.start();\r\n    } else {\r\n      setTimeout(proper_start, 100);\r\n    }\r\n  }\r\n  proper_start();\r\n\r\n  return { subscribe, execute };\r\n}","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar PI_OVER_180 = Math.PI / 180;\nfunction detectBrowser() {\n    return (typeof window !== 'undefined' &&\n        ({}.toString.call(window) === '[object Window]' ||\n            {}.toString.call(window) === '[object global]'));\n}\nvar _detectIE = function (ua) {\n    var msie = ua.indexOf('msie ');\n    if (msie > 0) {\n        return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\n    }\n    var trident = ua.indexOf('trident/');\n    if (trident > 0) {\n        var rv = ua.indexOf('rv:');\n        return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\n    }\n    var edge = ua.indexOf('edge/');\n    if (edge > 0) {\n        return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\n    }\n    return false;\n};\nexports._parseUA = function (userAgent) {\n    var ua = userAgent.toLowerCase(), match = /(chrome)[ /]([\\w.]+)/.exec(ua) ||\n        /(webkit)[ /]([\\w.]+)/.exec(ua) ||\n        /(opera)(?:.*version|)[ /]([\\w.]+)/.exec(ua) ||\n        /(msie) ([\\w.]+)/.exec(ua) ||\n        (ua.indexOf('compatible') < 0 &&\n            /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec(ua)) ||\n        [], mobile = !!userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i), ieMobile = !!userAgent.match(/IEMobile/i);\n    return {\n        browser: match[1] || '',\n        version: match[2] || '0',\n        isIE: _detectIE(ua),\n        mobile: mobile,\n        ieMobile: ieMobile\n    };\n};\nexports.glob = typeof global !== 'undefined'\n    ? global\n    : typeof window !== 'undefined'\n        ? window\n        : typeof WorkerGlobalScope !== 'undefined'\n            ? self\n            : {};\nexports.Konva = {\n    _global: exports.glob,\n    version: '4.2.2',\n    isBrowser: detectBrowser(),\n    isUnminified: /param/.test(function (param) { }.toString()),\n    dblClickWindow: 400,\n    getAngle: function (angle) {\n        return exports.Konva.angleDeg ? angle * PI_OVER_180 : angle;\n    },\n    enableTrace: false,\n    _pointerEventsEnabled: false,\n    hitOnDragEnabled: false,\n    captureTouchEventsEnabled: false,\n    listenClickTap: false,\n    inDblClickWindow: false,\n    pixelRatio: undefined,\n    dragDistance: 3,\n    angleDeg: true,\n    showWarnings: true,\n    dragButtons: [0, 1],\n    isDragging: function () {\n        return exports.Konva['DD'].isDragging;\n    },\n    isDragReady: function () {\n        return !!exports.Konva['DD'].node;\n    },\n    UA: exports._parseUA((exports.glob.navigator && exports.glob.navigator.userAgent) || ''),\n    document: exports.glob.document,\n    _injectGlobal: function (Konva) {\n        exports.glob.Konva = Konva;\n    },\n    _parseUA: exports._parseUA\n};\nexports._NODES_REGISTRY = {};\nexports._registerNode = function (NodeClass) {\n    exports._NODES_REGISTRY[NodeClass.prototype.getClassName()] = NodeClass;\n    exports.Konva[NodeClass.prototype.getClassName()] = NodeClass;\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Global_1 = require(\"./Global\");\nvar Collection = (function () {\n    function Collection() {\n    }\n    Collection.toCollection = function (arr) {\n        var collection = new Collection(), len = arr.length, n;\n        for (n = 0; n < len; n++) {\n            collection.push(arr[n]);\n        }\n        return collection;\n    };\n    Collection._mapMethod = function (methodName) {\n        Collection.prototype[methodName] = function () {\n            var len = this.length, i;\n            var args = [].slice.call(arguments);\n            for (i = 0; i < len; i++) {\n                this[i][methodName].apply(this[i], args);\n            }\n            return this;\n        };\n    };\n    Collection.mapMethods = function (constructor) {\n        var prot = constructor.prototype;\n        for (var methodName in prot) {\n            Collection._mapMethod(methodName);\n        }\n    };\n    return Collection;\n}());\nexports.Collection = Collection;\nCollection.prototype = [];\nCollection.prototype.each = function (func) {\n    for (var n = 0; n < this.length; n++) {\n        func(this[n], n);\n    }\n};\nCollection.prototype.toArray = function () {\n    var arr = [], len = this.length, n;\n    for (n = 0; n < len; n++) {\n        arr.push(this[n]);\n    }\n    return arr;\n};\nvar Transform = (function () {\n    function Transform(m) {\n        if (m === void 0) { m = [1, 0, 0, 1, 0, 0]; }\n        this.m = (m && m.slice()) || [1, 0, 0, 1, 0, 0];\n    }\n    Transform.prototype.copy = function () {\n        return new Transform(this.m);\n    };\n    Transform.prototype.point = function (point) {\n        var m = this.m;\n        return {\n            x: m[0] * point.x + m[2] * point.y + m[4],\n            y: m[1] * point.x + m[3] * point.y + m[5]\n        };\n    };\n    Transform.prototype.translate = function (x, y) {\n        this.m[4] += this.m[0] * x + this.m[2] * y;\n        this.m[5] += this.m[1] * x + this.m[3] * y;\n        return this;\n    };\n    Transform.prototype.scale = function (sx, sy) {\n        this.m[0] *= sx;\n        this.m[1] *= sx;\n        this.m[2] *= sy;\n        this.m[3] *= sy;\n        return this;\n    };\n    Transform.prototype.rotate = function (rad) {\n        var c = Math.cos(rad);\n        var s = Math.sin(rad);\n        var m11 = this.m[0] * c + this.m[2] * s;\n        var m12 = this.m[1] * c + this.m[3] * s;\n        var m21 = this.m[0] * -s + this.m[2] * c;\n        var m22 = this.m[1] * -s + this.m[3] * c;\n        this.m[0] = m11;\n        this.m[1] = m12;\n        this.m[2] = m21;\n        this.m[3] = m22;\n        return this;\n    };\n    Transform.prototype.getTranslation = function () {\n        return {\n            x: this.m[4],\n            y: this.m[5]\n        };\n    };\n    Transform.prototype.skew = function (sx, sy) {\n        var m11 = this.m[0] + this.m[2] * sy;\n        var m12 = this.m[1] + this.m[3] * sy;\n        var m21 = this.m[2] + this.m[0] * sx;\n        var m22 = this.m[3] + this.m[1] * sx;\n        this.m[0] = m11;\n        this.m[1] = m12;\n        this.m[2] = m21;\n        this.m[3] = m22;\n        return this;\n    };\n    Transform.prototype.multiply = function (matrix) {\n        var m11 = this.m[0] * matrix.m[0] + this.m[2] * matrix.m[1];\n        var m12 = this.m[1] * matrix.m[0] + this.m[3] * matrix.m[1];\n        var m21 = this.m[0] * matrix.m[2] + this.m[2] * matrix.m[3];\n        var m22 = this.m[1] * matrix.m[2] + this.m[3] * matrix.m[3];\n        var dx = this.m[0] * matrix.m[4] + this.m[2] * matrix.m[5] + this.m[4];\n        var dy = this.m[1] * matrix.m[4] + this.m[3] * matrix.m[5] + this.m[5];\n        this.m[0] = m11;\n        this.m[1] = m12;\n        this.m[2] = m21;\n        this.m[3] = m22;\n        this.m[4] = dx;\n        this.m[5] = dy;\n        return this;\n    };\n    Transform.prototype.invert = function () {\n        var d = 1 / (this.m[0] * this.m[3] - this.m[1] * this.m[2]);\n        var m0 = this.m[3] * d;\n        var m1 = -this.m[1] * d;\n        var m2 = -this.m[2] * d;\n        var m3 = this.m[0] * d;\n        var m4 = d * (this.m[2] * this.m[5] - this.m[3] * this.m[4]);\n        var m5 = d * (this.m[1] * this.m[4] - this.m[0] * this.m[5]);\n        this.m[0] = m0;\n        this.m[1] = m1;\n        this.m[2] = m2;\n        this.m[3] = m3;\n        this.m[4] = m4;\n        this.m[5] = m5;\n        return this;\n    };\n    Transform.prototype.getMatrix = function () {\n        return this.m;\n    };\n    Transform.prototype.setAbsolutePosition = function (x, y) {\n        var m0 = this.m[0], m1 = this.m[1], m2 = this.m[2], m3 = this.m[3], m4 = this.m[4], m5 = this.m[5], yt = (m0 * (y - m5) - m1 * (x - m4)) / (m0 * m3 - m1 * m2), xt = (x - m4 - m2 * yt) / m0;\n        return this.translate(xt, yt);\n    };\n    return Transform;\n}());\nexports.Transform = Transform;\nvar OBJECT_ARRAY = '[object Array]', OBJECT_NUMBER = '[object Number]', OBJECT_STRING = '[object String]', OBJECT_BOOLEAN = '[object Boolean]', PI_OVER_DEG180 = Math.PI / 180, DEG180_OVER_PI = 180 / Math.PI, HASH = '#', EMPTY_STRING = '', ZERO = '0', KONVA_WARNING = 'Konva warning: ', KONVA_ERROR = 'Konva error: ', RGB_PAREN = 'rgb(', COLORS = {\n    aliceblue: [240, 248, 255],\n    antiquewhite: [250, 235, 215],\n    aqua: [0, 255, 255],\n    aquamarine: [127, 255, 212],\n    azure: [240, 255, 255],\n    beige: [245, 245, 220],\n    bisque: [255, 228, 196],\n    black: [0, 0, 0],\n    blanchedalmond: [255, 235, 205],\n    blue: [0, 0, 255],\n    blueviolet: [138, 43, 226],\n    brown: [165, 42, 42],\n    burlywood: [222, 184, 135],\n    cadetblue: [95, 158, 160],\n    chartreuse: [127, 255, 0],\n    chocolate: [210, 105, 30],\n    coral: [255, 127, 80],\n    cornflowerblue: [100, 149, 237],\n    cornsilk: [255, 248, 220],\n    crimson: [220, 20, 60],\n    cyan: [0, 255, 255],\n    darkblue: [0, 0, 139],\n    darkcyan: [0, 139, 139],\n    darkgoldenrod: [184, 132, 11],\n    darkgray: [169, 169, 169],\n    darkgreen: [0, 100, 0],\n    darkgrey: [169, 169, 169],\n    darkkhaki: [189, 183, 107],\n    darkmagenta: [139, 0, 139],\n    darkolivegreen: [85, 107, 47],\n    darkorange: [255, 140, 0],\n    darkorchid: [153, 50, 204],\n    darkred: [139, 0, 0],\n    darksalmon: [233, 150, 122],\n    darkseagreen: [143, 188, 143],\n    darkslateblue: [72, 61, 139],\n    darkslategray: [47, 79, 79],\n    darkslategrey: [47, 79, 79],\n    darkturquoise: [0, 206, 209],\n    darkviolet: [148, 0, 211],\n    deeppink: [255, 20, 147],\n    deepskyblue: [0, 191, 255],\n    dimgray: [105, 105, 105],\n    dimgrey: [105, 105, 105],\n    dodgerblue: [30, 144, 255],\n    firebrick: [178, 34, 34],\n    floralwhite: [255, 255, 240],\n    forestgreen: [34, 139, 34],\n    fuchsia: [255, 0, 255],\n    gainsboro: [220, 220, 220],\n    ghostwhite: [248, 248, 255],\n    gold: [255, 215, 0],\n    goldenrod: [218, 165, 32],\n    gray: [128, 128, 128],\n    green: [0, 128, 0],\n    greenyellow: [173, 255, 47],\n    grey: [128, 128, 128],\n    honeydew: [240, 255, 240],\n    hotpink: [255, 105, 180],\n    indianred: [205, 92, 92],\n    indigo: [75, 0, 130],\n    ivory: [255, 255, 240],\n    khaki: [240, 230, 140],\n    lavender: [230, 230, 250],\n    lavenderblush: [255, 240, 245],\n    lawngreen: [124, 252, 0],\n    lemonchiffon: [255, 250, 205],\n    lightblue: [173, 216, 230],\n    lightcoral: [240, 128, 128],\n    lightcyan: [224, 255, 255],\n    lightgoldenrodyellow: [250, 250, 210],\n    lightgray: [211, 211, 211],\n    lightgreen: [144, 238, 144],\n    lightgrey: [211, 211, 211],\n    lightpink: [255, 182, 193],\n    lightsalmon: [255, 160, 122],\n    lightseagreen: [32, 178, 170],\n    lightskyblue: [135, 206, 250],\n    lightslategray: [119, 136, 153],\n    lightslategrey: [119, 136, 153],\n    lightsteelblue: [176, 196, 222],\n    lightyellow: [255, 255, 224],\n    lime: [0, 255, 0],\n    limegreen: [50, 205, 50],\n    linen: [250, 240, 230],\n    magenta: [255, 0, 255],\n    maroon: [128, 0, 0],\n    mediumaquamarine: [102, 205, 170],\n    mediumblue: [0, 0, 205],\n    mediumorchid: [186, 85, 211],\n    mediumpurple: [147, 112, 219],\n    mediumseagreen: [60, 179, 113],\n    mediumslateblue: [123, 104, 238],\n    mediumspringgreen: [0, 250, 154],\n    mediumturquoise: [72, 209, 204],\n    mediumvioletred: [199, 21, 133],\n    midnightblue: [25, 25, 112],\n    mintcream: [245, 255, 250],\n    mistyrose: [255, 228, 225],\n    moccasin: [255, 228, 181],\n    navajowhite: [255, 222, 173],\n    navy: [0, 0, 128],\n    oldlace: [253, 245, 230],\n    olive: [128, 128, 0],\n    olivedrab: [107, 142, 35],\n    orange: [255, 165, 0],\n    orangered: [255, 69, 0],\n    orchid: [218, 112, 214],\n    palegoldenrod: [238, 232, 170],\n    palegreen: [152, 251, 152],\n    paleturquoise: [175, 238, 238],\n    palevioletred: [219, 112, 147],\n    papayawhip: [255, 239, 213],\n    peachpuff: [255, 218, 185],\n    peru: [205, 133, 63],\n    pink: [255, 192, 203],\n    plum: [221, 160, 203],\n    powderblue: [176, 224, 230],\n    purple: [128, 0, 128],\n    rebeccapurple: [102, 51, 153],\n    red: [255, 0, 0],\n    rosybrown: [188, 143, 143],\n    royalblue: [65, 105, 225],\n    saddlebrown: [139, 69, 19],\n    salmon: [250, 128, 114],\n    sandybrown: [244, 164, 96],\n    seagreen: [46, 139, 87],\n    seashell: [255, 245, 238],\n    sienna: [160, 82, 45],\n    silver: [192, 192, 192],\n    skyblue: [135, 206, 235],\n    slateblue: [106, 90, 205],\n    slategray: [119, 128, 144],\n    slategrey: [119, 128, 144],\n    snow: [255, 255, 250],\n    springgreen: [0, 255, 127],\n    steelblue: [70, 130, 180],\n    tan: [210, 180, 140],\n    teal: [0, 128, 128],\n    thistle: [216, 191, 216],\n    transparent: [255, 255, 255, 0],\n    tomato: [255, 99, 71],\n    turquoise: [64, 224, 208],\n    violet: [238, 130, 238],\n    wheat: [245, 222, 179],\n    white: [255, 255, 255],\n    whitesmoke: [245, 245, 245],\n    yellow: [255, 255, 0],\n    yellowgreen: [154, 205, 5]\n}, RGB_REGEX = /rgb\\((\\d{1,3}),(\\d{1,3}),(\\d{1,3})\\)/, animQueue = [];\nexports.Util = {\n    _isElement: function (obj) {\n        return !!(obj && obj.nodeType == 1);\n    },\n    _isFunction: function (obj) {\n        return !!(obj && obj.constructor && obj.call && obj.apply);\n    },\n    _isPlainObject: function (obj) {\n        return !!obj && obj.constructor === Object;\n    },\n    _isArray: function (obj) {\n        return Object.prototype.toString.call(obj) === OBJECT_ARRAY;\n    },\n    _isNumber: function (obj) {\n        return (Object.prototype.toString.call(obj) === OBJECT_NUMBER &&\n            !isNaN(obj) &&\n            isFinite(obj));\n    },\n    _isString: function (obj) {\n        return Object.prototype.toString.call(obj) === OBJECT_STRING;\n    },\n    _isBoolean: function (obj) {\n        return Object.prototype.toString.call(obj) === OBJECT_BOOLEAN;\n    },\n    isObject: function (val) {\n        return val instanceof Object;\n    },\n    isValidSelector: function (selector) {\n        if (typeof selector !== 'string') {\n            return false;\n        }\n        var firstChar = selector[0];\n        return (firstChar === '#' ||\n            firstChar === '.' ||\n            firstChar === firstChar.toUpperCase());\n    },\n    _sign: function (number) {\n        if (number === 0) {\n            return 0;\n        }\n        if (number > 0) {\n            return 1;\n        }\n        else {\n            return -1;\n        }\n    },\n    requestAnimFrame: function (callback) {\n        animQueue.push(callback);\n        if (animQueue.length === 1) {\n            requestAnimationFrame(function () {\n                var queue = animQueue;\n                animQueue = [];\n                queue.forEach(function (cb) {\n                    cb();\n                });\n            });\n        }\n    },\n    createCanvasElement: function () {\n        var canvas = document.createElement('canvas');\n        try {\n            canvas.style = canvas.style || {};\n        }\n        catch (e) { }\n        return canvas;\n    },\n    createImageElement: function () {\n        return document.createElement('img');\n    },\n    _isInDocument: function (el) {\n        while ((el = el.parentNode)) {\n            if (el == document) {\n                return true;\n            }\n        }\n        return false;\n    },\n    _simplifyArray: function (arr) {\n        var retArr = [], len = arr.length, util = exports.Util, n, val;\n        for (n = 0; n < len; n++) {\n            val = arr[n];\n            if (util._isNumber(val)) {\n                val = Math.round(val * 1000) / 1000;\n            }\n            else if (!util._isString(val)) {\n                val = val.toString();\n            }\n            retArr.push(val);\n        }\n        return retArr;\n    },\n    _urlToImage: function (url, callback) {\n        var imageObj = new Global_1.glob.Image();\n        imageObj.onload = function () {\n            callback(imageObj);\n        };\n        imageObj.src = url;\n    },\n    _rgbToHex: function (r, g, b) {\n        return ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n    },\n    _hexToRgb: function (hex) {\n        hex = hex.replace(HASH, EMPTY_STRING);\n        var bigint = parseInt(hex, 16);\n        return {\n            r: (bigint >> 16) & 255,\n            g: (bigint >> 8) & 255,\n            b: bigint & 255\n        };\n    },\n    getRandomColor: function () {\n        var randColor = ((Math.random() * 0xffffff) << 0).toString(16);\n        while (randColor.length < 6) {\n            randColor = ZERO + randColor;\n        }\n        return HASH + randColor;\n    },\n    get: function (val, def) {\n        if (val === undefined) {\n            return def;\n        }\n        else {\n            return val;\n        }\n    },\n    getRGB: function (color) {\n        var rgb;\n        if (color in COLORS) {\n            rgb = COLORS[color];\n            return {\n                r: rgb[0],\n                g: rgb[1],\n                b: rgb[2]\n            };\n        }\n        else if (color[0] === HASH) {\n            return this._hexToRgb(color.substring(1));\n        }\n        else if (color.substr(0, 4) === RGB_PAREN) {\n            rgb = RGB_REGEX.exec(color.replace(/ /g, ''));\n            return {\n                r: parseInt(rgb[1], 10),\n                g: parseInt(rgb[2], 10),\n                b: parseInt(rgb[3], 10)\n            };\n        }\n        else {\n            return {\n                r: 0,\n                g: 0,\n                b: 0\n            };\n        }\n    },\n    colorToRGBA: function (str) {\n        str = str || 'black';\n        return (exports.Util._namedColorToRBA(str) ||\n            exports.Util._hex3ColorToRGBA(str) ||\n            exports.Util._hex6ColorToRGBA(str) ||\n            exports.Util._rgbColorToRGBA(str) ||\n            exports.Util._rgbaColorToRGBA(str) ||\n            exports.Util._hslColorToRGBA(str));\n    },\n    _namedColorToRBA: function (str) {\n        var c = COLORS[str.toLowerCase()];\n        if (!c) {\n            return null;\n        }\n        return {\n            r: c[0],\n            g: c[1],\n            b: c[2],\n            a: 1\n        };\n    },\n    _rgbColorToRGBA: function (str) {\n        if (str.indexOf('rgb(') === 0) {\n            str = str.match(/rgb\\(([^)]+)\\)/)[1];\n            var parts = str.split(/ *, */).map(Number);\n            return {\n                r: parts[0],\n                g: parts[1],\n                b: parts[2],\n                a: 1\n            };\n        }\n    },\n    _rgbaColorToRGBA: function (str) {\n        if (str.indexOf('rgba(') === 0) {\n            str = str.match(/rgba\\(([^)]+)\\)/)[1];\n            var parts = str.split(/ *, */).map(Number);\n            return {\n                r: parts[0],\n                g: parts[1],\n                b: parts[2],\n                a: parts[3]\n            };\n        }\n    },\n    _hex6ColorToRGBA: function (str) {\n        if (str[0] === '#' && str.length === 7) {\n            return {\n                r: parseInt(str.slice(1, 3), 16),\n                g: parseInt(str.slice(3, 5), 16),\n                b: parseInt(str.slice(5, 7), 16),\n                a: 1\n            };\n        }\n    },\n    _hex3ColorToRGBA: function (str) {\n        if (str[0] === '#' && str.length === 4) {\n            return {\n                r: parseInt(str[1] + str[1], 16),\n                g: parseInt(str[2] + str[2], 16),\n                b: parseInt(str[3] + str[3], 16),\n                a: 1\n            };\n        }\n    },\n    _hslColorToRGBA: function (str) {\n        if (/hsl\\((\\d+),\\s*([\\d.]+)%,\\s*([\\d.]+)%\\)/g.test(str)) {\n            var _a = /hsl\\((\\d+),\\s*([\\d.]+)%,\\s*([\\d.]+)%\\)/g.exec(str), _ = _a[0], hsl = _a.slice(1);\n            var h = Number(hsl[0]) / 360;\n            var s = Number(hsl[1]) / 100;\n            var l = Number(hsl[2]) / 100;\n            var t2 = void 0;\n            var t3 = void 0;\n            var val = void 0;\n            if (s === 0) {\n                val = l * 255;\n                return {\n                    r: Math.round(val),\n                    g: Math.round(val),\n                    b: Math.round(val),\n                    a: 1\n                };\n            }\n            if (l < 0.5) {\n                t2 = l * (1 + s);\n            }\n            else {\n                t2 = l + s - l * s;\n            }\n            var t1 = 2 * l - t2;\n            var rgb = [0, 0, 0];\n            for (var i = 0; i < 3; i++) {\n                t3 = h + (1 / 3) * -(i - 1);\n                if (t3 < 0) {\n                    t3++;\n                }\n                if (t3 > 1) {\n                    t3--;\n                }\n                if (6 * t3 < 1) {\n                    val = t1 + (t2 - t1) * 6 * t3;\n                }\n                else if (2 * t3 < 1) {\n                    val = t2;\n                }\n                else if (3 * t3 < 2) {\n                    val = t1 + (t2 - t1) * (2 / 3 - t3) * 6;\n                }\n                else {\n                    val = t1;\n                }\n                rgb[i] = val * 255;\n            }\n            return {\n                r: Math.round(rgb[0]),\n                g: Math.round(rgb[1]),\n                b: Math.round(rgb[2]),\n                a: 1\n            };\n        }\n    },\n    haveIntersection: function (r1, r2) {\n        return !(r2.x > r1.x + r1.width ||\n            r2.x + r2.width < r1.x ||\n            r2.y > r1.y + r1.height ||\n            r2.y + r2.height < r1.y);\n    },\n    cloneObject: function (obj) {\n        var retObj = {};\n        for (var key in obj) {\n            if (this._isPlainObject(obj[key])) {\n                retObj[key] = this.cloneObject(obj[key]);\n            }\n            else if (this._isArray(obj[key])) {\n                retObj[key] = this.cloneArray(obj[key]);\n            }\n            else {\n                retObj[key] = obj[key];\n            }\n        }\n        return retObj;\n    },\n    cloneArray: function (arr) {\n        return arr.slice(0);\n    },\n    _degToRad: function (deg) {\n        return deg * PI_OVER_DEG180;\n    },\n    _radToDeg: function (rad) {\n        return rad * DEG180_OVER_PI;\n    },\n    _capitalize: function (str) {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n    throw: function (str) {\n        throw new Error(KONVA_ERROR + str);\n    },\n    error: function (str) {\n        console.error(KONVA_ERROR + str);\n    },\n    warn: function (str) {\n        if (!Global_1.Konva.showWarnings) {\n            return;\n        }\n        console.warn(KONVA_WARNING + str);\n    },\n    extend: function (child, parent) {\n        function Ctor() {\n            this.constructor = child;\n        }\n        Ctor.prototype = parent.prototype;\n        var oldProto = child.prototype;\n        child.prototype = new Ctor();\n        for (var key in oldProto) {\n            if (oldProto.hasOwnProperty(key)) {\n                child.prototype[key] = oldProto[key];\n            }\n        }\n        child.__super__ = parent.prototype;\n        child.super = parent;\n    },\n    _getControlPoints: function (x0, y0, x1, y1, x2, y2, t) {\n        var d01 = Math.sqrt(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2)), d12 = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2)), fa = (t * d01) / (d01 + d12), fb = (t * d12) / (d01 + d12), p1x = x1 - fa * (x2 - x0), p1y = y1 - fa * (y2 - y0), p2x = x1 + fb * (x2 - x0), p2y = y1 + fb * (y2 - y0);\n        return [p1x, p1y, p2x, p2y];\n    },\n    _expandPoints: function (p, tension) {\n        var len = p.length, allPoints = [], n, cp;\n        for (n = 2; n < len - 2; n += 2) {\n            cp = exports.Util._getControlPoints(p[n - 2], p[n - 1], p[n], p[n + 1], p[n + 2], p[n + 3], tension);\n            allPoints.push(cp[0]);\n            allPoints.push(cp[1]);\n            allPoints.push(p[n]);\n            allPoints.push(p[n + 1]);\n            allPoints.push(cp[2]);\n            allPoints.push(cp[3]);\n        }\n        return allPoints;\n    },\n    each: function (obj, func) {\n        for (var key in obj) {\n            func(key, obj[key]);\n        }\n    },\n    _inRange: function (val, left, right) {\n        return left <= val && val < right;\n    },\n    _getProjectionToSegment: function (x1, y1, x2, y2, x3, y3) {\n        var x, y, dist;\n        var pd2 = (x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2);\n        if (pd2 == 0) {\n            x = x1;\n            y = y1;\n            dist = (x3 - x2) * (x3 - x2) + (y3 - y2) * (y3 - y2);\n        }\n        else {\n            var u = ((x3 - x1) * (x2 - x1) + (y3 - y1) * (y2 - y1)) / pd2;\n            if (u < 0) {\n                x = x1;\n                y = y1;\n                dist = (x1 - x3) * (x1 - x3) + (y1 - y3) * (y1 - y3);\n            }\n            else if (u > 1.0) {\n                x = x2;\n                y = y2;\n                dist = (x2 - x3) * (x2 - x3) + (y2 - y3) * (y2 - y3);\n            }\n            else {\n                x = x1 + u * (x2 - x1);\n                y = y1 + u * (y2 - y1);\n                dist = (x - x3) * (x - x3) + (y - y3) * (y - y3);\n            }\n        }\n        return [x, y, dist];\n    },\n    _getProjectionToLine: function (pt, line, isClosed) {\n        var pc = exports.Util.cloneObject(pt);\n        var dist = Number.MAX_VALUE;\n        line.forEach(function (p1, i) {\n            if (!isClosed && i === line.length - 1) {\n                return;\n            }\n            var p2 = line[(i + 1) % line.length];\n            var proj = exports.Util._getProjectionToSegment(p1.x, p1.y, p2.x, p2.y, pt.x, pt.y);\n            var px = proj[0], py = proj[1], pdist = proj[2];\n            if (pdist < dist) {\n                pc.x = px;\n                pc.y = py;\n                dist = pdist;\n            }\n        });\n        return pc;\n    },\n    _prepareArrayForTween: function (startArray, endArray, isClosed) {\n        var n, start = [], end = [];\n        if (startArray.length > endArray.length) {\n            var temp = endArray;\n            endArray = startArray;\n            startArray = temp;\n        }\n        for (n = 0; n < startArray.length; n += 2) {\n            start.push({\n                x: startArray[n],\n                y: startArray[n + 1]\n            });\n        }\n        for (n = 0; n < endArray.length; n += 2) {\n            end.push({\n                x: endArray[n],\n                y: endArray[n + 1]\n            });\n        }\n        var newStart = [];\n        end.forEach(function (point) {\n            var pr = exports.Util._getProjectionToLine(point, start, isClosed);\n            newStart.push(pr.x);\n            newStart.push(pr.y);\n        });\n        return newStart;\n    },\n    _prepareToStringify: function (obj) {\n        var desc;\n        obj.visitedByCircularReferenceRemoval = true;\n        for (var key in obj) {\n            if (!(obj.hasOwnProperty(key) && obj[key] && typeof obj[key] == 'object')) {\n                continue;\n            }\n            desc = Object.getOwnPropertyDescriptor(obj, key);\n            if (obj[key].visitedByCircularReferenceRemoval ||\n                exports.Util._isElement(obj[key])) {\n                if (desc.configurable) {\n                    delete obj[key];\n                }\n                else {\n                    return null;\n                }\n            }\n            else if (exports.Util._prepareToStringify(obj[key]) === null) {\n                if (desc.configurable) {\n                    delete obj[key];\n                }\n                else {\n                    return null;\n                }\n            }\n        }\n        delete obj.visitedByCircularReferenceRemoval;\n        return obj;\n    },\n    _assign: function (target, source) {\n        for (var key in source) {\n            target[key] = source[key];\n        }\n        return target;\n    },\n    _getFirstPointerId: function (evt) {\n        if (!evt.touches) {\n            return 999;\n        }\n        else {\n            return evt.changedTouches[0].identifier;\n        }\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Global_1 = require(\"./Global\");\nvar Util_1 = require(\"./Util\");\nfunction _formatValue(val) {\n    if (Util_1.Util._isString(val)) {\n        return '\"' + val + '\"';\n    }\n    if (Object.prototype.toString.call(val) === '[object Number]') {\n        return val;\n    }\n    if (Util_1.Util._isBoolean(val)) {\n        return val;\n    }\n    return Object.prototype.toString.call(val);\n}\nfunction RGBComponent(val) {\n    if (val > 255) {\n        return 255;\n    }\n    else if (val < 0) {\n        return 0;\n    }\n    return Math.round(val);\n}\nexports.RGBComponent = RGBComponent;\nfunction alphaComponent(val) {\n    if (val > 1) {\n        return 1;\n    }\n    else if (val < 0.0001) {\n        return 0.0001;\n    }\n    return val;\n}\nexports.alphaComponent = alphaComponent;\nfunction getNumberValidator() {\n    if (Global_1.Konva.isUnminified) {\n        return function (val, attr) {\n            if (!Util_1.Util._isNumber(val)) {\n                Util_1.Util.warn(_formatValue(val) +\n                    ' is a not valid value for \"' +\n                    attr +\n                    '\" attribute. The value should be a number.');\n            }\n            return val;\n        };\n    }\n}\nexports.getNumberValidator = getNumberValidator;\nfunction getNumberOrAutoValidator() {\n    if (Global_1.Konva.isUnminified) {\n        return function (val, attr) {\n            var isNumber = Util_1.Util._isNumber(val);\n            var isAuto = val === 'auto';\n            if (!(isNumber || isAuto)) {\n                Util_1.Util.warn(_formatValue(val) +\n                    ' is a not valid value for \"' +\n                    attr +\n                    '\" attribute. The value should be a number or \"auto\".');\n            }\n            return val;\n        };\n    }\n}\nexports.getNumberOrAutoValidator = getNumberOrAutoValidator;\nfunction getStringValidator() {\n    if (Global_1.Konva.isUnminified) {\n        return function (val, attr) {\n            if (!Util_1.Util._isString(val)) {\n                Util_1.Util.warn(_formatValue(val) +\n                    ' is a not valid value for \"' +\n                    attr +\n                    '\" attribute. The value should be a string.');\n            }\n            return val;\n        };\n    }\n}\nexports.getStringValidator = getStringValidator;\nfunction getFunctionValidator() {\n    if (Global_1.Konva.isUnminified) {\n        return function (val, attr) {\n            if (!Util_1.Util._isFunction(val)) {\n                Util_1.Util.warn(_formatValue(val) +\n                    ' is a not valid value for \"' +\n                    attr +\n                    '\" attribute. The value should be a function.');\n            }\n            return val;\n        };\n    }\n}\nexports.getFunctionValidator = getFunctionValidator;\nfunction getNumberArrayValidator() {\n    if (Global_1.Konva.isUnminified) {\n        return function (val, attr) {\n            if (!Util_1.Util._isArray(val)) {\n                Util_1.Util.warn(_formatValue(val) +\n                    ' is a not valid value for \"' +\n                    attr +\n                    '\" attribute. The value should be a array of numbers.');\n            }\n            else {\n                val.forEach(function (item) {\n                    if (!Util_1.Util._isNumber(item)) {\n                        Util_1.Util.warn('\"' +\n                            attr +\n                            '\" attribute has non numeric element ' +\n                            item +\n                            '. Make sure that all elements are numbers.');\n                    }\n                });\n            }\n            return val;\n        };\n    }\n}\nexports.getNumberArrayValidator = getNumberArrayValidator;\nfunction getBooleanValidator() {\n    if (Global_1.Konva.isUnminified) {\n        return function (val, attr) {\n            var isBool = val === true || val === false;\n            if (!isBool) {\n                Util_1.Util.warn(_formatValue(val) +\n                    ' is a not valid value for \"' +\n                    attr +\n                    '\" attribute. The value should be a boolean.');\n            }\n            return val;\n        };\n    }\n}\nexports.getBooleanValidator = getBooleanValidator;\nfunction getComponentValidator(components) {\n    if (Global_1.Konva.isUnminified) {\n        return function (val, attr) {\n            if (!Util_1.Util.isObject(val)) {\n                Util_1.Util.warn(_formatValue(val) +\n                    ' is a not valid value for \"' +\n                    attr +\n                    '\" attribute. The value should be an object with properties ' +\n                    components);\n            }\n            return val;\n        };\n    }\n}\nexports.getComponentValidator = getComponentValidator;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Validators_1 = require(\"./Validators\");\nvar GET = 'get', SET = 'set';\nexports.Factory = {\n    addGetterSetter: function (constructor, attr, def, validator, after) {\n        this.addGetter(constructor, attr, def);\n        this.addSetter(constructor, attr, validator, after);\n        this.addOverloadedGetterSetter(constructor, attr);\n    },\n    addGetter: function (constructor, attr, def) {\n        var method = GET + Util_1.Util._capitalize(attr);\n        constructor.prototype[method] =\n            constructor.prototype[method] ||\n                function () {\n                    var val = this.attrs[attr];\n                    return val === undefined ? def : val;\n                };\n    },\n    addSetter: function (constructor, attr, validator, after) {\n        var method = SET + Util_1.Util._capitalize(attr);\n        if (!constructor.prototype[method]) {\n            exports.Factory.overWriteSetter(constructor, attr, validator, after);\n        }\n    },\n    overWriteSetter: function (constructor, attr, validator, after) {\n        var method = SET + Util_1.Util._capitalize(attr);\n        constructor.prototype[method] = function (val) {\n            if (validator && val !== undefined && val !== null) {\n                val = validator.call(this, val, attr);\n            }\n            this._setAttr(attr, val);\n            if (after) {\n                after.call(this);\n            }\n            return this;\n        };\n    },\n    addComponentsGetterSetter: function (constructor, attr, components, validator, after) {\n        var len = components.length, capitalize = Util_1.Util._capitalize, getter = GET + capitalize(attr), setter = SET + capitalize(attr), n, component;\n        constructor.prototype[getter] = function () {\n            var ret = {};\n            for (n = 0; n < len; n++) {\n                component = components[n];\n                ret[component] = this.getAttr(attr + capitalize(component));\n            }\n            return ret;\n        };\n        var basicValidator = Validators_1.getComponentValidator(components);\n        constructor.prototype[setter] = function (val) {\n            var oldVal = this.attrs[attr], key;\n            if (validator) {\n                val = validator.call(this, val);\n            }\n            if (basicValidator) {\n                basicValidator.call(this, val, attr);\n            }\n            for (key in val) {\n                if (!val.hasOwnProperty(key)) {\n                    continue;\n                }\n                this._setAttr(attr + capitalize(key), val[key]);\n            }\n            this._fireChangeEvent(attr, oldVal, val);\n            if (after) {\n                after.call(this);\n            }\n            return this;\n        };\n        this.addOverloadedGetterSetter(constructor, attr);\n    },\n    addOverloadedGetterSetter: function (constructor, attr) {\n        var capitalizedAttr = Util_1.Util._capitalize(attr), setter = SET + capitalizedAttr, getter = GET + capitalizedAttr;\n        constructor.prototype[attr] = function () {\n            if (arguments.length) {\n                this[setter](arguments[0]);\n                return this;\n            }\n            return this[getter]();\n        };\n    },\n    addDeprecatedGetterSetter: function (constructor, attr, def, validator) {\n        Util_1.Util.error('Adding deprecated ' + attr);\n        var method = GET + Util_1.Util._capitalize(attr);\n        var message = attr +\n            ' property is deprecated and will be removed soon. Look at Konva change log for more information.';\n        constructor.prototype[method] = function () {\n            Util_1.Util.error(message);\n            var val = this.attrs[attr];\n            return val === undefined ? def : val;\n        };\n        this.addSetter(constructor, attr, validator, function () {\n            Util_1.Util.error(message);\n        });\n        this.addOverloadedGetterSetter(constructor, attr);\n    },\n    backCompat: function (constructor, methods) {\n        Util_1.Util.each(methods, function (oldMethodName, newMethodName) {\n            var method = constructor.prototype[newMethodName];\n            var oldGetter = GET + Util_1.Util._capitalize(oldMethodName);\n            var oldSetter = SET + Util_1.Util._capitalize(oldMethodName);\n            function deprecated() {\n                method.apply(this, arguments);\n                Util_1.Util.error('\"' +\n                    oldMethodName +\n                    '\" method is deprecated and will be removed soon. Use \"\"' +\n                    newMethodName +\n                    '\" instead.');\n            }\n            constructor.prototype[oldMethodName] = deprecated;\n            constructor.prototype[oldGetter] = deprecated;\n            constructor.prototype[oldSetter] = deprecated;\n        });\n    },\n    afterSetFilter: function () {\n        this._filterUpToDate = false;\n    }\n};\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Global_1 = require(\"./Global\");\nvar COMMA = ',', OPEN_PAREN = '(', CLOSE_PAREN = ')', OPEN_PAREN_BRACKET = '([', CLOSE_BRACKET_PAREN = '])', SEMICOLON = ';', DOUBLE_PAREN = '()', EQUALS = '=', CONTEXT_METHODS = [\n    'arc',\n    'arcTo',\n    'beginPath',\n    'bezierCurveTo',\n    'clearRect',\n    'clip',\n    'closePath',\n    'createLinearGradient',\n    'createPattern',\n    'createRadialGradient',\n    'drawImage',\n    'ellipse',\n    'fill',\n    'fillText',\n    'getImageData',\n    'createImageData',\n    'lineTo',\n    'moveTo',\n    'putImageData',\n    'quadraticCurveTo',\n    'rect',\n    'restore',\n    'rotate',\n    'save',\n    'scale',\n    'setLineDash',\n    'setTransform',\n    'stroke',\n    'strokeText',\n    'transform',\n    'translate'\n];\nvar CONTEXT_PROPERTIES = [\n    'fillStyle',\n    'strokeStyle',\n    'shadowColor',\n    'shadowBlur',\n    'shadowOffsetX',\n    'shadowOffsetY',\n    'lineCap',\n    'lineDashOffset',\n    'lineJoin',\n    'lineWidth',\n    'miterLimit',\n    'font',\n    'textAlign',\n    'textBaseline',\n    'globalAlpha',\n    'globalCompositeOperation',\n    'imageSmoothingEnabled'\n];\nvar traceArrMax = 100;\nvar Context = (function () {\n    function Context(canvas) {\n        this.canvas = canvas;\n        this._context = canvas._canvas.getContext('2d');\n        if (Global_1.Konva.enableTrace) {\n            this.traceArr = [];\n            this._enableTrace();\n        }\n    }\n    Context.prototype.fillShape = function (shape) {\n        if (shape.fillEnabled()) {\n            this._fill(shape);\n        }\n    };\n    Context.prototype._fill = function (shape) {\n    };\n    Context.prototype.strokeShape = function (shape) {\n        if (shape.hasStroke()) {\n            this._stroke(shape);\n        }\n    };\n    Context.prototype._stroke = function (shape) {\n    };\n    Context.prototype.fillStrokeShape = function (shape) {\n        this.fillShape(shape);\n        this.strokeShape(shape);\n    };\n    Context.prototype.getTrace = function (relaxed) {\n        var traceArr = this.traceArr, len = traceArr.length, str = '', n, trace, method, args;\n        for (n = 0; n < len; n++) {\n            trace = traceArr[n];\n            method = trace.method;\n            if (method) {\n                args = trace.args;\n                str += method;\n                if (relaxed) {\n                    str += DOUBLE_PAREN;\n                }\n                else {\n                    if (Util_1.Util._isArray(args[0])) {\n                        str += OPEN_PAREN_BRACKET + args.join(COMMA) + CLOSE_BRACKET_PAREN;\n                    }\n                    else {\n                        str += OPEN_PAREN + args.join(COMMA) + CLOSE_PAREN;\n                    }\n                }\n            }\n            else {\n                str += trace.property;\n                if (!relaxed) {\n                    str += EQUALS + trace.val;\n                }\n            }\n            str += SEMICOLON;\n        }\n        return str;\n    };\n    Context.prototype.clearTrace = function () {\n        this.traceArr = [];\n    };\n    Context.prototype._trace = function (str) {\n        var traceArr = this.traceArr, len;\n        traceArr.push(str);\n        len = traceArr.length;\n        if (len >= traceArrMax) {\n            traceArr.shift();\n        }\n    };\n    Context.prototype.reset = function () {\n        var pixelRatio = this.getCanvas().getPixelRatio();\n        this.setTransform(1 * pixelRatio, 0, 0, 1 * pixelRatio, 0, 0);\n    };\n    Context.prototype.getCanvas = function () {\n        return this.canvas;\n    };\n    Context.prototype.clear = function (bounds) {\n        var canvas = this.getCanvas();\n        if (bounds) {\n            this.clearRect(bounds.x || 0, bounds.y || 0, bounds.width || 0, bounds.height || 0);\n        }\n        else {\n            this.clearRect(0, 0, canvas.getWidth() / canvas.pixelRatio, canvas.getHeight() / canvas.pixelRatio);\n        }\n    };\n    Context.prototype._applyLineCap = function (shape) {\n        var lineCap = shape.getLineCap();\n        if (lineCap) {\n            this.setAttr('lineCap', lineCap);\n        }\n    };\n    Context.prototype._applyOpacity = function (shape) {\n        var absOpacity = shape.getAbsoluteOpacity();\n        if (absOpacity !== 1) {\n            this.setAttr('globalAlpha', absOpacity);\n        }\n    };\n    Context.prototype._applyLineJoin = function (shape) {\n        var lineJoin = shape.getLineJoin();\n        if (lineJoin) {\n            this.setAttr('lineJoin', lineJoin);\n        }\n    };\n    Context.prototype.setAttr = function (attr, val) {\n        this._context[attr] = val;\n    };\n    Context.prototype.arc = function (a0, a1, a2, a3, a4, a5) {\n        this._context.arc(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.arcTo = function (a0, a1, a2, a3, a4) {\n        this._context.arcTo(a0, a1, a2, a3, a4);\n    };\n    Context.prototype.beginPath = function () {\n        this._context.beginPath();\n    };\n    Context.prototype.bezierCurveTo = function (a0, a1, a2, a3, a4, a5) {\n        this._context.bezierCurveTo(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.clearRect = function (a0, a1, a2, a3) {\n        this._context.clearRect(a0, a1, a2, a3);\n    };\n    Context.prototype.clip = function () {\n        this._context.clip();\n    };\n    Context.prototype.closePath = function () {\n        this._context.closePath();\n    };\n    Context.prototype.createImageData = function (a0, a1) {\n        var a = arguments;\n        if (a.length === 2) {\n            return this._context.createImageData(a0, a1);\n        }\n        else if (a.length === 1) {\n            return this._context.createImageData(a0);\n        }\n    };\n    Context.prototype.createLinearGradient = function (a0, a1, a2, a3) {\n        return this._context.createLinearGradient(a0, a1, a2, a3);\n    };\n    Context.prototype.createPattern = function (a0, a1) {\n        return this._context.createPattern(a0, a1);\n    };\n    Context.prototype.createRadialGradient = function (a0, a1, a2, a3, a4, a5) {\n        return this._context.createRadialGradient(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.drawImage = function (a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n        var a = arguments, _context = this._context;\n        if (a.length === 3) {\n            _context.drawImage(a0, a1, a2);\n        }\n        else if (a.length === 5) {\n            _context.drawImage(a0, a1, a2, a3, a4);\n        }\n        else if (a.length === 9) {\n            _context.drawImage(a0, a1, a2, a3, a4, a5, a6, a7, a8);\n        }\n    };\n    Context.prototype.ellipse = function (a0, a1, a2, a3, a4, a5, a6, a7) {\n        this._context.ellipse(a0, a1, a2, a3, a4, a5, a6, a7);\n    };\n    Context.prototype.isPointInPath = function (x, y) {\n        return this._context.isPointInPath(x, y);\n    };\n    Context.prototype.fill = function () {\n        this._context.fill();\n    };\n    Context.prototype.fillRect = function (x, y, width, height) {\n        this._context.fillRect(x, y, width, height);\n    };\n    Context.prototype.strokeRect = function (x, y, width, height) {\n        this._context.strokeRect(x, y, width, height);\n    };\n    Context.prototype.fillText = function (a0, a1, a2) {\n        this._context.fillText(a0, a1, a2);\n    };\n    Context.prototype.measureText = function (text) {\n        return this._context.measureText(text);\n    };\n    Context.prototype.getImageData = function (a0, a1, a2, a3) {\n        return this._context.getImageData(a0, a1, a2, a3);\n    };\n    Context.prototype.lineTo = function (a0, a1) {\n        this._context.lineTo(a0, a1);\n    };\n    Context.prototype.moveTo = function (a0, a1) {\n        this._context.moveTo(a0, a1);\n    };\n    Context.prototype.rect = function (a0, a1, a2, a3) {\n        this._context.rect(a0, a1, a2, a3);\n    };\n    Context.prototype.putImageData = function (a0, a1, a2) {\n        this._context.putImageData(a0, a1, a2);\n    };\n    Context.prototype.quadraticCurveTo = function (a0, a1, a2, a3) {\n        this._context.quadraticCurveTo(a0, a1, a2, a3);\n    };\n    Context.prototype.restore = function () {\n        this._context.restore();\n    };\n    Context.prototype.rotate = function (a0) {\n        this._context.rotate(a0);\n    };\n    Context.prototype.save = function () {\n        this._context.save();\n    };\n    Context.prototype.scale = function (a0, a1) {\n        this._context.scale(a0, a1);\n    };\n    Context.prototype.setLineDash = function (a0) {\n        if (this._context.setLineDash) {\n            this._context.setLineDash(a0);\n        }\n        else if ('mozDash' in this._context) {\n            this._context['mozDash'] = a0;\n        }\n        else if ('webkitLineDash' in this._context) {\n            this._context['webkitLineDash'] = a0;\n        }\n    };\n    Context.prototype.getLineDash = function () {\n        return this._context.getLineDash();\n    };\n    Context.prototype.setTransform = function (a0, a1, a2, a3, a4, a5) {\n        this._context.setTransform(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.stroke = function () {\n        this._context.stroke();\n    };\n    Context.prototype.strokeText = function (a0, a1, a2, a3) {\n        this._context.strokeText(a0, a1, a2, a3);\n    };\n    Context.prototype.transform = function (a0, a1, a2, a3, a4, a5) {\n        this._context.transform(a0, a1, a2, a3, a4, a5);\n    };\n    Context.prototype.translate = function (a0, a1) {\n        this._context.translate(a0, a1);\n    };\n    Context.prototype._enableTrace = function () {\n        var that = this, len = CONTEXT_METHODS.length, _simplifyArray = Util_1.Util._simplifyArray, origSetter = this.setAttr, n, args;\n        var func = function (methodName) {\n            var origMethod = that[methodName], ret;\n            that[methodName] = function () {\n                args = _simplifyArray(Array.prototype.slice.call(arguments, 0));\n                ret = origMethod.apply(that, arguments);\n                that._trace({\n                    method: methodName,\n                    args: args\n                });\n                return ret;\n            };\n        };\n        for (n = 0; n < len; n++) {\n            func(CONTEXT_METHODS[n]);\n        }\n        that.setAttr = function () {\n            origSetter.apply(that, arguments);\n            var prop = arguments[0];\n            var val = arguments[1];\n            if (prop === 'shadowOffsetX' ||\n                prop === 'shadowOffsetY' ||\n                prop === 'shadowBlur') {\n                val = val / this.canvas.getPixelRatio();\n            }\n            that._trace({\n                property: prop,\n                val: val\n            });\n        };\n    };\n    Context.prototype._applyGlobalCompositeOperation = function (node) {\n        var globalCompositeOperation = node.getGlobalCompositeOperation();\n        if (globalCompositeOperation !== 'source-over') {\n            this.setAttr('globalCompositeOperation', globalCompositeOperation);\n        }\n    };\n    return Context;\n}());\nexports.Context = Context;\nCONTEXT_PROPERTIES.forEach(function (prop) {\n    Object.defineProperty(Context.prototype, prop, {\n        get: function () {\n            return this._context[prop];\n        },\n        set: function (val) {\n            this._context[prop] = val;\n        }\n    });\n});\nvar SceneContext = (function (_super) {\n    __extends(SceneContext, _super);\n    function SceneContext() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    SceneContext.prototype._fillColor = function (shape) {\n        var fill = shape.fill();\n        this.setAttr('fillStyle', fill);\n        shape._fillFunc(this);\n    };\n    SceneContext.prototype._fillPattern = function (shape) {\n        var fillPatternX = shape.getFillPatternX(), fillPatternY = shape.getFillPatternY(), fillPatternRotation = Global_1.Konva.getAngle(shape.getFillPatternRotation()), fillPatternOffsetX = shape.getFillPatternOffsetX(), fillPatternOffsetY = shape.getFillPatternOffsetY(), fillPatternScaleX = shape.getFillPatternScaleX(), fillPatternScaleY = shape.getFillPatternScaleY();\n        if (fillPatternX || fillPatternY) {\n            this.translate(fillPatternX || 0, fillPatternY || 0);\n        }\n        if (fillPatternRotation) {\n            this.rotate(fillPatternRotation);\n        }\n        if (fillPatternScaleX || fillPatternScaleY) {\n            this.scale(fillPatternScaleX, fillPatternScaleY);\n        }\n        if (fillPatternOffsetX || fillPatternOffsetY) {\n            this.translate(-1 * fillPatternOffsetX, -1 * fillPatternOffsetY);\n        }\n        this.setAttr('fillStyle', shape._getFillPattern());\n        shape._fillFunc(this);\n    };\n    SceneContext.prototype._fillLinearGradient = function (shape) {\n        var grd = shape._getLinearGradient();\n        if (grd) {\n            this.setAttr('fillStyle', grd);\n            shape._fillFunc(this);\n        }\n    };\n    SceneContext.prototype._fillRadialGradient = function (shape) {\n        var grd = shape._getRadialGradient();\n        if (grd) {\n            this.setAttr('fillStyle', grd);\n            shape._fillFunc(this);\n        }\n    };\n    SceneContext.prototype._fill = function (shape) {\n        var hasColor = shape.fill(), fillPriority = shape.getFillPriority();\n        if (hasColor && fillPriority === 'color') {\n            this._fillColor(shape);\n            return;\n        }\n        var hasPattern = shape.getFillPatternImage();\n        if (hasPattern && fillPriority === 'pattern') {\n            this._fillPattern(shape);\n            return;\n        }\n        var hasLinearGradient = shape.getFillLinearGradientColorStops();\n        if (hasLinearGradient && fillPriority === 'linear-gradient') {\n            this._fillLinearGradient(shape);\n            return;\n        }\n        var hasRadialGradient = shape.getFillRadialGradientColorStops();\n        if (hasRadialGradient && fillPriority === 'radial-gradient') {\n            this._fillRadialGradient(shape);\n            return;\n        }\n        if (hasColor) {\n            this._fillColor(shape);\n        }\n        else if (hasPattern) {\n            this._fillPattern(shape);\n        }\n        else if (hasLinearGradient) {\n            this._fillLinearGradient(shape);\n        }\n        else if (hasRadialGradient) {\n            this._fillRadialGradient(shape);\n        }\n    };\n    SceneContext.prototype._strokeLinearGradient = function (shape) {\n        var start = shape.getStrokeLinearGradientStartPoint(), end = shape.getStrokeLinearGradientEndPoint(), colorStops = shape.getStrokeLinearGradientColorStops(), grd = this.createLinearGradient(start.x, start.y, end.x, end.y);\n        if (colorStops) {\n            for (var n = 0; n < colorStops.length; n += 2) {\n                grd.addColorStop(colorStops[n], colorStops[n + 1]);\n            }\n            this.setAttr('strokeStyle', grd);\n        }\n    };\n    SceneContext.prototype._stroke = function (shape) {\n        var dash = shape.dash(), strokeScaleEnabled = shape.getStrokeScaleEnabled();\n        if (shape.hasStroke()) {\n            if (!strokeScaleEnabled) {\n                this.save();\n                var pixelRatio = this.getCanvas().getPixelRatio();\n                this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n            }\n            this._applyLineCap(shape);\n            if (dash && shape.dashEnabled()) {\n                this.setLineDash(dash);\n                this.setAttr('lineDashOffset', shape.dashOffset());\n            }\n            this.setAttr('lineWidth', shape.strokeWidth());\n            if (!shape.getShadowForStrokeEnabled()) {\n                this.setAttr('shadowColor', 'rgba(0,0,0,0)');\n            }\n            var hasLinearGradient = shape.getStrokeLinearGradientColorStops();\n            if (hasLinearGradient) {\n                this._strokeLinearGradient(shape);\n            }\n            else {\n                this.setAttr('strokeStyle', shape.stroke());\n            }\n            shape._strokeFunc(this);\n            if (!strokeScaleEnabled) {\n                this.restore();\n            }\n        }\n    };\n    SceneContext.prototype._applyShadow = function (shape) {\n        var util = Util_1.Util, color = util.get(shape.getShadowRGBA(), 'black'), blur = util.get(shape.getShadowBlur(), 5), offset = util.get(shape.getShadowOffset(), {\n            x: 0,\n            y: 0\n        }), scale = shape.getAbsoluteScale(), ratio = this.canvas.getPixelRatio(), scaleX = scale.x * ratio, scaleY = scale.y * ratio;\n        this.setAttr('shadowColor', color);\n        this.setAttr('shadowBlur', blur * Math.min(Math.abs(scaleX), Math.abs(scaleY)));\n        this.setAttr('shadowOffsetX', offset.x * scaleX);\n        this.setAttr('shadowOffsetY', offset.y * scaleY);\n    };\n    return SceneContext;\n}(Context));\nexports.SceneContext = SceneContext;\nvar HitContext = (function (_super) {\n    __extends(HitContext, _super);\n    function HitContext() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    HitContext.prototype._fill = function (shape) {\n        this.save();\n        this.setAttr('fillStyle', shape.colorKey);\n        shape._fillFuncHit(this);\n        this.restore();\n    };\n    HitContext.prototype.strokeShape = function (shape) {\n        if (shape.hasHitStroke()) {\n            this._stroke(shape);\n        }\n    };\n    HitContext.prototype._stroke = function (shape) {\n        if (shape.hasHitStroke()) {\n            var strokeScaleEnabled = shape.getStrokeScaleEnabled();\n            if (!strokeScaleEnabled) {\n                this.save();\n                var pixelRatio = this.getCanvas().getPixelRatio();\n                this.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n            }\n            this._applyLineCap(shape);\n            var hitStrokeWidth = shape.hitStrokeWidth();\n            var strokeWidth = hitStrokeWidth === 'auto' ? shape.strokeWidth() : hitStrokeWidth;\n            this.setAttr('lineWidth', strokeWidth);\n            this.setAttr('strokeStyle', shape.colorKey);\n            shape._strokeFuncHit(this);\n            if (!strokeScaleEnabled) {\n                this.restore();\n            }\n        }\n    };\n    return HitContext;\n}(Context));\nexports.HitContext = HitContext;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Context_1 = require(\"./Context\");\nvar Global_1 = require(\"./Global\");\nvar Factory_1 = require(\"./Factory\");\nvar Validators_1 = require(\"./Validators\");\nvar _pixelRatio;\nfunction getDevicePixelRatio() {\n    if (_pixelRatio) {\n        return _pixelRatio;\n    }\n    var canvas = Util_1.Util.createCanvasElement();\n    var context = canvas.getContext('2d');\n    _pixelRatio = (function () {\n        var devicePixelRatio = Global_1.Konva._global.devicePixelRatio || 1, backingStoreRatio = context.webkitBackingStorePixelRatio ||\n            context.mozBackingStorePixelRatio ||\n            context.msBackingStorePixelRatio ||\n            context.oBackingStorePixelRatio ||\n            context.backingStorePixelRatio ||\n            1;\n        return devicePixelRatio / backingStoreRatio;\n    })();\n    return _pixelRatio;\n}\nvar Canvas = (function () {\n    function Canvas(config) {\n        this.pixelRatio = 1;\n        this.width = 0;\n        this.height = 0;\n        this.isCache = false;\n        var conf = config || {};\n        var pixelRatio = conf.pixelRatio || Global_1.Konva.pixelRatio || getDevicePixelRatio();\n        this.pixelRatio = pixelRatio;\n        this._canvas = Util_1.Util.createCanvasElement();\n        this._canvas.style.padding = '0';\n        this._canvas.style.margin = '0';\n        this._canvas.style.border = '0';\n        this._canvas.style.background = 'transparent';\n        this._canvas.style.position = 'absolute';\n        this._canvas.style.top = '0';\n        this._canvas.style.left = '0';\n    }\n    Canvas.prototype.getContext = function () {\n        return this.context;\n    };\n    Canvas.prototype.getPixelRatio = function () {\n        return this.pixelRatio;\n    };\n    Canvas.prototype.setPixelRatio = function (pixelRatio) {\n        var previousRatio = this.pixelRatio;\n        this.pixelRatio = pixelRatio;\n        this.setSize(this.getWidth() / previousRatio, this.getHeight() / previousRatio);\n    };\n    Canvas.prototype.setWidth = function (width) {\n        this.width = this._canvas.width = width * this.pixelRatio;\n        this._canvas.style.width = width + 'px';\n        var pixelRatio = this.pixelRatio, _context = this.getContext()._context;\n        _context.scale(pixelRatio, pixelRatio);\n    };\n    Canvas.prototype.setHeight = function (height) {\n        this.height = this._canvas.height = height * this.pixelRatio;\n        this._canvas.style.height = height + 'px';\n        var pixelRatio = this.pixelRatio, _context = this.getContext()._context;\n        _context.scale(pixelRatio, pixelRatio);\n    };\n    Canvas.prototype.getWidth = function () {\n        return this.width;\n    };\n    Canvas.prototype.getHeight = function () {\n        return this.height;\n    };\n    Canvas.prototype.setSize = function (width, height) {\n        this.setWidth(width || 0);\n        this.setHeight(height || 0);\n    };\n    Canvas.prototype.toDataURL = function (mimeType, quality) {\n        try {\n            return this._canvas.toDataURL(mimeType, quality);\n        }\n        catch (e) {\n            try {\n                return this._canvas.toDataURL();\n            }\n            catch (err) {\n                Util_1.Util.error('Unable to get data URL. ' +\n                    err.message +\n                    ' For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n                return '';\n            }\n        }\n    };\n    return Canvas;\n}());\nexports.Canvas = Canvas;\nFactory_1.Factory.addGetterSetter(Canvas, 'pixelRatio', undefined, Validators_1.getNumberValidator());\nvar SceneCanvas = (function (_super) {\n    __extends(SceneCanvas, _super);\n    function SceneCanvas(config) {\n        if (config === void 0) { config = { width: 0, height: 0 }; }\n        var _this = _super.call(this, config) || this;\n        _this.context = new Context_1.SceneContext(_this);\n        _this.setSize(config.width, config.height);\n        return _this;\n    }\n    return SceneCanvas;\n}(Canvas));\nexports.SceneCanvas = SceneCanvas;\nvar HitCanvas = (function (_super) {\n    __extends(HitCanvas, _super);\n    function HitCanvas(config) {\n        if (config === void 0) { config = { width: 0, height: 0 }; }\n        var _this = _super.call(this, config) || this;\n        _this.hitCanvas = true;\n        _this.context = new Context_1.HitContext(_this);\n        _this.setSize(config.width, config.height);\n        return _this;\n    }\n    return HitCanvas;\n}(Canvas));\nexports.HitCanvas = HitCanvas;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Global_1 = require(\"./Global\");\nvar Util_1 = require(\"./Util\");\nexports.DD = {\n    get isDragging() {\n        var flag = false;\n        exports.DD._dragElements.forEach(function (elem) {\n            if (elem.dragStatus === 'dragging') {\n                flag = true;\n            }\n        });\n        return flag;\n    },\n    justDragged: false,\n    get node() {\n        var node;\n        exports.DD._dragElements.forEach(function (elem) {\n            node = elem.node;\n        });\n        return node;\n    },\n    _dragElements: new Map(),\n    _drag: function (evt) {\n        exports.DD._dragElements.forEach(function (elem, key) {\n            var node = elem.node;\n            var stage = node.getStage();\n            stage.setPointersPositions(evt);\n            if (elem.pointerId === undefined) {\n                elem.pointerId = Util_1.Util._getFirstPointerId(evt);\n            }\n            var pos = stage._changedPointerPositions.find(function (pos) { return pos.id === elem.pointerId; });\n            if (!pos) {\n                return;\n            }\n            if (elem.dragStatus !== 'dragging') {\n                var dragDistance = node.dragDistance();\n                var distance = Math.max(Math.abs(pos.x - elem.startPointerPos.x), Math.abs(pos.y - elem.startPointerPos.y));\n                if (distance < dragDistance) {\n                    return;\n                }\n                node.startDrag({ evt: evt });\n                if (!node.isDragging()) {\n                    return;\n                }\n            }\n            node._setDragPosition(evt, elem);\n            node.fire('dragmove', {\n                type: 'dragmove',\n                target: node,\n                evt: evt\n            }, true);\n        });\n    },\n    _endDragBefore: function (evt) {\n        exports.DD._dragElements.forEach(function (elem, key) {\n            var node = elem.node;\n            var stage = node.getStage();\n            if (evt) {\n                stage.setPointersPositions(evt);\n            }\n            var pos = stage._changedPointerPositions.find(function (pos) { return pos.id === elem.pointerId; });\n            if (!pos) {\n                return;\n            }\n            if (elem.dragStatus === 'dragging' || elem.dragStatus === 'stopped') {\n                exports.DD.justDragged = true;\n                Global_1.Konva.listenClickTap = false;\n                elem.dragStatus = 'stopped';\n            }\n            var drawNode = elem.node.getLayer() ||\n                (elem.node instanceof Global_1.Konva['Stage'] && elem.node);\n            if (drawNode) {\n                drawNode.draw();\n            }\n        });\n    },\n    _endDragAfter: function (evt) {\n        exports.DD._dragElements.forEach(function (elem, key) {\n            if (elem.dragStatus === 'stopped') {\n                elem.node.fire('dragend', {\n                    type: 'dragend',\n                    target: elem.node,\n                    evt: evt\n                }, true);\n            }\n            if (elem.dragStatus !== 'dragging') {\n                exports.DD._dragElements.delete(key);\n            }\n        });\n    }\n};\nif (Global_1.Konva.isBrowser) {\n    window.addEventListener('mouseup', exports.DD._endDragBefore, true);\n    window.addEventListener('touchend', exports.DD._endDragBefore, true);\n    window.addEventListener('mousemove', exports.DD._drag);\n    window.addEventListener('touchmove', exports.DD._drag);\n    window.addEventListener('mouseup', exports.DD._endDragAfter, false);\n    window.addEventListener('touchend', exports.DD._endDragAfter, false);\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Canvas_1 = require(\"./Canvas\");\nvar Global_1 = require(\"./Global\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Validators_1 = require(\"./Validators\");\nexports.ids = {};\nexports.names = {};\nvar _addId = function (node, id) {\n    if (!id) {\n        return;\n    }\n    exports.ids[id] = node;\n};\nexports._removeId = function (id, node) {\n    if (!id) {\n        return;\n    }\n    if (exports.ids[id] !== node) {\n        return;\n    }\n    delete exports.ids[id];\n};\nexports._addName = function (node, name) {\n    if (name) {\n        if (!exports.names[name]) {\n            exports.names[name] = [];\n        }\n        exports.names[name].push(node);\n    }\n};\nexports._removeName = function (name, _id) {\n    if (!name) {\n        return;\n    }\n    var nodes = exports.names[name];\n    if (!nodes) {\n        return;\n    }\n    for (var n = 0; n < nodes.length; n++) {\n        var no = nodes[n];\n        if (no._id === _id) {\n            nodes.splice(n, 1);\n        }\n    }\n    if (nodes.length === 0) {\n        delete exports.names[name];\n    }\n};\nvar ABSOLUTE_OPACITY = 'absoluteOpacity', ABSOLUTE_TRANSFORM = 'absoluteTransform', ABSOLUTE_SCALE = 'absoluteScale', CANVAS = 'canvas', CHANGE = 'Change', CHILDREN = 'children', KONVA = 'konva', LISTENING = 'listening', MOUSEENTER = 'mouseenter', MOUSELEAVE = 'mouseleave', NAME = 'name', SET = 'set', SHAPE = 'Shape', SPACE = ' ', STAGE = 'stage', TRANSFORM = 'transform', UPPER_STAGE = 'Stage', VISIBLE = 'visible', CLONE_BLACK_LIST = ['id'], TRANSFORM_CHANGE_STR = [\n    'xChange.konva',\n    'yChange.konva',\n    'scaleXChange.konva',\n    'scaleYChange.konva',\n    'skewXChange.konva',\n    'skewYChange.konva',\n    'rotationChange.konva',\n    'offsetXChange.konva',\n    'offsetYChange.konva',\n    'transformsEnabledChange.konva'\n].join(SPACE), SCALE_CHANGE_STR = ['scaleXChange.konva', 'scaleYChange.konva'].join(SPACE);\nvar emptyChildren = new Util_1.Collection();\nvar idCounter = 1;\nvar Node = (function () {\n    function Node(config) {\n        var _this = this;\n        this._id = idCounter++;\n        this.eventListeners = {};\n        this.attrs = {};\n        this.index = 0;\n        this.parent = null;\n        this._cache = new Map();\n        this._lastPos = null;\n        this._filterUpToDate = false;\n        this._isUnderCache = false;\n        this.children = emptyChildren;\n        this._dragEventId = null;\n        this.setAttrs(config);\n        this.on(TRANSFORM_CHANGE_STR, function () {\n            _this._clearCache(TRANSFORM);\n            _this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        });\n        this.on(SCALE_CHANGE_STR, function () {\n            _this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        });\n        this.on('visibleChange.konva', function () {\n            _this._clearSelfAndDescendantCache(VISIBLE);\n        });\n        this.on('listeningChange.konva', function () {\n            _this._clearSelfAndDescendantCache(LISTENING);\n        });\n        this.on('opacityChange.konva', function () {\n            _this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        });\n    }\n    Node.prototype.hasChildren = function () {\n        return false;\n    };\n    Node.prototype.getChildren = function () {\n        return emptyChildren;\n    };\n    Node.prototype._clearCache = function (attr) {\n        if (attr) {\n            this._cache.delete(attr);\n        }\n        else {\n            this._cache.clear();\n        }\n    };\n    Node.prototype._getCache = function (attr, privateGetter) {\n        var cache = this._cache.get(attr);\n        if (cache === undefined) {\n            cache = privateGetter.call(this);\n            this._cache.set(attr, cache);\n        }\n        return cache;\n    };\n    Node.prototype._getCanvasCache = function () {\n        return this._cache.get(CANVAS);\n    };\n    Node.prototype._clearSelfAndDescendantCache = function (attr) {\n        this._clearCache(attr);\n        if (this.isCached()) {\n            return;\n        }\n        if (this.children) {\n            this.children.each(function (node) {\n                node._clearSelfAndDescendantCache(attr);\n            });\n        }\n    };\n    Node.prototype.clearCache = function () {\n        this._cache.delete(CANVAS);\n        this._clearSelfAndDescendantCache();\n        return this;\n    };\n    Node.prototype.cache = function (config) {\n        var conf = config || {};\n        var rect = {};\n        if (conf.x === undefined ||\n            conf.y === undefined ||\n            conf.width === undefined ||\n            conf.height === undefined) {\n            rect = this.getClientRect({\n                skipTransform: true,\n                relativeTo: this.getParent()\n            });\n        }\n        var width = Math.ceil(conf.width || rect.width), height = Math.ceil(conf.height || rect.height), pixelRatio = conf.pixelRatio, x = conf.x === undefined ? rect.x : conf.x, y = conf.y === undefined ? rect.y : conf.y, offset = conf.offset || 0, drawBorder = conf.drawBorder || false;\n        if (!width || !height) {\n            Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n            return;\n        }\n        width += offset * 2;\n        height += offset * 2;\n        x -= offset;\n        y -= offset;\n        var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: width,\n            height: height\n        }), cachedFilterCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: width,\n            height: height\n        }), cachedHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1,\n            width: width,\n            height: height\n        }), sceneContext = cachedSceneCanvas.getContext(), hitContext = cachedHitCanvas.getContext();\n        cachedHitCanvas.isCache = true;\n        this._cache.delete('canvas');\n        this._filterUpToDate = false;\n        if (conf.imageSmoothingEnabled === false) {\n            cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n            cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n            cachedHitCanvas.getContext()._context.imageSmoothingEnabled = false;\n        }\n        sceneContext.save();\n        hitContext.save();\n        sceneContext.translate(-x, -y);\n        hitContext.translate(-x, -y);\n        this._isUnderCache = true;\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this.drawScene(cachedSceneCanvas, this, true);\n        this.drawHit(cachedHitCanvas, this, true);\n        this._isUnderCache = false;\n        sceneContext.restore();\n        hitContext.restore();\n        if (drawBorder) {\n            sceneContext.save();\n            sceneContext.beginPath();\n            sceneContext.rect(0, 0, width, height);\n            sceneContext.closePath();\n            sceneContext.setAttr('strokeStyle', 'red');\n            sceneContext.setAttr('lineWidth', 5);\n            sceneContext.stroke();\n            sceneContext.restore();\n        }\n        this._cache.set(CANVAS, {\n            scene: cachedSceneCanvas,\n            filter: cachedFilterCanvas,\n            hit: cachedHitCanvas,\n            x: x,\n            y: y\n        });\n        return this;\n    };\n    Node.prototype.isCached = function () {\n        return this._cache.has('canvas');\n    };\n    Node.prototype.getClientRect = function (config) {\n        throw new Error('abstract \"getClientRect\" method call');\n    };\n    Node.prototype._transformedRect = function (rect, top) {\n        var points = [\n            { x: rect.x, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y + rect.height },\n            { x: rect.x, y: rect.y + rect.height }\n        ];\n        var minX, minY, maxX, maxY;\n        var trans = this.getAbsoluteTransform(top);\n        points.forEach(function (point) {\n            var transformed = trans.point(point);\n            if (minX === undefined) {\n                minX = maxX = transformed.x;\n                minY = maxY = transformed.y;\n            }\n            minX = Math.min(minX, transformed.x);\n            minY = Math.min(minY, transformed.y);\n            maxX = Math.max(maxX, transformed.x);\n            maxY = Math.max(maxY, transformed.y);\n        });\n        return {\n            x: minX,\n            y: minY,\n            width: maxX - minX,\n            height: maxY - minY\n        };\n    };\n    Node.prototype._drawCachedSceneCanvas = function (context) {\n        context.save();\n        context._applyOpacity(this);\n        context._applyGlobalCompositeOperation(this);\n        var canvasCache = this._getCanvasCache();\n        context.translate(canvasCache.x, canvasCache.y);\n        var cacheCanvas = this._getCachedSceneCanvas();\n        var ratio = cacheCanvas.pixelRatio;\n        context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n        context.restore();\n    };\n    Node.prototype._drawCachedHitCanvas = function (context) {\n        var canvasCache = this._getCanvasCache(), hitCanvas = canvasCache.hit;\n        context.save();\n        context.translate(canvasCache.x, canvasCache.y);\n        context.drawImage(hitCanvas._canvas, 0, 0);\n        context.restore();\n    };\n    Node.prototype._getCachedSceneCanvas = function () {\n        var filters = this.filters(), cachedCanvas = this._getCanvasCache(), sceneCanvas = cachedCanvas.scene, filterCanvas = cachedCanvas.filter, filterContext = filterCanvas.getContext(), len, imageData, n, filter;\n        if (filters) {\n            if (!this._filterUpToDate) {\n                var ratio = sceneCanvas.pixelRatio;\n                try {\n                    len = filters.length;\n                    filterContext.clear();\n                    filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n                    imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n                    for (n = 0; n < len; n++) {\n                        filter = filters[n];\n                        if (typeof filter !== 'function') {\n                            Util_1.Util.error('Filter should be type of function, but got ' +\n                                typeof filter +\n                                ' instead. Please check correct filters');\n                            continue;\n                        }\n                        filter.call(this, imageData);\n                        filterContext.putImageData(imageData, 0, 0);\n                    }\n                }\n                catch (e) {\n                    Util_1.Util.error('Unable to apply filter. ' +\n                        e.message +\n                        ' This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n                }\n                this._filterUpToDate = true;\n            }\n            return filterCanvas;\n        }\n        return sceneCanvas;\n    };\n    Node.prototype.on = function (evtStr, handler) {\n        if (arguments.length === 3) {\n            return this._delegate.apply(this, arguments);\n        }\n        var events = evtStr.split(SPACE), len = events.length, n, event, parts, baseEvent, name;\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1] || '';\n            if (!this.eventListeners[baseEvent]) {\n                this.eventListeners[baseEvent] = [];\n            }\n            this.eventListeners[baseEvent].push({\n                name: name,\n                handler: handler\n            });\n        }\n        return this;\n    };\n    Node.prototype.off = function (evtStr, callback) {\n        var events = (evtStr || '').split(SPACE), len = events.length, n, t, event, parts, baseEvent, name;\n        if (!evtStr) {\n            for (t in this.eventListeners) {\n                this._off(t);\n            }\n        }\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1];\n            if (baseEvent) {\n                if (this.eventListeners[baseEvent]) {\n                    this._off(baseEvent, name, callback);\n                }\n            }\n            else {\n                for (t in this.eventListeners) {\n                    this._off(t, name, callback);\n                }\n            }\n        }\n        return this;\n    };\n    Node.prototype.dispatchEvent = function (evt) {\n        var e = {\n            target: this,\n            type: evt.type,\n            evt: evt\n        };\n        this.fire(evt.type, e);\n        return this;\n    };\n    Node.prototype.addEventListener = function (type, handler) {\n        this.on(type, function (evt) {\n            handler.call(this, evt.evt);\n        });\n        return this;\n    };\n    Node.prototype.removeEventListener = function (type) {\n        this.off(type);\n        return this;\n    };\n    Node.prototype._delegate = function (event, selector, handler) {\n        var stopNode = this;\n        this.on(event, function (evt) {\n            var targets = evt.target.findAncestors(selector, true, stopNode);\n            for (var i = 0; i < targets.length; i++) {\n                evt = Util_1.Util.cloneObject(evt);\n                evt.currentTarget = targets[i];\n                handler.call(targets[i], evt);\n            }\n        });\n    };\n    Node.prototype.remove = function () {\n        if (this.isDragging()) {\n            this.stopDrag();\n        }\n        DragAndDrop_1.DD._dragElements.delete(this._id);\n        this._remove();\n        return this;\n    };\n    Node.prototype._clearCaches = function () {\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this._clearSelfAndDescendantCache(STAGE);\n        this._clearSelfAndDescendantCache(VISIBLE);\n        this._clearSelfAndDescendantCache(LISTENING);\n    };\n    Node.prototype._remove = function () {\n        this._clearCaches();\n        var parent = this.getParent();\n        if (parent && parent.children) {\n            parent.children.splice(this.index, 1);\n            parent._setChildrenIndices();\n            this.parent = null;\n        }\n    };\n    Node.prototype.destroy = function () {\n        exports._removeId(this.id(), this);\n        var names = (this.name() || '').split(/\\s/g);\n        for (var i = 0; i < names.length; i++) {\n            var subname = names[i];\n            exports._removeName(subname, this._id);\n        }\n        this.remove();\n        return this;\n    };\n    Node.prototype.getAttr = function (attr) {\n        var method = 'get' + Util_1.Util._capitalize(attr);\n        if (Util_1.Util._isFunction(this[method])) {\n            return this[method]();\n        }\n        return this.attrs[attr];\n    };\n    Node.prototype.getAncestors = function () {\n        var parent = this.getParent(), ancestors = new Util_1.Collection();\n        while (parent) {\n            ancestors.push(parent);\n            parent = parent.getParent();\n        }\n        return ancestors;\n    };\n    Node.prototype.getAttrs = function () {\n        return this.attrs || {};\n    };\n    Node.prototype.setAttrs = function (config) {\n        var key, method;\n        if (!config) {\n            return this;\n        }\n        for (key in config) {\n            if (key === CHILDREN) {\n                continue;\n            }\n            method = SET + Util_1.Util._capitalize(key);\n            if (Util_1.Util._isFunction(this[method])) {\n                this[method](config[key]);\n            }\n            else {\n                this._setAttr(key, config[key]);\n            }\n        }\n        return this;\n    };\n    Node.prototype.isListening = function () {\n        return this._getCache(LISTENING, this._isListening);\n    };\n    Node.prototype._isListening = function () {\n        var listening = this.listening(), parent = this.getParent();\n        if (listening === 'inherit') {\n            if (parent) {\n                return parent.isListening();\n            }\n            else {\n                return true;\n            }\n        }\n        else {\n            return listening;\n        }\n    };\n    Node.prototype.isVisible = function () {\n        return this._getCache(VISIBLE, this._isVisible);\n    };\n    Node.prototype._isVisible = function (relativeTo) {\n        var visible = this.visible(), parent = this.getParent();\n        if (visible === 'inherit') {\n            if (parent && parent !== relativeTo) {\n                return parent._isVisible(relativeTo);\n            }\n            else {\n                return true;\n            }\n        }\n        else if (relativeTo && relativeTo !== parent) {\n            return visible && parent._isVisible(relativeTo);\n        }\n        else {\n            return visible;\n        }\n    };\n    Node.prototype.shouldDrawHit = function () {\n        var layer = this.getLayer();\n        return ((!layer && this.isListening() && this.isVisible()) ||\n            (layer &&\n                layer.hitGraphEnabled() &&\n                this.isListening() &&\n                this.isVisible()));\n    };\n    Node.prototype.show = function () {\n        this.visible(true);\n        return this;\n    };\n    Node.prototype.hide = function () {\n        this.visible(false);\n        return this;\n    };\n    Node.prototype.getZIndex = function () {\n        return this.index || 0;\n    };\n    Node.prototype.getAbsoluteZIndex = function () {\n        var depth = this.getDepth(), that = this, index = 0, nodes, len, n, child;\n        function addChildren(children) {\n            nodes = [];\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                child = children[n];\n                index++;\n                if (child.nodeType !== SHAPE) {\n                    nodes = nodes.concat(child.getChildren().toArray());\n                }\n                if (child._id === that._id) {\n                    n = len;\n                }\n            }\n            if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n                addChildren(nodes);\n            }\n        }\n        if (that.nodeType !== UPPER_STAGE) {\n            addChildren(that.getStage().getChildren());\n        }\n        return index;\n    };\n    Node.prototype.getDepth = function () {\n        var depth = 0, parent = this.parent;\n        while (parent) {\n            depth++;\n            parent = parent.parent;\n        }\n        return depth;\n    };\n    Node.prototype.setPosition = function (pos) {\n        this.x(pos.x);\n        this.y(pos.y);\n        return this;\n    };\n    Node.prototype.getPosition = function () {\n        return {\n            x: this.x(),\n            y: this.y()\n        };\n    };\n    Node.prototype.getAbsolutePosition = function (top) {\n        var haveCachedParent = false;\n        var parent = this.parent;\n        while (parent) {\n            if (parent.isCached()) {\n                haveCachedParent = true;\n                break;\n            }\n            parent = parent.parent;\n        }\n        if (haveCachedParent && !top) {\n            top = true;\n        }\n        var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(), absoluteTransform = new Util_1.Transform(), offset = this.offset();\n        absoluteTransform.m = absoluteMatrix.slice();\n        absoluteTransform.translate(offset.x, offset.y);\n        return absoluteTransform.getTranslation();\n    };\n    Node.prototype.setAbsolutePosition = function (pos) {\n        var origTrans = this._clearTransform(), it;\n        this.attrs.x = origTrans.x;\n        this.attrs.y = origTrans.y;\n        delete origTrans.x;\n        delete origTrans.y;\n        it = this.getAbsoluteTransform();\n        it.invert();\n        it.translate(pos.x, pos.y);\n        pos = {\n            x: this.attrs.x + it.getTranslation().x,\n            y: this.attrs.y + it.getTranslation().y\n        };\n        this.setPosition({ x: pos.x, y: pos.y });\n        this._setTransform(origTrans);\n        return this;\n    };\n    Node.prototype._setTransform = function (trans) {\n        var key;\n        for (key in trans) {\n            this.attrs[key] = trans[key];\n        }\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n    };\n    Node.prototype._clearTransform = function () {\n        var trans = {\n            x: this.x(),\n            y: this.y(),\n            rotation: this.rotation(),\n            scaleX: this.scaleX(),\n            scaleY: this.scaleY(),\n            offsetX: this.offsetX(),\n            offsetY: this.offsetY(),\n            skewX: this.skewX(),\n            skewY: this.skewY()\n        };\n        this.attrs.x = 0;\n        this.attrs.y = 0;\n        this.attrs.rotation = 0;\n        this.attrs.scaleX = 1;\n        this.attrs.scaleY = 1;\n        this.attrs.offsetX = 0;\n        this.attrs.offsetY = 0;\n        this.attrs.skewX = 0;\n        this.attrs.skewY = 0;\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        return trans;\n    };\n    Node.prototype.move = function (change) {\n        var changeX = change.x, changeY = change.y, x = this.x(), y = this.y();\n        if (changeX !== undefined) {\n            x += changeX;\n        }\n        if (changeY !== undefined) {\n            y += changeY;\n        }\n        this.setPosition({ x: x, y: y });\n        return this;\n    };\n    Node.prototype._eachAncestorReverse = function (func, top) {\n        var family = [], parent = this.getParent(), len, n;\n        if (top && top._id === this._id) {\n            func(this);\n            return;\n        }\n        family.unshift(this);\n        while (parent && (!top || parent._id !== top._id)) {\n            family.unshift(parent);\n            parent = parent.parent;\n        }\n        len = family.length;\n        for (n = 0; n < len; n++) {\n            func(family[n]);\n        }\n    };\n    Node.prototype.rotate = function (theta) {\n        this.rotation(this.rotation() + theta);\n        return this;\n    };\n    Node.prototype.moveToTop = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        this.parent.children.splice(index, 1);\n        this.parent.children.push(this);\n        this.parent._setChildrenIndices();\n        return true;\n    };\n    Node.prototype.moveUp = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index + 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    };\n    Node.prototype.moveDown = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index - 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    };\n    Node.prototype.moveToBottom = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.unshift(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    };\n    Node.prototype.setZIndex = function (zIndex) {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n            return this;\n        }\n        if (zIndex < 0 || zIndex >= this.parent.children.length) {\n            Util_1.Util.warn('Unexpected value ' +\n                zIndex +\n                ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' +\n                (this.parent.children.length - 1) +\n                '.');\n        }\n        var index = this.index;\n        this.parent.children.splice(index, 1);\n        this.parent.children.splice(zIndex, 0, this);\n        this.parent._setChildrenIndices();\n        return this;\n    };\n    Node.prototype.getAbsoluteOpacity = function () {\n        return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n    };\n    Node.prototype._getAbsoluteOpacity = function () {\n        var absOpacity = this.opacity();\n        var parent = this.getParent();\n        if (parent && !parent._isUnderCache) {\n            absOpacity *= parent.getAbsoluteOpacity();\n        }\n        return absOpacity;\n    };\n    Node.prototype.moveTo = function (newContainer) {\n        if (this.getParent() !== newContainer) {\n            this._remove();\n            newContainer.add(this);\n        }\n        return this;\n    };\n    Node.prototype.toObject = function () {\n        var obj = {}, attrs = this.getAttrs(), key, val, getter, defaultValue, nonPlainObject;\n        obj.attrs = {};\n        for (key in attrs) {\n            val = attrs[key];\n            nonPlainObject =\n                Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n            if (nonPlainObject) {\n                continue;\n            }\n            getter = typeof this[key] === 'function' && this[key];\n            delete attrs[key];\n            defaultValue = getter ? getter.call(this) : null;\n            attrs[key] = val;\n            if (defaultValue !== val) {\n                obj.attrs[key] = val;\n            }\n        }\n        obj.className = this.getClassName();\n        return Util_1.Util._prepareToStringify(obj);\n    };\n    Node.prototype.toJSON = function () {\n        return JSON.stringify(this.toObject());\n    };\n    Node.prototype.getParent = function () {\n        return this.parent;\n    };\n    Node.prototype.findAncestors = function (selector, includeSelf, stopNode) {\n        var res = [];\n        if (includeSelf && this._isMatch(selector)) {\n            res.push(this);\n        }\n        var ancestor = this.parent;\n        while (ancestor) {\n            if (ancestor === stopNode) {\n                return res;\n            }\n            if (ancestor._isMatch(selector)) {\n                res.push(ancestor);\n            }\n            ancestor = ancestor.parent;\n        }\n        return res;\n    };\n    Node.prototype.isAncestorOf = function (node) {\n        return false;\n    };\n    Node.prototype.findAncestor = function (selector, includeSelf, stopNode) {\n        return this.findAncestors(selector, includeSelf, stopNode)[0];\n    };\n    Node.prototype._isMatch = function (selector) {\n        if (!selector) {\n            return false;\n        }\n        if (typeof selector === 'function') {\n            return selector(this);\n        }\n        var selectorArr = selector.replace(/ /g, '').split(','), len = selectorArr.length, n, sel;\n        for (n = 0; n < len; n++) {\n            sel = selectorArr[n];\n            if (!Util_1.Util.isValidSelector(sel)) {\n                Util_1.Util.warn('Selector \"' +\n                    sel +\n                    '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n                Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n                Util_1.Util.warn('Konva is awesome, right?');\n            }\n            if (sel.charAt(0) === '#') {\n                if (this.id() === sel.slice(1)) {\n                    return true;\n                }\n            }\n            else if (sel.charAt(0) === '.') {\n                if (this.hasName(sel.slice(1))) {\n                    return true;\n                }\n            }\n            else if (this.className === sel || this.nodeType === sel) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Node.prototype.getLayer = function () {\n        var parent = this.getParent();\n        return parent ? parent.getLayer() : null;\n    };\n    Node.prototype.getStage = function () {\n        return this._getCache(STAGE, this._getStage);\n    };\n    Node.prototype._getStage = function () {\n        var parent = this.getParent();\n        if (parent) {\n            return parent.getStage();\n        }\n        else {\n            return undefined;\n        }\n    };\n    Node.prototype.fire = function (eventType, evt, bubble) {\n        evt = evt || {};\n        evt.target = evt.target || this;\n        if (bubble) {\n            this._fireAndBubble(eventType, evt);\n        }\n        else {\n            this._fire(eventType, evt);\n        }\n        return this;\n    };\n    Node.prototype.getAbsoluteTransform = function (top) {\n        if (top) {\n            return this._getAbsoluteTransform(top);\n        }\n        else {\n            return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n        }\n    };\n    Node.prototype._getAbsoluteTransform = function (top) {\n        var at;\n        if (top) {\n            at = new Util_1.Transform();\n            this._eachAncestorReverse(function (node) {\n                var transformsEnabled = node.transformsEnabled();\n                if (transformsEnabled === 'all') {\n                    at.multiply(node.getTransform());\n                }\n                else if (transformsEnabled === 'position') {\n                    at.translate(node.x() - node.offsetX(), node.y() - node.offsetY());\n                }\n            }, top);\n            return at;\n        }\n        else {\n            if (this.parent) {\n                at = this.parent.getAbsoluteTransform().copy();\n            }\n            else {\n                at = new Util_1.Transform();\n            }\n            var transformsEnabled = this.transformsEnabled();\n            if (transformsEnabled === 'all') {\n                at.multiply(this.getTransform());\n            }\n            else if (transformsEnabled === 'position') {\n                at.translate(this.x() - this.offsetX(), this.y() - this.offsetY());\n            }\n            return at;\n        }\n    };\n    Node.prototype.getAbsoluteScale = function (top) {\n        if (top) {\n            return this._getAbsoluteScale(top);\n        }\n        else {\n            return this._getCache(ABSOLUTE_SCALE, this._getAbsoluteScale);\n        }\n    };\n    Node.prototype._getAbsoluteScale = function (top) {\n        var parent = this;\n        while (parent) {\n            if (parent._isUnderCache) {\n                top = parent;\n            }\n            parent = parent.getParent();\n        }\n        var scaleX = 1, scaleY = 1;\n        this._eachAncestorReverse(function (node) {\n            scaleX *= node.scaleX();\n            scaleY *= node.scaleY();\n        }, top);\n        return {\n            x: scaleX,\n            y: scaleY\n        };\n    };\n    Node.prototype.getAbsoluteRotation = function () {\n        var parent = this;\n        var rotation = 0;\n        while (parent) {\n            rotation += parent.rotation();\n            parent = parent.getParent();\n        }\n        return rotation;\n    };\n    Node.prototype.getTransform = function () {\n        return this._getCache(TRANSFORM, this._getTransform);\n    };\n    Node.prototype._getTransform = function () {\n        var m = new Util_1.Transform(), x = this.x(), y = this.y(), rotation = Global_1.Konva.getAngle(this.rotation()), scaleX = this.scaleX(), scaleY = this.scaleY(), skewX = this.skewX(), skewY = this.skewY(), offsetX = this.offsetX(), offsetY = this.offsetY();\n        if (x !== 0 || y !== 0) {\n            m.translate(x, y);\n        }\n        if (rotation !== 0) {\n            m.rotate(rotation);\n        }\n        if (skewX !== 0 || skewY !== 0) {\n            m.skew(skewX, skewY);\n        }\n        if (scaleX !== 1 || scaleY !== 1) {\n            m.scale(scaleX, scaleY);\n        }\n        if (offsetX !== 0 || offsetY !== 0) {\n            m.translate(-1 * offsetX, -1 * offsetY);\n        }\n        return m;\n    };\n    Node.prototype.clone = function (obj) {\n        var attrs = Util_1.Util.cloneObject(this.attrs), key, allListeners, len, n, listener;\n        for (key in obj) {\n            attrs[key] = obj[key];\n        }\n        var node = new this.constructor(attrs);\n        for (key in this.eventListeners) {\n            allListeners = this.eventListeners[key];\n            len = allListeners.length;\n            for (n = 0; n < len; n++) {\n                listener = allListeners[n];\n                if (listener.name.indexOf(KONVA) < 0) {\n                    if (!node.eventListeners[key]) {\n                        node.eventListeners[key] = [];\n                    }\n                    node.eventListeners[key].push(listener);\n                }\n            }\n        }\n        return node;\n    };\n    Node.prototype._toKonvaCanvas = function (config) {\n        config = config || {};\n        var box = this.getClientRect();\n        var stage = this.getStage(), x = config.x !== undefined ? config.x : box.x, y = config.y !== undefined ? config.y : box.y, pixelRatio = config.pixelRatio || 1, canvas = new Canvas_1.SceneCanvas({\n            width: config.width || box.width || (stage ? stage.width() : 0),\n            height: config.height || box.height || (stage ? stage.height() : 0),\n            pixelRatio: pixelRatio\n        }), context = canvas.getContext();\n        context.save();\n        if (x || y) {\n            context.translate(-1 * x, -1 * y);\n        }\n        this.drawScene(canvas);\n        context.restore();\n        return canvas;\n    };\n    Node.prototype.toCanvas = function (config) {\n        return this._toKonvaCanvas(config)._canvas;\n    };\n    Node.prototype.toDataURL = function (config) {\n        config = config || {};\n        var mimeType = config.mimeType || null, quality = config.quality || null;\n        var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n        if (config.callback) {\n            config.callback(url);\n        }\n        return url;\n    };\n    Node.prototype.toImage = function (config) {\n        if (!config || !config.callback) {\n            throw 'callback required for toImage method config argument';\n        }\n        var callback = config.callback;\n        delete config.callback;\n        Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\n            callback(img);\n        });\n    };\n    Node.prototype.setSize = function (size) {\n        this.width(size.width);\n        this.height(size.height);\n        return this;\n    };\n    Node.prototype.getSize = function () {\n        return {\n            width: this.width(),\n            height: this.height()\n        };\n    };\n    Node.prototype.getClassName = function () {\n        return this.className || this.nodeType;\n    };\n    Node.prototype.getType = function () {\n        return this.nodeType;\n    };\n    Node.prototype.getDragDistance = function () {\n        if (this.attrs.dragDistance !== undefined) {\n            return this.attrs.dragDistance;\n        }\n        else if (this.parent) {\n            return this.parent.getDragDistance();\n        }\n        else {\n            return Global_1.Konva.dragDistance;\n        }\n    };\n    Node.prototype._off = function (type, name, callback) {\n        var evtListeners = this.eventListeners[type], i, evtName, handler;\n        for (i = 0; i < evtListeners.length; i++) {\n            evtName = evtListeners[i].name;\n            handler = evtListeners[i].handler;\n            if ((evtName !== 'konva' || name === 'konva') &&\n                (!name || evtName === name) &&\n                (!callback || callback === handler)) {\n                evtListeners.splice(i, 1);\n                if (evtListeners.length === 0) {\n                    delete this.eventListeners[type];\n                    break;\n                }\n                i--;\n            }\n        }\n    };\n    Node.prototype._fireChangeEvent = function (attr, oldVal, newVal) {\n        this._fire(attr + CHANGE, {\n            oldVal: oldVal,\n            newVal: newVal\n        });\n    };\n    Node.prototype.setId = function (id) {\n        var oldId = this.id();\n        exports._removeId(oldId, this);\n        _addId(this, id);\n        this._setAttr('id', id);\n        return this;\n    };\n    Node.prototype.setName = function (name) {\n        var oldNames = (this.name() || '').split(/\\s/g);\n        var newNames = (name || '').split(/\\s/g);\n        var subname, i;\n        for (i = 0; i < oldNames.length; i++) {\n            subname = oldNames[i];\n            if (newNames.indexOf(subname) === -1 && subname) {\n                exports._removeName(subname, this._id);\n            }\n        }\n        for (i = 0; i < newNames.length; i++) {\n            subname = newNames[i];\n            if (oldNames.indexOf(subname) === -1 && subname) {\n                exports._addName(this, subname);\n            }\n        }\n        this._setAttr(NAME, name);\n        return this;\n    };\n    Node.prototype.addName = function (name) {\n        if (!this.hasName(name)) {\n            var oldName = this.name();\n            var newName = oldName ? oldName + ' ' + name : name;\n            this.setName(newName);\n        }\n        return this;\n    };\n    Node.prototype.hasName = function (name) {\n        if (!name) {\n            return false;\n        }\n        var fullName = this.name();\n        if (!fullName) {\n            return false;\n        }\n        var names = (fullName || '').split(/\\s/g);\n        return names.indexOf(name) !== -1;\n    };\n    Node.prototype.removeName = function (name) {\n        var names = (this.name() || '').split(/\\s/g);\n        var index = names.indexOf(name);\n        if (index !== -1) {\n            names.splice(index, 1);\n            this.setName(names.join(' '));\n        }\n        return this;\n    };\n    Node.prototype.setAttr = function (attr, val) {\n        var func = this[SET + Util_1.Util._capitalize(attr)];\n        if (Util_1.Util._isFunction(func)) {\n            func.call(this, val);\n        }\n        else {\n            this._setAttr(attr, val);\n        }\n        return this;\n    };\n    Node.prototype._setAttr = function (key, val) {\n        var oldVal = this.attrs[key];\n        if (oldVal === val && !Util_1.Util.isObject(val)) {\n            return;\n        }\n        if (val === undefined || val === null) {\n            delete this.attrs[key];\n        }\n        else {\n            this.attrs[key] = val;\n        }\n        this._fireChangeEvent(key, oldVal, val);\n    };\n    Node.prototype._setComponentAttr = function (key, component, val) {\n        var oldVal;\n        if (val !== undefined) {\n            oldVal = this.attrs[key];\n            if (!oldVal) {\n                this.attrs[key] = this.getAttr(key);\n            }\n            this.attrs[key][component] = val;\n            this._fireChangeEvent(key, oldVal, val);\n        }\n    };\n    Node.prototype._fireAndBubble = function (eventType, evt, compareShape) {\n        if (evt && this.nodeType === SHAPE) {\n            evt.target = this;\n        }\n        var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n            ((compareShape &&\n                (this === compareShape ||\n                    (this.isAncestorOf && this.isAncestorOf(compareShape)))) ||\n                (this.nodeType === 'Stage' && !compareShape));\n        if (!shouldStop) {\n            this._fire(eventType, evt);\n            var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n                compareShape &&\n                compareShape.isAncestorOf &&\n                compareShape.isAncestorOf(this) &&\n                !compareShape.isAncestorOf(this.parent);\n            if (((evt && !evt.cancelBubble) || !evt) &&\n                this.parent &&\n                this.parent.isListening() &&\n                !stopBubble) {\n                if (compareShape && compareShape.parent) {\n                    this._fireAndBubble.call(this.parent, eventType, evt, compareShape);\n                }\n                else {\n                    this._fireAndBubble.call(this.parent, eventType, evt);\n                }\n            }\n        }\n    };\n    Node.prototype._fire = function (eventType, evt) {\n        var events = this.eventListeners[eventType], i;\n        if (events) {\n            evt = evt || {};\n            evt.currentTarget = this;\n            evt.type = eventType;\n            for (i = 0; i < events.length; i++) {\n                events[i].handler.call(this, evt);\n            }\n        }\n    };\n    Node.prototype.draw = function () {\n        this.drawScene();\n        this.drawHit();\n        return this;\n    };\n    Node.prototype._createDragElement = function (evt) {\n        var pointerId = evt ? evt.pointerId : undefined;\n        var stage = this.getStage();\n        var ap = this.getAbsolutePosition();\n        var pos = stage._getPointerById(pointerId) ||\n            stage._changedPointerPositions[0] ||\n            ap;\n        DragAndDrop_1.DD._dragElements.set(this._id, {\n            node: this,\n            startPointerPos: pos,\n            offset: {\n                x: pos.x - ap.x,\n                y: pos.y - ap.y\n            },\n            dragStatus: 'ready',\n            pointerId: pointerId\n        });\n    };\n    Node.prototype.startDrag = function (evt) {\n        if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n            this._createDragElement(evt);\n        }\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        elem.dragStatus = 'dragging';\n        this.fire('dragstart', {\n            type: 'dragstart',\n            target: this,\n            evt: evt && evt.evt\n        }, true);\n    };\n    Node.prototype._setDragPosition = function (evt, elem) {\n        var pos = this.getStage()._getPointerById(elem.pointerId);\n        if (!pos) {\n            return;\n        }\n        var newNodePos = {\n            x: pos.x - elem.offset.x,\n            y: pos.y - elem.offset.y\n        };\n        var dbf = this.dragBoundFunc();\n        if (dbf !== undefined) {\n            var bounded = dbf.call(this, newNodePos, evt);\n            if (!bounded) {\n                Util_1.Util.warn('dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.');\n            }\n            else {\n                newNodePos = bounded;\n            }\n        }\n        if (!this._lastPos ||\n            this._lastPos.x !== newNodePos.x ||\n            this._lastPos.y !== newNodePos.y) {\n            this.setAbsolutePosition(newNodePos);\n            if (this.getLayer()) {\n                this.getLayer().batchDraw();\n            }\n            else if (this.getStage()) {\n                this.getStage().batchDraw();\n            }\n        }\n        this._lastPos = newNodePos;\n    };\n    Node.prototype.stopDrag = function (evt) {\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        if (elem) {\n            elem.dragStatus = 'stopped';\n        }\n        DragAndDrop_1.DD._endDragBefore(evt);\n        DragAndDrop_1.DD._endDragAfter(evt);\n    };\n    Node.prototype.setDraggable = function (draggable) {\n        this._setAttr('draggable', draggable);\n        this._dragChange();\n    };\n    Node.prototype.isDragging = function () {\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        return elem ? elem.dragStatus === 'dragging' : false;\n    };\n    Node.prototype._listenDrag = function () {\n        this._dragCleanup();\n        this.on('mousedown.konva touchstart.konva', function (evt) {\n            var _this = this;\n            var shouldCheckButton = evt.evt['button'] !== undefined;\n            var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n            if (!canDrag) {\n                return;\n            }\n            if (this.isDragging()) {\n                return;\n            }\n            var hasDraggingChild = false;\n            DragAndDrop_1.DD._dragElements.forEach(function (elem) {\n                if (_this.isAncestorOf(elem.node)) {\n                    hasDraggingChild = true;\n                }\n            });\n            if (!hasDraggingChild) {\n                this._createDragElement(evt);\n            }\n        });\n    };\n    Node.prototype._dragChange = function () {\n        if (this.attrs.draggable) {\n            this._listenDrag();\n        }\n        else {\n            this._dragCleanup();\n            var stage = this.getStage();\n            if (stage && DragAndDrop_1.DD._dragElements.has(this._id)) {\n                this.stopDrag();\n            }\n        }\n    };\n    Node.prototype._dragCleanup = function () {\n        this.off('mousedown.konva');\n        this.off('touchstart.konva');\n    };\n    Node.create = function (data, container) {\n        if (Util_1.Util._isString(data)) {\n            data = JSON.parse(data);\n        }\n        return this._createNode(data, container);\n    };\n    Node._createNode = function (obj, container) {\n        var className = Node.prototype.getClassName.call(obj), children = obj.children, no, len, n;\n        if (container) {\n            obj.attrs.container = container;\n        }\n        if (!Global_1._NODES_REGISTRY[className]) {\n            Util_1.Util.warn('Can not find a node with class name \"' +\n                className +\n                '\". Fallback to \"Shape\".');\n            className = 'Shape';\n        }\n        var Class = Global_1._NODES_REGISTRY[className];\n        no = new Class(obj.attrs);\n        if (children) {\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                no.add(Node._createNode(children[n]));\n            }\n        }\n        return no;\n    };\n    return Node;\n}());\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nFactory_1.Factory.addGetterSetter(Node, 'zIndex');\nFactory_1.Factory.addGetterSetter(Node, 'absolutePosition');\nFactory_1.Factory.addGetterSetter(Node, 'position');\nFactory_1.Factory.addGetterSetter(Node, 'x', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'y', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'globalCompositeOperation', 'source-over', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'opacity', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'name', '', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'id', '', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'rotation', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Node, 'scaleX', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'scaleY', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Node, 'skewX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'skewY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Node, 'offsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'offsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'dragDistance', null, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'width', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'height', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'listening', 'inherit', function (val) {\n    var isValid = val === true || val === false || val === 'inherit';\n    if (!isValid) {\n        Util_1.Util.warn(val +\n            ' is a not valid value for \"listening\" attribute. The value may be true, false or \"inherit\".');\n    }\n    return val;\n});\nFactory_1.Factory.addGetterSetter(Node, 'preventDefault', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Node, 'filters', null, function (val) {\n    this._filterUpToDate = false;\n    return val;\n});\nFactory_1.Factory.addGetterSetter(Node, 'visible', 'inherit', function (val) {\n    var isValid = val === true || val === false || val === 'inherit';\n    if (!isValid) {\n        Util_1.Util.warn(val +\n            ' is a not valid value for \"visible\" attribute. The value may be true, false or \"inherit\".');\n    }\n    return val;\n});\nFactory_1.Factory.addGetterSetter(Node, 'transformsEnabled', 'all', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'size');\nFactory_1.Factory.addGetterSetter(Node, 'dragBoundFunc');\nFactory_1.Factory.addGetterSetter(Node, 'draggable', false, Validators_1.getBooleanValidator());\nFactory_1.Factory.backCompat(Node, {\n    rotateDeg: 'rotate',\n    setRotationDeg: 'setRotation',\n    getRotationDeg: 'getRotation'\n});\nUtil_1.Collection.mapMethods(Node);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Node_1 = require(\"./Node\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Validators_1 = require(\"./Validators\");\nvar Global_1 = require(\"./Global\");\nvar Container = (function (_super) {\n    __extends(Container, _super);\n    function Container() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.children = new Util_1.Collection();\n        return _this;\n    }\n    Container.prototype.getChildren = function (filterFunc) {\n        if (!filterFunc) {\n            return this.children;\n        }\n        var results = new Util_1.Collection();\n        this.children.each(function (child) {\n            if (filterFunc(child)) {\n                results.push(child);\n            }\n        });\n        return results;\n    };\n    Container.prototype.hasChildren = function () {\n        return this.getChildren().length > 0;\n    };\n    Container.prototype.removeChildren = function () {\n        var child;\n        for (var i = 0; i < this.children.length; i++) {\n            child = this.children[i];\n            child.parent = null;\n            child.index = 0;\n            child.remove();\n        }\n        this.children = new Util_1.Collection();\n        return this;\n    };\n    Container.prototype.destroyChildren = function () {\n        var child;\n        for (var i = 0; i < this.children.length; i++) {\n            child = this.children[i];\n            child.parent = null;\n            child.index = 0;\n            child.destroy();\n        }\n        this.children = new Util_1.Collection();\n        return this;\n    };\n    Container.prototype.add = function () {\n        var children = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            children[_i] = arguments[_i];\n        }\n        if (arguments.length > 1) {\n            for (var i = 0; i < arguments.length; i++) {\n                this.add(arguments[i]);\n            }\n            return this;\n        }\n        var child = children[0];\n        if (child.getParent()) {\n            child.moveTo(this);\n            return this;\n        }\n        var _children = this.children;\n        this._validateAdd(child);\n        child._clearCaches();\n        child.index = _children.length;\n        child.parent = this;\n        _children.push(child);\n        this._fire('add', {\n            child: child\n        });\n        return this;\n    };\n    Container.prototype.destroy = function () {\n        if (this.hasChildren()) {\n            this.destroyChildren();\n        }\n        _super.prototype.destroy.call(this);\n        return this;\n    };\n    Container.prototype.find = function (selector) {\n        return this._generalFind(selector, false);\n    };\n    Container.prototype.get = function (selector) {\n        Util_1.Util.warn('collection.get() method is deprecated. Please use collection.find() instead.');\n        return this.find(selector);\n    };\n    Container.prototype.findOne = function (selector) {\n        var result = this._generalFind(selector, true);\n        return result.length > 0 ? result[0] : undefined;\n    };\n    Container.prototype._generalFind = function (selector, findOne) {\n        var retArr = [];\n        this._descendants(function (node) {\n            var valid = node._isMatch(selector);\n            if (valid) {\n                retArr.push(node);\n            }\n            if (valid && findOne) {\n                return true;\n            }\n            return false;\n        });\n        return Util_1.Collection.toCollection(retArr);\n    };\n    Container.prototype._descendants = function (fn) {\n        var shouldStop = false;\n        for (var i = 0; i < this.children.length; i++) {\n            var child = this.children[i];\n            shouldStop = fn(child);\n            if (shouldStop) {\n                return true;\n            }\n            if (!child.hasChildren()) {\n                continue;\n            }\n            shouldStop = child._descendants(fn);\n            if (shouldStop) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Container.prototype.toObject = function () {\n        var obj = Node_1.Node.prototype.toObject.call(this);\n        obj.children = [];\n        var children = this.getChildren();\n        var len = children.length;\n        for (var n = 0; n < len; n++) {\n            var child = children[n];\n            obj.children.push(child.toObject());\n        }\n        return obj;\n    };\n    Container.prototype._getDescendants = function (arr) {\n        var retArr = [];\n        var len = arr.length;\n        for (var n = 0; n < len; n++) {\n            var node = arr[n];\n            if (this.isAncestorOf(node)) {\n                retArr.push(node);\n            }\n        }\n        return retArr;\n    };\n    Container.prototype.isAncestorOf = function (node) {\n        var parent = node.getParent();\n        while (parent) {\n            if (parent._id === this._id) {\n                return true;\n            }\n            parent = parent.getParent();\n        }\n        return false;\n    };\n    Container.prototype.clone = function (obj) {\n        var node = Node_1.Node.prototype.clone.call(this, obj);\n        this.getChildren().each(function (no) {\n            node.add(no.clone());\n        });\n        return node;\n    };\n    Container.prototype.getAllIntersections = function (pos) {\n        var arr = [];\n        this.find('Shape').each(function (shape) {\n            if (shape.isVisible() && shape.intersects(pos)) {\n                arr.push(shape);\n            }\n        });\n        return arr;\n    };\n    Container.prototype._setChildrenIndices = function () {\n        this.children.each(function (child, n) {\n            child.index = n;\n        });\n    };\n    Container.prototype.drawScene = function (can, top, caching) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.getCanvas()), context = canvas && canvas.getContext(), cachedCanvas = this._getCanvasCache(), cachedSceneCanvas = cachedCanvas && cachedCanvas.scene;\n        if (this.isVisible() || caching) {\n            if (!caching && cachedSceneCanvas) {\n                context.save();\n                layer._applyTransform(this, context, top);\n                this._drawCachedSceneCanvas(context);\n                context.restore();\n            }\n            else {\n                this._drawChildren(canvas, 'drawScene', top, false, caching, caching);\n            }\n        }\n        return this;\n    };\n    Container.prototype.drawHit = function (can, top, caching) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.hitCanvas), context = canvas && canvas.getContext(), cachedCanvas = this._getCanvasCache(), cachedHitCanvas = cachedCanvas && cachedCanvas.hit;\n        if (this.shouldDrawHit(canvas) || caching) {\n            if (!caching && cachedHitCanvas) {\n                context.save();\n                layer._applyTransform(this, context, top);\n                this._drawCachedHitCanvas(context);\n                context.restore();\n            }\n            else {\n                this._drawChildren(canvas, 'drawHit', top, false, caching, caching);\n            }\n        }\n        return this;\n    };\n    Container.prototype._drawChildren = function (canvas, drawMethod, top, caching, skipBuffer, skipComposition) {\n        var layer = this.getLayer(), context = canvas && canvas.getContext(), clipWidth = this.clipWidth(), clipHeight = this.clipHeight(), clipFunc = this.clipFunc(), hasClip = (clipWidth && clipHeight) || clipFunc, clipX, clipY;\n        if (hasClip && layer) {\n            context.save();\n            var transform = this.getAbsoluteTransform(top);\n            var m = transform.getMatrix();\n            context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n            context.beginPath();\n            if (clipFunc) {\n                clipFunc.call(this, context, this);\n            }\n            else {\n                clipX = this.clipX();\n                clipY = this.clipY();\n                context.rect(clipX, clipY, clipWidth, clipHeight);\n            }\n            context.clip();\n            m = transform\n                .copy()\n                .invert()\n                .getMatrix();\n            context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n        }\n        var hasComposition = this.globalCompositeOperation() !== 'source-over' &&\n            !skipComposition &&\n            drawMethod === 'drawScene';\n        if (hasComposition && layer) {\n            context.save();\n            context._applyGlobalCompositeOperation(this);\n        }\n        this.children.each(function (child) {\n            child[drawMethod](canvas, top, caching, skipBuffer);\n        });\n        if (hasComposition && layer) {\n            context.restore();\n        }\n        if (hasClip && layer) {\n            context.restore();\n        }\n    };\n    Container.prototype.shouldDrawHit = function (canvas) {\n        if (canvas && canvas.isCache) {\n            return true;\n        }\n        var layer = this.getLayer();\n        var layerUnderDrag = false;\n        DragAndDrop_1.DD._dragElements.forEach(function (elem) {\n            if (elem.dragStatus === 'dragging' && elem.node.getLayer() === layer) {\n                layerUnderDrag = true;\n            }\n        });\n        var dragSkip = !Global_1.Konva.hitOnDragEnabled && layerUnderDrag;\n        return layer && layer.hitGraphEnabled() && this.isVisible() && !dragSkip;\n    };\n    Container.prototype.getClientRect = function (attrs) {\n        attrs = attrs || {};\n        var skipTransform = attrs.skipTransform;\n        var relativeTo = attrs.relativeTo;\n        var minX, minY, maxX, maxY;\n        var selfRect = {\n            x: Infinity,\n            y: Infinity,\n            width: 0,\n            height: 0\n        };\n        var that = this;\n        this.children.each(function (child) {\n            if (!child.visible()) {\n                return;\n            }\n            var rect = child.getClientRect({\n                relativeTo: that,\n                skipShadow: attrs.skipShadow,\n                skipStroke: attrs.skipStroke\n            });\n            if (rect.width === 0 && rect.height === 0) {\n                return;\n            }\n            if (minX === undefined) {\n                minX = rect.x;\n                minY = rect.y;\n                maxX = rect.x + rect.width;\n                maxY = rect.y + rect.height;\n            }\n            else {\n                minX = Math.min(minX, rect.x);\n                minY = Math.min(minY, rect.y);\n                maxX = Math.max(maxX, rect.x + rect.width);\n                maxY = Math.max(maxY, rect.y + rect.height);\n            }\n        });\n        var shapes = this.find('Shape');\n        var hasVisible = false;\n        for (var i = 0; i < shapes.length; i++) {\n            var shape = shapes[i];\n            if (shape._isVisible(this)) {\n                hasVisible = true;\n                break;\n            }\n        }\n        if (hasVisible && minX !== undefined) {\n            selfRect = {\n                x: minX,\n                y: minY,\n                width: maxX - minX,\n                height: maxY - minY\n            };\n        }\n        else {\n            selfRect = {\n                x: 0,\n                y: 0,\n                width: 0,\n                height: 0\n            };\n        }\n        if (!skipTransform) {\n            return this._transformedRect(selfRect, relativeTo);\n        }\n        return selfRect;\n    };\n    return Container;\n}(Node_1.Node));\nexports.Container = Container;\nFactory_1.Factory.addComponentsGetterSetter(Container, 'clip', [\n    'x',\n    'y',\n    'width',\n    'height'\n]);\nFactory_1.Factory.addGetterSetter(Container, 'clipX', undefined, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Container, 'clipY', undefined, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Container, 'clipWidth', undefined, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Container, 'clipHeight', undefined, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Container, 'clipFunc');\nUtil_1.Collection.mapMethods(Container);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Global_1 = require(\"./Global\");\nvar Captures = new Map();\nvar SUPPORT_POINTER_EVENTS = Global_1.Konva._global['PointerEvent'] !== undefined;\nfunction getCapturedShape(pointerId) {\n    return Captures.get(pointerId);\n}\nexports.getCapturedShape = getCapturedShape;\nfunction createEvent(evt) {\n    return {\n        evt: evt,\n        pointerId: evt.pointerId\n    };\n}\nexports.createEvent = createEvent;\nfunction hasPointerCapture(pointerId, shape) {\n    return Captures.get(pointerId) === shape;\n}\nexports.hasPointerCapture = hasPointerCapture;\nfunction setPointerCapture(pointerId, shape) {\n    releaseCapture(pointerId);\n    var stage = shape.getStage();\n    if (!stage)\n        return;\n    Captures.set(pointerId, shape);\n    if (SUPPORT_POINTER_EVENTS) {\n        shape._fire('gotpointercapture', createEvent(new PointerEvent('gotpointercapture')));\n    }\n}\nexports.setPointerCapture = setPointerCapture;\nfunction releaseCapture(pointerId, target) {\n    var shape = Captures.get(pointerId);\n    if (!shape)\n        return;\n    var stage = shape.getStage();\n    if (stage && stage.content) {\n    }\n    Captures.delete(pointerId);\n    if (SUPPORT_POINTER_EVENTS) {\n        shape._fire('lostpointercapture', createEvent(new PointerEvent('lostpointercapture')));\n    }\n}\nexports.releaseCapture = releaseCapture;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Container_1 = require(\"./Container\");\nvar Global_1 = require(\"./Global\");\nvar Canvas_1 = require(\"./Canvas\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Global_2 = require(\"./Global\");\nvar PointerEvents = require(\"./PointerEvents\");\nvar STAGE = 'Stage', STRING = 'string', PX = 'px', MOUSEOUT = 'mouseout', MOUSELEAVE = 'mouseleave', MOUSEOVER = 'mouseover', MOUSEENTER = 'mouseenter', MOUSEMOVE = 'mousemove', MOUSEDOWN = 'mousedown', MOUSEUP = 'mouseup', POINTERMOVE = 'pointermove', POINTERDOWN = 'pointerdown', POINTERUP = 'pointerup', POINTERCANCEL = 'pointercancel', LOSTPOINTERCAPTURE = 'lostpointercapture', CONTEXTMENU = 'contextmenu', CLICK = 'click', DBL_CLICK = 'dblclick', TOUCHSTART = 'touchstart', TOUCHEND = 'touchend', TAP = 'tap', DBL_TAP = 'dbltap', TOUCHMOVE = 'touchmove', WHEEL = 'wheel', CONTENT_MOUSEOUT = 'contentMouseout', CONTENT_MOUSEOVER = 'contentMouseover', CONTENT_MOUSEMOVE = 'contentMousemove', CONTENT_MOUSEDOWN = 'contentMousedown', CONTENT_MOUSEUP = 'contentMouseup', CONTENT_CONTEXTMENU = 'contentContextmenu', CONTENT_CLICK = 'contentClick', CONTENT_DBL_CLICK = 'contentDblclick', CONTENT_TOUCHSTART = 'contentTouchstart', CONTENT_TOUCHEND = 'contentTouchend', CONTENT_DBL_TAP = 'contentDbltap', CONTENT_TAP = 'contentTap', CONTENT_TOUCHMOVE = 'contentTouchmove', CONTENT_POINTERMOVE = 'contentPointermove', CONTENT_POINTERDOWN = 'contentPointerdown', CONTENT_POINTERUP = 'contentPointerup', CONTENT_WHEEL = 'contentWheel', RELATIVE = 'relative', KONVA_CONTENT = 'konvajs-content', SPACE = ' ', UNDERSCORE = '_', CONTAINER = 'container', MAX_LAYERS_NUMBER = 5, EMPTY_STRING = '', EVENTS = [\n    MOUSEENTER,\n    MOUSEDOWN,\n    MOUSEMOVE,\n    MOUSEUP,\n    MOUSEOUT,\n    TOUCHSTART,\n    TOUCHMOVE,\n    TOUCHEND,\n    MOUSEOVER,\n    WHEEL,\n    CONTEXTMENU,\n    POINTERDOWN,\n    POINTERMOVE,\n    POINTERUP,\n    POINTERCANCEL,\n    LOSTPOINTERCAPTURE\n], eventsLength = EVENTS.length;\nfunction addEvent(ctx, eventName) {\n    ctx.content.addEventListener(eventName, function (evt) {\n        ctx[UNDERSCORE + eventName](evt);\n    }, false);\n}\nvar NO_POINTERS_MESSAGE = \"Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);\";\nexports.stages = [];\nfunction checkNoClip(attrs) {\n    if (attrs === void 0) { attrs = {}; }\n    if (attrs.clipFunc || attrs.clipWidth || attrs.clipHeight) {\n        Util_1.Util.warn('Stage does not support clipping. Please use clip for Layers or Groups.');\n    }\n    return attrs;\n}\nvar Stage = (function (_super) {\n    __extends(Stage, _super);\n    function Stage(config) {\n        var _this = _super.call(this, checkNoClip(config)) || this;\n        _this._pointerPositions = [];\n        _this._changedPointerPositions = [];\n        _this._buildDOM();\n        _this._bindContentEvents();\n        exports.stages.push(_this);\n        _this.on('widthChange.konva heightChange.konva', _this._resizeDOM);\n        _this.on('visibleChange.konva', _this._checkVisibility);\n        _this.on('clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva', function () {\n            checkNoClip(_this.attrs);\n        });\n        _this._checkVisibility();\n        return _this;\n    }\n    Stage.prototype._validateAdd = function (child) {\n        var isLayer = child.getType() === 'Layer';\n        var isFastLayer = child.getType() === 'FastLayer';\n        var valid = isLayer || isFastLayer;\n        if (!valid) {\n            Util_1.Util.throw('You may only add layers to the stage.');\n        }\n    };\n    Stage.prototype._checkVisibility = function () {\n        if (!this.content) {\n            return;\n        }\n        var style = this.visible() ? '' : 'none';\n        this.content.style.display = style;\n    };\n    Stage.prototype.setContainer = function (container) {\n        if (typeof container === STRING) {\n            if (container.charAt(0) === '.') {\n                var className = container.slice(1);\n                container = document.getElementsByClassName(className)[0];\n            }\n            else {\n                var id;\n                if (container.charAt(0) !== '#') {\n                    id = container;\n                }\n                else {\n                    id = container.slice(1);\n                }\n                container = document.getElementById(id);\n            }\n            if (!container) {\n                throw 'Can not find container in document with id ' + id;\n            }\n        }\n        this._setAttr(CONTAINER, container);\n        if (this.content) {\n            if (this.content.parentElement) {\n                this.content.parentElement.removeChild(this.content);\n            }\n            container.appendChild(this.content);\n        }\n        return this;\n    };\n    Stage.prototype.shouldDrawHit = function () {\n        return true;\n    };\n    Stage.prototype.clear = function () {\n        var layers = this.children, len = layers.length, n;\n        for (n = 0; n < len; n++) {\n            layers[n].clear();\n        }\n        return this;\n    };\n    Stage.prototype.clone = function (obj) {\n        if (!obj) {\n            obj = {};\n        }\n        obj.container = document.createElement('div');\n        return Container_1.Container.prototype.clone.call(this, obj);\n    };\n    Stage.prototype.destroy = function () {\n        _super.prototype.destroy.call(this);\n        var content = this.content;\n        if (content && Util_1.Util._isInDocument(content)) {\n            this.container().removeChild(content);\n        }\n        var index = exports.stages.indexOf(this);\n        if (index > -1) {\n            exports.stages.splice(index, 1);\n        }\n        return this;\n    };\n    Stage.prototype.getPointerPosition = function () {\n        var pos = this._pointerPositions[0] || this._changedPointerPositions[0];\n        if (!pos) {\n            Util_1.Util.warn(NO_POINTERS_MESSAGE);\n            return null;\n        }\n        return {\n            x: pos.x,\n            y: pos.y\n        };\n    };\n    Stage.prototype._getPointerById = function (id) {\n        return this._pointerPositions.find(function (p) { return p.id === id; });\n    };\n    Stage.prototype.getPointersPositions = function () {\n        return this._pointerPositions;\n    };\n    Stage.prototype.getStage = function () {\n        return this;\n    };\n    Stage.prototype.getContent = function () {\n        return this.content;\n    };\n    Stage.prototype._toKonvaCanvas = function (config) {\n        config = config || {};\n        var x = config.x || 0, y = config.y || 0, canvas = new Canvas_1.SceneCanvas({\n            width: config.width || this.width(),\n            height: config.height || this.height(),\n            pixelRatio: config.pixelRatio || 1\n        }), _context = canvas.getContext()._context, layers = this.children;\n        if (x || y) {\n            _context.translate(-1 * x, -1 * y);\n        }\n        layers.each(function (layer) {\n            if (!layer.isVisible()) {\n                return;\n            }\n            var layerCanvas = layer._toKonvaCanvas(config);\n            _context.drawImage(layerCanvas._canvas, x, y, layerCanvas.getWidth() / layerCanvas.getPixelRatio(), layerCanvas.getHeight() / layerCanvas.getPixelRatio());\n        });\n        return canvas;\n    };\n    Stage.prototype.getIntersection = function (pos, selector) {\n        if (!pos) {\n            return null;\n        }\n        var layers = this.children, len = layers.length, end = len - 1, n, shape;\n        for (n = end; n >= 0; n--) {\n            shape = layers[n].getIntersection(pos, selector);\n            if (shape) {\n                return shape;\n            }\n        }\n        return null;\n    };\n    Stage.prototype._resizeDOM = function () {\n        var width = this.width();\n        var height = this.height();\n        if (this.content) {\n            this.content.style.width = width + PX;\n            this.content.style.height = height + PX;\n        }\n        this.bufferCanvas.setSize(width, height);\n        this.bufferHitCanvas.setSize(width, height);\n        this.children.each(function (layer) {\n            layer.setSize({ width: width, height: height });\n            layer.draw();\n        });\n    };\n    Stage.prototype.add = function (layer) {\n        if (arguments.length > 1) {\n            for (var i = 0; i < arguments.length; i++) {\n                this.add(arguments[i]);\n            }\n            return this;\n        }\n        _super.prototype.add.call(this, layer);\n        var length = this.children.length;\n        if (length > MAX_LAYERS_NUMBER) {\n            Util_1.Util.warn('The stage has ' +\n                length +\n                ' layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group.');\n        }\n        layer._setCanvasSize(this.width(), this.height());\n        layer.draw();\n        if (Global_1.Konva.isBrowser) {\n            this.content.appendChild(layer.canvas._canvas);\n        }\n        return this;\n    };\n    Stage.prototype.getParent = function () {\n        return null;\n    };\n    Stage.prototype.getLayer = function () {\n        return null;\n    };\n    Stage.prototype.hasPointerCapture = function (pointerId) {\n        return PointerEvents.hasPointerCapture(pointerId, this);\n    };\n    Stage.prototype.setPointerCapture = function (pointerId) {\n        PointerEvents.setPointerCapture(pointerId, this);\n    };\n    Stage.prototype.releaseCapture = function (pointerId) {\n        PointerEvents.releaseCapture(pointerId, this);\n    };\n    Stage.prototype.getLayers = function () {\n        return this.getChildren();\n    };\n    Stage.prototype._bindContentEvents = function () {\n        if (!Global_1.Konva.isBrowser) {\n            return;\n        }\n        for (var n = 0; n < eventsLength; n++) {\n            addEvent(this, EVENTS[n]);\n        }\n    };\n    Stage.prototype._mouseenter = function (evt) {\n        this.setPointersPositions(evt);\n        this._fire(MOUSEENTER, { evt: evt, target: this, currentTarget: this });\n    };\n    Stage.prototype._mouseover = function (evt) {\n        this.setPointersPositions(evt);\n        this._fire(CONTENT_MOUSEOVER, { evt: evt });\n        this._fire(MOUSEOVER, { evt: evt, target: this, currentTarget: this });\n    };\n    Stage.prototype._mouseout = function (evt) {\n        this.setPointersPositions(evt);\n        var targetShape = this.targetShape;\n        var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n        if (targetShape && eventsEnabled) {\n            targetShape._fireAndBubble(MOUSEOUT, { evt: evt });\n            targetShape._fireAndBubble(MOUSELEAVE, { evt: evt });\n            this._fire(MOUSELEAVE, { evt: evt, target: this, currentTarget: this });\n            this.targetShape = null;\n        }\n        else if (eventsEnabled) {\n            this._fire(MOUSELEAVE, {\n                evt: evt,\n                target: this,\n                currentTarget: this\n            });\n            this._fire(MOUSEOUT, {\n                evt: evt,\n                target: this,\n                currentTarget: this\n            });\n        }\n        this.pointerPos = undefined;\n        this._pointerPositions = [];\n        this._fire(CONTENT_MOUSEOUT, { evt: evt });\n    };\n    Stage.prototype._mousemove = function (evt) {\n        if (Global_1.Konva.UA.ieMobile) {\n            return this._touchmove(evt);\n        }\n        this.setPointersPositions(evt);\n        var pointerId = Util_1.Util._getFirstPointerId(evt);\n        var shape;\n        var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n        if (eventsEnabled) {\n            shape = this.getIntersection(this.getPointerPosition());\n            if (shape && shape.isListening()) {\n                var differentTarget = !this.targetShape || this.targetShape !== shape;\n                if (eventsEnabled && differentTarget) {\n                    if (this.targetShape) {\n                        this.targetShape._fireAndBubble(MOUSEOUT, { evt: evt, pointerId: pointerId }, shape);\n                        this.targetShape._fireAndBubble(MOUSELEAVE, { evt: evt, pointerId: pointerId }, shape);\n                    }\n                    shape._fireAndBubble(MOUSEOVER, { evt: evt, pointerId: pointerId }, this.targetShape);\n                    shape._fireAndBubble(MOUSEENTER, { evt: evt, pointerId: pointerId }, this.targetShape);\n                    shape._fireAndBubble(MOUSEMOVE, { evt: evt, pointerId: pointerId });\n                    this.targetShape = shape;\n                }\n                else {\n                    shape._fireAndBubble(MOUSEMOVE, { evt: evt, pointerId: pointerId });\n                }\n            }\n            else {\n                if (this.targetShape && eventsEnabled) {\n                    this.targetShape._fireAndBubble(MOUSEOUT, { evt: evt, pointerId: pointerId });\n                    this.targetShape._fireAndBubble(MOUSELEAVE, { evt: evt, pointerId: pointerId });\n                    this._fire(MOUSEOVER, {\n                        evt: evt,\n                        target: this,\n                        currentTarget: this,\n                        pointerId: pointerId\n                    });\n                    this.targetShape = null;\n                }\n                this._fire(MOUSEMOVE, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: pointerId\n                });\n            }\n            this._fire(CONTENT_MOUSEMOVE, { evt: evt });\n        }\n        if (evt.cancelable) {\n            evt.preventDefault();\n        }\n    };\n    Stage.prototype._mousedown = function (evt) {\n        if (Global_1.Konva.UA.ieMobile) {\n            return this._touchstart(evt);\n        }\n        this.setPointersPositions(evt);\n        var pointerId = Util_1.Util._getFirstPointerId(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        DragAndDrop_1.DD.justDragged = false;\n        Global_1.Konva.listenClickTap = true;\n        if (shape && shape.isListening()) {\n            this.clickStartShape = shape;\n            shape._fireAndBubble(MOUSEDOWN, { evt: evt, pointerId: pointerId });\n        }\n        else {\n            this._fire(MOUSEDOWN, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: pointerId\n            });\n        }\n        this._fire(CONTENT_MOUSEDOWN, { evt: evt });\n    };\n    Stage.prototype._mouseup = function (evt) {\n        if (Global_1.Konva.UA.ieMobile) {\n            return this._touchend(evt);\n        }\n        this.setPointersPositions(evt);\n        var pointerId = Util_1.Util._getFirstPointerId(evt);\n        var shape = this.getIntersection(this.getPointerPosition()), clickStartShape = this.clickStartShape, clickEndShape = this.clickEndShape, fireDblClick = false;\n        if (Global_1.Konva.inDblClickWindow) {\n            fireDblClick = true;\n            clearTimeout(this.dblTimeout);\n        }\n        else if (!DragAndDrop_1.DD.justDragged) {\n            Global_1.Konva.inDblClickWindow = true;\n            clearTimeout(this.dblTimeout);\n        }\n        this.dblTimeout = setTimeout(function () {\n            Global_1.Konva.inDblClickWindow = false;\n        }, Global_1.Konva.dblClickWindow);\n        if (shape && shape.isListening()) {\n            this.clickEndShape = shape;\n            shape._fireAndBubble(MOUSEUP, { evt: evt, pointerId: pointerId });\n            if (Global_1.Konva.listenClickTap &&\n                clickStartShape &&\n                clickStartShape._id === shape._id) {\n                shape._fireAndBubble(CLICK, { evt: evt, pointerId: pointerId });\n                if (fireDblClick && clickEndShape && clickEndShape === shape) {\n                    shape._fireAndBubble(DBL_CLICK, { evt: evt, pointerId: pointerId });\n                }\n            }\n        }\n        else {\n            this._fire(MOUSEUP, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: pointerId\n            });\n            if (Global_1.Konva.listenClickTap) {\n                this._fire(CLICK, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: pointerId\n                });\n            }\n            if (fireDblClick) {\n                this._fire(DBL_CLICK, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: pointerId\n                });\n            }\n        }\n        this._fire(CONTENT_MOUSEUP, { evt: evt });\n        if (Global_1.Konva.listenClickTap) {\n            this._fire(CONTENT_CLICK, { evt: evt });\n            if (fireDblClick) {\n                this._fire(CONTENT_DBL_CLICK, { evt: evt });\n            }\n        }\n        Global_1.Konva.listenClickTap = false;\n        if (evt.cancelable) {\n            evt.preventDefault();\n        }\n    };\n    Stage.prototype._contextmenu = function (evt) {\n        this.setPointersPositions(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        if (shape && shape.isListening()) {\n            shape._fireAndBubble(CONTEXTMENU, { evt: evt });\n        }\n        else {\n            this._fire(CONTEXTMENU, {\n                evt: evt,\n                target: this,\n                currentTarget: this\n            });\n        }\n        this._fire(CONTENT_CONTEXTMENU, { evt: evt });\n    };\n    Stage.prototype._touchstart = function (evt) {\n        var _this = this;\n        this.setPointersPositions(evt);\n        var triggeredOnShape = false;\n        this._changedPointerPositions.forEach(function (pos) {\n            var shape = _this.getIntersection(pos);\n            Global_1.Konva.listenClickTap = true;\n            DragAndDrop_1.DD.justDragged = false;\n            var hasShape = shape && shape.isListening();\n            if (!hasShape) {\n                return;\n            }\n            if (Global_1.Konva.captureTouchEventsEnabled) {\n                shape.setPointerCapture(pos.id);\n            }\n            _this.tapStartShape = shape;\n            shape._fireAndBubble(TOUCHSTART, { evt: evt, pointerId: pos.id }, _this);\n            triggeredOnShape = true;\n            if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n                evt.preventDefault();\n            }\n        });\n        if (!triggeredOnShape) {\n            this._fire(TOUCHSTART, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id\n            });\n        }\n        this._fire(CONTENT_TOUCHSTART, { evt: evt });\n    };\n    Stage.prototype._touchmove = function (evt) {\n        var _this = this;\n        this.setPointersPositions(evt);\n        var eventsEnabled = !DragAndDrop_1.DD.isDragging || Global_1.Konva.hitOnDragEnabled;\n        if (eventsEnabled) {\n            var triggeredOnShape = false;\n            var processedShapesIds = {};\n            this._changedPointerPositions.forEach(function (pos) {\n                var shape = PointerEvents.getCapturedShape(pos.id) || _this.getIntersection(pos);\n                var hasShape = shape && shape.isListening();\n                if (!hasShape) {\n                    return;\n                }\n                if (processedShapesIds[shape._id]) {\n                    return;\n                }\n                processedShapesIds[shape._id] = true;\n                shape._fireAndBubble(TOUCHMOVE, { evt: evt, pointerId: pos.id });\n                triggeredOnShape = true;\n                if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n                    evt.preventDefault();\n                }\n            });\n            if (!triggeredOnShape) {\n                this._fire(TOUCHMOVE, {\n                    evt: evt,\n                    target: this,\n                    currentTarget: this,\n                    pointerId: this._changedPointerPositions[0].id\n                });\n            }\n            this._fire(CONTENT_TOUCHMOVE, { evt: evt });\n        }\n        if (DragAndDrop_1.DD.isDragging && DragAndDrop_1.DD.node.preventDefault() && evt.cancelable) {\n            evt.preventDefault();\n        }\n    };\n    Stage.prototype._touchend = function (evt) {\n        var _this = this;\n        this.setPointersPositions(evt);\n        var clickEndShape = this.clickEndShape, fireDblClick = false;\n        if (Global_1.Konva.inDblClickWindow) {\n            fireDblClick = true;\n            clearTimeout(this.dblTimeout);\n        }\n        else if (!DragAndDrop_1.DD.justDragged) {\n            Global_1.Konva.inDblClickWindow = true;\n            clearTimeout(this.dblTimeout);\n        }\n        this.dblTimeout = setTimeout(function () {\n            Global_1.Konva.inDblClickWindow = false;\n        }, Global_1.Konva.dblClickWindow);\n        var triggeredOnShape = false;\n        var processedShapesIds = {};\n        var tapTriggered = false;\n        var dblTapTriggered = false;\n        this._changedPointerPositions.forEach(function (pos) {\n            var shape = PointerEvents.getCapturedShape(pos.id) ||\n                _this.getIntersection(pos);\n            if (shape) {\n                shape.releaseCapture(pos.id);\n            }\n            var hasShape = shape && shape.isListening();\n            if (!hasShape) {\n                return;\n            }\n            if (processedShapesIds[shape._id]) {\n                return;\n            }\n            processedShapesIds[shape._id] = true;\n            _this.clickEndShape = shape;\n            shape._fireAndBubble(TOUCHEND, { evt: evt, pointerId: pos.id });\n            triggeredOnShape = true;\n            if (Global_1.Konva.listenClickTap && shape === _this.tapStartShape) {\n                tapTriggered = true;\n                shape._fireAndBubble(TAP, { evt: evt, pointerId: pos.id });\n                if (fireDblClick && clickEndShape && clickEndShape === shape) {\n                    dblTapTriggered = true;\n                    shape._fireAndBubble(DBL_TAP, { evt: evt, pointerId: pos.id });\n                }\n            }\n            if (shape.isListening() && shape.preventDefault() && evt.cancelable) {\n                evt.preventDefault();\n            }\n        });\n        if (!triggeredOnShape) {\n            this._fire(TOUCHEND, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id\n            });\n        }\n        if (Global_1.Konva.listenClickTap && !tapTriggered) {\n            this._fire(TAP, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id\n            });\n        }\n        if (fireDblClick && !dblTapTriggered) {\n            this._fire(DBL_TAP, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id\n            });\n        }\n        this._fire(CONTENT_TOUCHEND, { evt: evt });\n        if (Global_1.Konva.listenClickTap) {\n            this._fire(CONTENT_TAP, { evt: evt });\n            if (fireDblClick) {\n                this._fire(CONTENT_DBL_TAP, { evt: evt });\n            }\n        }\n        Global_1.Konva.listenClickTap = false;\n    };\n    Stage.prototype._wheel = function (evt) {\n        this.setPointersPositions(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        if (shape && shape.isListening()) {\n            shape._fireAndBubble(WHEEL, { evt: evt });\n        }\n        else {\n            this._fire(WHEEL, {\n                evt: evt,\n                target: this,\n                currentTarget: this\n            });\n        }\n        this._fire(CONTENT_WHEEL, { evt: evt });\n    };\n    Stage.prototype._pointerdown = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERDOWN, PointerEvents.createEvent(evt));\n        }\n    };\n    Stage.prototype._pointermove = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERMOVE, PointerEvents.createEvent(evt));\n        }\n    };\n    Stage.prototype._pointerup = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n        }\n        PointerEvents.releaseCapture(evt.pointerId);\n    };\n    Stage.prototype._pointercancel = function (evt) {\n        if (!Global_1.Konva._pointerEventsEnabled) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n        }\n        PointerEvents.releaseCapture(evt.pointerId);\n    };\n    Stage.prototype._lostpointercapture = function (evt) {\n        PointerEvents.releaseCapture(evt.pointerId);\n    };\n    Stage.prototype.setPointersPositions = function (evt) {\n        var _this = this;\n        var contentPosition = this._getContentPosition(), x = null, y = null;\n        evt = evt ? evt : window.event;\n        if (evt.touches !== undefined) {\n            this._pointerPositions = [];\n            this._changedPointerPositions = [];\n            Util_1.Collection.prototype.each.call(evt.touches, function (touch) {\n                _this._pointerPositions.push({\n                    id: touch.identifier,\n                    x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n                    y: (touch.clientY - contentPosition.top) / contentPosition.scaleY\n                });\n            });\n            Util_1.Collection.prototype.each.call(evt.changedTouches || evt.touches, function (touch) {\n                _this._changedPointerPositions.push({\n                    id: touch.identifier,\n                    x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n                    y: (touch.clientY - contentPosition.top) / contentPosition.scaleY\n                });\n            });\n        }\n        else {\n            x = (evt.clientX - contentPosition.left) / contentPosition.scaleX;\n            y = (evt.clientY - contentPosition.top) / contentPosition.scaleY;\n            this.pointerPos = {\n                x: x,\n                y: y\n            };\n            this._pointerPositions = [{ x: x, y: y, id: Util_1.Util._getFirstPointerId(evt) }];\n            this._changedPointerPositions = [\n                { x: x, y: y, id: Util_1.Util._getFirstPointerId(evt) }\n            ];\n        }\n    };\n    Stage.prototype._setPointerPosition = function (evt) {\n        Util_1.Util.warn('Method _setPointerPosition is deprecated. Use \"stage.setPointersPositions(event)\" instead.');\n        this.setPointersPositions(evt);\n    };\n    Stage.prototype._getContentPosition = function () {\n        if (!this.content || !this.content.getBoundingClientRect) {\n            return {\n                top: 0,\n                left: 0,\n                scaleX: 1,\n                scaleY: 1\n            };\n        }\n        var rect = this.content.getBoundingClientRect();\n        return {\n            top: rect.top,\n            left: rect.left,\n            scaleX: rect.width / this.content.clientWidth || 1,\n            scaleY: rect.height / this.content.clientHeight || 1\n        };\n    };\n    Stage.prototype._buildDOM = function () {\n        this.bufferCanvas = new Canvas_1.SceneCanvas({\n            width: this.width(),\n            height: this.height()\n        });\n        this.bufferHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1,\n            width: this.width(),\n            height: this.height()\n        });\n        if (!Global_1.Konva.isBrowser) {\n            return;\n        }\n        var container = this.container();\n        if (!container) {\n            throw 'Stage has no container. A container is required.';\n        }\n        container.innerHTML = EMPTY_STRING;\n        this.content = document.createElement('div');\n        this.content.style.position = RELATIVE;\n        this.content.style.userSelect = 'none';\n        this.content.className = KONVA_CONTENT;\n        this.content.setAttribute('role', 'presentation');\n        container.appendChild(this.content);\n        this._resizeDOM();\n    };\n    Stage.prototype.cache = function () {\n        Util_1.Util.warn('Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.');\n        return this;\n    };\n    Stage.prototype.clearCache = function () {\n        return this;\n    };\n    Stage.prototype.batchDraw = function () {\n        this.children.each(function (layer) {\n            layer.batchDraw();\n        });\n        return this;\n    };\n    return Stage;\n}(Container_1.Container));\nexports.Stage = Stage;\nStage.prototype.nodeType = STAGE;\nGlobal_2._registerNode(Stage);\nFactory_1.Factory.addGetterSetter(Stage, 'container');\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Container_1 = require(\"./Container\");\nvar Node_1 = require(\"./Node\");\nvar Factory_1 = require(\"./Factory\");\nvar Canvas_1 = require(\"./Canvas\");\nvar BaseLayer = (function (_super) {\n    __extends(BaseLayer, _super);\n    function BaseLayer(config) {\n        var _this = _super.call(this, config) || this;\n        _this.canvas = new Canvas_1.SceneCanvas();\n        _this._waitingForDraw = false;\n        _this.on('visibleChange', _this._checkVisibility);\n        _this._checkVisibility();\n        _this.on('imageSmoothingEnabledChange', _this._checkSmooth);\n        _this._checkSmooth();\n        return _this;\n    }\n    BaseLayer.prototype.createPNGStream = function () {\n        var c = this.canvas._canvas;\n        return c.createPNGStream();\n    };\n    BaseLayer.prototype.getCanvas = function () {\n        return this.canvas;\n    };\n    BaseLayer.prototype.getHitCanvas = function () {\n        return this.hitCanvas;\n    };\n    BaseLayer.prototype.getContext = function () {\n        return this.getCanvas().getContext();\n    };\n    BaseLayer.prototype.clear = function (bounds) {\n        this.getContext().clear(bounds);\n        return this;\n    };\n    BaseLayer.prototype.setZIndex = function (index) {\n        _super.prototype.setZIndex.call(this, index);\n        var stage = this.getStage();\n        if (stage) {\n            stage.content.removeChild(this.getCanvas()._canvas);\n            if (index < stage.children.length - 1) {\n                stage.content.insertBefore(this.getCanvas()._canvas, stage.children[index + 1].getCanvas()._canvas);\n            }\n            else {\n                stage.content.appendChild(this.getCanvas()._canvas);\n            }\n        }\n        return this;\n    };\n    BaseLayer.prototype.moveToTop = function () {\n        Node_1.Node.prototype.moveToTop.call(this);\n        var stage = this.getStage();\n        if (stage) {\n            stage.content.removeChild(this.getCanvas()._canvas);\n            stage.content.appendChild(this.getCanvas()._canvas);\n        }\n        return true;\n    };\n    BaseLayer.prototype.moveUp = function () {\n        var moved = Node_1.Node.prototype.moveUp.call(this);\n        if (!moved) {\n            return false;\n        }\n        var stage = this.getStage();\n        if (!stage) {\n            return false;\n        }\n        stage.content.removeChild(this.getCanvas()._canvas);\n        if (this.index < stage.children.length - 1) {\n            stage.content.insertBefore(this.getCanvas()._canvas, stage.children[this.index + 1].getCanvas()._canvas);\n        }\n        else {\n            stage.content.appendChild(this.getCanvas()._canvas);\n        }\n        return true;\n    };\n    BaseLayer.prototype.moveDown = function () {\n        if (Node_1.Node.prototype.moveDown.call(this)) {\n            var stage = this.getStage();\n            if (stage) {\n                var children = stage.children;\n                stage.content.removeChild(this.getCanvas()._canvas);\n                stage.content.insertBefore(this.getCanvas()._canvas, children[this.index + 1].getCanvas()._canvas);\n            }\n            return true;\n        }\n        return false;\n    };\n    BaseLayer.prototype.moveToBottom = function () {\n        if (Node_1.Node.prototype.moveToBottom.call(this)) {\n            var stage = this.getStage();\n            if (stage) {\n                var children = stage.children;\n                stage.content.removeChild(this.getCanvas()._canvas);\n                stage.content.insertBefore(this.getCanvas()._canvas, children[1].getCanvas()._canvas);\n            }\n            return true;\n        }\n        return false;\n    };\n    BaseLayer.prototype.getLayer = function () {\n        return this;\n    };\n    BaseLayer.prototype.hitGraphEnabled = function () {\n        return true;\n    };\n    BaseLayer.prototype.remove = function () {\n        var _canvas = this.getCanvas()._canvas;\n        Node_1.Node.prototype.remove.call(this);\n        if (_canvas && _canvas.parentNode && Util_1.Util._isInDocument(_canvas)) {\n            _canvas.parentNode.removeChild(_canvas);\n        }\n        return this;\n    };\n    BaseLayer.prototype.getStage = function () {\n        return this.parent;\n    };\n    BaseLayer.prototype.setSize = function (_a) {\n        var width = _a.width, height = _a.height;\n        this.canvas.setSize(width, height);\n        return this;\n    };\n    BaseLayer.prototype._toKonvaCanvas = function (config) {\n        config = config || {};\n        config.width = config.width || this.getWidth();\n        config.height = config.height || this.getHeight();\n        config.x = config.x !== undefined ? config.x : this.x();\n        config.y = config.y !== undefined ? config.y : this.y();\n        return Node_1.Node.prototype._toKonvaCanvas.call(this, config);\n    };\n    BaseLayer.prototype._checkVisibility = function () {\n        var visible = this.visible();\n        if (visible) {\n            this.canvas._canvas.style.display = 'block';\n        }\n        else {\n            this.canvas._canvas.style.display = 'none';\n        }\n    };\n    BaseLayer.prototype._checkSmooth = function () {\n        this.getContext()._context.imageSmoothingEnabled = this.imageSmoothingEnabled();\n    };\n    BaseLayer.prototype.getWidth = function () {\n        if (this.parent) {\n            return this.parent.width();\n        }\n    };\n    BaseLayer.prototype.setWidth = function () {\n        Util_1.Util.warn('Can not change width of layer. Use \"stage.width(value)\" function instead.');\n    };\n    BaseLayer.prototype.getHeight = function () {\n        if (this.parent) {\n            return this.parent.height();\n        }\n    };\n    BaseLayer.prototype.setHeight = function () {\n        Util_1.Util.warn('Can not change height of layer. Use \"stage.height(value)\" function instead.');\n    };\n    BaseLayer.prototype.getIntersection = function (pos, selector) {\n        return null;\n    };\n    BaseLayer.prototype.batchDraw = function () {\n        var _this = this;\n        if (!this._waitingForDraw) {\n            this._waitingForDraw = true;\n            Util_1.Util.requestAnimFrame(function () {\n                _this.draw();\n                _this._waitingForDraw = false;\n            });\n        }\n        return this;\n    };\n    BaseLayer.prototype._applyTransform = function (shape, context, top) {\n        var m = shape.getAbsoluteTransform(top).getMatrix();\n        context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n    };\n    return BaseLayer;\n}(Container_1.Container));\nexports.BaseLayer = BaseLayer;\nBaseLayer.prototype.nodeType = 'BaseLayer';\nFactory_1.Factory.addGetterSetter(BaseLayer, 'imageSmoothingEnabled', true);\nFactory_1.Factory.addGetterSetter(BaseLayer, 'clearBeforeDraw', true);\nUtil_1.Collection.mapMethods(BaseLayer);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Node_1 = require(\"./Node\");\nvar Validators_1 = require(\"./Validators\");\nvar Global_1 = require(\"./Global\");\nvar PointerEvents = require(\"./PointerEvents\");\nvar HAS_SHADOW = 'hasShadow';\nvar SHADOW_RGBA = 'shadowRGBA';\nvar patternImage = 'patternImage';\nvar linearGradient = 'linearGradient';\nvar radialGradient = 'radialGradient';\nvar dummyContext;\nfunction getDummyContext() {\n    if (dummyContext) {\n        return dummyContext;\n    }\n    dummyContext = Util_1.Util.createCanvasElement().getContext('2d');\n    return dummyContext;\n}\nexports.shapes = {};\nfunction _fillFunc(context) {\n    context.fill();\n}\nfunction _strokeFunc(context) {\n    context.stroke();\n}\nfunction _fillFuncHit(context) {\n    context.fill();\n}\nfunction _strokeFuncHit(context) {\n    context.stroke();\n}\nfunction _clearHasShadowCache() {\n    this._clearCache(HAS_SHADOW);\n}\nfunction _clearGetShadowRGBACache() {\n    this._clearCache(SHADOW_RGBA);\n}\nfunction _clearFillPatternCache() {\n    this._clearCache(patternImage);\n}\nfunction _clearLinearGradientCache() {\n    this._clearCache(linearGradient);\n}\nfunction _clearRadialGradientCache() {\n    this._clearCache(radialGradient);\n}\nvar Shape = (function (_super) {\n    __extends(Shape, _super);\n    function Shape(config) {\n        var _this = _super.call(this, config) || this;\n        var key;\n        while (true) {\n            key = Util_1.Util.getRandomColor();\n            if (key && !(key in exports.shapes)) {\n                break;\n            }\n        }\n        _this.colorKey = key;\n        exports.shapes[key] = _this;\n        _this.on('shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva', _clearHasShadowCache);\n        _this.on('shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva', _clearGetShadowRGBACache);\n        _this.on('fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva', _clearFillPatternCache);\n        _this.on('fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva', _clearLinearGradientCache);\n        _this.on('fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva', _clearRadialGradientCache);\n        return _this;\n    }\n    Shape.prototype.getContext = function () {\n        return this.getLayer().getContext();\n    };\n    Shape.prototype.getCanvas = function () {\n        return this.getLayer().getCanvas();\n    };\n    Shape.prototype.getSceneFunc = function () {\n        return this.attrs.sceneFunc || this['_sceneFunc'];\n    };\n    Shape.prototype.getHitFunc = function () {\n        return this.attrs.hitFunc || this['_hitFunc'];\n    };\n    Shape.prototype.hasShadow = function () {\n        return this._getCache(HAS_SHADOW, this._hasShadow);\n    };\n    Shape.prototype._hasShadow = function () {\n        return (this.shadowEnabled() &&\n            this.shadowOpacity() !== 0 &&\n            !!(this.shadowColor() ||\n                this.shadowBlur() ||\n                this.shadowOffsetX() ||\n                this.shadowOffsetY()));\n    };\n    Shape.prototype._getFillPattern = function () {\n        return this._getCache(patternImage, this.__getFillPattern);\n    };\n    Shape.prototype.__getFillPattern = function () {\n        if (this.fillPatternImage()) {\n            var ctx = getDummyContext();\n            var pattern = ctx.createPattern(this.fillPatternImage(), this.fillPatternRepeat() || 'repeat');\n            return pattern;\n        }\n    };\n    Shape.prototype._getLinearGradient = function () {\n        return this._getCache(linearGradient, this.__getLinearGradient);\n    };\n    Shape.prototype.__getLinearGradient = function () {\n        var colorStops = this.fillLinearGradientColorStops();\n        if (colorStops) {\n            var ctx = getDummyContext();\n            var start = this.fillLinearGradientStartPoint();\n            var end = this.fillLinearGradientEndPoint();\n            var grd = ctx.createLinearGradient(start.x, start.y, end.x, end.y);\n            for (var n = 0; n < colorStops.length; n += 2) {\n                grd.addColorStop(colorStops[n], colorStops[n + 1]);\n            }\n            return grd;\n        }\n    };\n    Shape.prototype._getRadialGradient = function () {\n        return this._getCache(radialGradient, this.__getRadialGradient);\n    };\n    Shape.prototype.__getRadialGradient = function () {\n        var colorStops = this.fillRadialGradientColorStops();\n        if (colorStops) {\n            var ctx = getDummyContext();\n            var start = this.fillRadialGradientStartPoint();\n            var end = this.fillRadialGradientEndPoint();\n            var grd = ctx.createRadialGradient(start.x, start.y, this.fillRadialGradientStartRadius(), end.x, end.y, this.fillRadialGradientEndRadius());\n            for (var n = 0; n < colorStops.length; n += 2) {\n                grd.addColorStop(colorStops[n], colorStops[n + 1]);\n            }\n            return grd;\n        }\n    };\n    Shape.prototype.getShadowRGBA = function () {\n        return this._getCache(SHADOW_RGBA, this._getShadowRGBA);\n    };\n    Shape.prototype._getShadowRGBA = function () {\n        if (this.hasShadow()) {\n            var rgba = Util_1.Util.colorToRGBA(this.shadowColor());\n            return ('rgba(' +\n                rgba.r +\n                ',' +\n                rgba.g +\n                ',' +\n                rgba.b +\n                ',' +\n                rgba.a * (this.shadowOpacity() || 1) +\n                ')');\n        }\n    };\n    Shape.prototype.hasFill = function () {\n        return (this.fillEnabled() &&\n            !!(this.fill() ||\n                this.fillPatternImage() ||\n                this.fillLinearGradientColorStops() ||\n                this.fillRadialGradientColorStops()));\n    };\n    Shape.prototype.hasStroke = function () {\n        return (this.strokeEnabled() &&\n            this.strokeWidth() &&\n            !!(this.stroke() || this.strokeLinearGradientColorStops()));\n    };\n    Shape.prototype.hasHitStroke = function () {\n        var width = this.hitStrokeWidth();\n        if (width === 'auto') {\n            return this.hasStroke();\n        }\n        return this.strokeEnabled() && !!width;\n    };\n    Shape.prototype.intersects = function (point) {\n        var stage = this.getStage(), bufferHitCanvas = stage.bufferHitCanvas, p;\n        bufferHitCanvas.getContext().clear();\n        this.drawHit(bufferHitCanvas);\n        p = bufferHitCanvas.context.getImageData(Math.round(point.x), Math.round(point.y), 1, 1).data;\n        return p[3] > 0;\n    };\n    Shape.prototype.destroy = function () {\n        Node_1.Node.prototype.destroy.call(this);\n        delete exports.shapes[this.colorKey];\n        delete this.colorKey;\n        return this;\n    };\n    Shape.prototype._useBufferCanvas = function (caching) {\n        return !!((!caching || this.hasShadow()) &&\n            this.perfectDrawEnabled() &&\n            this.getAbsoluteOpacity() !== 1 &&\n            this.hasFill() &&\n            this.hasStroke() &&\n            this.getStage());\n    };\n    Shape.prototype.setStrokeHitEnabled = function (val) {\n        Util_1.Util.warn('strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead.');\n        if (val) {\n            this.hitStrokeWidth('auto');\n        }\n        else {\n            this.hitStrokeWidth(0);\n        }\n    };\n    Shape.prototype.getStrokeHitEnabled = function () {\n        if (this.hitStrokeWidth() === 0) {\n            return false;\n        }\n        else {\n            return true;\n        }\n    };\n    Shape.prototype.getSelfRect = function () {\n        var size = this.size();\n        return {\n            x: this._centroid ? -size.width / 2 : 0,\n            y: this._centroid ? -size.height / 2 : 0,\n            width: size.width,\n            height: size.height\n        };\n    };\n    Shape.prototype.getClientRect = function (attrs) {\n        attrs = attrs || {};\n        var skipTransform = attrs.skipTransform;\n        var relativeTo = attrs.relativeTo;\n        var fillRect = this.getSelfRect();\n        var applyStroke = !attrs.skipStroke && this.hasStroke();\n        var strokeWidth = (applyStroke && this.strokeWidth()) || 0;\n        var fillAndStrokeWidth = fillRect.width + strokeWidth;\n        var fillAndStrokeHeight = fillRect.height + strokeWidth;\n        var applyShadow = !attrs.skipShadow && this.hasShadow();\n        var shadowOffsetX = applyShadow ? this.shadowOffsetX() : 0;\n        var shadowOffsetY = applyShadow ? this.shadowOffsetY() : 0;\n        var preWidth = fillAndStrokeWidth + Math.abs(shadowOffsetX);\n        var preHeight = fillAndStrokeHeight + Math.abs(shadowOffsetY);\n        var blurRadius = (applyShadow && this.shadowBlur()) || 0;\n        var width = preWidth + blurRadius * 2;\n        var height = preHeight + blurRadius * 2;\n        var roundingOffset = 0;\n        if (Math.round(strokeWidth / 2) !== strokeWidth / 2) {\n            roundingOffset = 1;\n        }\n        var rect = {\n            width: width + roundingOffset,\n            height: height + roundingOffset,\n            x: -Math.round(strokeWidth / 2 + blurRadius) +\n                Math.min(shadowOffsetX, 0) +\n                fillRect.x,\n            y: -Math.round(strokeWidth / 2 + blurRadius) +\n                Math.min(shadowOffsetY, 0) +\n                fillRect.y\n        };\n        if (!skipTransform) {\n            return this._transformedRect(rect, relativeTo);\n        }\n        return rect;\n    };\n    Shape.prototype.drawScene = function (can, top, caching, skipBuffer) {\n        var layer = this.getLayer(), canvas = can || layer.getCanvas(), context = canvas.getContext(), cachedCanvas = this._getCanvasCache(), drawFunc = this.sceneFunc(), hasShadow = this.hasShadow(), hasStroke = this.hasStroke(), stage, bufferCanvas, bufferContext;\n        if (!this.isVisible() && !caching) {\n            return this;\n        }\n        if (cachedCanvas) {\n            context.save();\n            layer._applyTransform(this, context, top);\n            this._drawCachedSceneCanvas(context);\n            context.restore();\n            return this;\n        }\n        if (!drawFunc) {\n            return this;\n        }\n        context.save();\n        if (this._useBufferCanvas(caching) && !skipBuffer) {\n            stage = this.getStage();\n            bufferCanvas = stage.bufferCanvas;\n            bufferContext = bufferCanvas.getContext();\n            bufferContext.clear();\n            bufferContext.save();\n            bufferContext._applyLineJoin(this);\n            if (!caching) {\n                if (layer) {\n                    layer._applyTransform(this, bufferContext, top);\n                }\n                else {\n                    var m = this.getAbsoluteTransform(top).getMatrix();\n                    context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n                }\n            }\n            drawFunc.call(this, bufferContext, this);\n            bufferContext.restore();\n            var ratio = bufferCanvas.pixelRatio;\n            if (hasShadow && !canvas.hitCanvas) {\n                context.save();\n                context._applyShadow(this);\n                context._applyOpacity(this);\n                context._applyGlobalCompositeOperation(this);\n                context.drawImage(bufferCanvas._canvas, 0, 0, bufferCanvas.width / ratio, bufferCanvas.height / ratio);\n                context.restore();\n            }\n            else {\n                context._applyOpacity(this);\n                context._applyGlobalCompositeOperation(this);\n                context.drawImage(bufferCanvas._canvas, 0, 0, bufferCanvas.width / ratio, bufferCanvas.height / ratio);\n            }\n        }\n        else {\n            context._applyLineJoin(this);\n            if (!caching) {\n                if (layer) {\n                    layer._applyTransform(this, context, top);\n                }\n                else {\n                    var o = this.getAbsoluteTransform(top).getMatrix();\n                    context.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n                }\n            }\n            if (hasShadow && hasStroke && !canvas.hitCanvas) {\n                context.save();\n                if (!caching) {\n                    context._applyOpacity(this);\n                    context._applyGlobalCompositeOperation(this);\n                }\n                context._applyShadow(this);\n                drawFunc.call(this, context, this);\n                context.restore();\n                if (this.hasFill() && this.shadowForStrokeEnabled()) {\n                    drawFunc.call(this, context, this);\n                }\n            }\n            else if (hasShadow && !canvas.hitCanvas) {\n                context.save();\n                if (!caching) {\n                    context._applyOpacity(this);\n                    context._applyGlobalCompositeOperation(this);\n                }\n                context._applyShadow(this);\n                drawFunc.call(this, context, this);\n                context.restore();\n            }\n            else {\n                if (!caching) {\n                    context._applyOpacity(this);\n                    context._applyGlobalCompositeOperation(this);\n                }\n                drawFunc.call(this, context, this);\n            }\n        }\n        context.restore();\n        return this;\n    };\n    Shape.prototype.drawHit = function (can, top, caching) {\n        var layer = this.getLayer(), canvas = can || layer.hitCanvas, context = canvas && canvas.getContext(), drawFunc = this.hitFunc() || this.sceneFunc(), cachedCanvas = this._getCanvasCache(), cachedHitCanvas = cachedCanvas && cachedCanvas.hit;\n        if (!this.colorKey) {\n            console.log(this);\n            Util_1.Util.warn('Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()');\n        }\n        if (!this.shouldDrawHit() && !caching) {\n            return this;\n        }\n        if (cachedHitCanvas) {\n            context.save();\n            layer._applyTransform(this, context, top);\n            this._drawCachedHitCanvas(context);\n            context.restore();\n            return this;\n        }\n        if (!drawFunc) {\n            return this;\n        }\n        context.save();\n        context._applyLineJoin(this);\n        if (!caching) {\n            if (layer) {\n                layer._applyTransform(this, context, top);\n            }\n            else {\n                var o = this.getAbsoluteTransform(top).getMatrix();\n                context.transform(o[0], o[1], o[2], o[3], o[4], o[5]);\n            }\n        }\n        drawFunc.call(this, context, this);\n        context.restore();\n        return this;\n    };\n    Shape.prototype.drawHitFromCache = function (alphaThreshold) {\n        if (alphaThreshold === void 0) { alphaThreshold = 0; }\n        var cachedCanvas = this._getCanvasCache(), sceneCanvas = this._getCachedSceneCanvas(), hitCanvas = cachedCanvas.hit, hitContext = hitCanvas.getContext(), hitWidth = hitCanvas.getWidth(), hitHeight = hitCanvas.getHeight(), hitImageData, hitData, len, rgbColorKey, i, alpha;\n        hitContext.clear();\n        hitContext.drawImage(sceneCanvas._canvas, 0, 0, hitWidth, hitHeight);\n        try {\n            hitImageData = hitContext.getImageData(0, 0, hitWidth, hitHeight);\n            hitData = hitImageData.data;\n            len = hitData.length;\n            rgbColorKey = Util_1.Util._hexToRgb(this.colorKey);\n            for (i = 0; i < len; i += 4) {\n                alpha = hitData[i + 3];\n                if (alpha > alphaThreshold) {\n                    hitData[i] = rgbColorKey.r;\n                    hitData[i + 1] = rgbColorKey.g;\n                    hitData[i + 2] = rgbColorKey.b;\n                    hitData[i + 3] = 255;\n                }\n                else {\n                    hitData[i + 3] = 0;\n                }\n            }\n            hitContext.putImageData(hitImageData, 0, 0);\n        }\n        catch (e) {\n            Util_1.Util.error('Unable to draw hit graph from cached scene canvas. ' + e.message);\n        }\n        return this;\n    };\n    Shape.prototype.hasPointerCapture = function (pointerId) {\n        return PointerEvents.hasPointerCapture(pointerId, this);\n    };\n    Shape.prototype.setPointerCapture = function (pointerId) {\n        PointerEvents.setPointerCapture(pointerId, this);\n    };\n    Shape.prototype.releaseCapture = function (pointerId) {\n        PointerEvents.releaseCapture(pointerId, this);\n    };\n    return Shape;\n}(Node_1.Node));\nexports.Shape = Shape;\nShape.prototype._fillFunc = _fillFunc;\nShape.prototype._strokeFunc = _strokeFunc;\nShape.prototype._fillFuncHit = _fillFuncHit;\nShape.prototype._strokeFuncHit = _strokeFuncHit;\nShape.prototype._centroid = false;\nShape.prototype.nodeType = 'Shape';\nGlobal_1._registerNode(Shape);\nFactory_1.Factory.addGetterSetter(Shape, 'stroke', undefined, Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'strokeWidth', 2, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'hitStrokeWidth', 'auto', Validators_1.getNumberOrAutoValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'strokeHitEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'perfectDrawEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowForStrokeEnabled', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'lineJoin');\nFactory_1.Factory.addGetterSetter(Shape, 'lineCap');\nFactory_1.Factory.addGetterSetter(Shape, 'sceneFunc');\nFactory_1.Factory.addGetterSetter(Shape, 'hitFunc');\nFactory_1.Factory.addGetterSetter(Shape, 'dash');\nFactory_1.Factory.addGetterSetter(Shape, 'dashOffset', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowColor', undefined, Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowBlur', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOpacity', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'shadowOffset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOffsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'shadowOffsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternImage');\nFactory_1.Factory.addGetterSetter(Shape, 'fill', undefined, Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartRadius', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndRadius', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientColorStops');\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternRepeat', 'repeat');\nFactory_1.Factory.addGetterSetter(Shape, 'fillEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'shadowEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'dashEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeScaleEnabled', true);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPriority', 'color');\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillPatternOffset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternOffsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternOffsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillPatternScale', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternScaleX', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternScaleY', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillLinearGradientStartPoint', [\n    'x',\n    'y'\n]);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'strokeLinearGradientStartPoint', [\n    'x',\n    'y'\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientStartPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientStartPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillLinearGradientEndPoint', [\n    'x',\n    'y'\n]);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'strokeLinearGradientEndPoint', [\n    'x',\n    'y'\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillLinearGradientEndPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'strokeLinearGradientEndPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillRadialGradientStartPoint', [\n    'x',\n    'y'\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientStartPointY', 0);\nFactory_1.Factory.addComponentsGetterSetter(Shape, 'fillRadialGradientEndPoint', [\n    'x',\n    'y'\n]);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndPointX', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillRadialGradientEndPointY', 0);\nFactory_1.Factory.addGetterSetter(Shape, 'fillPatternRotation', 0);\nFactory_1.Factory.backCompat(Shape, {\n    dashArray: 'dash',\n    getDashArray: 'getDash',\n    setDashArray: 'getDash',\n    drawFunc: 'sceneFunc',\n    getDrawFunc: 'getSceneFunc',\n    setDrawFunc: 'setSceneFunc',\n    drawHitFunc: 'hitFunc',\n    getDrawHitFunc: 'getHitFunc',\n    setDrawHitFunc: 'setHitFunc'\n});\nUtil_1.Collection.mapMethods(Shape);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Container_1 = require(\"./Container\");\nvar Factory_1 = require(\"./Factory\");\nvar BaseLayer_1 = require(\"./BaseLayer\");\nvar Canvas_1 = require(\"./Canvas\");\nvar Shape_1 = require(\"./Shape\");\nvar Validators_1 = require(\"./Validators\");\nvar Global_1 = require(\"./Global\");\nvar HASH = '#', BEFORE_DRAW = 'beforeDraw', DRAW = 'draw', INTERSECTION_OFFSETS = [\n    { x: 0, y: 0 },\n    { x: -1, y: -1 },\n    { x: 1, y: -1 },\n    { x: 1, y: 1 },\n    { x: -1, y: 1 }\n], INTERSECTION_OFFSETS_LEN = INTERSECTION_OFFSETS.length;\nvar Layer = (function (_super) {\n    __extends(Layer, _super);\n    function Layer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.hitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1\n        });\n        return _this;\n    }\n    Layer.prototype._setCanvasSize = function (width, height) {\n        this.canvas.setSize(width, height);\n        this.hitCanvas.setSize(width, height);\n        this._checkSmooth();\n    };\n    Layer.prototype._validateAdd = function (child) {\n        var type = child.getType();\n        if (type !== 'Group' && type !== 'Shape') {\n            Util_1.Util.throw('You may only add groups and shapes to a layer.');\n        }\n    };\n    Layer.prototype.getIntersection = function (pos, selector) {\n        var obj, i, intersectionOffset, shape;\n        if (!this.hitGraphEnabled() || !this.isVisible()) {\n            return null;\n        }\n        var spiralSearchDistance = 1;\n        var continueSearch = false;\n        while (true) {\n            for (i = 0; i < INTERSECTION_OFFSETS_LEN; i++) {\n                intersectionOffset = INTERSECTION_OFFSETS[i];\n                obj = this._getIntersection({\n                    x: pos.x + intersectionOffset.x * spiralSearchDistance,\n                    y: pos.y + intersectionOffset.y * spiralSearchDistance\n                });\n                shape = obj.shape;\n                if (shape && selector) {\n                    return shape.findAncestor(selector, true);\n                }\n                else if (shape) {\n                    return shape;\n                }\n                continueSearch = !!obj.antialiased;\n                if (!obj.antialiased) {\n                    break;\n                }\n            }\n            if (continueSearch) {\n                spiralSearchDistance += 1;\n            }\n            else {\n                return null;\n            }\n        }\n    };\n    Layer.prototype._getIntersection = function (pos) {\n        var ratio = this.hitCanvas.pixelRatio;\n        var p = this.hitCanvas.context.getImageData(Math.round(pos.x * ratio), Math.round(pos.y * ratio), 1, 1).data, p3 = p[3], colorKey, shape;\n        if (p3 === 255) {\n            colorKey = Util_1.Util._rgbToHex(p[0], p[1], p[2]);\n            shape = Shape_1.shapes[HASH + colorKey];\n            if (shape) {\n                return {\n                    shape: shape\n                };\n            }\n            return {\n                antialiased: true\n            };\n        }\n        else if (p3 > 0) {\n            return {\n                antialiased: true\n            };\n        }\n        return {};\n    };\n    Layer.prototype.drawScene = function (can, top) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.getCanvas());\n        this._fire(BEFORE_DRAW, {\n            node: this\n        });\n        if (this.clearBeforeDraw()) {\n            canvas.getContext().clear();\n        }\n        Container_1.Container.prototype.drawScene.call(this, canvas, top);\n        this._fire(DRAW, {\n            node: this\n        });\n        return this;\n    };\n    Layer.prototype.drawHit = function (can, top) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.hitCanvas);\n        if (layer && layer.clearBeforeDraw()) {\n            layer\n                .getHitCanvas()\n                .getContext()\n                .clear();\n        }\n        Container_1.Container.prototype.drawHit.call(this, canvas, top);\n        return this;\n    };\n    Layer.prototype.clear = function (bounds) {\n        BaseLayer_1.BaseLayer.prototype.clear.call(this, bounds);\n        this.getHitCanvas()\n            .getContext()\n            .clear(bounds);\n        return this;\n    };\n    Layer.prototype.enableHitGraph = function () {\n        this.hitGraphEnabled(true);\n        return this;\n    };\n    Layer.prototype.disableHitGraph = function () {\n        this.hitGraphEnabled(false);\n        return this;\n    };\n    Layer.prototype.toggleHitCanvas = function () {\n        if (!this.parent) {\n            return;\n        }\n        var parent = this.parent;\n        var added = !!this.hitCanvas._canvas.parentNode;\n        if (added) {\n            parent.content.removeChild(this.hitCanvas._canvas);\n        }\n        else {\n            parent.content.appendChild(this.hitCanvas._canvas);\n        }\n    };\n    Layer.prototype.setSize = function (_a) {\n        var width = _a.width, height = _a.height;\n        _super.prototype.setSize.call(this, { width: width, height: height });\n        this.hitCanvas.setSize(width, height);\n        return this;\n    };\n    return Layer;\n}(BaseLayer_1.BaseLayer));\nexports.Layer = Layer;\nLayer.prototype.nodeType = 'Layer';\nGlobal_1._registerNode(Layer);\nFactory_1.Factory.addGetterSetter(Layer, 'hitGraphEnabled', true, Validators_1.getBooleanValidator());\nUtil_1.Collection.mapMethods(Layer);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Container_1 = require(\"./Container\");\nvar BaseLayer_1 = require(\"./BaseLayer\");\nvar Global_1 = require(\"./Global\");\nvar FastLayer = (function (_super) {\n    __extends(FastLayer, _super);\n    function FastLayer() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FastLayer.prototype._validateAdd = function (child) {\n        var type = child.getType();\n        if (type !== 'Shape') {\n            Util_1.Util.throw('You may only add shapes to a fast layer.');\n        }\n    };\n    FastLayer.prototype._setCanvasSize = function (width, height) {\n        this.canvas.setSize(width, height);\n        this._checkSmooth();\n    };\n    FastLayer.prototype.hitGraphEnabled = function () {\n        return false;\n    };\n    FastLayer.prototype.drawScene = function (can) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.getCanvas());\n        if (this.clearBeforeDraw()) {\n            canvas.getContext().clear();\n        }\n        Container_1.Container.prototype.drawScene.call(this, canvas);\n        return this;\n    };\n    FastLayer.prototype.draw = function () {\n        this.drawScene();\n        return this;\n    };\n    return FastLayer;\n}(BaseLayer_1.BaseLayer));\nexports.FastLayer = FastLayer;\nFastLayer.prototype.nodeType = 'FastLayer';\nGlobal_1._registerNode(FastLayer);\nUtil_1.Collection.mapMethods(FastLayer);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Container_1 = require(\"./Container\");\nvar Global_1 = require(\"./Global\");\nvar Group = (function (_super) {\n    __extends(Group, _super);\n    function Group() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Group.prototype._validateAdd = function (child) {\n        var type = child.getType();\n        if (type !== 'Group' && type !== 'Shape') {\n            Util_1.Util.throw('You may only add groups and shapes to groups.');\n        }\n    };\n    return Group;\n}(Container_1.Container));\nexports.Group = Group;\nGroup.prototype.nodeType = 'Group';\nGlobal_1._registerNode(Group);\nUtil_1.Collection.mapMethods(Group);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Global_1 = require(\"./Global\");\nvar now = (function () {\n    if (Global_1.glob.performance && Global_1.glob.performance.now) {\n        return function () {\n            return Global_1.glob.performance.now();\n        };\n    }\n    return function () {\n        return new Date().getTime();\n    };\n})();\nvar Animation = (function () {\n    function Animation(func, layers) {\n        this.id = Animation.animIdCounter++;\n        this.frame = {\n            time: 0,\n            timeDiff: 0,\n            lastTime: now(),\n            frameRate: 0\n        };\n        this.func = func;\n        this.setLayers(layers);\n    }\n    Animation.prototype.setLayers = function (layers) {\n        var lays = [];\n        if (!layers) {\n            lays = [];\n        }\n        else if (layers.length > 0) {\n            lays = layers;\n        }\n        else {\n            lays = [layers];\n        }\n        this.layers = lays;\n        return this;\n    };\n    Animation.prototype.getLayers = function () {\n        return this.layers;\n    };\n    Animation.prototype.addLayer = function (layer) {\n        var layers = this.layers, len = layers.length, n;\n        for (n = 0; n < len; n++) {\n            if (layers[n]._id === layer._id) {\n                return false;\n            }\n        }\n        this.layers.push(layer);\n        return true;\n    };\n    Animation.prototype.isRunning = function () {\n        var a = Animation, animations = a.animations, len = animations.length, n;\n        for (n = 0; n < len; n++) {\n            if (animations[n].id === this.id) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Animation.prototype.start = function () {\n        this.stop();\n        this.frame.timeDiff = 0;\n        this.frame.lastTime = now();\n        Animation._addAnimation(this);\n        return this;\n    };\n    Animation.prototype.stop = function () {\n        Animation._removeAnimation(this);\n        return this;\n    };\n    Animation.prototype._updateFrameObject = function (time) {\n        this.frame.timeDiff = time - this.frame.lastTime;\n        this.frame.lastTime = time;\n        this.frame.time += this.frame.timeDiff;\n        this.frame.frameRate = 1000 / this.frame.timeDiff;\n    };\n    Animation._addAnimation = function (anim) {\n        this.animations.push(anim);\n        this._handleAnimation();\n    };\n    Animation._removeAnimation = function (anim) {\n        var id = anim.id, animations = this.animations, len = animations.length, n;\n        for (n = 0; n < len; n++) {\n            if (animations[n].id === id) {\n                this.animations.splice(n, 1);\n                break;\n            }\n        }\n    };\n    Animation._runFrames = function () {\n        var layerHash = {}, animations = this.animations, anim, layers, func, n, i, layersLen, layer, key, needRedraw;\n        for (n = 0; n < animations.length; n++) {\n            anim = animations[n];\n            layers = anim.layers;\n            func = anim.func;\n            anim._updateFrameObject(now());\n            layersLen = layers.length;\n            if (func) {\n                needRedraw = func.call(anim, anim.frame) !== false;\n            }\n            else {\n                needRedraw = true;\n            }\n            if (!needRedraw) {\n                continue;\n            }\n            for (i = 0; i < layersLen; i++) {\n                layer = layers[i];\n                if (layer._id !== undefined) {\n                    layerHash[layer._id] = layer;\n                }\n            }\n        }\n        for (key in layerHash) {\n            if (!layerHash.hasOwnProperty(key)) {\n                continue;\n            }\n            layerHash[key].draw();\n        }\n    };\n    Animation._animationLoop = function () {\n        var Anim = Animation;\n        if (Anim.animations.length) {\n            Anim._runFrames();\n            requestAnimationFrame(Anim._animationLoop);\n        }\n        else {\n            Anim.animRunning = false;\n        }\n    };\n    Animation._handleAnimation = function () {\n        if (!this.animRunning) {\n            this.animRunning = true;\n            requestAnimationFrame(this._animationLoop);\n        }\n    };\n    Animation.animations = [];\n    Animation.animIdCounter = 0;\n    Animation.animRunning = false;\n    return Animation;\n}());\nexports.Animation = Animation;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Animation_1 = require(\"./Animation\");\nvar Node_1 = require(\"./Node\");\nvar Global_1 = require(\"./Global\");\nvar blacklist = {\n    node: 1,\n    duration: 1,\n    easing: 1,\n    onFinish: 1,\n    yoyo: 1\n}, PAUSED = 1, PLAYING = 2, REVERSING = 3, idCounter = 0, colorAttrs = ['fill', 'stroke', 'shadowColor'];\nvar TweenEngine = (function () {\n    function TweenEngine(prop, propFunc, func, begin, finish, duration, yoyo) {\n        this.prop = prop;\n        this.propFunc = propFunc;\n        this.begin = begin;\n        this._pos = begin;\n        this.duration = duration;\n        this._change = 0;\n        this.prevPos = 0;\n        this.yoyo = yoyo;\n        this._time = 0;\n        this._position = 0;\n        this._startTime = 0;\n        this._finish = 0;\n        this.func = func;\n        this._change = finish - this.begin;\n        this.pause();\n    }\n    TweenEngine.prototype.fire = function (str) {\n        var handler = this[str];\n        if (handler) {\n            handler();\n        }\n    };\n    TweenEngine.prototype.setTime = function (t) {\n        if (t > this.duration) {\n            if (this.yoyo) {\n                this._time = this.duration;\n                this.reverse();\n            }\n            else {\n                this.finish();\n            }\n        }\n        else if (t < 0) {\n            if (this.yoyo) {\n                this._time = 0;\n                this.play();\n            }\n            else {\n                this.reset();\n            }\n        }\n        else {\n            this._time = t;\n            this.update();\n        }\n    };\n    TweenEngine.prototype.getTime = function () {\n        return this._time;\n    };\n    TweenEngine.prototype.setPosition = function (p) {\n        this.prevPos = this._pos;\n        this.propFunc(p);\n        this._pos = p;\n    };\n    TweenEngine.prototype.getPosition = function (t) {\n        if (t === undefined) {\n            t = this._time;\n        }\n        return this.func(t, this.begin, this._change, this.duration);\n    };\n    TweenEngine.prototype.play = function () {\n        this.state = PLAYING;\n        this._startTime = this.getTimer() - this._time;\n        this.onEnterFrame();\n        this.fire('onPlay');\n    };\n    TweenEngine.prototype.reverse = function () {\n        this.state = REVERSING;\n        this._time = this.duration - this._time;\n        this._startTime = this.getTimer() - this._time;\n        this.onEnterFrame();\n        this.fire('onReverse');\n    };\n    TweenEngine.prototype.seek = function (t) {\n        this.pause();\n        this._time = t;\n        this.update();\n        this.fire('onSeek');\n    };\n    TweenEngine.prototype.reset = function () {\n        this.pause();\n        this._time = 0;\n        this.update();\n        this.fire('onReset');\n    };\n    TweenEngine.prototype.finish = function () {\n        this.pause();\n        this._time = this.duration;\n        this.update();\n        this.fire('onFinish');\n    };\n    TweenEngine.prototype.update = function () {\n        this.setPosition(this.getPosition(this._time));\n    };\n    TweenEngine.prototype.onEnterFrame = function () {\n        var t = this.getTimer() - this._startTime;\n        if (this.state === PLAYING) {\n            this.setTime(t);\n        }\n        else if (this.state === REVERSING) {\n            this.setTime(this.duration - t);\n        }\n    };\n    TweenEngine.prototype.pause = function () {\n        this.state = PAUSED;\n        this.fire('onPause');\n    };\n    TweenEngine.prototype.getTimer = function () {\n        return new Date().getTime();\n    };\n    return TweenEngine;\n}());\nvar Tween = (function () {\n    function Tween(config) {\n        var that = this, node = config.node, nodeId = node._id, duration, easing = config.easing || exports.Easings.Linear, yoyo = !!config.yoyo, key;\n        if (typeof config.duration === 'undefined') {\n            duration = 0.3;\n        }\n        else if (config.duration === 0) {\n            duration = 0.001;\n        }\n        else {\n            duration = config.duration;\n        }\n        this.node = node;\n        this._id = idCounter++;\n        var layers = node.getLayer() ||\n            (node instanceof Global_1.Konva['Stage'] ? node.getLayers() : null);\n        if (!layers) {\n            Util_1.Util.error('Tween constructor have `node` that is not in a layer. Please add node into layer first.');\n        }\n        this.anim = new Animation_1.Animation(function () {\n            that.tween.onEnterFrame();\n        }, layers);\n        this.tween = new TweenEngine(key, function (i) {\n            that._tweenFunc(i);\n        }, easing, 0, 1, duration * 1000, yoyo);\n        this._addListeners();\n        if (!Tween.attrs[nodeId]) {\n            Tween.attrs[nodeId] = {};\n        }\n        if (!Tween.attrs[nodeId][this._id]) {\n            Tween.attrs[nodeId][this._id] = {};\n        }\n        if (!Tween.tweens[nodeId]) {\n            Tween.tweens[nodeId] = {};\n        }\n        for (key in config) {\n            if (blacklist[key] === undefined) {\n                this._addAttr(key, config[key]);\n            }\n        }\n        this.reset();\n        this.onFinish = config.onFinish;\n        this.onReset = config.onReset;\n    }\n    Tween.prototype._addAttr = function (key, end) {\n        var node = this.node, nodeId = node._id, start, diff, tweenId, n, len, trueEnd, trueStart, endRGBA;\n        tweenId = Tween.tweens[nodeId][key];\n        if (tweenId) {\n            delete Tween.attrs[nodeId][tweenId][key];\n        }\n        start = node.getAttr(key);\n        if (Util_1.Util._isArray(end)) {\n            diff = [];\n            len = Math.max(end.length, start.length);\n            if (key === 'points' && end.length !== start.length) {\n                if (end.length > start.length) {\n                    trueStart = start;\n                    start = Util_1.Util._prepareArrayForTween(start, end, node.closed());\n                }\n                else {\n                    trueEnd = end;\n                    end = Util_1.Util._prepareArrayForTween(end, start, node.closed());\n                }\n            }\n            if (key.indexOf('fill') === 0) {\n                for (n = 0; n < len; n++) {\n                    if (n % 2 === 0) {\n                        diff.push(end[n] - start[n]);\n                    }\n                    else {\n                        var startRGBA = Util_1.Util.colorToRGBA(start[n]);\n                        endRGBA = Util_1.Util.colorToRGBA(end[n]);\n                        start[n] = startRGBA;\n                        diff.push({\n                            r: endRGBA.r - startRGBA.r,\n                            g: endRGBA.g - startRGBA.g,\n                            b: endRGBA.b - startRGBA.b,\n                            a: endRGBA.a - startRGBA.a\n                        });\n                    }\n                }\n            }\n            else {\n                for (n = 0; n < len; n++) {\n                    diff.push(end[n] - start[n]);\n                }\n            }\n        }\n        else if (colorAttrs.indexOf(key) !== -1) {\n            start = Util_1.Util.colorToRGBA(start);\n            endRGBA = Util_1.Util.colorToRGBA(end);\n            diff = {\n                r: endRGBA.r - start.r,\n                g: endRGBA.g - start.g,\n                b: endRGBA.b - start.b,\n                a: endRGBA.a - start.a\n            };\n        }\n        else {\n            diff = end - start;\n        }\n        Tween.attrs[nodeId][this._id][key] = {\n            start: start,\n            diff: diff,\n            end: end,\n            trueEnd: trueEnd,\n            trueStart: trueStart\n        };\n        Tween.tweens[nodeId][key] = this._id;\n    };\n    Tween.prototype._tweenFunc = function (i) {\n        var node = this.node, attrs = Tween.attrs[node._id][this._id], key, attr, start, diff, newVal, n, len, end;\n        for (key in attrs) {\n            attr = attrs[key];\n            start = attr.start;\n            diff = attr.diff;\n            end = attr.end;\n            if (Util_1.Util._isArray(start)) {\n                newVal = [];\n                len = Math.max(start.length, end.length);\n                if (key.indexOf('fill') === 0) {\n                    for (n = 0; n < len; n++) {\n                        if (n % 2 === 0) {\n                            newVal.push((start[n] || 0) + diff[n] * i);\n                        }\n                        else {\n                            newVal.push('rgba(' +\n                                Math.round(start[n].r + diff[n].r * i) +\n                                ',' +\n                                Math.round(start[n].g + diff[n].g * i) +\n                                ',' +\n                                Math.round(start[n].b + diff[n].b * i) +\n                                ',' +\n                                (start[n].a + diff[n].a * i) +\n                                ')');\n                        }\n                    }\n                }\n                else {\n                    for (n = 0; n < len; n++) {\n                        newVal.push((start[n] || 0) + diff[n] * i);\n                    }\n                }\n            }\n            else if (colorAttrs.indexOf(key) !== -1) {\n                newVal =\n                    'rgba(' +\n                        Math.round(start.r + diff.r * i) +\n                        ',' +\n                        Math.round(start.g + diff.g * i) +\n                        ',' +\n                        Math.round(start.b + diff.b * i) +\n                        ',' +\n                        (start.a + diff.a * i) +\n                        ')';\n            }\n            else {\n                newVal = start + diff * i;\n            }\n            node.setAttr(key, newVal);\n        }\n    };\n    Tween.prototype._addListeners = function () {\n        var _this = this;\n        this.tween.onPlay = function () {\n            _this.anim.start();\n        };\n        this.tween.onReverse = function () {\n            _this.anim.start();\n        };\n        this.tween.onPause = function () {\n            _this.anim.stop();\n        };\n        this.tween.onFinish = function () {\n            var node = _this.node;\n            var attrs = Tween.attrs[node._id][_this._id];\n            if (attrs.points && attrs.points.trueEnd) {\n                node.setAttr('points', attrs.points.trueEnd);\n            }\n            if (_this.onFinish) {\n                _this.onFinish.call(_this);\n            }\n        };\n        this.tween.onReset = function () {\n            var node = _this.node;\n            var attrs = Tween.attrs[node._id][_this._id];\n            if (attrs.points && attrs.points.trueStart) {\n                node.points(attrs.points.trueStart);\n            }\n            if (_this.onReset) {\n                _this.onReset();\n            }\n        };\n    };\n    Tween.prototype.play = function () {\n        this.tween.play();\n        return this;\n    };\n    Tween.prototype.reverse = function () {\n        this.tween.reverse();\n        return this;\n    };\n    Tween.prototype.reset = function () {\n        this.tween.reset();\n        return this;\n    };\n    Tween.prototype.seek = function (t) {\n        this.tween.seek(t * 1000);\n        return this;\n    };\n    Tween.prototype.pause = function () {\n        this.tween.pause();\n        return this;\n    };\n    Tween.prototype.finish = function () {\n        this.tween.finish();\n        return this;\n    };\n    Tween.prototype.destroy = function () {\n        var nodeId = this.node._id, thisId = this._id, attrs = Tween.tweens[nodeId], key;\n        this.pause();\n        for (key in attrs) {\n            delete Tween.tweens[nodeId][key];\n        }\n        delete Tween.attrs[nodeId][thisId];\n    };\n    Tween.attrs = {};\n    Tween.tweens = {};\n    return Tween;\n}());\nexports.Tween = Tween;\nNode_1.Node.prototype.to = function (params) {\n    var onFinish = params.onFinish;\n    params.node = this;\n    params.onFinish = function () {\n        this.destroy();\n        if (onFinish) {\n            onFinish();\n        }\n    };\n    var tween = new Tween(params);\n    tween.play();\n};\nexports.Easings = {\n    BackEaseIn: function (t, b, c, d) {\n        var s = 1.70158;\n        return c * (t /= d) * t * ((s + 1) * t - s) + b;\n    },\n    BackEaseOut: function (t, b, c, d) {\n        var s = 1.70158;\n        return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n    },\n    BackEaseInOut: function (t, b, c, d) {\n        var s = 1.70158;\n        if ((t /= d / 2) < 1) {\n            return (c / 2) * (t * t * (((s *= 1.525) + 1) * t - s)) + b;\n        }\n        return (c / 2) * ((t -= 2) * t * (((s *= 1.525) + 1) * t + s) + 2) + b;\n    },\n    ElasticEaseIn: function (t, b, c, d, a, p) {\n        var s = 0;\n        if (t === 0) {\n            return b;\n        }\n        if ((t /= d) === 1) {\n            return b + c;\n        }\n        if (!p) {\n            p = d * 0.3;\n        }\n        if (!a || a < Math.abs(c)) {\n            a = c;\n            s = p / 4;\n        }\n        else {\n            s = (p / (2 * Math.PI)) * Math.asin(c / a);\n        }\n        return (-(a *\n            Math.pow(2, 10 * (t -= 1)) *\n            Math.sin(((t * d - s) * (2 * Math.PI)) / p)) + b);\n    },\n    ElasticEaseOut: function (t, b, c, d, a, p) {\n        var s = 0;\n        if (t === 0) {\n            return b;\n        }\n        if ((t /= d) === 1) {\n            return b + c;\n        }\n        if (!p) {\n            p = d * 0.3;\n        }\n        if (!a || a < Math.abs(c)) {\n            a = c;\n            s = p / 4;\n        }\n        else {\n            s = (p / (2 * Math.PI)) * Math.asin(c / a);\n        }\n        return (a * Math.pow(2, -10 * t) * Math.sin(((t * d - s) * (2 * Math.PI)) / p) +\n            c +\n            b);\n    },\n    ElasticEaseInOut: function (t, b, c, d, a, p) {\n        var s = 0;\n        if (t === 0) {\n            return b;\n        }\n        if ((t /= d / 2) === 2) {\n            return b + c;\n        }\n        if (!p) {\n            p = d * (0.3 * 1.5);\n        }\n        if (!a || a < Math.abs(c)) {\n            a = c;\n            s = p / 4;\n        }\n        else {\n            s = (p / (2 * Math.PI)) * Math.asin(c / a);\n        }\n        if (t < 1) {\n            return (-0.5 *\n                (a *\n                    Math.pow(2, 10 * (t -= 1)) *\n                    Math.sin(((t * d - s) * (2 * Math.PI)) / p)) +\n                b);\n        }\n        return (a *\n            Math.pow(2, -10 * (t -= 1)) *\n            Math.sin(((t * d - s) * (2 * Math.PI)) / p) *\n            0.5 +\n            c +\n            b);\n    },\n    BounceEaseOut: function (t, b, c, d) {\n        if ((t /= d) < 1 / 2.75) {\n            return c * (7.5625 * t * t) + b;\n        }\n        else if (t < 2 / 2.75) {\n            return c * (7.5625 * (t -= 1.5 / 2.75) * t + 0.75) + b;\n        }\n        else if (t < 2.5 / 2.75) {\n            return c * (7.5625 * (t -= 2.25 / 2.75) * t + 0.9375) + b;\n        }\n        else {\n            return c * (7.5625 * (t -= 2.625 / 2.75) * t + 0.984375) + b;\n        }\n    },\n    BounceEaseIn: function (t, b, c, d) {\n        return c - exports.Easings.BounceEaseOut(d - t, 0, c, d) + b;\n    },\n    BounceEaseInOut: function (t, b, c, d) {\n        if (t < d / 2) {\n            return exports.Easings.BounceEaseIn(t * 2, 0, c, d) * 0.5 + b;\n        }\n        else {\n            return exports.Easings.BounceEaseOut(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n        }\n    },\n    EaseIn: function (t, b, c, d) {\n        return c * (t /= d) * t + b;\n    },\n    EaseOut: function (t, b, c, d) {\n        return -c * (t /= d) * (t - 2) + b;\n    },\n    EaseInOut: function (t, b, c, d) {\n        if ((t /= d / 2) < 1) {\n            return (c / 2) * t * t + b;\n        }\n        return (-c / 2) * (--t * (t - 2) - 1) + b;\n    },\n    StrongEaseIn: function (t, b, c, d) {\n        return c * (t /= d) * t * t * t * t + b;\n    },\n    StrongEaseOut: function (t, b, c, d) {\n        return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n    },\n    StrongEaseInOut: function (t, b, c, d) {\n        if ((t /= d / 2) < 1) {\n            return (c / 2) * t * t * t * t * t + b;\n        }\n        return (c / 2) * ((t -= 2) * t * t * t * t + 2) + b;\n    },\n    Linear: function (t, b, c, d) {\n        return (c * t) / d + b;\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Global_1 = require(\"./Global\");\nvar Util_1 = require(\"./Util\");\nvar Node_1 = require(\"./Node\");\nvar Container_1 = require(\"./Container\");\nvar Stage_1 = require(\"./Stage\");\nvar Layer_1 = require(\"./Layer\");\nvar FastLayer_1 = require(\"./FastLayer\");\nvar Group_1 = require(\"./Group\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Shape_1 = require(\"./Shape\");\nvar Animation_1 = require(\"./Animation\");\nvar Tween_1 = require(\"./Tween\");\nvar Context_1 = require(\"./Context\");\nvar Canvas_1 = require(\"./Canvas\");\nexports.Konva = Util_1.Util._assign(Global_1.Konva, {\n    Collection: Util_1.Collection,\n    Util: Util_1.Util,\n    Transform: Util_1.Transform,\n    Node: Node_1.Node,\n    ids: Node_1.ids,\n    names: Node_1.names,\n    Container: Container_1.Container,\n    Stage: Stage_1.Stage,\n    stages: Stage_1.stages,\n    Layer: Layer_1.Layer,\n    FastLayer: FastLayer_1.FastLayer,\n    Group: Group_1.Group,\n    DD: DragAndDrop_1.DD,\n    Shape: Shape_1.Shape,\n    shapes: Shape_1.shapes,\n    Animation: Animation_1.Animation,\n    Tween: Tween_1.Tween,\n    Easings: Tween_1.Easings,\n    Context: Context_1.Context,\n    Canvas: Canvas_1.Canvas\n});\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Global_1 = require(\"../Global\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_2 = require(\"../Global\");\nvar Arc = (function (_super) {\n    __extends(Arc, _super);\n    function Arc() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Arc.prototype._sceneFunc = function (context) {\n        var angle = Global_1.Konva.getAngle(this.angle()), clockwise = this.clockwise();\n        context.beginPath();\n        context.arc(0, 0, this.outerRadius(), 0, angle, clockwise);\n        context.arc(0, 0, this.innerRadius(), angle, 0, !clockwise);\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Arc.prototype.getWidth = function () {\n        return this.outerRadius() * 2;\n    };\n    Arc.prototype.getHeight = function () {\n        return this.outerRadius() * 2;\n    };\n    Arc.prototype.setWidth = function (width) {\n        this.outerRadius(width / 2);\n    };\n    Arc.prototype.setHeight = function (height) {\n        this.outerRadius(height / 2);\n    };\n    return Arc;\n}(Shape_1.Shape));\nexports.Arc = Arc;\nArc.prototype._centroid = true;\nArc.prototype.className = 'Arc';\nArc.prototype._attrsAffectingSize = ['innerRadius', 'outerRadius'];\nGlobal_2._registerNode(Arc);\nFactory_1.Factory.addGetterSetter(Arc, 'innerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Arc, 'outerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Arc, 'angle', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Arc, 'clockwise', false, Validators_1.getBooleanValidator());\nUtil_1.Collection.mapMethods(Arc);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar Line = (function (_super) {\n    __extends(Line, _super);\n    function Line(config) {\n        var _this = _super.call(this, config) || this;\n        _this.on('pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva', function () {\n            this._clearCache('tensionPoints');\n        });\n        return _this;\n    }\n    Line.prototype._sceneFunc = function (context) {\n        var points = this.points(), length = points.length, tension = this.tension(), closed = this.closed(), bezier = this.bezier(), tp, len, n;\n        if (!length) {\n            return;\n        }\n        context.beginPath();\n        context.moveTo(points[0], points[1]);\n        if (tension !== 0 && length > 4) {\n            tp = this.getTensionPoints();\n            len = tp.length;\n            n = closed ? 0 : 4;\n            if (!closed) {\n                context.quadraticCurveTo(tp[0], tp[1], tp[2], tp[3]);\n            }\n            while (n < len - 2) {\n                context.bezierCurveTo(tp[n++], tp[n++], tp[n++], tp[n++], tp[n++], tp[n++]);\n            }\n            if (!closed) {\n                context.quadraticCurveTo(tp[len - 2], tp[len - 1], points[length - 2], points[length - 1]);\n            }\n        }\n        else if (bezier) {\n            n = 2;\n            while (n < length) {\n                context.bezierCurveTo(points[n++], points[n++], points[n++], points[n++], points[n++], points[n++]);\n            }\n        }\n        else {\n            for (n = 2; n < length; n += 2) {\n                context.lineTo(points[n], points[n + 1]);\n            }\n        }\n        if (closed) {\n            context.closePath();\n            context.fillStrokeShape(this);\n        }\n        else {\n            context.strokeShape(this);\n        }\n    };\n    Line.prototype.getTensionPoints = function () {\n        return this._getCache('tensionPoints', this._getTensionPoints);\n    };\n    Line.prototype._getTensionPoints = function () {\n        if (this.closed()) {\n            return this._getTensionPointsClosed();\n        }\n        else {\n            return Util_1.Util._expandPoints(this.points(), this.tension());\n        }\n    };\n    Line.prototype._getTensionPointsClosed = function () {\n        var p = this.points(), len = p.length, tension = this.tension(), firstControlPoints = Util_1.Util._getControlPoints(p[len - 2], p[len - 1], p[0], p[1], p[2], p[3], tension), lastControlPoints = Util_1.Util._getControlPoints(p[len - 4], p[len - 3], p[len - 2], p[len - 1], p[0], p[1], tension), middle = Util_1.Util._expandPoints(p, tension), tp = [firstControlPoints[2], firstControlPoints[3]]\n            .concat(middle)\n            .concat([\n            lastControlPoints[0],\n            lastControlPoints[1],\n            p[len - 2],\n            p[len - 1],\n            lastControlPoints[2],\n            lastControlPoints[3],\n            firstControlPoints[0],\n            firstControlPoints[1],\n            p[0],\n            p[1]\n        ]);\n        return tp;\n    };\n    Line.prototype.getWidth = function () {\n        return this.getSelfRect().width;\n    };\n    Line.prototype.getHeight = function () {\n        return this.getSelfRect().height;\n    };\n    Line.prototype.getSelfRect = function () {\n        var points = this.points();\n        if (points.length < 4) {\n            return {\n                x: points[0] || 0,\n                y: points[1] || 0,\n                width: 0,\n                height: 0\n            };\n        }\n        if (this.tension() !== 0) {\n            points = __spreadArrays([\n                points[0],\n                points[1]\n            ], this._getTensionPoints(), [\n                points[points.length - 2],\n                points[points.length - 1]\n            ]);\n        }\n        else {\n            points = this.points();\n        }\n        var minX = points[0];\n        var maxX = points[0];\n        var minY = points[1];\n        var maxY = points[1];\n        var x, y;\n        for (var i = 0; i < points.length / 2; i++) {\n            x = points[i * 2];\n            y = points[i * 2 + 1];\n            minX = Math.min(minX, x);\n            maxX = Math.max(maxX, x);\n            minY = Math.min(minY, y);\n            maxY = Math.max(maxY, y);\n        }\n        return {\n            x: minX,\n            y: minY,\n            width: maxX - minX,\n            height: maxY - minY\n        };\n    };\n    return Line;\n}(Shape_1.Shape));\nexports.Line = Line;\nLine.prototype.className = 'Line';\nLine.prototype._attrsAffectingSize = ['points', 'bezier', 'tension'];\nGlobal_1._registerNode(Line);\nFactory_1.Factory.addGetterSetter(Line, 'closed', false);\nFactory_1.Factory.addGetterSetter(Line, 'bezier', false);\nFactory_1.Factory.addGetterSetter(Line, 'tension', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Line, 'points', [], Validators_1.getNumberArrayValidator());\nUtil_1.Collection.mapMethods(Line);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Line_1 = require(\"./Line\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar Arrow = (function (_super) {\n    __extends(Arrow, _super);\n    function Arrow() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Arrow.prototype._sceneFunc = function (ctx) {\n        _super.prototype._sceneFunc.call(this, ctx);\n        var PI2 = Math.PI * 2;\n        var points = this.points();\n        var tp = points;\n        var fromTension = this.tension() !== 0 && points.length > 4;\n        if (fromTension) {\n            tp = this.getTensionPoints();\n        }\n        var n = points.length;\n        var dx, dy;\n        if (fromTension) {\n            dx = points[n - 2] - (tp[tp.length - 2] + tp[tp.length - 4]) / 2;\n            dy = points[n - 1] - (tp[tp.length - 1] + tp[tp.length - 3]) / 2;\n        }\n        else {\n            dx = points[n - 2] - points[n - 4];\n            dy = points[n - 1] - points[n - 3];\n        }\n        var radians = (Math.atan2(dy, dx) + PI2) % PI2;\n        var length = this.pointerLength();\n        var width = this.pointerWidth();\n        ctx.save();\n        ctx.beginPath();\n        ctx.translate(points[n - 2], points[n - 1]);\n        ctx.rotate(radians);\n        ctx.moveTo(0, 0);\n        ctx.lineTo(-length, width / 2);\n        ctx.lineTo(-length, -width / 2);\n        ctx.closePath();\n        ctx.restore();\n        if (this.pointerAtBeginning()) {\n            ctx.save();\n            ctx.translate(points[0], points[1]);\n            if (fromTension) {\n                dx = (tp[0] + tp[2]) / 2 - points[0];\n                dy = (tp[1] + tp[3]) / 2 - points[1];\n            }\n            else {\n                dx = points[2] - points[0];\n                dy = points[3] - points[1];\n            }\n            ctx.rotate((Math.atan2(-dy, -dx) + PI2) % PI2);\n            ctx.moveTo(0, 0);\n            ctx.lineTo(-length, width / 2);\n            ctx.lineTo(-length, -width / 2);\n            ctx.closePath();\n            ctx.restore();\n        }\n        var isDashEnabled = this.dashEnabled();\n        if (isDashEnabled) {\n            this.attrs.dashEnabled = false;\n            ctx.setLineDash([]);\n        }\n        ctx.fillStrokeShape(this);\n        if (isDashEnabled) {\n            this.attrs.dashEnabled = true;\n        }\n    };\n    Arrow.prototype.getSelfRect = function () {\n        var lineRect = _super.prototype.getSelfRect.call(this);\n        var offset = this.pointerWidth() / 2;\n        return {\n            x: lineRect.x - offset,\n            y: lineRect.y - offset,\n            width: lineRect.width + offset * 2,\n            height: lineRect.height + offset * 2\n        };\n    };\n    return Arrow;\n}(Line_1.Line));\nexports.Arrow = Arrow;\nArrow.prototype.className = 'Arrow';\nGlobal_1._registerNode(Arrow);\nFactory_1.Factory.addGetterSetter(Arrow, 'pointerLength', 10, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Arrow, 'pointerWidth', 10, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Arrow, 'pointerAtBeginning', false);\nUtil_1.Collection.mapMethods(Arrow);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar Circle = (function (_super) {\n    __extends(Circle, _super);\n    function Circle() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Circle.prototype._sceneFunc = function (context) {\n        context.beginPath();\n        context.arc(0, 0, this.radius(), 0, Math.PI * 2, false);\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Circle.prototype.getWidth = function () {\n        return this.radius() * 2;\n    };\n    Circle.prototype.getHeight = function () {\n        return this.radius() * 2;\n    };\n    Circle.prototype.setWidth = function (width) {\n        if (this.radius() !== width / 2) {\n            this.radius(width / 2);\n        }\n    };\n    Circle.prototype.setHeight = function (height) {\n        if (this.radius() !== height / 2) {\n            this.radius(height / 2);\n        }\n    };\n    return Circle;\n}(Shape_1.Shape));\nexports.Circle = Circle;\nCircle.prototype._centroid = true;\nCircle.prototype.className = 'Circle';\nCircle.prototype._attrsAffectingSize = ['radius'];\nGlobal_1._registerNode(Circle);\nFactory_1.Factory.addGetterSetter(Circle, 'radius', 0, Validators_1.getNumberValidator());\nUtil_1.Collection.mapMethods(Circle);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar Ellipse = (function (_super) {\n    __extends(Ellipse, _super);\n    function Ellipse() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Ellipse.prototype._sceneFunc = function (context) {\n        var rx = this.radiusX(), ry = this.radiusY();\n        context.beginPath();\n        context.save();\n        if (rx !== ry) {\n            context.scale(1, ry / rx);\n        }\n        context.arc(0, 0, rx, 0, Math.PI * 2, false);\n        context.restore();\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Ellipse.prototype.getWidth = function () {\n        return this.radiusX() * 2;\n    };\n    Ellipse.prototype.getHeight = function () {\n        return this.radiusY() * 2;\n    };\n    Ellipse.prototype.setWidth = function (width) {\n        this.radiusX(width / 2);\n    };\n    Ellipse.prototype.setHeight = function (height) {\n        this.radiusY(height / 2);\n    };\n    return Ellipse;\n}(Shape_1.Shape));\nexports.Ellipse = Ellipse;\nEllipse.prototype.className = 'Ellipse';\nEllipse.prototype._centroid = true;\nEllipse.prototype._attrsAffectingSize = ['radiusX', 'radiusY'];\nGlobal_1._registerNode(Ellipse);\nFactory_1.Factory.addComponentsGetterSetter(Ellipse, 'radius', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Ellipse, 'radiusX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Ellipse, 'radiusY', 0, Validators_1.getNumberValidator());\nUtil_1.Collection.mapMethods(Ellipse);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar Image = (function (_super) {\n    __extends(Image, _super);\n    function Image() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Image.prototype._useBufferCanvas = function () {\n        return !!((this.hasShadow() || this.getAbsoluteOpacity() !== 1) &&\n            this.hasStroke() &&\n            this.getStage());\n    };\n    Image.prototype._sceneFunc = function (context) {\n        var width = this.width(), height = this.height(), image = this.image(), cropWidth, cropHeight, params;\n        if (image) {\n            cropWidth = this.cropWidth();\n            cropHeight = this.cropHeight();\n            if (cropWidth && cropHeight) {\n                params = [\n                    image,\n                    this.cropX(),\n                    this.cropY(),\n                    cropWidth,\n                    cropHeight,\n                    0,\n                    0,\n                    width,\n                    height\n                ];\n            }\n            else {\n                params = [image, 0, 0, width, height];\n            }\n        }\n        if (this.hasFill() || this.hasStroke()) {\n            context.beginPath();\n            context.rect(0, 0, width, height);\n            context.closePath();\n            context.fillStrokeShape(this);\n        }\n        if (image) {\n            context.drawImage.apply(context, params);\n        }\n    };\n    Image.prototype._hitFunc = function (context) {\n        var width = this.width(), height = this.height();\n        context.beginPath();\n        context.rect(0, 0, width, height);\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Image.prototype.getWidth = function () {\n        var _a;\n        var image = this.image();\n        return _a = this.attrs.width, (_a !== null && _a !== void 0 ? _a : (image ? image.width : 0));\n    };\n    Image.prototype.getHeight = function () {\n        var _a;\n        var image = this.image();\n        return _a = this.attrs.height, (_a !== null && _a !== void 0 ? _a : (image ? image.height : 0));\n    };\n    Image.fromURL = function (url, callback) {\n        var img = Util_1.Util.createImageElement();\n        img.onload = function () {\n            var image = new Image({\n                image: img\n            });\n            callback(image);\n        };\n        img.crossOrigin = 'Anonymous';\n        img.src = url;\n    };\n    return Image;\n}(Shape_1.Shape));\nexports.Image = Image;\nImage.prototype.className = 'Image';\nGlobal_1._registerNode(Image);\nFactory_1.Factory.addGetterSetter(Image, 'image');\nFactory_1.Factory.addComponentsGetterSetter(Image, 'crop', ['x', 'y', 'width', 'height']);\nFactory_1.Factory.addGetterSetter(Image, 'cropX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Image, 'cropY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Image, 'cropWidth', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Image, 'cropHeight', 0, Validators_1.getNumberValidator());\nUtil_1.Collection.mapMethods(Image);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Group_1 = require(\"../Group\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar ATTR_CHANGE_LIST = [\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'padding',\n    'lineHeight',\n    'text',\n    'width'\n], CHANGE_KONVA = 'Change.konva', NONE = 'none', UP = 'up', RIGHT = 'right', DOWN = 'down', LEFT = 'left', attrChangeListLen = ATTR_CHANGE_LIST.length;\nvar Label = (function (_super) {\n    __extends(Label, _super);\n    function Label(config) {\n        var _this = _super.call(this, config) || this;\n        _this.on('add.konva', function (evt) {\n            this._addListeners(evt.child);\n            this._sync();\n        });\n        return _this;\n    }\n    Label.prototype.getText = function () {\n        return this.find('Text')[0];\n    };\n    Label.prototype.getTag = function () {\n        return this.find('Tag')[0];\n    };\n    Label.prototype._addListeners = function (text) {\n        var that = this, n;\n        var func = function () {\n            that._sync();\n        };\n        for (n = 0; n < attrChangeListLen; n++) {\n            text.on(ATTR_CHANGE_LIST[n] + CHANGE_KONVA, func);\n        }\n    };\n    Label.prototype.getWidth = function () {\n        return this.getText().width();\n    };\n    Label.prototype.getHeight = function () {\n        return this.getText().height();\n    };\n    Label.prototype._sync = function () {\n        var text = this.getText(), tag = this.getTag(), width, height, pointerDirection, pointerWidth, x, y, pointerHeight;\n        if (text && tag) {\n            width = text.width();\n            height = text.height();\n            pointerDirection = tag.pointerDirection();\n            pointerWidth = tag.pointerWidth();\n            pointerHeight = tag.pointerHeight();\n            x = 0;\n            y = 0;\n            switch (pointerDirection) {\n                case UP:\n                    x = width / 2;\n                    y = -1 * pointerHeight;\n                    break;\n                case RIGHT:\n                    x = width + pointerWidth;\n                    y = height / 2;\n                    break;\n                case DOWN:\n                    x = width / 2;\n                    y = height + pointerHeight;\n                    break;\n                case LEFT:\n                    x = -1 * pointerWidth;\n                    y = height / 2;\n                    break;\n            }\n            tag.setAttrs({\n                x: -1 * x,\n                y: -1 * y,\n                width: width,\n                height: height\n            });\n            text.setAttrs({\n                x: -1 * x,\n                y: -1 * y\n            });\n        }\n    };\n    return Label;\n}(Group_1.Group));\nexports.Label = Label;\nLabel.prototype.className = 'Label';\nGlobal_1._registerNode(Label);\nUtil_1.Collection.mapMethods(Label);\nvar Tag = (function (_super) {\n    __extends(Tag, _super);\n    function Tag() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Tag.prototype._sceneFunc = function (context) {\n        var width = this.width(), height = this.height(), pointerDirection = this.pointerDirection(), pointerWidth = this.pointerWidth(), pointerHeight = this.pointerHeight(), cornerRadius = Math.min(this.cornerRadius(), width / 2, height / 2);\n        context.beginPath();\n        if (!cornerRadius) {\n            context.moveTo(0, 0);\n        }\n        else {\n            context.moveTo(cornerRadius, 0);\n        }\n        if (pointerDirection === UP) {\n            context.lineTo((width - pointerWidth) / 2, 0);\n            context.lineTo(width / 2, -1 * pointerHeight);\n            context.lineTo((width + pointerWidth) / 2, 0);\n        }\n        if (!cornerRadius) {\n            context.lineTo(width, 0);\n        }\n        else {\n            context.lineTo(width - cornerRadius, 0);\n            context.arc(width - cornerRadius, cornerRadius, cornerRadius, (Math.PI * 3) / 2, 0, false);\n        }\n        if (pointerDirection === RIGHT) {\n            context.lineTo(width, (height - pointerHeight) / 2);\n            context.lineTo(width + pointerWidth, height / 2);\n            context.lineTo(width, (height + pointerHeight) / 2);\n        }\n        if (!cornerRadius) {\n            context.lineTo(width, height);\n        }\n        else {\n            context.lineTo(width, height - cornerRadius);\n            context.arc(width - cornerRadius, height - cornerRadius, cornerRadius, 0, Math.PI / 2, false);\n        }\n        if (pointerDirection === DOWN) {\n            context.lineTo((width + pointerWidth) / 2, height);\n            context.lineTo(width / 2, height + pointerHeight);\n            context.lineTo((width - pointerWidth) / 2, height);\n        }\n        if (!cornerRadius) {\n            context.lineTo(0, height);\n        }\n        else {\n            context.lineTo(cornerRadius, height);\n            context.arc(cornerRadius, height - cornerRadius, cornerRadius, Math.PI / 2, Math.PI, false);\n        }\n        if (pointerDirection === LEFT) {\n            context.lineTo(0, (height + pointerHeight) / 2);\n            context.lineTo(-1 * pointerWidth, height / 2);\n            context.lineTo(0, (height - pointerHeight) / 2);\n        }\n        if (cornerRadius) {\n            context.lineTo(0, cornerRadius);\n            context.arc(cornerRadius, cornerRadius, cornerRadius, Math.PI, (Math.PI * 3) / 2, false);\n        }\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Tag.prototype.getSelfRect = function () {\n        var x = 0, y = 0, pointerWidth = this.pointerWidth(), pointerHeight = this.pointerHeight(), direction = this.pointerDirection(), width = this.width(), height = this.height();\n        if (direction === UP) {\n            y -= pointerHeight;\n            height += pointerHeight;\n        }\n        else if (direction === DOWN) {\n            height += pointerHeight;\n        }\n        else if (direction === LEFT) {\n            x -= pointerWidth * 1.5;\n            width += pointerWidth;\n        }\n        else if (direction === RIGHT) {\n            width += pointerWidth * 1.5;\n        }\n        return {\n            x: x,\n            y: y,\n            width: width,\n            height: height\n        };\n    };\n    return Tag;\n}(Shape_1.Shape));\nexports.Tag = Tag;\nTag.prototype.className = 'Tag';\nGlobal_1._registerNode(Tag);\nFactory_1.Factory.addGetterSetter(Tag, 'pointerDirection', NONE);\nFactory_1.Factory.addGetterSetter(Tag, 'pointerWidth', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Tag, 'pointerHeight', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Tag, 'cornerRadius', 0, Validators_1.getNumberValidator());\nUtil_1.Collection.mapMethods(Tag);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Global_1 = require(\"../Global\");\nvar Path = (function (_super) {\n    __extends(Path, _super);\n    function Path(config) {\n        var _this = _super.call(this, config) || this;\n        _this.dataArray = [];\n        _this.pathLength = 0;\n        _this.dataArray = Path.parsePathData(_this.data());\n        _this.pathLength = 0;\n        for (var i = 0; i < _this.dataArray.length; ++i) {\n            _this.pathLength += _this.dataArray[i].pathLength;\n        }\n        _this.on('dataChange.konva', function () {\n            this.dataArray = Path.parsePathData(this.data());\n            this.pathLength = 0;\n            for (var i = 0; i < this.dataArray.length; ++i) {\n                this.pathLength += this.dataArray[i].pathLength;\n            }\n        });\n        return _this;\n    }\n    Path.prototype._sceneFunc = function (context) {\n        var ca = this.dataArray;\n        context.beginPath();\n        var isClosed = false;\n        for (var n = 0; n < ca.length; n++) {\n            var c = ca[n].command;\n            var p = ca[n].points;\n            switch (c) {\n                case 'L':\n                    context.lineTo(p[0], p[1]);\n                    break;\n                case 'M':\n                    context.moveTo(p[0], p[1]);\n                    break;\n                case 'C':\n                    context.bezierCurveTo(p[0], p[1], p[2], p[3], p[4], p[5]);\n                    break;\n                case 'Q':\n                    context.quadraticCurveTo(p[0], p[1], p[2], p[3]);\n                    break;\n                case 'A':\n                    var cx = p[0], cy = p[1], rx = p[2], ry = p[3], theta = p[4], dTheta = p[5], psi = p[6], fs = p[7];\n                    var r = rx > ry ? rx : ry;\n                    var scaleX = rx > ry ? 1 : rx / ry;\n                    var scaleY = rx > ry ? ry / rx : 1;\n                    context.translate(cx, cy);\n                    context.rotate(psi);\n                    context.scale(scaleX, scaleY);\n                    context.arc(0, 0, r, theta, theta + dTheta, 1 - fs);\n                    context.scale(1 / scaleX, 1 / scaleY);\n                    context.rotate(-psi);\n                    context.translate(-cx, -cy);\n                    break;\n                case 'z':\n                    isClosed = true;\n                    context.closePath();\n                    break;\n            }\n        }\n        if (!isClosed && !this.hasFill()) {\n            context.strokeShape(this);\n        }\n        else {\n            context.fillStrokeShape(this);\n        }\n    };\n    Path.prototype.getSelfRect = function () {\n        var points = [];\n        this.dataArray.forEach(function (data) {\n            if (data.command === 'A') {\n                var start = data.points[4];\n                var dTheta = data.points[5];\n                var end = data.points[4] + dTheta;\n                var inc = Math.PI / 180.0;\n                if (Math.abs(start - end) < inc) {\n                    inc = Math.abs(start - end);\n                }\n                if (dTheta < 0) {\n                    for (var t = start - inc; t > end; t -= inc) {\n                        var point = Path.getPointOnEllipticalArc(data.points[0], data.points[1], data.points[2], data.points[3], t, 0);\n                        points.push(point.x, point.y);\n                    }\n                }\n                else {\n                    for (var t = start + inc; t < end; t += inc) {\n                        var point = Path.getPointOnEllipticalArc(data.points[0], data.points[1], data.points[2], data.points[3], t, 0);\n                        points.push(point.x, point.y);\n                    }\n                }\n            }\n            else if (data.command === 'C') {\n                for (var t = 0.0; t <= 1; t += 0.01) {\n                    var point = Path.getPointOnCubicBezier(t, data.start.x, data.start.y, data.points[0], data.points[1], data.points[2], data.points[3], data.points[4], data.points[5]);\n                    points.push(point.x, point.y);\n                }\n            }\n            else {\n                points = points.concat(data.points);\n            }\n        });\n        var minX = points[0];\n        var maxX = points[0];\n        var minY = points[1];\n        var maxY = points[1];\n        var x, y;\n        for (var i = 0; i < points.length / 2; i++) {\n            x = points[i * 2];\n            y = points[i * 2 + 1];\n            if (!isNaN(x)) {\n                minX = Math.min(minX, x);\n                maxX = Math.max(maxX, x);\n            }\n            if (!isNaN(y)) {\n                minY = Math.min(minY, y);\n                maxY = Math.max(maxY, y);\n            }\n        }\n        return {\n            x: Math.round(minX),\n            y: Math.round(minY),\n            width: Math.round(maxX - minX),\n            height: Math.round(maxY - minY)\n        };\n    };\n    Path.prototype.getLength = function () {\n        return this.pathLength;\n    };\n    Path.prototype.getPointAtLength = function (length) {\n        var point, i = 0, ii = this.dataArray.length;\n        if (!ii) {\n            return null;\n        }\n        while (i < ii && length > this.dataArray[i].pathLength) {\n            length -= this.dataArray[i].pathLength;\n            ++i;\n        }\n        if (i === ii) {\n            point = this.dataArray[i - 1].points.slice(-2);\n            return {\n                x: point[0],\n                y: point[1]\n            };\n        }\n        if (length < 0.01) {\n            point = this.dataArray[i].points.slice(0, 2);\n            return {\n                x: point[0],\n                y: point[1]\n            };\n        }\n        var cp = this.dataArray[i];\n        var p = cp.points;\n        switch (cp.command) {\n            case 'L':\n                return Path.getPointOnLine(length, cp.start.x, cp.start.y, p[0], p[1]);\n            case 'C':\n                return Path.getPointOnCubicBezier(length / cp.pathLength, cp.start.x, cp.start.y, p[0], p[1], p[2], p[3], p[4], p[5]);\n            case 'Q':\n                return Path.getPointOnQuadraticBezier(length / cp.pathLength, cp.start.x, cp.start.y, p[0], p[1], p[2], p[3]);\n            case 'A':\n                var cx = p[0], cy = p[1], rx = p[2], ry = p[3], theta = p[4], dTheta = p[5], psi = p[6];\n                theta += (dTheta * length) / cp.pathLength;\n                return Path.getPointOnEllipticalArc(cx, cy, rx, ry, theta, psi);\n        }\n        return null;\n    };\n    Path.getLineLength = function (x1, y1, x2, y2) {\n        return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n    };\n    Path.getPointOnLine = function (dist, P1x, P1y, P2x, P2y, fromX, fromY) {\n        if (fromX === undefined) {\n            fromX = P1x;\n        }\n        if (fromY === undefined) {\n            fromY = P1y;\n        }\n        var m = (P2y - P1y) / (P2x - P1x + 0.00000001);\n        var run = Math.sqrt((dist * dist) / (1 + m * m));\n        if (P2x < P1x) {\n            run *= -1;\n        }\n        var rise = m * run;\n        var pt;\n        if (P2x === P1x) {\n            pt = {\n                x: fromX,\n                y: fromY + rise\n            };\n        }\n        else if ((fromY - P1y) / (fromX - P1x + 0.00000001) === m) {\n            pt = {\n                x: fromX + run,\n                y: fromY + rise\n            };\n        }\n        else {\n            var ix, iy;\n            var len = this.getLineLength(P1x, P1y, P2x, P2y);\n            if (len < 0.00000001) {\n                return undefined;\n            }\n            var u = (fromX - P1x) * (P2x - P1x) + (fromY - P1y) * (P2y - P1y);\n            u = u / (len * len);\n            ix = P1x + u * (P2x - P1x);\n            iy = P1y + u * (P2y - P1y);\n            var pRise = this.getLineLength(fromX, fromY, ix, iy);\n            var pRun = Math.sqrt(dist * dist - pRise * pRise);\n            run = Math.sqrt((pRun * pRun) / (1 + m * m));\n            if (P2x < P1x) {\n                run *= -1;\n            }\n            rise = m * run;\n            pt = {\n                x: ix + run,\n                y: iy + rise\n            };\n        }\n        return pt;\n    };\n    Path.getPointOnCubicBezier = function (pct, P1x, P1y, P2x, P2y, P3x, P3y, P4x, P4y) {\n        function CB1(t) {\n            return t * t * t;\n        }\n        function CB2(t) {\n            return 3 * t * t * (1 - t);\n        }\n        function CB3(t) {\n            return 3 * t * (1 - t) * (1 - t);\n        }\n        function CB4(t) {\n            return (1 - t) * (1 - t) * (1 - t);\n        }\n        var x = P4x * CB1(pct) + P3x * CB2(pct) + P2x * CB3(pct) + P1x * CB4(pct);\n        var y = P4y * CB1(pct) + P3y * CB2(pct) + P2y * CB3(pct) + P1y * CB4(pct);\n        return {\n            x: x,\n            y: y\n        };\n    };\n    Path.getPointOnQuadraticBezier = function (pct, P1x, P1y, P2x, P2y, P3x, P3y) {\n        function QB1(t) {\n            return t * t;\n        }\n        function QB2(t) {\n            return 2 * t * (1 - t);\n        }\n        function QB3(t) {\n            return (1 - t) * (1 - t);\n        }\n        var x = P3x * QB1(pct) + P2x * QB2(pct) + P1x * QB3(pct);\n        var y = P3y * QB1(pct) + P2y * QB2(pct) + P1y * QB3(pct);\n        return {\n            x: x,\n            y: y\n        };\n    };\n    Path.getPointOnEllipticalArc = function (cx, cy, rx, ry, theta, psi) {\n        var cosPsi = Math.cos(psi), sinPsi = Math.sin(psi);\n        var pt = {\n            x: rx * Math.cos(theta),\n            y: ry * Math.sin(theta)\n        };\n        return {\n            x: cx + (pt.x * cosPsi - pt.y * sinPsi),\n            y: cy + (pt.x * sinPsi + pt.y * cosPsi)\n        };\n    };\n    Path.parsePathData = function (data) {\n        if (!data) {\n            return [];\n        }\n        var cs = data;\n        var cc = [\n            'm',\n            'M',\n            'l',\n            'L',\n            'v',\n            'V',\n            'h',\n            'H',\n            'z',\n            'Z',\n            'c',\n            'C',\n            'q',\n            'Q',\n            't',\n            'T',\n            's',\n            'S',\n            'a',\n            'A'\n        ];\n        cs = cs.replace(new RegExp(' ', 'g'), ',');\n        for (var n = 0; n < cc.length; n++) {\n            cs = cs.replace(new RegExp(cc[n], 'g'), '|' + cc[n]);\n        }\n        var arr = cs.split('|');\n        var ca = [];\n        var coords = [];\n        var cpx = 0;\n        var cpy = 0;\n        var re = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:e[-+]?\\d+)?)/gi;\n        var match;\n        for (n = 1; n < arr.length; n++) {\n            var str = arr[n];\n            var c = str.charAt(0);\n            str = str.slice(1);\n            coords.length = 0;\n            while ((match = re.exec(str))) {\n                coords.push(match[0]);\n            }\n            var p = [];\n            for (var j = 0, jlen = coords.length; j < jlen; j++) {\n                var parsed = parseFloat(coords[j]);\n                if (!isNaN(parsed)) {\n                    p.push(parsed);\n                }\n                else {\n                    p.push(0);\n                }\n            }\n            while (p.length > 0) {\n                if (isNaN(p[0])) {\n                    break;\n                }\n                var cmd = null;\n                var points = [];\n                var startX = cpx, startY = cpy;\n                var prevCmd, ctlPtx, ctlPty;\n                var rx, ry, psi, fa, fs, x1, y1;\n                switch (c) {\n                    case 'l':\n                        cpx += p.shift();\n                        cpy += p.shift();\n                        cmd = 'L';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'L':\n                        cpx = p.shift();\n                        cpy = p.shift();\n                        points.push(cpx, cpy);\n                        break;\n                    case 'm':\n                        var dx = p.shift();\n                        var dy = p.shift();\n                        cpx += dx;\n                        cpy += dy;\n                        cmd = 'M';\n                        if (ca.length > 2 && ca[ca.length - 1].command === 'z') {\n                            for (var idx = ca.length - 2; idx >= 0; idx--) {\n                                if (ca[idx].command === 'M') {\n                                    cpx = ca[idx].points[0] + dx;\n                                    cpy = ca[idx].points[1] + dy;\n                                    break;\n                                }\n                            }\n                        }\n                        points.push(cpx, cpy);\n                        c = 'l';\n                        break;\n                    case 'M':\n                        cpx = p.shift();\n                        cpy = p.shift();\n                        cmd = 'M';\n                        points.push(cpx, cpy);\n                        c = 'L';\n                        break;\n                    case 'h':\n                        cpx += p.shift();\n                        cmd = 'L';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'H':\n                        cpx = p.shift();\n                        cmd = 'L';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'v':\n                        cpy += p.shift();\n                        cmd = 'L';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'V':\n                        cpy = p.shift();\n                        cmd = 'L';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'C':\n                        points.push(p.shift(), p.shift(), p.shift(), p.shift());\n                        cpx = p.shift();\n                        cpy = p.shift();\n                        points.push(cpx, cpy);\n                        break;\n                    case 'c':\n                        points.push(cpx + p.shift(), cpy + p.shift(), cpx + p.shift(), cpy + p.shift());\n                        cpx += p.shift();\n                        cpy += p.shift();\n                        cmd = 'C';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'S':\n                        ctlPtx = cpx;\n                        ctlPty = cpy;\n                        prevCmd = ca[ca.length - 1];\n                        if (prevCmd.command === 'C') {\n                            ctlPtx = cpx + (cpx - prevCmd.points[2]);\n                            ctlPty = cpy + (cpy - prevCmd.points[3]);\n                        }\n                        points.push(ctlPtx, ctlPty, p.shift(), p.shift());\n                        cpx = p.shift();\n                        cpy = p.shift();\n                        cmd = 'C';\n                        points.push(cpx, cpy);\n                        break;\n                    case 's':\n                        ctlPtx = cpx;\n                        ctlPty = cpy;\n                        prevCmd = ca[ca.length - 1];\n                        if (prevCmd.command === 'C') {\n                            ctlPtx = cpx + (cpx - prevCmd.points[2]);\n                            ctlPty = cpy + (cpy - prevCmd.points[3]);\n                        }\n                        points.push(ctlPtx, ctlPty, cpx + p.shift(), cpy + p.shift());\n                        cpx += p.shift();\n                        cpy += p.shift();\n                        cmd = 'C';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'Q':\n                        points.push(p.shift(), p.shift());\n                        cpx = p.shift();\n                        cpy = p.shift();\n                        points.push(cpx, cpy);\n                        break;\n                    case 'q':\n                        points.push(cpx + p.shift(), cpy + p.shift());\n                        cpx += p.shift();\n                        cpy += p.shift();\n                        cmd = 'Q';\n                        points.push(cpx, cpy);\n                        break;\n                    case 'T':\n                        ctlPtx = cpx;\n                        ctlPty = cpy;\n                        prevCmd = ca[ca.length - 1];\n                        if (prevCmd.command === 'Q') {\n                            ctlPtx = cpx + (cpx - prevCmd.points[0]);\n                            ctlPty = cpy + (cpy - prevCmd.points[1]);\n                        }\n                        cpx = p.shift();\n                        cpy = p.shift();\n                        cmd = 'Q';\n                        points.push(ctlPtx, ctlPty, cpx, cpy);\n                        break;\n                    case 't':\n                        ctlPtx = cpx;\n                        ctlPty = cpy;\n                        prevCmd = ca[ca.length - 1];\n                        if (prevCmd.command === 'Q') {\n                            ctlPtx = cpx + (cpx - prevCmd.points[0]);\n                            ctlPty = cpy + (cpy - prevCmd.points[1]);\n                        }\n                        cpx += p.shift();\n                        cpy += p.shift();\n                        cmd = 'Q';\n                        points.push(ctlPtx, ctlPty, cpx, cpy);\n                        break;\n                    case 'A':\n                        rx = p.shift();\n                        ry = p.shift();\n                        psi = p.shift();\n                        fa = p.shift();\n                        fs = p.shift();\n                        x1 = cpx;\n                        y1 = cpy;\n                        cpx = p.shift();\n                        cpy = p.shift();\n                        cmd = 'A';\n                        points = this.convertEndpointToCenterParameterization(x1, y1, cpx, cpy, fa, fs, rx, ry, psi);\n                        break;\n                    case 'a':\n                        rx = p.shift();\n                        ry = p.shift();\n                        psi = p.shift();\n                        fa = p.shift();\n                        fs = p.shift();\n                        x1 = cpx;\n                        y1 = cpy;\n                        cpx += p.shift();\n                        cpy += p.shift();\n                        cmd = 'A';\n                        points = this.convertEndpointToCenterParameterization(x1, y1, cpx, cpy, fa, fs, rx, ry, psi);\n                        break;\n                }\n                ca.push({\n                    command: cmd || c,\n                    points: points,\n                    start: {\n                        x: startX,\n                        y: startY\n                    },\n                    pathLength: this.calcLength(startX, startY, cmd || c, points)\n                });\n            }\n            if (c === 'z' || c === 'Z') {\n                ca.push({\n                    command: 'z',\n                    points: [],\n                    start: undefined,\n                    pathLength: 0\n                });\n            }\n        }\n        return ca;\n    };\n    Path.calcLength = function (x, y, cmd, points) {\n        var len, p1, p2, t;\n        var path = Path;\n        switch (cmd) {\n            case 'L':\n                return path.getLineLength(x, y, points[0], points[1]);\n            case 'C':\n                len = 0.0;\n                p1 = path.getPointOnCubicBezier(0, x, y, points[0], points[1], points[2], points[3], points[4], points[5]);\n                for (t = 0.01; t <= 1; t += 0.01) {\n                    p2 = path.getPointOnCubicBezier(t, x, y, points[0], points[1], points[2], points[3], points[4], points[5]);\n                    len += path.getLineLength(p1.x, p1.y, p2.x, p2.y);\n                    p1 = p2;\n                }\n                return len;\n            case 'Q':\n                len = 0.0;\n                p1 = path.getPointOnQuadraticBezier(0, x, y, points[0], points[1], points[2], points[3]);\n                for (t = 0.01; t <= 1; t += 0.01) {\n                    p2 = path.getPointOnQuadraticBezier(t, x, y, points[0], points[1], points[2], points[3]);\n                    len += path.getLineLength(p1.x, p1.y, p2.x, p2.y);\n                    p1 = p2;\n                }\n                return len;\n            case 'A':\n                len = 0.0;\n                var start = points[4];\n                var dTheta = points[5];\n                var end = points[4] + dTheta;\n                var inc = Math.PI / 180.0;\n                if (Math.abs(start - end) < inc) {\n                    inc = Math.abs(start - end);\n                }\n                p1 = path.getPointOnEllipticalArc(points[0], points[1], points[2], points[3], start, 0);\n                if (dTheta < 0) {\n                    for (t = start - inc; t > end; t -= inc) {\n                        p2 = path.getPointOnEllipticalArc(points[0], points[1], points[2], points[3], t, 0);\n                        len += path.getLineLength(p1.x, p1.y, p2.x, p2.y);\n                        p1 = p2;\n                    }\n                }\n                else {\n                    for (t = start + inc; t < end; t += inc) {\n                        p2 = path.getPointOnEllipticalArc(points[0], points[1], points[2], points[3], t, 0);\n                        len += path.getLineLength(p1.x, p1.y, p2.x, p2.y);\n                        p1 = p2;\n                    }\n                }\n                p2 = path.getPointOnEllipticalArc(points[0], points[1], points[2], points[3], end, 0);\n                len += path.getLineLength(p1.x, p1.y, p2.x, p2.y);\n                return len;\n        }\n        return 0;\n    };\n    Path.convertEndpointToCenterParameterization = function (x1, y1, x2, y2, fa, fs, rx, ry, psiDeg) {\n        var psi = psiDeg * (Math.PI / 180.0);\n        var xp = (Math.cos(psi) * (x1 - x2)) / 2.0 + (Math.sin(psi) * (y1 - y2)) / 2.0;\n        var yp = (-1 * Math.sin(psi) * (x1 - x2)) / 2.0 +\n            (Math.cos(psi) * (y1 - y2)) / 2.0;\n        var lambda = (xp * xp) / (rx * rx) + (yp * yp) / (ry * ry);\n        if (lambda > 1) {\n            rx *= Math.sqrt(lambda);\n            ry *= Math.sqrt(lambda);\n        }\n        var f = Math.sqrt((rx * rx * (ry * ry) - rx * rx * (yp * yp) - ry * ry * (xp * xp)) /\n            (rx * rx * (yp * yp) + ry * ry * (xp * xp)));\n        if (fa === fs) {\n            f *= -1;\n        }\n        if (isNaN(f)) {\n            f = 0;\n        }\n        var cxp = (f * rx * yp) / ry;\n        var cyp = (f * -ry * xp) / rx;\n        var cx = (x1 + x2) / 2.0 + Math.cos(psi) * cxp - Math.sin(psi) * cyp;\n        var cy = (y1 + y2) / 2.0 + Math.sin(psi) * cxp + Math.cos(psi) * cyp;\n        var vMag = function (v) {\n            return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n        };\n        var vRatio = function (u, v) {\n            return (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v));\n        };\n        var vAngle = function (u, v) {\n            return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n        };\n        var theta = vAngle([1, 0], [(xp - cxp) / rx, (yp - cyp) / ry]);\n        var u = [(xp - cxp) / rx, (yp - cyp) / ry];\n        var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry];\n        var dTheta = vAngle(u, v);\n        if (vRatio(u, v) <= -1) {\n            dTheta = Math.PI;\n        }\n        if (vRatio(u, v) >= 1) {\n            dTheta = 0;\n        }\n        if (fs === 0 && dTheta > 0) {\n            dTheta = dTheta - 2 * Math.PI;\n        }\n        if (fs === 1 && dTheta < 0) {\n            dTheta = dTheta + 2 * Math.PI;\n        }\n        return [cx, cy, rx, ry, theta, dTheta, psi, fs];\n    };\n    return Path;\n}(Shape_1.Shape));\nexports.Path = Path;\nPath.prototype.className = 'Path';\nPath.prototype._attrsAffectingSize = ['data'];\nGlobal_1._registerNode(Path);\nFactory_1.Factory.addGetterSetter(Path, 'data');\nUtil_1.Collection.mapMethods(Path);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Global_1 = require(\"../Global\");\nvar Rect = (function (_super) {\n    __extends(Rect, _super);\n    function Rect() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Rect.prototype._sceneFunc = function (context) {\n        var cornerRadius = this.cornerRadius(), width = this.width(), height = this.height();\n        context.beginPath();\n        if (!cornerRadius) {\n            context.rect(0, 0, width, height);\n        }\n        else {\n            var topLeft = 0;\n            var topRight = 0;\n            var bottomLeft = 0;\n            var bottomRight = 0;\n            if (typeof cornerRadius === 'number') {\n                topLeft = topRight = bottomLeft = bottomRight = Math.min(cornerRadius, width / 2, height / 2);\n            }\n            else {\n                topLeft = Math.min(cornerRadius[0], width / 2, height / 2);\n                topRight = Math.min(cornerRadius[1], width / 2, height / 2);\n                bottomRight = Math.min(cornerRadius[2], width / 2, height / 2);\n                bottomLeft = Math.min(cornerRadius[3], width / 2, height / 2);\n            }\n            context.moveTo(topLeft, 0);\n            context.lineTo(width - topRight, 0);\n            context.arc(width - topRight, topRight, topRight, (Math.PI * 3) / 2, 0, false);\n            context.lineTo(width, height - bottomRight);\n            context.arc(width - bottomRight, height - bottomRight, bottomRight, 0, Math.PI / 2, false);\n            context.lineTo(bottomLeft, height);\n            context.arc(bottomLeft, height - bottomLeft, bottomLeft, Math.PI / 2, Math.PI, false);\n            context.lineTo(0, topLeft);\n            context.arc(topLeft, topLeft, topLeft, Math.PI, (Math.PI * 3) / 2, false);\n        }\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    return Rect;\n}(Shape_1.Shape));\nexports.Rect = Rect;\nRect.prototype.className = 'Rect';\nGlobal_1._registerNode(Rect);\nFactory_1.Factory.addGetterSetter(Rect, 'cornerRadius', 0);\nUtil_1.Collection.mapMethods(Rect);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar RegularPolygon = (function (_super) {\n    __extends(RegularPolygon, _super);\n    function RegularPolygon() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RegularPolygon.prototype._sceneFunc = function (context) {\n        var sides = this.sides(), radius = this.radius(), n, x, y;\n        context.beginPath();\n        context.moveTo(0, 0 - radius);\n        for (n = 1; n < sides; n++) {\n            x = radius * Math.sin((n * 2 * Math.PI) / sides);\n            y = -1 * radius * Math.cos((n * 2 * Math.PI) / sides);\n            context.lineTo(x, y);\n        }\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    RegularPolygon.prototype.getWidth = function () {\n        return this.radius() * 2;\n    };\n    RegularPolygon.prototype.getHeight = function () {\n        return this.radius() * 2;\n    };\n    RegularPolygon.prototype.setWidth = function (width) {\n        this.radius(width / 2);\n    };\n    RegularPolygon.prototype.setHeight = function (height) {\n        this.radius(height / 2);\n    };\n    return RegularPolygon;\n}(Shape_1.Shape));\nexports.RegularPolygon = RegularPolygon;\nRegularPolygon.prototype.className = 'RegularPolygon';\nRegularPolygon.prototype._centroid = true;\nRegularPolygon.prototype._attrsAffectingSize = ['radius'];\nGlobal_1._registerNode(RegularPolygon);\nFactory_1.Factory.addGetterSetter(RegularPolygon, 'radius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(RegularPolygon, 'sides', 0, Validators_1.getNumberValidator());\nUtil_1.Collection.mapMethods(RegularPolygon);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar PIx2 = Math.PI * 2;\nvar Ring = (function (_super) {\n    __extends(Ring, _super);\n    function Ring() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Ring.prototype._sceneFunc = function (context) {\n        context.beginPath();\n        context.arc(0, 0, this.innerRadius(), 0, PIx2, false);\n        context.moveTo(this.outerRadius(), 0);\n        context.arc(0, 0, this.outerRadius(), PIx2, 0, true);\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Ring.prototype.getWidth = function () {\n        return this.outerRadius() * 2;\n    };\n    Ring.prototype.getHeight = function () {\n        return this.outerRadius() * 2;\n    };\n    Ring.prototype.setWidth = function (width) {\n        this.outerRadius(width / 2);\n    };\n    Ring.prototype.setHeight = function (height) {\n        this.outerRadius(height / 2);\n    };\n    return Ring;\n}(Shape_1.Shape));\nexports.Ring = Ring;\nRing.prototype.className = 'Ring';\nRing.prototype._centroid = true;\nRing.prototype._attrsAffectingSize = ['innerRadius', 'outerRadius'];\nGlobal_1._registerNode(Ring);\nFactory_1.Factory.addGetterSetter(Ring, 'innerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Ring, 'outerRadius', 0, Validators_1.getNumberValidator());\nUtil_1.Collection.mapMethods(Ring);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Animation_1 = require(\"../Animation\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar Sprite = (function (_super) {\n    __extends(Sprite, _super);\n    function Sprite(config) {\n        var _this = _super.call(this, config) || this;\n        _this._updated = true;\n        _this.anim = new Animation_1.Animation(function () {\n            var updated = _this._updated;\n            _this._updated = false;\n            return updated;\n        });\n        _this.on('animationChange.konva', function () {\n            this.frameIndex(0);\n        });\n        _this.on('frameIndexChange.konva', function () {\n            this._updated = true;\n        });\n        _this.on('frameRateChange.konva', function () {\n            if (!this.anim.isRunning()) {\n                return;\n            }\n            clearInterval(this.interval);\n            this._setInterval();\n        });\n        return _this;\n    }\n    Sprite.prototype._sceneFunc = function (context) {\n        var anim = this.animation(), index = this.frameIndex(), ix4 = index * 4, set = this.animations()[anim], offsets = this.frameOffsets(), x = set[ix4 + 0], y = set[ix4 + 1], width = set[ix4 + 2], height = set[ix4 + 3], image = this.image();\n        if (this.hasFill() || this.hasStroke()) {\n            context.beginPath();\n            context.rect(0, 0, width, height);\n            context.closePath();\n            context.fillStrokeShape(this);\n        }\n        if (image) {\n            if (offsets) {\n                var offset = offsets[anim], ix2 = index * 2;\n                context.drawImage(image, x, y, width, height, offset[ix2 + 0], offset[ix2 + 1], width, height);\n            }\n            else {\n                context.drawImage(image, x, y, width, height, 0, 0, width, height);\n            }\n        }\n    };\n    Sprite.prototype._hitFunc = function (context) {\n        var anim = this.animation(), index = this.frameIndex(), ix4 = index * 4, set = this.animations()[anim], offsets = this.frameOffsets(), width = set[ix4 + 2], height = set[ix4 + 3];\n        context.beginPath();\n        if (offsets) {\n            var offset = offsets[anim];\n            var ix2 = index * 2;\n            context.rect(offset[ix2 + 0], offset[ix2 + 1], width, height);\n        }\n        else {\n            context.rect(0, 0, width, height);\n        }\n        context.closePath();\n        context.fillShape(this);\n    };\n    Sprite.prototype._useBufferCanvas = function () {\n        return ((this.hasShadow() || this.getAbsoluteOpacity() !== 1) && this.hasStroke());\n    };\n    Sprite.prototype._setInterval = function () {\n        var that = this;\n        this.interval = setInterval(function () {\n            that._updateIndex();\n        }, 1000 / this.frameRate());\n    };\n    Sprite.prototype.start = function () {\n        if (this.isRunning()) {\n            return;\n        }\n        var layer = this.getLayer();\n        this.anim.setLayers(layer);\n        this._setInterval();\n        this.anim.start();\n    };\n    Sprite.prototype.stop = function () {\n        this.anim.stop();\n        clearInterval(this.interval);\n    };\n    Sprite.prototype.isRunning = function () {\n        return this.anim.isRunning();\n    };\n    Sprite.prototype._updateIndex = function () {\n        var index = this.frameIndex(), animation = this.animation(), animations = this.animations(), anim = animations[animation], len = anim.length / 4;\n        if (index < len - 1) {\n            this.frameIndex(index + 1);\n        }\n        else {\n            this.frameIndex(0);\n        }\n    };\n    return Sprite;\n}(Shape_1.Shape));\nexports.Sprite = Sprite;\nSprite.prototype.className = 'Sprite';\nGlobal_1._registerNode(Sprite);\nFactory_1.Factory.addGetterSetter(Sprite, 'animation');\nFactory_1.Factory.addGetterSetter(Sprite, 'animations');\nFactory_1.Factory.addGetterSetter(Sprite, 'frameOffsets');\nFactory_1.Factory.addGetterSetter(Sprite, 'image');\nFactory_1.Factory.addGetterSetter(Sprite, 'frameIndex', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Sprite, 'frameRate', 17, Validators_1.getNumberValidator());\nFactory_1.Factory.backCompat(Sprite, {\n    index: 'frameIndex',\n    getIndex: 'getFrameIndex',\n    setIndex: 'setFrameIndex'\n});\nUtil_1.Collection.mapMethods(Sprite);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar Star = (function (_super) {\n    __extends(Star, _super);\n    function Star() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Star.prototype._sceneFunc = function (context) {\n        var innerRadius = this.innerRadius(), outerRadius = this.outerRadius(), numPoints = this.numPoints();\n        context.beginPath();\n        context.moveTo(0, 0 - outerRadius);\n        for (var n = 1; n < numPoints * 2; n++) {\n            var radius = n % 2 === 0 ? outerRadius : innerRadius;\n            var x = radius * Math.sin((n * Math.PI) / numPoints);\n            var y = -1 * radius * Math.cos((n * Math.PI) / numPoints);\n            context.lineTo(x, y);\n        }\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Star.prototype.getWidth = function () {\n        return this.outerRadius() * 2;\n    };\n    Star.prototype.getHeight = function () {\n        return this.outerRadius() * 2;\n    };\n    Star.prototype.setWidth = function (width) {\n        this.outerRadius(width / 2);\n    };\n    Star.prototype.setHeight = function (height) {\n        this.outerRadius(height / 2);\n    };\n    return Star;\n}(Shape_1.Shape));\nexports.Star = Star;\nStar.prototype.className = 'Star';\nStar.prototype._centroid = true;\nStar.prototype._attrsAffectingSize = ['innerRadius', 'outerRadius'];\nGlobal_1._registerNode(Star);\nFactory_1.Factory.addGetterSetter(Star, 'numPoints', 5, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Star, 'innerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Star, 'outerRadius', 0, Validators_1.getNumberValidator());\nUtil_1.Collection.mapMethods(Star);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Global_1 = require(\"../Global\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_2 = require(\"../Global\");\nvar AUTO = 'auto', CENTER = 'center', JUSTIFY = 'justify', CHANGE_KONVA = 'Change.konva', CONTEXT_2D = '2d', DASH = '-', LEFT = 'left', TEXT = 'text', TEXT_UPPER = 'Text', TOP = 'top', BOTTOM = 'bottom', MIDDLE = 'middle', NORMAL = 'normal', PX_SPACE = 'px ', SPACE = ' ', RIGHT = 'right', WORD = 'word', CHAR = 'char', NONE = 'none', ELLIPSIS = '…', ATTR_CHANGE_LIST = [\n    'fontFamily',\n    'fontSize',\n    'fontStyle',\n    'fontVariant',\n    'padding',\n    'align',\n    'verticalAlign',\n    'lineHeight',\n    'text',\n    'width',\n    'height',\n    'wrap',\n    'ellipsis',\n    'letterSpacing'\n], attrChangeListLen = ATTR_CHANGE_LIST.length;\nvar dummyContext;\nfunction getDummyContext() {\n    if (dummyContext) {\n        return dummyContext;\n    }\n    dummyContext = Util_1.Util.createCanvasElement().getContext(CONTEXT_2D);\n    return dummyContext;\n}\nfunction _fillFunc(context) {\n    context.fillText(this._partialText, this._partialTextX, this._partialTextY);\n}\nfunction _strokeFunc(context) {\n    context.strokeText(this._partialText, this._partialTextX, this._partialTextY);\n}\nfunction checkDefaultFill(config) {\n    config = config || {};\n    if (!config.fillLinearGradientColorStops &&\n        !config.fillRadialGradientColorStops &&\n        !config.fillPatternImage) {\n        config.fill = config.fill || 'black';\n    }\n    return config;\n}\nvar trimRight = String.prototype.trimRight ||\n    function polyfill() {\n        return this.replace(/[\\s\\xa0]+$/, '');\n    };\nvar Text = (function (_super) {\n    __extends(Text, _super);\n    function Text(config) {\n        var _this = _super.call(this, checkDefaultFill(config)) || this;\n        _this._partialTextX = 0;\n        _this._partialTextY = 0;\n        for (var n = 0; n < attrChangeListLen; n++) {\n            _this.on(ATTR_CHANGE_LIST[n] + CHANGE_KONVA, _this._setTextData);\n        }\n        _this._setTextData();\n        return _this;\n    }\n    Text.prototype._sceneFunc = function (context) {\n        var padding = this.padding(), fontSize = this.fontSize(), lineHeightPx = this.lineHeight() * fontSize, textArr = this.textArr, textArrLen = textArr.length, verticalAlign = this.verticalAlign(), alignY = 0, align = this.align(), totalWidth = this.getWidth(), letterSpacing = this.letterSpacing(), fill = this.fill(), textDecoration = this.textDecoration(), shouldUnderline = textDecoration.indexOf('underline') !== -1, shouldLineThrough = textDecoration.indexOf('line-through') !== -1, n;\n        var translateY = 0;\n        var translateY = lineHeightPx / 2;\n        var lineTranslateX = 0;\n        var lineTranslateY = 0;\n        context.setAttr('font', this._getContextFont());\n        context.setAttr('textBaseline', MIDDLE);\n        context.setAttr('textAlign', LEFT);\n        if (verticalAlign === MIDDLE) {\n            alignY = (this.getHeight() - textArrLen * lineHeightPx - padding * 2) / 2;\n        }\n        else if (verticalAlign === BOTTOM) {\n            alignY = this.getHeight() - textArrLen * lineHeightPx - padding * 2;\n        }\n        context.translate(padding, alignY + padding);\n        for (n = 0; n < textArrLen; n++) {\n            var lineTranslateX = 0;\n            var lineTranslateY = 0;\n            var obj = textArr[n], text = obj.text, width = obj.width, lastLine = n !== textArrLen - 1, spacesNumber, oneWord, lineWidth;\n            context.save();\n            if (align === RIGHT) {\n                lineTranslateX += totalWidth - width - padding * 2;\n            }\n            else if (align === CENTER) {\n                lineTranslateX += (totalWidth - width - padding * 2) / 2;\n            }\n            if (shouldUnderline) {\n                context.save();\n                context.beginPath();\n                context.moveTo(lineTranslateX, translateY + lineTranslateY + Math.round(fontSize / 2));\n                spacesNumber = text.split(' ').length - 1;\n                oneWord = spacesNumber === 0;\n                lineWidth =\n                    align === JUSTIFY && lastLine && !oneWord\n                        ? totalWidth - padding * 2\n                        : width;\n                context.lineTo(lineTranslateX + Math.round(lineWidth), translateY + lineTranslateY + Math.round(fontSize / 2));\n                context.lineWidth = fontSize / 15;\n                context.strokeStyle = fill;\n                context.stroke();\n                context.restore();\n            }\n            if (shouldLineThrough) {\n                context.save();\n                context.beginPath();\n                context.moveTo(lineTranslateX, translateY + lineTranslateY);\n                spacesNumber = text.split(' ').length - 1;\n                oneWord = spacesNumber === 0;\n                lineWidth =\n                    align === JUSTIFY && lastLine && !oneWord\n                        ? totalWidth - padding * 2\n                        : width;\n                context.lineTo(lineTranslateX + Math.round(lineWidth), translateY + lineTranslateY);\n                context.lineWidth = fontSize / 15;\n                context.strokeStyle = fill;\n                context.stroke();\n                context.restore();\n            }\n            if (letterSpacing !== 0 || align === JUSTIFY) {\n                spacesNumber = text.split(' ').length - 1;\n                for (var li = 0; li < text.length; li++) {\n                    var letter = text[li];\n                    if (letter === ' ' && n !== textArrLen - 1 && align === JUSTIFY) {\n                        lineTranslateX += Math.floor((totalWidth - padding * 2 - width) / spacesNumber);\n                    }\n                    this._partialTextX = lineTranslateX;\n                    this._partialTextY = translateY + lineTranslateY;\n                    this._partialText = letter;\n                    context.fillStrokeShape(this);\n                    lineTranslateX +=\n                        Math.round(this.measureSize(letter).width) + letterSpacing;\n                }\n            }\n            else {\n                this._partialTextX = lineTranslateX;\n                this._partialTextY = translateY + lineTranslateY;\n                this._partialText = text;\n                context.fillStrokeShape(this);\n            }\n            context.restore();\n            if (textArrLen > 1) {\n                translateY += lineHeightPx;\n            }\n        }\n    };\n    Text.prototype._hitFunc = function (context) {\n        var width = this.getWidth(), height = this.getHeight();\n        context.beginPath();\n        context.rect(0, 0, width, height);\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Text.prototype.setText = function (text) {\n        var str = Util_1.Util._isString(text)\n            ? text\n            : text === null || text === undefined\n                ? ''\n                : text + '';\n        this._setAttr(TEXT, str);\n        return this;\n    };\n    Text.prototype.getWidth = function () {\n        var isAuto = this.attrs.width === AUTO || this.attrs.width === undefined;\n        return isAuto ? this.getTextWidth() + this.padding() * 2 : this.attrs.width;\n    };\n    Text.prototype.getHeight = function () {\n        var isAuto = this.attrs.height === AUTO || this.attrs.height === undefined;\n        return isAuto\n            ? this.fontSize() * this.textArr.length * this.lineHeight() +\n                this.padding() * 2\n            : this.attrs.height;\n    };\n    Text.prototype.getTextWidth = function () {\n        return this.textWidth;\n    };\n    Text.prototype.getTextHeight = function () {\n        Util_1.Util.warn('text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height.');\n        return this.textHeight;\n    };\n    Text.prototype.measureSize = function (text) {\n        var _context = getDummyContext(), fontSize = this.fontSize(), metrics;\n        _context.save();\n        _context.font = this._getContextFont();\n        metrics = _context.measureText(text);\n        _context.restore();\n        return {\n            width: metrics.width,\n            height: fontSize\n        };\n    };\n    Text.prototype._getContextFont = function () {\n        if (Global_1.Konva.UA.isIE) {\n            return (this.fontStyle() +\n                SPACE +\n                this.fontSize() +\n                PX_SPACE +\n                this.fontFamily());\n        }\n        return (this.fontStyle() +\n            SPACE +\n            this.fontVariant() +\n            SPACE +\n            this.fontSize() +\n            PX_SPACE +\n            this.fontFamily());\n    };\n    Text.prototype._addTextLine = function (line) {\n        if (this.align() === JUSTIFY) {\n            line = line.trim();\n        }\n        var width = this._getTextWidth(line);\n        return this.textArr.push({ text: line, width: width });\n    };\n    Text.prototype._getTextWidth = function (text) {\n        var letterSpacing = this.letterSpacing();\n        var length = text.length;\n        return (getDummyContext().measureText(text).width +\n            (length ? letterSpacing * (length - 1) : 0));\n    };\n    Text.prototype._setTextData = function () {\n        var lines = this.text().split('\\n'), fontSize = +this.fontSize(), textWidth = 0, lineHeightPx = this.lineHeight() * fontSize, width = this.attrs.width, height = this.attrs.height, fixedWidth = width !== AUTO && width !== undefined, fixedHeight = height !== AUTO && height !== undefined, padding = this.padding(), maxWidth = width - padding * 2, maxHeightPx = height - padding * 2, currentHeightPx = 0, wrap = this.wrap(), shouldWrap = wrap !== NONE, wrapAtWord = wrap !== CHAR && shouldWrap, shouldAddEllipsis = this.ellipsis() && !shouldWrap;\n        this.textArr = [];\n        getDummyContext().font = this._getContextFont();\n        var additionalWidth = shouldAddEllipsis ? this._getTextWidth(ELLIPSIS) : 0;\n        for (var i = 0, max = lines.length; i < max; ++i) {\n            var line = lines[i];\n            var lineWidth = this._getTextWidth(line);\n            if (fixedWidth && lineWidth > maxWidth) {\n                while (line.length > 0) {\n                    var low = 0, high = line.length, match = '', matchWidth = 0;\n                    while (low < high) {\n                        var mid = (low + high) >>> 1, substr = line.slice(0, mid + 1), substrWidth = this._getTextWidth(substr) + additionalWidth;\n                        if (substrWidth <= maxWidth) {\n                            low = mid + 1;\n                            match = substr + (shouldAddEllipsis ? ELLIPSIS : '');\n                            matchWidth = substrWidth;\n                        }\n                        else {\n                            high = mid;\n                        }\n                    }\n                    if (match) {\n                        if (wrapAtWord) {\n                            var wrapIndex;\n                            var nextChar = line[match.length];\n                            var nextIsSpaceOrDash = nextChar === SPACE || nextChar === DASH;\n                            if (nextIsSpaceOrDash && matchWidth <= maxWidth) {\n                                wrapIndex = match.length;\n                            }\n                            else {\n                                wrapIndex =\n                                    Math.max(match.lastIndexOf(SPACE), match.lastIndexOf(DASH)) +\n                                        1;\n                            }\n                            if (wrapIndex > 0) {\n                                low = wrapIndex;\n                                match = match.slice(0, low);\n                                matchWidth = this._getTextWidth(match);\n                            }\n                        }\n                        match = match.trimRight();\n                        this._addTextLine(match);\n                        textWidth = Math.max(textWidth, matchWidth);\n                        currentHeightPx += lineHeightPx;\n                        if (!shouldWrap ||\n                            (fixedHeight && currentHeightPx + lineHeightPx > maxHeightPx)) {\n                            break;\n                        }\n                        line = line.slice(low);\n                        line = line.trimLeft();\n                        if (line.length > 0) {\n                            lineWidth = this._getTextWidth(line);\n                            if (lineWidth <= maxWidth) {\n                                this._addTextLine(line);\n                                currentHeightPx += lineHeightPx;\n                                textWidth = Math.max(textWidth, lineWidth);\n                                break;\n                            }\n                        }\n                    }\n                    else {\n                        break;\n                    }\n                }\n            }\n            else {\n                this._addTextLine(line);\n                currentHeightPx += lineHeightPx;\n                textWidth = Math.max(textWidth, lineWidth);\n            }\n            if (fixedHeight && currentHeightPx + lineHeightPx > maxHeightPx) {\n                break;\n            }\n        }\n        this.textHeight = fontSize;\n        this.textWidth = textWidth;\n    };\n    Text.prototype.getStrokeScaleEnabled = function () {\n        return true;\n    };\n    return Text;\n}(Shape_1.Shape));\nexports.Text = Text;\nText.prototype._fillFunc = _fillFunc;\nText.prototype._strokeFunc = _strokeFunc;\nText.prototype.className = TEXT_UPPER;\nText.prototype._attrsAffectingSize = [\n    'text',\n    'fontSize',\n    'padding',\n    'wrap',\n    'lineHeight'\n];\nGlobal_2._registerNode(Text);\nFactory_1.Factory.overWriteSetter(Text, 'width', Validators_1.getNumberOrAutoValidator());\nFactory_1.Factory.overWriteSetter(Text, 'height', Validators_1.getNumberOrAutoValidator());\nFactory_1.Factory.addGetterSetter(Text, 'fontFamily', 'Arial');\nFactory_1.Factory.addGetterSetter(Text, 'fontSize', 12, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Text, 'fontStyle', NORMAL);\nFactory_1.Factory.addGetterSetter(Text, 'fontVariant', NORMAL);\nFactory_1.Factory.addGetterSetter(Text, 'padding', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Text, 'align', LEFT);\nFactory_1.Factory.addGetterSetter(Text, 'verticalAlign', TOP);\nFactory_1.Factory.addGetterSetter(Text, 'lineHeight', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Text, 'wrap', WORD);\nFactory_1.Factory.addGetterSetter(Text, 'ellipsis', false);\nFactory_1.Factory.addGetterSetter(Text, 'letterSpacing', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Text, 'text', '', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Text, 'textDecoration', '');\nUtil_1.Collection.mapMethods(Text);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Path_1 = require(\"./Path\");\nvar Text_1 = require(\"./Text\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_1 = require(\"../Global\");\nvar EMPTY_STRING = '', NORMAL = 'normal';\nfunction _fillFunc(context) {\n    context.fillText(this.partialText, 0, 0);\n}\nfunction _strokeFunc(context) {\n    context.strokeText(this.partialText, 0, 0);\n}\nvar TextPath = (function (_super) {\n    __extends(TextPath, _super);\n    function TextPath(config) {\n        var _this = _super.call(this, config) || this;\n        _this.dummyCanvas = Util_1.Util.createCanvasElement();\n        _this.dataArray = [];\n        _this.dataArray = Path_1.Path.parsePathData(_this.attrs.data);\n        _this.on('dataChange.konva', function () {\n            this.dataArray = Path_1.Path.parsePathData(this.attrs.data);\n            this._setTextData();\n        });\n        _this.on('textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva', _this._setTextData);\n        if (config && config['getKerning']) {\n            Util_1.Util.warn('getKerning TextPath API is deprecated. Please use \"kerningFunc\" instead.');\n            _this.kerningFunc(config['getKerning']);\n        }\n        _this._setTextData();\n        return _this;\n    }\n    TextPath.prototype._sceneFunc = function (context) {\n        context.setAttr('font', this._getContextFont());\n        context.setAttr('textBaseline', this.textBaseline());\n        context.setAttr('textAlign', 'left');\n        context.save();\n        var textDecoration = this.textDecoration();\n        var fill = this.fill();\n        var fontSize = this.fontSize();\n        var glyphInfo = this.glyphInfo;\n        if (textDecoration === 'underline') {\n            context.beginPath();\n        }\n        for (var i = 0; i < glyphInfo.length; i++) {\n            context.save();\n            var p0 = glyphInfo[i].p0;\n            context.translate(p0.x, p0.y);\n            context.rotate(glyphInfo[i].rotation);\n            this.partialText = glyphInfo[i].text;\n            context.fillStrokeShape(this);\n            if (textDecoration === 'underline') {\n                if (i === 0) {\n                    context.moveTo(0, fontSize / 2 + 1);\n                }\n                context.lineTo(fontSize, fontSize / 2 + 1);\n            }\n            context.restore();\n        }\n        if (textDecoration === 'underline') {\n            context.strokeStyle = fill;\n            context.lineWidth = fontSize / 20;\n            context.stroke();\n        }\n        context.restore();\n    };\n    TextPath.prototype._hitFunc = function (context) {\n        context.beginPath();\n        var glyphInfo = this.glyphInfo;\n        if (glyphInfo.length >= 1) {\n            var p0 = glyphInfo[0].p0;\n            context.moveTo(p0.x, p0.y);\n        }\n        for (var i = 0; i < glyphInfo.length; i++) {\n            var p1 = glyphInfo[i].p1;\n            context.lineTo(p1.x, p1.y);\n        }\n        context.setAttr('lineWidth', this.fontSize());\n        context.setAttr('strokeStyle', this.colorKey);\n        context.stroke();\n    };\n    TextPath.prototype.getTextWidth = function () {\n        return this.textWidth;\n    };\n    TextPath.prototype.getTextHeight = function () {\n        Util_1.Util.warn('text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height.');\n        return this.textHeight;\n    };\n    TextPath.prototype.setText = function (text) {\n        return Text_1.Text.prototype.setText.call(this, text);\n    };\n    TextPath.prototype._getContextFont = function () {\n        return Text_1.Text.prototype._getContextFont.call(this);\n    };\n    TextPath.prototype._getTextSize = function (text) {\n        var dummyCanvas = this.dummyCanvas;\n        var _context = dummyCanvas.getContext('2d');\n        _context.save();\n        _context.font = this._getContextFont();\n        var metrics = _context.measureText(text);\n        _context.restore();\n        return {\n            width: metrics.width,\n            height: parseInt(this.attrs.fontSize, 10)\n        };\n    };\n    TextPath.prototype._setTextData = function () {\n        var that = this;\n        var size = this._getTextSize(this.attrs.text);\n        var letterSpacing = this.letterSpacing();\n        var align = this.align();\n        var kerningFunc = this.kerningFunc();\n        this.textWidth = size.width;\n        this.textHeight = size.height;\n        var textFullWidth = Math.max(this.textWidth + ((this.attrs.text || '').length - 1) * letterSpacing, 0);\n        this.glyphInfo = [];\n        var fullPathWidth = 0;\n        for (var l = 0; l < that.dataArray.length; l++) {\n            if (that.dataArray[l].pathLength > 0) {\n                fullPathWidth += that.dataArray[l].pathLength;\n            }\n        }\n        var offset = 0;\n        if (align === 'center') {\n            offset = Math.max(0, fullPathWidth / 2 - textFullWidth / 2);\n        }\n        if (align === 'right') {\n            offset = Math.max(0, fullPathWidth - textFullWidth);\n        }\n        var charArr = this.text().split('');\n        var spacesNumber = this.text().split(' ').length - 1;\n        var p0, p1, pathCmd;\n        var pIndex = -1;\n        var currentT = 0;\n        var getNextPathSegment = function () {\n            currentT = 0;\n            var pathData = that.dataArray;\n            for (var j = pIndex + 1; j < pathData.length; j++) {\n                if (pathData[j].pathLength > 0) {\n                    pIndex = j;\n                    return pathData[j];\n                }\n                else if (pathData[j].command === 'M') {\n                    p0 = {\n                        x: pathData[j].points[0],\n                        y: pathData[j].points[1]\n                    };\n                }\n            }\n            return {};\n        };\n        var findSegmentToFitCharacter = function (c) {\n            var glyphWidth = that._getTextSize(c).width + letterSpacing;\n            if (c === ' ' && align === 'justify') {\n                glyphWidth += (fullPathWidth - textFullWidth) / spacesNumber;\n            }\n            var currLen = 0;\n            var attempts = 0;\n            p1 = undefined;\n            while (Math.abs(glyphWidth - currLen) / glyphWidth > 0.01 &&\n                attempts < 25) {\n                attempts++;\n                var cumulativePathLength = currLen;\n                while (pathCmd === undefined) {\n                    pathCmd = getNextPathSegment();\n                    if (pathCmd &&\n                        cumulativePathLength + pathCmd.pathLength < glyphWidth) {\n                        cumulativePathLength += pathCmd.pathLength;\n                        pathCmd = undefined;\n                    }\n                }\n                if (pathCmd === {} || p0 === undefined) {\n                    return undefined;\n                }\n                var needNewSegment = false;\n                switch (pathCmd.command) {\n                    case 'L':\n                        if (Path_1.Path.getLineLength(p0.x, p0.y, pathCmd.points[0], pathCmd.points[1]) > glyphWidth) {\n                            p1 = Path_1.Path.getPointOnLine(glyphWidth, p0.x, p0.y, pathCmd.points[0], pathCmd.points[1], p0.x, p0.y);\n                        }\n                        else {\n                            pathCmd = undefined;\n                        }\n                        break;\n                    case 'A':\n                        var start = pathCmd.points[4];\n                        var dTheta = pathCmd.points[5];\n                        var end = pathCmd.points[4] + dTheta;\n                        if (currentT === 0) {\n                            currentT = start + 0.00000001;\n                        }\n                        else if (glyphWidth > currLen) {\n                            currentT += ((Math.PI / 180.0) * dTheta) / Math.abs(dTheta);\n                        }\n                        else {\n                            currentT -= ((Math.PI / 360.0) * dTheta) / Math.abs(dTheta);\n                        }\n                        if ((dTheta < 0 && currentT < end) ||\n                            (dTheta >= 0 && currentT > end)) {\n                            currentT = end;\n                            needNewSegment = true;\n                        }\n                        p1 = Path_1.Path.getPointOnEllipticalArc(pathCmd.points[0], pathCmd.points[1], pathCmd.points[2], pathCmd.points[3], currentT, pathCmd.points[6]);\n                        break;\n                    case 'C':\n                        if (currentT === 0) {\n                            if (glyphWidth > pathCmd.pathLength) {\n                                currentT = 0.00000001;\n                            }\n                            else {\n                                currentT = glyphWidth / pathCmd.pathLength;\n                            }\n                        }\n                        else if (glyphWidth > currLen) {\n                            currentT += (glyphWidth - currLen) / pathCmd.pathLength;\n                        }\n                        else {\n                            currentT -= (currLen - glyphWidth) / pathCmd.pathLength;\n                        }\n                        if (currentT > 1.0) {\n                            currentT = 1.0;\n                            needNewSegment = true;\n                        }\n                        p1 = Path_1.Path.getPointOnCubicBezier(currentT, pathCmd.start.x, pathCmd.start.y, pathCmd.points[0], pathCmd.points[1], pathCmd.points[2], pathCmd.points[3], pathCmd.points[4], pathCmd.points[5]);\n                        break;\n                    case 'Q':\n                        if (currentT === 0) {\n                            currentT = glyphWidth / pathCmd.pathLength;\n                        }\n                        else if (glyphWidth > currLen) {\n                            currentT += (glyphWidth - currLen) / pathCmd.pathLength;\n                        }\n                        else {\n                            currentT -= (currLen - glyphWidth) / pathCmd.pathLength;\n                        }\n                        if (currentT > 1.0) {\n                            currentT = 1.0;\n                            needNewSegment = true;\n                        }\n                        p1 = Path_1.Path.getPointOnQuadraticBezier(currentT, pathCmd.start.x, pathCmd.start.y, pathCmd.points[0], pathCmd.points[1], pathCmd.points[2], pathCmd.points[3]);\n                        break;\n                }\n                if (p1 !== undefined) {\n                    currLen = Path_1.Path.getLineLength(p0.x, p0.y, p1.x, p1.y);\n                }\n                if (needNewSegment) {\n                    needNewSegment = false;\n                    pathCmd = undefined;\n                }\n            }\n        };\n        var testChar = 'C';\n        var glyphWidth = that._getTextSize(testChar).width + letterSpacing;\n        var lettersInOffset = offset / glyphWidth - 1;\n        for (var k = 0; k < lettersInOffset; k++) {\n            findSegmentToFitCharacter(testChar);\n            if (p0 === undefined || p1 === undefined) {\n                break;\n            }\n            p0 = p1;\n        }\n        for (var i = 0; i < charArr.length; i++) {\n            findSegmentToFitCharacter(charArr[i]);\n            if (p0 === undefined || p1 === undefined) {\n                break;\n            }\n            var width = Path_1.Path.getLineLength(p0.x, p0.y, p1.x, p1.y);\n            var kern = 0;\n            if (kerningFunc) {\n                try {\n                    kern = kerningFunc(charArr[i - 1], charArr[i]) * this.fontSize();\n                }\n                catch (e) {\n                    kern = 0;\n                }\n            }\n            p0.x += kern;\n            p1.x += kern;\n            this.textWidth += kern;\n            var midpoint = Path_1.Path.getPointOnLine(kern + width / 2.0, p0.x, p0.y, p1.x, p1.y);\n            var rotation = Math.atan2(p1.y - p0.y, p1.x - p0.x);\n            this.glyphInfo.push({\n                transposeX: midpoint.x,\n                transposeY: midpoint.y,\n                text: charArr[i],\n                rotation: rotation,\n                p0: p0,\n                p1: p1\n            });\n            p0 = p1;\n        }\n    };\n    TextPath.prototype.getSelfRect = function () {\n        if (!this.glyphInfo.length) {\n            return {\n                x: 0,\n                y: 0,\n                width: 0,\n                height: 0\n            };\n        }\n        var points = [];\n        this.glyphInfo.forEach(function (info) {\n            points.push(info.p0.x);\n            points.push(info.p0.y);\n            points.push(info.p1.x);\n            points.push(info.p1.y);\n        });\n        var minX = points[0] || 0;\n        var maxX = points[0] || 0;\n        var minY = points[1] || 0;\n        var maxY = points[1] || 0;\n        var x, y;\n        for (var i = 0; i < points.length / 2; i++) {\n            x = points[i * 2];\n            y = points[i * 2 + 1];\n            minX = Math.min(minX, x);\n            maxX = Math.max(maxX, x);\n            minY = Math.min(minY, y);\n            maxY = Math.max(maxY, y);\n        }\n        var fontSize = this.fontSize();\n        return {\n            x: minX - fontSize / 2,\n            y: minY - fontSize / 2,\n            width: maxX - minX + fontSize,\n            height: maxY - minY + fontSize\n        };\n    };\n    return TextPath;\n}(Shape_1.Shape));\nexports.TextPath = TextPath;\nTextPath.prototype._fillFunc = _fillFunc;\nTextPath.prototype._strokeFunc = _strokeFunc;\nTextPath.prototype._fillFuncHit = _fillFunc;\nTextPath.prototype._strokeFuncHit = _strokeFunc;\nTextPath.prototype.className = 'TextPath';\nTextPath.prototype._attrsAffectingSize = ['text', 'fontSize', 'data'];\nGlobal_1._registerNode(TextPath);\nFactory_1.Factory.addGetterSetter(TextPath, 'data');\nFactory_1.Factory.addGetterSetter(TextPath, 'fontFamily', 'Arial');\nFactory_1.Factory.addGetterSetter(TextPath, 'fontSize', 12, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(TextPath, 'fontStyle', NORMAL);\nFactory_1.Factory.addGetterSetter(TextPath, 'align', 'left');\nFactory_1.Factory.addGetterSetter(TextPath, 'letterSpacing', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(TextPath, 'textBaseline', 'middle');\nFactory_1.Factory.addGetterSetter(TextPath, 'fontVariant', NORMAL);\nFactory_1.Factory.addGetterSetter(TextPath, 'text', EMPTY_STRING);\nFactory_1.Factory.addGetterSetter(TextPath, 'textDecoration', null);\nFactory_1.Factory.addGetterSetter(TextPath, 'kerningFunc', null);\nUtil_1.Collection.mapMethods(TextPath);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Shape_1 = require(\"../Shape\");\nvar Rect_1 = require(\"./Rect\");\nvar Group_1 = require(\"../Group\");\nvar Global_1 = require(\"../Global\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_2 = require(\"../Global\");\nvar EVENTS_NAME = 'tr-konva';\nvar ATTR_CHANGE_LIST = [\n    'resizeEnabledChange',\n    'rotateAnchorOffsetChange',\n    'rotateEnabledChange',\n    'enabledAnchorsChange',\n    'anchorSizeChange',\n    'borderEnabledChange',\n    'borderStrokeChange',\n    'borderStrokeWidthChange',\n    'borderDashChange',\n    'anchorStrokeChange',\n    'anchorStrokeWidthChange',\n    'anchorFillChange',\n    'anchorCornerRadiusChange',\n    'ignoreStrokeChange'\n]\n    .map(function (e) { return e + (\".\" + EVENTS_NAME); })\n    .join(' ');\nvar NODE_RECT = 'nodeRect';\nvar TRANSFORM_CHANGE_STR = [\n    'widthChange',\n    'heightChange',\n    'scaleXChange',\n    'scaleYChange',\n    'skewXChange',\n    'skewYChange',\n    'rotationChange',\n    'offsetXChange',\n    'offsetYChange',\n    'transformsEnabledChange',\n    'strokeWidthChange'\n]\n    .map(function (e) { return e + (\".\" + EVENTS_NAME); })\n    .join(' ');\nvar ANGLES = {\n    'top-left': -45,\n    'top-center': 0,\n    'top-right': 45,\n    'middle-right': -90,\n    'middle-left': 90,\n    'bottom-left': -135,\n    'bottom-center': 180,\n    'bottom-right': 135\n};\nvar TOUCH_DEVICE = 'ontouchstart' in Global_1.Konva._global;\nfunction getCursor(anchorName, rad, isMirrored) {\n    if (anchorName === 'rotater') {\n        return 'crosshair';\n    }\n    rad += Util_1.Util._degToRad(ANGLES[anchorName] || 0);\n    if (isMirrored) {\n        rad *= -1;\n    }\n    var angle = ((Util_1.Util._radToDeg(rad) % 360) + 360) % 360;\n    if (Util_1.Util._inRange(angle, 315 + 22.5, 360) || Util_1.Util._inRange(angle, 0, 22.5)) {\n        return 'ns-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 45 - 22.5, 45 + 22.5)) {\n        return 'nesw-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 90 - 22.5, 90 + 22.5)) {\n        return 'ew-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 135 - 22.5, 135 + 22.5)) {\n        return 'nwse-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 180 - 22.5, 180 + 22.5)) {\n        return 'ns-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 225 - 22.5, 225 + 22.5)) {\n        return 'nesw-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 270 - 22.5, 270 + 22.5)) {\n        return 'ew-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 315 - 22.5, 315 + 22.5)) {\n        return 'nwse-resize';\n    }\n    else {\n        Util_1.Util.error('Transformer has unknown angle for cursor detection: ' + angle);\n        return 'pointer';\n    }\n}\nvar ANCHORS_NAMES = [\n    'top-left',\n    'top-center',\n    'top-right',\n    'middle-right',\n    'middle-left',\n    'bottom-left',\n    'bottom-center',\n    'bottom-right'\n];\nvar MAX_SAFE_INTEGER = 100000000;\nvar Transformer = (function (_super) {\n    __extends(Transformer, _super);\n    function Transformer(config) {\n        var _this = _super.call(this, config) || this;\n        _this._transforming = false;\n        _this._createElements();\n        _this._handleMouseMove = _this._handleMouseMove.bind(_this);\n        _this._handleMouseUp = _this._handleMouseUp.bind(_this);\n        _this.update = _this.update.bind(_this);\n        _this.on(ATTR_CHANGE_LIST, _this.update);\n        if (_this.getNode()) {\n            _this.update();\n        }\n        return _this;\n    }\n    Transformer.prototype.attachTo = function (node) {\n        this.setNode(node);\n        return this;\n    };\n    Transformer.prototype.setNode = function (node) {\n        var _this = this;\n        if (this._node) {\n            this.detach();\n        }\n        this._node = node;\n        this._resetTransformCache();\n        var additionalEvents = node._attrsAffectingSize\n            .map(function (prop) { return prop + 'Change.' + EVENTS_NAME; })\n            .join(' ');\n        var onChange = function () {\n            _this._resetTransformCache();\n            if (!_this._transforming) {\n                _this.update();\n            }\n        };\n        node.on(additionalEvents, onChange);\n        node.on(TRANSFORM_CHANGE_STR, onChange);\n        node.on(\"xChange.\" + EVENTS_NAME + \" yChange.\" + EVENTS_NAME, function () {\n            return _this._resetTransformCache();\n        });\n        var elementsCreated = !!this.findOne('.top-left');\n        if (elementsCreated) {\n            this.update();\n        }\n        return this;\n    };\n    Transformer.prototype.getNode = function () {\n        return this._node;\n    };\n    Transformer.prototype.getActiveAnchor = function () {\n        return this._movingAnchorName;\n    };\n    Transformer.prototype.detach = function () {\n        if (this.getNode()) {\n            this.getNode().off('.' + EVENTS_NAME);\n            this._node = undefined;\n        }\n        this._resetTransformCache();\n    };\n    Transformer.prototype._resetTransformCache = function () {\n        this._clearCache(NODE_RECT);\n        this._clearCache('transform');\n        this._clearSelfAndDescendantCache('absoluteTransform');\n    };\n    Transformer.prototype._getNodeRect = function () {\n        return this._getCache(NODE_RECT, this.__getNodeRect);\n    };\n    Transformer.prototype.__getNodeRect = function () {\n        var node = this.getNode();\n        if (!node) {\n            return {\n                x: -MAX_SAFE_INTEGER,\n                y: -MAX_SAFE_INTEGER,\n                width: 0,\n                height: 0,\n                rotation: 0\n            };\n        }\n        if (node.parent && this.parent && node.parent !== this.parent) {\n            Util_1.Util.warn('Transformer and attached node have different parents. Konva does not support such case right now. Please move Transformer to the parent of attaching node.');\n        }\n        var rect = node.getClientRect({\n            skipTransform: true,\n            skipShadow: true,\n            skipStroke: this.ignoreStroke()\n        });\n        var rotation = Global_1.Konva.getAngle(node.rotation());\n        var dx = rect.x * node.scaleX() - node.offsetX() * node.scaleX();\n        var dy = rect.y * node.scaleY() - node.offsetY() * node.scaleY();\n        return {\n            x: node.x() + dx * Math.cos(rotation) + dy * Math.sin(-rotation),\n            y: node.y() + dy * Math.cos(rotation) + dx * Math.sin(rotation),\n            width: rect.width * node.scaleX(),\n            height: rect.height * node.scaleY(),\n            rotation: node.rotation()\n        };\n    };\n    Transformer.prototype.getX = function () {\n        return this._getNodeRect().x;\n    };\n    Transformer.prototype.getY = function () {\n        return this._getNodeRect().y;\n    };\n    Transformer.prototype.getRotation = function () {\n        return this._getNodeRect().rotation;\n    };\n    Transformer.prototype.getWidth = function () {\n        return this._getNodeRect().width;\n    };\n    Transformer.prototype.getHeight = function () {\n        return this._getNodeRect().height;\n    };\n    Transformer.prototype._createElements = function () {\n        this._createBack();\n        ANCHORS_NAMES.forEach(function (name) {\n            this._createAnchor(name);\n        }.bind(this));\n        this._createAnchor('rotater');\n    };\n    Transformer.prototype._createAnchor = function (name) {\n        var _this = this;\n        var anchor = new Rect_1.Rect({\n            stroke: 'rgb(0, 161, 255)',\n            fill: 'white',\n            strokeWidth: 1,\n            name: name + ' _anchor',\n            dragDistance: 0,\n            draggable: true,\n            hitStrokeWidth: TOUCH_DEVICE ? 10 : 'auto'\n        });\n        var self = this;\n        anchor.on('mousedown touchstart', function (e) {\n            self._handleMouseDown(e);\n        });\n        anchor.on('dragstart', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('dragmove', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('dragend', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('mouseenter', function () {\n            var rad = Global_1.Konva.getAngle(_this.getAbsoluteRotation());\n            var scale = _this.getNode().getAbsoluteScale();\n            var isMirrored = scale.y * scale.x < 0;\n            var cursor = getCursor(name, rad, isMirrored);\n            anchor.getStage().content.style.cursor = cursor;\n            _this._cursorChange = true;\n        });\n        anchor.on('mouseout', function () {\n            if (!anchor.getStage() || !anchor.getParent()) {\n                return;\n            }\n            anchor.getStage().content.style.cursor = '';\n            _this._cursorChange = false;\n        });\n        this.add(anchor);\n    };\n    Transformer.prototype._createBack = function () {\n        var back = new Shape_1.Shape({\n            name: 'back',\n            width: 0,\n            height: 0,\n            listening: false,\n            sceneFunc: function (ctx) {\n                var tr = this.getParent();\n                var padding = tr.padding();\n                ctx.beginPath();\n                ctx.rect(-padding, -padding, this.width() + padding * 2, this.height() + padding * 2);\n                ctx.moveTo(this.width() / 2, -padding);\n                if (tr.rotateEnabled()) {\n                    ctx.lineTo(this.width() / 2, -tr.rotateAnchorOffset() * Util_1.Util._sign(this.height()) - padding);\n                }\n                ctx.fillStrokeShape(this);\n            }\n        });\n        this.add(back);\n    };\n    Transformer.prototype._handleMouseDown = function (e) {\n        this._movingAnchorName = e.target.name().split(' ')[0];\n        var attrs = this._getNodeRect();\n        var width = attrs.width;\n        var height = attrs.height;\n        var hypotenuse = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));\n        this.sin = Math.abs(height / hypotenuse);\n        this.cos = Math.abs(width / hypotenuse);\n        window.addEventListener('mousemove', this._handleMouseMove);\n        window.addEventListener('touchmove', this._handleMouseMove);\n        window.addEventListener('mouseup', this._handleMouseUp, true);\n        window.addEventListener('touchend', this._handleMouseUp, true);\n        this._transforming = true;\n        this._fire('transformstart', { evt: e, target: this.getNode() });\n        this.getNode()._fire('transformstart', { evt: e, target: this.getNode() });\n    };\n    Transformer.prototype._handleMouseMove = function (e) {\n        var x, y, newHypotenuse;\n        var anchorNode = this.findOne('.' + this._movingAnchorName);\n        var stage = anchorNode.getStage();\n        stage.setPointersPositions(e);\n        anchorNode.setAbsolutePosition(stage.getPointerPosition());\n        var keepProportion = this.keepRatio() || e.shiftKey;\n        var padding = this.padding();\n        if (this._movingAnchorName === 'top-left') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - anchorNode.x() - padding * 2, 2) +\n                    Math.pow(this.findOne('.bottom-right').y() - anchorNode.y() - padding * 2, 2));\n                var reverseX = this.findOne('.top-left').x() > this.findOne('.bottom-right').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.top-left').y() > this.findOne('.bottom-right').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.top-left').x(this.findOne('.bottom-right').x() - x - padding * 2);\n                this.findOne('.top-left').y(this.findOne('.bottom-right').y() - y - padding * 2);\n            }\n        }\n        else if (this._movingAnchorName === 'top-center') {\n            this.findOne('.top-left').y(anchorNode.y());\n        }\n        else if (this._movingAnchorName === 'top-right') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(anchorNode.x() - this.findOne('.bottom-left').x() - padding * 2, 2) +\n                    Math.pow(this.findOne('.bottom-left').y() - anchorNode.y() - padding * 2, 2));\n                var reverseX = this.findOne('.top-right').x() < this.findOne('.top-left').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.top-right').y() > this.findOne('.bottom-left').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.top-right').x(x + padding);\n                this.findOne('.top-right').y(this.findOne('.bottom-left').y() - y - padding * 2);\n            }\n            var pos = anchorNode.position();\n            this.findOne('.top-left').y(pos.y);\n            this.findOne('.bottom-right').x(pos.x);\n        }\n        else if (this._movingAnchorName === 'middle-left') {\n            this.findOne('.top-left').x(anchorNode.x());\n        }\n        else if (this._movingAnchorName === 'middle-right') {\n            this.findOne('.bottom-right').x(anchorNode.x());\n        }\n        else if (this._movingAnchorName === 'bottom-left') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.top-right').x() - anchorNode.x() - padding * 2, 2) +\n                    Math.pow(anchorNode.y() - this.findOne('.top-right').y() - padding * 2, 2));\n                var reverseX = this.findOne('.top-right').x() < this.findOne('.bottom-left').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.bottom-right').y() < this.findOne('.top-left').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.bottom-left').x(this.findOne('.top-right').x() - x - padding * 2);\n                this.findOne('.bottom-left').y(y + padding);\n            }\n            pos = anchorNode.position();\n            this.findOne('.top-left').x(pos.x);\n            this.findOne('.bottom-right').y(pos.y);\n        }\n        else if (this._movingAnchorName === 'bottom-center') {\n            this.findOne('.bottom-right').y(anchorNode.y());\n        }\n        else if (this._movingAnchorName === 'bottom-right') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - padding, 2) +\n                    Math.pow(this.findOne('.bottom-right').y() - padding, 2));\n                var reverseX = this.findOne('.top-left').x() > this.findOne('.bottom-right').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.top-left').y() > this.findOne('.bottom-right').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.bottom-right').x(x + padding);\n                this.findOne('.bottom-right').y(y + padding);\n            }\n        }\n        else if (this._movingAnchorName === 'rotater') {\n            var attrs = this._getNodeRect();\n            x = anchorNode.x() - attrs.width / 2;\n            y = -anchorNode.y() + attrs.height / 2;\n            var dAlpha = Math.atan2(-y, x) + Math.PI / 2;\n            if (attrs.height < 0) {\n                dAlpha -= Math.PI;\n            }\n            var rot = Global_1.Konva.getAngle(this.rotation());\n            var newRotation = Util_1.Util._radToDeg(rot) + Util_1.Util._radToDeg(dAlpha);\n            var alpha = Global_1.Konva.getAngle(this.getNode().rotation());\n            var newAlpha = Util_1.Util._degToRad(newRotation);\n            var snaps = this.rotationSnaps();\n            var offset = Global_1.Konva.getAngle(this.rotationSnapTolerance());\n            for (var i = 0; i < snaps.length; i++) {\n                var angle = Global_1.Konva.getAngle(snaps[i]);\n                var dif = Math.abs(angle - Util_1.Util._degToRad(newRotation)) % (Math.PI * 2);\n                if (dif < offset) {\n                    newRotation = Util_1.Util._radToDeg(angle);\n                    newAlpha = Util_1.Util._degToRad(newRotation);\n                }\n            }\n            var dx = padding;\n            var dy = padding;\n            this._fitNodeInto({\n                rotation: Global_1.Konva.angleDeg ? newRotation : Util_1.Util._degToRad(newRotation),\n                x: attrs.x +\n                    (attrs.width / 2 + padding) *\n                        (Math.cos(alpha) - Math.cos(newAlpha)) +\n                    (attrs.height / 2 + padding) *\n                        (Math.sin(-alpha) - Math.sin(-newAlpha)) -\n                    (dx * Math.cos(rot) + dy * Math.sin(-rot)),\n                y: attrs.y +\n                    (attrs.height / 2 + padding) *\n                        (Math.cos(alpha) - Math.cos(newAlpha)) +\n                    (attrs.width / 2 + padding) *\n                        (Math.sin(alpha) - Math.sin(newAlpha)) -\n                    (dy * Math.cos(rot) + dx * Math.sin(rot)),\n                width: attrs.width + padding * 2,\n                height: attrs.height + padding * 2\n            }, e);\n        }\n        else {\n            console.error(new Error('Wrong position argument of selection resizer: ' +\n                this._movingAnchorName));\n        }\n        if (this._movingAnchorName === 'rotater') {\n            return;\n        }\n        var centeredScaling = this.centeredScaling() || e.altKey;\n        if (centeredScaling) {\n            var topLeft = this.findOne('.top-left');\n            var bottomRight = this.findOne('.bottom-right');\n            var topOffsetX = topLeft.x() + padding;\n            var topOffsetY = topLeft.y() + padding;\n            var bottomOffsetX = this.getWidth() - bottomRight.x() + padding;\n            var bottomOffsetY = this.getHeight() - bottomRight.y() + padding;\n            bottomRight.move({\n                x: -topOffsetX,\n                y: -topOffsetY\n            });\n            topLeft.move({\n                x: bottomOffsetX,\n                y: bottomOffsetY\n            });\n        }\n        var absPos = this.findOne('.top-left').getAbsolutePosition(this.getParent());\n        x = absPos.x;\n        y = absPos.y;\n        var width = this.findOne('.bottom-right').x() - this.findOne('.top-left').x();\n        var height = this.findOne('.bottom-right').y() - this.findOne('.top-left').y();\n        this._fitNodeInto({\n            x: x + this.offsetX(),\n            y: y + this.offsetY(),\n            width: width,\n            height: height\n        }, e);\n    };\n    Transformer.prototype._handleMouseUp = function (e) {\n        this._removeEvents(e);\n    };\n    Transformer.prototype._removeEvents = function (e) {\n        if (this._transforming) {\n            this._transforming = false;\n            window.removeEventListener('mousemove', this._handleMouseMove);\n            window.removeEventListener('touchmove', this._handleMouseMove);\n            window.removeEventListener('mouseup', this._handleMouseUp, true);\n            window.removeEventListener('touchend', this._handleMouseUp, true);\n            var node = this.getNode();\n            this._fire('transformend', { evt: e, target: node });\n            if (node) {\n                node.fire('transformend', { evt: e, target: node });\n            }\n            this._movingAnchorName = null;\n        }\n    };\n    Transformer.prototype._fitNodeInto = function (newAttrs, evt) {\n        var boundBoxFunc = this.boundBoxFunc();\n        if (boundBoxFunc) {\n            var oldAttrs = this._getNodeRect();\n            newAttrs = boundBoxFunc.call(this, oldAttrs, newAttrs);\n        }\n        var node = this.getNode();\n        if (newAttrs.rotation !== undefined) {\n            this.getNode().rotation(newAttrs.rotation);\n        }\n        var pure = node.getClientRect({\n            skipTransform: true,\n            skipShadow: true,\n            skipStroke: this.ignoreStroke()\n        });\n        var padding = this.padding();\n        var scaleX = pure.width ? (newAttrs.width - padding * 2) / pure.width : 1;\n        var scaleY = pure.height\n            ? (newAttrs.height - padding * 2) / pure.height\n            : 1;\n        var rotation = Global_1.Konva.getAngle(node.rotation());\n        var dx = pure.x * scaleX - padding - node.offsetX() * scaleX;\n        var dy = pure.y * scaleY - padding - node.offsetY() * scaleY;\n        this.getNode().setAttrs({\n            scaleX: scaleX,\n            scaleY: scaleY,\n            x: newAttrs.x - (dx * Math.cos(rotation) + dy * Math.sin(-rotation)),\n            y: newAttrs.y - (dy * Math.cos(rotation) + dx * Math.sin(rotation))\n        });\n        this._fire('transform', { evt: evt, target: this.getNode() });\n        this.getNode()._fire('transform', { evt: evt, target: this.getNode() });\n        this.update();\n        this.getLayer().batchDraw();\n    };\n    Transformer.prototype.forceUpdate = function () {\n        this._resetTransformCache();\n        this.update();\n    };\n    Transformer.prototype.update = function () {\n        var _this = this;\n        var attrs = this._getNodeRect();\n        var node = this.getNode();\n        var scale = { x: 1, y: 1 };\n        if (node && node.getParent()) {\n            scale = node.getParent().getAbsoluteScale();\n        }\n        var invertedScale = {\n            x: 1 / scale.x,\n            y: 1 / scale.y\n        };\n        var width = attrs.width;\n        var height = attrs.height;\n        var enabledAnchors = this.enabledAnchors();\n        var resizeEnabled = this.resizeEnabled();\n        var padding = this.padding();\n        var anchorSize = this.anchorSize();\n        this.find('._anchor').each(function (node) {\n            return node.setAttrs({\n                width: anchorSize,\n                height: anchorSize,\n                offsetX: anchorSize / 2,\n                offsetY: anchorSize / 2,\n                stroke: _this.anchorStroke(),\n                strokeWidth: _this.anchorStrokeWidth(),\n                fill: _this.anchorFill(),\n                cornerRadius: _this.anchorCornerRadius()\n            });\n        });\n        this.findOne('.top-left').setAttrs({\n            x: -padding,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-left') >= 0\n        });\n        this.findOne('.top-center').setAttrs({\n            x: width / 2,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-center') >= 0\n        });\n        this.findOne('.top-right').setAttrs({\n            x: width + padding,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-right') >= 0\n        });\n        this.findOne('.middle-left').setAttrs({\n            x: -padding,\n            y: height / 2,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('middle-left') >= 0\n        });\n        this.findOne('.middle-right').setAttrs({\n            x: width + padding,\n            y: height / 2,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('middle-right') >= 0\n        });\n        this.findOne('.bottom-left').setAttrs({\n            x: -padding,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-left') >= 0\n        });\n        this.findOne('.bottom-center').setAttrs({\n            x: width / 2,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-center') >= 0\n        });\n        this.findOne('.bottom-right').setAttrs({\n            x: width + padding,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-right') >= 0\n        });\n        var scaledRotateAnchorOffset = -this.rotateAnchorOffset() * Math.abs(invertedScale.y);\n        this.findOne('.rotater').setAttrs({\n            x: width / 2,\n            y: scaledRotateAnchorOffset * Util_1.Util._sign(height) - padding,\n            scale: invertedScale,\n            visible: this.rotateEnabled()\n        });\n        this.findOne('.back').setAttrs({\n            width: width * scale.x,\n            height: height * scale.y,\n            scale: invertedScale,\n            visible: this.borderEnabled(),\n            stroke: this.borderStroke(),\n            strokeWidth: this.borderStrokeWidth(),\n            dash: this.borderDash()\n        });\n    };\n    Transformer.prototype.isTransforming = function () {\n        return this._transforming;\n    };\n    Transformer.prototype.stopTransform = function () {\n        if (this._transforming) {\n            this._removeEvents();\n            var anchorNode = this.findOne('.' + this._movingAnchorName);\n            if (anchorNode) {\n                anchorNode.stopDrag();\n            }\n        }\n    };\n    Transformer.prototype.destroy = function () {\n        if (this.getStage() && this._cursorChange) {\n            this.getStage().content.style.cursor = '';\n        }\n        Group_1.Group.prototype.destroy.call(this);\n        this.detach();\n        this._removeEvents();\n        return this;\n    };\n    Transformer.prototype.toObject = function () {\n        return Node_1.Node.prototype.toObject.call(this);\n    };\n    return Transformer;\n}(Group_1.Group));\nexports.Transformer = Transformer;\nfunction validateAnchors(val) {\n    if (!(val instanceof Array)) {\n        Util_1.Util.warn('enabledAnchors value should be an array');\n    }\n    if (val instanceof Array) {\n        val.forEach(function (name) {\n            if (ANCHORS_NAMES.indexOf(name) === -1) {\n                Util_1.Util.warn('Unknown anchor name: ' +\n                    name +\n                    '. Available names are: ' +\n                    ANCHORS_NAMES.join(', '));\n            }\n        });\n    }\n    return val || [];\n}\nTransformer.prototype.className = 'Transformer';\nGlobal_2._registerNode(Transformer);\nFactory_1.Factory.addGetterSetter(Transformer, 'enabledAnchors', ANCHORS_NAMES, validateAnchors);\nFactory_1.Factory.addGetterSetter(Transformer, 'resizeEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorSize', 10, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnaps', []);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateAnchorOffset', 50, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnapTolerance', 5, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorFill', 'white');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorCornerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderDash');\nFactory_1.Factory.addGetterSetter(Transformer, 'keepRatio', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'centeredScaling', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'ignoreStroke', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'padding', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'node');\nFactory_1.Factory.addGetterSetter(Transformer, 'boundBoxFunc');\nFactory_1.Factory.backCompat(Transformer, {\n    lineEnabled: 'borderEnabled',\n    rotateHandlerOffset: 'rotateAnchorOffset',\n    enabledHandlers: 'enabledAnchors'\n});\nUtil_1.Collection.mapMethods(Transformer);\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Shape_1 = require(\"../Shape\");\nvar Global_1 = require(\"../Global\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_2 = require(\"../Global\");\nvar Wedge = (function (_super) {\n    __extends(Wedge, _super);\n    function Wedge() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    Wedge.prototype._sceneFunc = function (context) {\n        context.beginPath();\n        context.arc(0, 0, this.radius(), 0, Global_1.Konva.getAngle(this.angle()), this.clockwise());\n        context.lineTo(0, 0);\n        context.closePath();\n        context.fillStrokeShape(this);\n    };\n    Wedge.prototype.getWidth = function () {\n        return this.radius() * 2;\n    };\n    Wedge.prototype.getHeight = function () {\n        return this.radius() * 2;\n    };\n    Wedge.prototype.setWidth = function (width) {\n        this.radius(width / 2);\n    };\n    Wedge.prototype.setHeight = function (height) {\n        this.radius(height / 2);\n    };\n    return Wedge;\n}(Shape_1.Shape));\nexports.Wedge = Wedge;\nWedge.prototype.className = 'Wedge';\nWedge.prototype._centroid = true;\nWedge.prototype._attrsAffectingSize = ['radius'];\nGlobal_2._registerNode(Wedge);\nFactory_1.Factory.addGetterSetter(Wedge, 'radius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Wedge, 'angle', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Wedge, 'clockwise', false);\nFactory_1.Factory.backCompat(Wedge, {\n    angleDeg: 'angle',\n    getAngleDeg: 'getAngle',\n    setAngleDeg: 'setAngle'\n});\nUtil_1.Collection.mapMethods(Wedge);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nfunction BlurStack() {\n    this.r = 0;\n    this.g = 0;\n    this.b = 0;\n    this.a = 0;\n    this.next = null;\n}\nvar mul_table = [\n    512,\n    512,\n    456,\n    512,\n    328,\n    456,\n    335,\n    512,\n    405,\n    328,\n    271,\n    456,\n    388,\n    335,\n    292,\n    512,\n    454,\n    405,\n    364,\n    328,\n    298,\n    271,\n    496,\n    456,\n    420,\n    388,\n    360,\n    335,\n    312,\n    292,\n    273,\n    512,\n    482,\n    454,\n    428,\n    405,\n    383,\n    364,\n    345,\n    328,\n    312,\n    298,\n    284,\n    271,\n    259,\n    496,\n    475,\n    456,\n    437,\n    420,\n    404,\n    388,\n    374,\n    360,\n    347,\n    335,\n    323,\n    312,\n    302,\n    292,\n    282,\n    273,\n    265,\n    512,\n    497,\n    482,\n    468,\n    454,\n    441,\n    428,\n    417,\n    405,\n    394,\n    383,\n    373,\n    364,\n    354,\n    345,\n    337,\n    328,\n    320,\n    312,\n    305,\n    298,\n    291,\n    284,\n    278,\n    271,\n    265,\n    259,\n    507,\n    496,\n    485,\n    475,\n    465,\n    456,\n    446,\n    437,\n    428,\n    420,\n    412,\n    404,\n    396,\n    388,\n    381,\n    374,\n    367,\n    360,\n    354,\n    347,\n    341,\n    335,\n    329,\n    323,\n    318,\n    312,\n    307,\n    302,\n    297,\n    292,\n    287,\n    282,\n    278,\n    273,\n    269,\n    265,\n    261,\n    512,\n    505,\n    497,\n    489,\n    482,\n    475,\n    468,\n    461,\n    454,\n    447,\n    441,\n    435,\n    428,\n    422,\n    417,\n    411,\n    405,\n    399,\n    394,\n    389,\n    383,\n    378,\n    373,\n    368,\n    364,\n    359,\n    354,\n    350,\n    345,\n    341,\n    337,\n    332,\n    328,\n    324,\n    320,\n    316,\n    312,\n    309,\n    305,\n    301,\n    298,\n    294,\n    291,\n    287,\n    284,\n    281,\n    278,\n    274,\n    271,\n    268,\n    265,\n    262,\n    259,\n    257,\n    507,\n    501,\n    496,\n    491,\n    485,\n    480,\n    475,\n    470,\n    465,\n    460,\n    456,\n    451,\n    446,\n    442,\n    437,\n    433,\n    428,\n    424,\n    420,\n    416,\n    412,\n    408,\n    404,\n    400,\n    396,\n    392,\n    388,\n    385,\n    381,\n    377,\n    374,\n    370,\n    367,\n    363,\n    360,\n    357,\n    354,\n    350,\n    347,\n    344,\n    341,\n    338,\n    335,\n    332,\n    329,\n    326,\n    323,\n    320,\n    318,\n    315,\n    312,\n    310,\n    307,\n    304,\n    302,\n    299,\n    297,\n    294,\n    292,\n    289,\n    287,\n    285,\n    282,\n    280,\n    278,\n    275,\n    273,\n    271,\n    269,\n    267,\n    265,\n    263,\n    261,\n    259\n];\nvar shg_table = [\n    9,\n    11,\n    12,\n    13,\n    13,\n    14,\n    14,\n    15,\n    15,\n    15,\n    15,\n    16,\n    16,\n    16,\n    16,\n    17,\n    17,\n    17,\n    17,\n    17,\n    17,\n    17,\n    18,\n    18,\n    18,\n    18,\n    18,\n    18,\n    18,\n    18,\n    18,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    19,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    20,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    21,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    22,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    23,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24,\n    24\n];\nfunction filterGaussBlurRGBA(imageData, radius) {\n    var pixels = imageData.data, width = imageData.width, height = imageData.height;\n    var x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum, a_sum, r_out_sum, g_out_sum, b_out_sum, a_out_sum, r_in_sum, g_in_sum, b_in_sum, a_in_sum, pr, pg, pb, pa, rbs;\n    var div = radius + radius + 1, widthMinus1 = width - 1, heightMinus1 = height - 1, radiusPlus1 = radius + 1, sumFactor = (radiusPlus1 * (radiusPlus1 + 1)) / 2, stackStart = new BlurStack(), stackEnd = null, stack = stackStart, stackIn = null, stackOut = null, mul_sum = mul_table[radius], shg_sum = shg_table[radius];\n    for (i = 1; i < div; i++) {\n        stack = stack.next = new BlurStack();\n        if (i === radiusPlus1) {\n            stackEnd = stack;\n        }\n    }\n    stack.next = stackStart;\n    yw = yi = 0;\n    for (y = 0; y < height; y++) {\n        r_in_sum = g_in_sum = b_in_sum = a_in_sum = r_sum = g_sum = b_sum = a_sum = 0;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n        a_out_sum = radiusPlus1 * (pa = pixels[yi + 3]);\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        a_sum += sumFactor * pa;\n        stack = stackStart;\n        for (i = 0; i < radiusPlus1; i++) {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack.a = pa;\n            stack = stack.next;\n        }\n        for (i = 1; i < radiusPlus1; i++) {\n            p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n            r_sum += (stack.r = pr = pixels[p]) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = pg = pixels[p + 1]) * rbs;\n            b_sum += (stack.b = pb = pixels[p + 2]) * rbs;\n            a_sum += (stack.a = pa = pixels[p + 3]) * rbs;\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            a_in_sum += pa;\n            stack = stack.next;\n        }\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (x = 0; x < width; x++) {\n            pixels[yi + 3] = pa = (a_sum * mul_sum) >> shg_sum;\n            if (pa !== 0) {\n                pa = 255 / pa;\n                pixels[yi] = ((r_sum * mul_sum) >> shg_sum) * pa;\n                pixels[yi + 1] = ((g_sum * mul_sum) >> shg_sum) * pa;\n                pixels[yi + 2] = ((b_sum * mul_sum) >> shg_sum) * pa;\n            }\n            else {\n                pixels[yi] = pixels[yi + 1] = pixels[yi + 2] = 0;\n            }\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            a_sum -= a_out_sum;\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            a_out_sum -= stackIn.a;\n            p = (yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1)) << 2;\n            r_in_sum += stackIn.r = pixels[p];\n            g_in_sum += stackIn.g = pixels[p + 1];\n            b_in_sum += stackIn.b = pixels[p + 2];\n            a_in_sum += stackIn.a = pixels[p + 3];\n            r_sum += r_in_sum;\n            g_sum += g_in_sum;\n            b_sum += b_in_sum;\n            a_sum += a_in_sum;\n            stackIn = stackIn.next;\n            r_out_sum += pr = stackOut.r;\n            g_out_sum += pg = stackOut.g;\n            b_out_sum += pb = stackOut.b;\n            a_out_sum += pa = stackOut.a;\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            a_in_sum -= pa;\n            stackOut = stackOut.next;\n            yi += 4;\n        }\n        yw += width;\n    }\n    for (x = 0; x < width; x++) {\n        g_in_sum = b_in_sum = a_in_sum = r_in_sum = g_sum = b_sum = a_sum = r_sum = 0;\n        yi = x << 2;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi + 1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi + 2]);\n        a_out_sum = radiusPlus1 * (pa = pixels[yi + 3]);\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        a_sum += sumFactor * pa;\n        stack = stackStart;\n        for (i = 0; i < radiusPlus1; i++) {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack.a = pa;\n            stack = stack.next;\n        }\n        yp = width;\n        for (i = 1; i <= radius; i++) {\n            yi = (yp + x) << 2;\n            r_sum += (stack.r = pr = pixels[yi]) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = pg = pixels[yi + 1]) * rbs;\n            b_sum += (stack.b = pb = pixels[yi + 2]) * rbs;\n            a_sum += (stack.a = pa = pixels[yi + 3]) * rbs;\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            a_in_sum += pa;\n            stack = stack.next;\n            if (i < heightMinus1) {\n                yp += width;\n            }\n        }\n        yi = x;\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (y = 0; y < height; y++) {\n            p = yi << 2;\n            pixels[p + 3] = pa = (a_sum * mul_sum) >> shg_sum;\n            if (pa > 0) {\n                pa = 255 / pa;\n                pixels[p] = ((r_sum * mul_sum) >> shg_sum) * pa;\n                pixels[p + 1] = ((g_sum * mul_sum) >> shg_sum) * pa;\n                pixels[p + 2] = ((b_sum * mul_sum) >> shg_sum) * pa;\n            }\n            else {\n                pixels[p] = pixels[p + 1] = pixels[p + 2] = 0;\n            }\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            a_sum -= a_out_sum;\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            a_out_sum -= stackIn.a;\n            p =\n                (x +\n                    ((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width) <<\n                    2;\n            r_sum += r_in_sum += stackIn.r = pixels[p];\n            g_sum += g_in_sum += stackIn.g = pixels[p + 1];\n            b_sum += b_in_sum += stackIn.b = pixels[p + 2];\n            a_sum += a_in_sum += stackIn.a = pixels[p + 3];\n            stackIn = stackIn.next;\n            r_out_sum += pr = stackOut.r;\n            g_out_sum += pg = stackOut.g;\n            b_out_sum += pb = stackOut.b;\n            a_out_sum += pa = stackOut.a;\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            a_in_sum -= pa;\n            stackOut = stackOut.next;\n            yi += width;\n        }\n    }\n}\nexports.Blur = function Blur(imageData) {\n    var radius = Math.round(this.blurRadius());\n    if (radius > 0) {\n        filterGaussBlurRGBA(imageData, radius);\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'blurRadius', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.Brighten = function (imageData) {\n    var brightness = this.brightness() * 255, data = imageData.data, len = data.length, i;\n    for (i = 0; i < len; i += 4) {\n        data[i] += brightness;\n        data[i + 1] += brightness;\n        data[i + 2] += brightness;\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'brightness', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.Contrast = function (imageData) {\n    var adjust = Math.pow((this.contrast() + 100) / 100, 2);\n    var data = imageData.data, nPixels = data.length, red = 150, green = 150, blue = 150, i;\n    for (i = 0; i < nPixels; i += 4) {\n        red = data[i];\n        green = data[i + 1];\n        blue = data[i + 2];\n        red /= 255;\n        red -= 0.5;\n        red *= adjust;\n        red += 0.5;\n        red *= 255;\n        green /= 255;\n        green -= 0.5;\n        green *= adjust;\n        green += 0.5;\n        green *= 255;\n        blue /= 255;\n        blue -= 0.5;\n        blue *= adjust;\n        blue += 0.5;\n        blue *= 255;\n        red = red < 0 ? 0 : red > 255 ? 255 : red;\n        green = green < 0 ? 0 : green > 255 ? 255 : green;\n        blue = blue < 0 ? 0 : blue > 255 ? 255 : blue;\n        data[i] = red;\n        data[i + 1] = green;\n        data[i + 2] = blue;\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'contrast', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Util_1 = require(\"../Util\");\nvar Validators_1 = require(\"../Validators\");\nexports.Emboss = function (imageData) {\n    var strength = this.embossStrength() * 10, greyLevel = this.embossWhiteLevel() * 255, direction = this.embossDirection(), blend = this.embossBlend(), dirY = 0, dirX = 0, data = imageData.data, w = imageData.width, h = imageData.height, w4 = w * 4, y = h;\n    switch (direction) {\n        case 'top-left':\n            dirY = -1;\n            dirX = -1;\n            break;\n        case 'top':\n            dirY = -1;\n            dirX = 0;\n            break;\n        case 'top-right':\n            dirY = -1;\n            dirX = 1;\n            break;\n        case 'right':\n            dirY = 0;\n            dirX = 1;\n            break;\n        case 'bottom-right':\n            dirY = 1;\n            dirX = 1;\n            break;\n        case 'bottom':\n            dirY = 1;\n            dirX = 0;\n            break;\n        case 'bottom-left':\n            dirY = 1;\n            dirX = -1;\n            break;\n        case 'left':\n            dirY = 0;\n            dirX = -1;\n            break;\n        default:\n            Util_1.Util.error('Unknown emboss direction: ' + direction);\n    }\n    do {\n        var offsetY = (y - 1) * w4;\n        var otherY = dirY;\n        if (y + otherY < 1) {\n            otherY = 0;\n        }\n        if (y + otherY > h) {\n            otherY = 0;\n        }\n        var offsetYOther = (y - 1 + otherY) * w * 4;\n        var x = w;\n        do {\n            var offset = offsetY + (x - 1) * 4;\n            var otherX = dirX;\n            if (x + otherX < 1) {\n                otherX = 0;\n            }\n            if (x + otherX > w) {\n                otherX = 0;\n            }\n            var offsetOther = offsetYOther + (x - 1 + otherX) * 4;\n            var dR = data[offset] - data[offsetOther];\n            var dG = data[offset + 1] - data[offsetOther + 1];\n            var dB = data[offset + 2] - data[offsetOther + 2];\n            var dif = dR;\n            var absDif = dif > 0 ? dif : -dif;\n            var absG = dG > 0 ? dG : -dG;\n            var absB = dB > 0 ? dB : -dB;\n            if (absG > absDif) {\n                dif = dG;\n            }\n            if (absB > absDif) {\n                dif = dB;\n            }\n            dif *= strength;\n            if (blend) {\n                var r = data[offset] + dif;\n                var g = data[offset + 1] + dif;\n                var b = data[offset + 2] + dif;\n                data[offset] = r > 255 ? 255 : r < 0 ? 0 : r;\n                data[offset + 1] = g > 255 ? 255 : g < 0 ? 0 : g;\n                data[offset + 2] = b > 255 ? 255 : b < 0 ? 0 : b;\n            }\n            else {\n                var grey = greyLevel - dif;\n                if (grey < 0) {\n                    grey = 0;\n                }\n                else if (grey > 255) {\n                    grey = 255;\n                }\n                data[offset] = data[offset + 1] = data[offset + 2] = grey;\n            }\n        } while (--x);\n    } while (--y);\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossStrength', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossWhiteLevel', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossDirection', 'top-left', null, Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossBlend', false, null, Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nfunction remap(fromValue, fromMin, fromMax, toMin, toMax) {\n    var fromRange = fromMax - fromMin, toRange = toMax - toMin, toValue;\n    if (fromRange === 0) {\n        return toMin + toRange / 2;\n    }\n    if (toRange === 0) {\n        return toMin;\n    }\n    toValue = (fromValue - fromMin) / fromRange;\n    toValue = toRange * toValue + toMin;\n    return toValue;\n}\nexports.Enhance = function (imageData) {\n    var data = imageData.data, nSubPixels = data.length, rMin = data[0], rMax = rMin, r, gMin = data[1], gMax = gMin, g, bMin = data[2], bMax = bMin, b, i;\n    var enhanceAmount = this.enhance();\n    if (enhanceAmount === 0) {\n        return;\n    }\n    for (i = 0; i < nSubPixels; i += 4) {\n        r = data[i + 0];\n        if (r < rMin) {\n            rMin = r;\n        }\n        else if (r > rMax) {\n            rMax = r;\n        }\n        g = data[i + 1];\n        if (g < gMin) {\n            gMin = g;\n        }\n        else if (g > gMax) {\n            gMax = g;\n        }\n        b = data[i + 2];\n        if (b < bMin) {\n            bMin = b;\n        }\n        else if (b > bMax) {\n            bMax = b;\n        }\n    }\n    if (rMax === rMin) {\n        rMax = 255;\n        rMin = 0;\n    }\n    if (gMax === gMin) {\n        gMax = 255;\n        gMin = 0;\n    }\n    if (bMax === bMin) {\n        bMax = 255;\n        bMin = 0;\n    }\n    var rMid, rGoalMax, rGoalMin, gMid, gGoalMax, gGoalMin, bMid, bGoalMax, bGoalMin;\n    if (enhanceAmount > 0) {\n        rGoalMax = rMax + enhanceAmount * (255 - rMax);\n        rGoalMin = rMin - enhanceAmount * (rMin - 0);\n        gGoalMax = gMax + enhanceAmount * (255 - gMax);\n        gGoalMin = gMin - enhanceAmount * (gMin - 0);\n        bGoalMax = bMax + enhanceAmount * (255 - bMax);\n        bGoalMin = bMin - enhanceAmount * (bMin - 0);\n    }\n    else {\n        rMid = (rMax + rMin) * 0.5;\n        rGoalMax = rMax + enhanceAmount * (rMax - rMid);\n        rGoalMin = rMin + enhanceAmount * (rMin - rMid);\n        gMid = (gMax + gMin) * 0.5;\n        gGoalMax = gMax + enhanceAmount * (gMax - gMid);\n        gGoalMin = gMin + enhanceAmount * (gMin - gMid);\n        bMid = (bMax + bMin) * 0.5;\n        bGoalMax = bMax + enhanceAmount * (bMax - bMid);\n        bGoalMin = bMin + enhanceAmount * (bMin - bMid);\n    }\n    for (i = 0; i < nSubPixels; i += 4) {\n        data[i + 0] = remap(data[i + 0], rMin, rMax, rGoalMin, rGoalMax);\n        data[i + 1] = remap(data[i + 1], gMin, gMax, gGoalMin, gGoalMax);\n        data[i + 2] = remap(data[i + 2], bMin, bMax, bGoalMin, bGoalMax);\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'enhance', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Grayscale = function (imageData) {\n    var data = imageData.data, len = data.length, i, brightness;\n    for (i = 0; i < len; i += 4) {\n        brightness = 0.34 * data[i] + 0.5 * data[i + 1] + 0.16 * data[i + 2];\n        data[i] = brightness;\n        data[i + 1] = brightness;\n        data[i + 2] = brightness;\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'hue', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'saturation', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'luminance', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nexports.HSL = function (imageData) {\n    var data = imageData.data, nPixels = data.length, v = 1, s = Math.pow(2, this.saturation()), h = Math.abs(this.hue() + 360) % 360, l = this.luminance() * 127, i;\n    var vsu = v * s * Math.cos((h * Math.PI) / 180), vsw = v * s * Math.sin((h * Math.PI) / 180);\n    var rr = 0.299 * v + 0.701 * vsu + 0.167 * vsw, rg = 0.587 * v - 0.587 * vsu + 0.33 * vsw, rb = 0.114 * v - 0.114 * vsu - 0.497 * vsw;\n    var gr = 0.299 * v - 0.299 * vsu - 0.328 * vsw, gg = 0.587 * v + 0.413 * vsu + 0.035 * vsw, gb = 0.114 * v - 0.114 * vsu + 0.293 * vsw;\n    var br = 0.299 * v - 0.3 * vsu + 1.25 * vsw, bg = 0.587 * v - 0.586 * vsu - 1.05 * vsw, bb = 0.114 * v + 0.886 * vsu - 0.2 * vsw;\n    var r, g, b, a;\n    for (i = 0; i < nPixels; i += 4) {\n        r = data[i + 0];\n        g = data[i + 1];\n        b = data[i + 2];\n        a = data[i + 3];\n        data[i + 0] = rr * r + rg * g + rb * b + l;\n        data[i + 1] = gr * r + gg * g + gb * b + l;\n        data[i + 2] = br * r + bg * g + bb * b + l;\n        data[i + 3] = a;\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.HSV = function (imageData) {\n    var data = imageData.data, nPixels = data.length, v = Math.pow(2, this.value()), s = Math.pow(2, this.saturation()), h = Math.abs(this.hue() + 360) % 360, i;\n    var vsu = v * s * Math.cos((h * Math.PI) / 180), vsw = v * s * Math.sin((h * Math.PI) / 180);\n    var rr = 0.299 * v + 0.701 * vsu + 0.167 * vsw, rg = 0.587 * v - 0.587 * vsu + 0.33 * vsw, rb = 0.114 * v - 0.114 * vsu - 0.497 * vsw;\n    var gr = 0.299 * v - 0.299 * vsu - 0.328 * vsw, gg = 0.587 * v + 0.413 * vsu + 0.035 * vsw, gb = 0.114 * v - 0.114 * vsu + 0.293 * vsw;\n    var br = 0.299 * v - 0.3 * vsu + 1.25 * vsw, bg = 0.587 * v - 0.586 * vsu - 1.05 * vsw, bb = 0.114 * v + 0.886 * vsu - 0.2 * vsw;\n    var r, g, b, a;\n    for (i = 0; i < nPixels; i += 4) {\n        r = data[i + 0];\n        g = data[i + 1];\n        b = data[i + 2];\n        a = data[i + 3];\n        data[i + 0] = rr * r + rg * g + rb * b;\n        data[i + 1] = gr * r + gg * g + gb * b;\n        data[i + 2] = br * r + bg * g + bb * b;\n        data[i + 3] = a;\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'hue', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'saturation', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'value', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Invert = function (imageData) {\n    var data = imageData.data, len = data.length, i;\n    for (i = 0; i < len; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Util_1 = require(\"../Util\");\nvar Validators_1 = require(\"../Validators\");\nvar ToPolar = function (src, dst, opt) {\n    var srcPixels = src.data, dstPixels = dst.data, xSize = src.width, ySize = src.height, xMid = opt.polarCenterX || xSize / 2, yMid = opt.polarCenterY || ySize / 2, i, x, y, r = 0, g = 0, b = 0, a = 0;\n    var rad, rMax = Math.sqrt(xMid * xMid + yMid * yMid);\n    x = xSize - xMid;\n    y = ySize - yMid;\n    rad = Math.sqrt(x * x + y * y);\n    rMax = rad > rMax ? rad : rMax;\n    var rSize = ySize, tSize = xSize, radius, theta;\n    var conversion = ((360 / tSize) * Math.PI) / 180, sin, cos;\n    for (theta = 0; theta < tSize; theta += 1) {\n        sin = Math.sin(theta * conversion);\n        cos = Math.cos(theta * conversion);\n        for (radius = 0; radius < rSize; radius += 1) {\n            x = Math.floor(xMid + ((rMax * radius) / rSize) * cos);\n            y = Math.floor(yMid + ((rMax * radius) / rSize) * sin);\n            i = (y * xSize + x) * 4;\n            r = srcPixels[i + 0];\n            g = srcPixels[i + 1];\n            b = srcPixels[i + 2];\n            a = srcPixels[i + 3];\n            i = (theta + radius * xSize) * 4;\n            dstPixels[i + 0] = r;\n            dstPixels[i + 1] = g;\n            dstPixels[i + 2] = b;\n            dstPixels[i + 3] = a;\n        }\n    }\n};\nvar FromPolar = function (src, dst, opt) {\n    var srcPixels = src.data, dstPixels = dst.data, xSize = src.width, ySize = src.height, xMid = opt.polarCenterX || xSize / 2, yMid = opt.polarCenterY || ySize / 2, i, x, y, dx, dy, r = 0, g = 0, b = 0, a = 0;\n    var rad, rMax = Math.sqrt(xMid * xMid + yMid * yMid);\n    x = xSize - xMid;\n    y = ySize - yMid;\n    rad = Math.sqrt(x * x + y * y);\n    rMax = rad > rMax ? rad : rMax;\n    var rSize = ySize, tSize = xSize, radius, theta, phaseShift = opt.polarRotation || 0;\n    var x1, y1;\n    for (x = 0; x < xSize; x += 1) {\n        for (y = 0; y < ySize; y += 1) {\n            dx = x - xMid;\n            dy = y - yMid;\n            radius = (Math.sqrt(dx * dx + dy * dy) * rSize) / rMax;\n            theta = ((Math.atan2(dy, dx) * 180) / Math.PI + 360 + phaseShift) % 360;\n            theta = (theta * tSize) / 360;\n            x1 = Math.floor(theta);\n            y1 = Math.floor(radius);\n            i = (y1 * xSize + x1) * 4;\n            r = srcPixels[i + 0];\n            g = srcPixels[i + 1];\n            b = srcPixels[i + 2];\n            a = srcPixels[i + 3];\n            i = (y * xSize + x) * 4;\n            dstPixels[i + 0] = r;\n            dstPixels[i + 1] = g;\n            dstPixels[i + 2] = b;\n            dstPixels[i + 3] = a;\n        }\n    }\n};\nexports.Kaleidoscope = function (imageData) {\n    var xSize = imageData.width, ySize = imageData.height;\n    var x, y, xoff, i, r, g, b, a, srcPos, dstPos;\n    var power = Math.round(this.kaleidoscopePower());\n    var angle = Math.round(this.kaleidoscopeAngle());\n    var offset = Math.floor((xSize * (angle % 360)) / 360);\n    if (power < 1) {\n        return;\n    }\n    var tempCanvas = Util_1.Util.createCanvasElement();\n    tempCanvas.width = xSize;\n    tempCanvas.height = ySize;\n    var scratchData = tempCanvas\n        .getContext('2d')\n        .getImageData(0, 0, xSize, ySize);\n    ToPolar(imageData, scratchData, {\n        polarCenterX: xSize / 2,\n        polarCenterY: ySize / 2\n    });\n    var minSectionSize = xSize / Math.pow(2, power);\n    while (minSectionSize <= 8) {\n        minSectionSize = minSectionSize * 2;\n        power -= 1;\n    }\n    minSectionSize = Math.ceil(minSectionSize);\n    var sectionSize = minSectionSize;\n    var xStart = 0, xEnd = sectionSize, xDelta = 1;\n    if (offset + minSectionSize > xSize) {\n        xStart = sectionSize;\n        xEnd = 0;\n        xDelta = -1;\n    }\n    for (y = 0; y < ySize; y += 1) {\n        for (x = xStart; x !== xEnd; x += xDelta) {\n            xoff = Math.round(x + offset) % xSize;\n            srcPos = (xSize * y + xoff) * 4;\n            r = scratchData.data[srcPos + 0];\n            g = scratchData.data[srcPos + 1];\n            b = scratchData.data[srcPos + 2];\n            a = scratchData.data[srcPos + 3];\n            dstPos = (xSize * y + x) * 4;\n            scratchData.data[dstPos + 0] = r;\n            scratchData.data[dstPos + 1] = g;\n            scratchData.data[dstPos + 2] = b;\n            scratchData.data[dstPos + 3] = a;\n        }\n    }\n    for (y = 0; y < ySize; y += 1) {\n        sectionSize = Math.floor(minSectionSize);\n        for (i = 0; i < power; i += 1) {\n            for (x = 0; x < sectionSize + 1; x += 1) {\n                srcPos = (xSize * y + x) * 4;\n                r = scratchData.data[srcPos + 0];\n                g = scratchData.data[srcPos + 1];\n                b = scratchData.data[srcPos + 2];\n                a = scratchData.data[srcPos + 3];\n                dstPos = (xSize * y + sectionSize * 2 - x - 1) * 4;\n                scratchData.data[dstPos + 0] = r;\n                scratchData.data[dstPos + 1] = g;\n                scratchData.data[dstPos + 2] = b;\n                scratchData.data[dstPos + 3] = a;\n            }\n            sectionSize *= 2;\n        }\n    }\n    FromPolar(scratchData, imageData, { polarRotation: 0 });\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'kaleidoscopePower', 2, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'kaleidoscopeAngle', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nfunction pixelAt(idata, x, y) {\n    var idx = (y * idata.width + x) * 4;\n    var d = [];\n    d.push(idata.data[idx++], idata.data[idx++], idata.data[idx++], idata.data[idx++]);\n    return d;\n}\nfunction rgbDistance(p1, p2) {\n    return Math.sqrt(Math.pow(p1[0] - p2[0], 2) +\n        Math.pow(p1[1] - p2[1], 2) +\n        Math.pow(p1[2] - p2[2], 2));\n}\nfunction rgbMean(pTab) {\n    var m = [0, 0, 0];\n    for (var i = 0; i < pTab.length; i++) {\n        m[0] += pTab[i][0];\n        m[1] += pTab[i][1];\n        m[2] += pTab[i][2];\n    }\n    m[0] /= pTab.length;\n    m[1] /= pTab.length;\n    m[2] /= pTab.length;\n    return m;\n}\nfunction backgroundMask(idata, threshold) {\n    var rgbv_no = pixelAt(idata, 0, 0);\n    var rgbv_ne = pixelAt(idata, idata.width - 1, 0);\n    var rgbv_so = pixelAt(idata, 0, idata.height - 1);\n    var rgbv_se = pixelAt(idata, idata.width - 1, idata.height - 1);\n    var thres = threshold || 10;\n    if (rgbDistance(rgbv_no, rgbv_ne) < thres &&\n        rgbDistance(rgbv_ne, rgbv_se) < thres &&\n        rgbDistance(rgbv_se, rgbv_so) < thres &&\n        rgbDistance(rgbv_so, rgbv_no) < thres) {\n        var mean = rgbMean([rgbv_ne, rgbv_no, rgbv_se, rgbv_so]);\n        var mask = [];\n        for (var i = 0; i < idata.width * idata.height; i++) {\n            var d = rgbDistance(mean, [\n                idata.data[i * 4],\n                idata.data[i * 4 + 1],\n                idata.data[i * 4 + 2]\n            ]);\n            mask[i] = d < thres ? 0 : 255;\n        }\n        return mask;\n    }\n}\nfunction applyMask(idata, mask) {\n    for (var i = 0; i < idata.width * idata.height; i++) {\n        idata.data[4 * i + 3] = mask[i];\n    }\n}\nfunction erodeMask(mask, sw, sh) {\n    var weights = [1, 1, 1, 1, 0, 1, 1, 1, 1];\n    var side = Math.round(Math.sqrt(weights.length));\n    var halfSide = Math.floor(side / 2);\n    var maskResult = [];\n    for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n            var so = y * sw + x;\n            var a = 0;\n            for (var cy = 0; cy < side; cy++) {\n                for (var cx = 0; cx < side; cx++) {\n                    var scy = y + cy - halfSide;\n                    var scx = x + cx - halfSide;\n                    if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n                        var srcOff = scy * sw + scx;\n                        var wt = weights[cy * side + cx];\n                        a += mask[srcOff] * wt;\n                    }\n                }\n            }\n            maskResult[so] = a === 255 * 8 ? 255 : 0;\n        }\n    }\n    return maskResult;\n}\nfunction dilateMask(mask, sw, sh) {\n    var weights = [1, 1, 1, 1, 1, 1, 1, 1, 1];\n    var side = Math.round(Math.sqrt(weights.length));\n    var halfSide = Math.floor(side / 2);\n    var maskResult = [];\n    for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n            var so = y * sw + x;\n            var a = 0;\n            for (var cy = 0; cy < side; cy++) {\n                for (var cx = 0; cx < side; cx++) {\n                    var scy = y + cy - halfSide;\n                    var scx = x + cx - halfSide;\n                    if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n                        var srcOff = scy * sw + scx;\n                        var wt = weights[cy * side + cx];\n                        a += mask[srcOff] * wt;\n                    }\n                }\n            }\n            maskResult[so] = a >= 255 * 4 ? 255 : 0;\n        }\n    }\n    return maskResult;\n}\nfunction smoothEdgeMask(mask, sw, sh) {\n    var weights = [1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9];\n    var side = Math.round(Math.sqrt(weights.length));\n    var halfSide = Math.floor(side / 2);\n    var maskResult = [];\n    for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n            var so = y * sw + x;\n            var a = 0;\n            for (var cy = 0; cy < side; cy++) {\n                for (var cx = 0; cx < side; cx++) {\n                    var scy = y + cy - halfSide;\n                    var scx = x + cx - halfSide;\n                    if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n                        var srcOff = scy * sw + scx;\n                        var wt = weights[cy * side + cx];\n                        a += mask[srcOff] * wt;\n                    }\n                }\n            }\n            maskResult[so] = a;\n        }\n    }\n    return maskResult;\n}\nexports.Mask = function (imageData) {\n    var threshold = this.threshold(), mask = backgroundMask(imageData, threshold);\n    if (mask) {\n        mask = erodeMask(mask, imageData.width, imageData.height);\n        mask = dilateMask(mask, imageData.width, imageData.height);\n        mask = smoothEdgeMask(mask, imageData.width, imageData.height);\n        applyMask(imageData, mask);\n    }\n    return imageData;\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'threshold', 0, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.Noise = function (imageData) {\n    var amount = this.noise() * 255, data = imageData.data, nPixels = data.length, half = amount / 2, i;\n    for (i = 0; i < nPixels; i += 4) {\n        data[i + 0] += half - 2 * half * Math.random();\n        data[i + 1] += half - 2 * half * Math.random();\n        data[i + 2] += half - 2 * half * Math.random();\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'noise', 0.2, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Util_1 = require(\"../Util\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.Pixelate = function (imageData) {\n    var pixelSize = Math.ceil(this.pixelSize()), width = imageData.width, height = imageData.height, x, y, i, red, green, blue, alpha, nBinsX = Math.ceil(width / pixelSize), nBinsY = Math.ceil(height / pixelSize), xBinStart, xBinEnd, yBinStart, yBinEnd, xBin, yBin, pixelsInBin, data = imageData.data;\n    if (pixelSize <= 0) {\n        Util_1.Util.error('pixelSize value can not be <= 0');\n        return;\n    }\n    for (xBin = 0; xBin < nBinsX; xBin += 1) {\n        for (yBin = 0; yBin < nBinsY; yBin += 1) {\n            red = 0;\n            green = 0;\n            blue = 0;\n            alpha = 0;\n            xBinStart = xBin * pixelSize;\n            xBinEnd = xBinStart + pixelSize;\n            yBinStart = yBin * pixelSize;\n            yBinEnd = yBinStart + pixelSize;\n            pixelsInBin = 0;\n            for (x = xBinStart; x < xBinEnd; x += 1) {\n                if (x >= width) {\n                    continue;\n                }\n                for (y = yBinStart; y < yBinEnd; y += 1) {\n                    if (y >= height) {\n                        continue;\n                    }\n                    i = (width * y + x) * 4;\n                    red += data[i + 0];\n                    green += data[i + 1];\n                    blue += data[i + 2];\n                    alpha += data[i + 3];\n                    pixelsInBin += 1;\n                }\n            }\n            red = red / pixelsInBin;\n            green = green / pixelsInBin;\n            blue = blue / pixelsInBin;\n            alpha = alpha / pixelsInBin;\n            for (x = xBinStart; x < xBinEnd; x += 1) {\n                if (x >= width) {\n                    continue;\n                }\n                for (y = yBinStart; y < yBinEnd; y += 1) {\n                    if (y >= height) {\n                        continue;\n                    }\n                    i = (width * y + x) * 4;\n                    data[i + 0] = red;\n                    data[i + 1] = green;\n                    data[i + 2] = blue;\n                    data[i + 3] = alpha;\n                }\n            }\n        }\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'pixelSize', 8, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.Posterize = function (imageData) {\n    var levels = Math.round(this.levels() * 254) + 1, data = imageData.data, len = data.length, scale = 255 / levels, i;\n    for (i = 0; i < len; i += 1) {\n        data[i] = Math.floor(data[i] / scale) * scale;\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'levels', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.RGB = function (imageData) {\n    var data = imageData.data, nPixels = data.length, red = this.red(), green = this.green(), blue = this.blue(), i, brightness;\n    for (i = 0; i < nPixels; i += 4) {\n        brightness =\n            (0.34 * data[i] + 0.5 * data[i + 1] + 0.16 * data[i + 2]) / 255;\n        data[i] = brightness * red;\n        data[i + 1] = brightness * green;\n        data[i + 2] = brightness * blue;\n        data[i + 3] = data[i + 3];\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'red', 0, function (val) {\n    this._filterUpToDate = false;\n    if (val > 255) {\n        return 255;\n    }\n    else if (val < 0) {\n        return 0;\n    }\n    else {\n        return Math.round(val);\n    }\n});\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'green', 0, function (val) {\n    this._filterUpToDate = false;\n    if (val > 255) {\n        return 255;\n    }\n    else if (val < 0) {\n        return 0;\n    }\n    else {\n        return Math.round(val);\n    }\n});\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'blue', 0, Validators_1.RGBComponent, Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.RGBA = function (imageData) {\n    var data = imageData.data, nPixels = data.length, red = this.red(), green = this.green(), blue = this.blue(), alpha = this.alpha(), i, ia;\n    for (i = 0; i < nPixels; i += 4) {\n        ia = 1 - alpha;\n        data[i] = red * alpha + data[i] * ia;\n        data[i + 1] = green * alpha + data[i + 1] * ia;\n        data[i + 2] = blue * alpha + data[i + 2] * ia;\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'red', 0, function (val) {\n    this._filterUpToDate = false;\n    if (val > 255) {\n        return 255;\n    }\n    else if (val < 0) {\n        return 0;\n    }\n    else {\n        return Math.round(val);\n    }\n});\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'green', 0, function (val) {\n    this._filterUpToDate = false;\n    if (val > 255) {\n        return 255;\n    }\n    else if (val < 0) {\n        return 0;\n    }\n    else {\n        return Math.round(val);\n    }\n});\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'blue', 0, Validators_1.RGBComponent, Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'alpha', 1, function (val) {\n    this._filterUpToDate = false;\n    if (val > 1) {\n        return 1;\n    }\n    else if (val < 0) {\n        return 0;\n    }\n    else {\n        return val;\n    }\n});\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Sepia = function (imageData) {\n    var data = imageData.data, nPixels = data.length, i, r, g, b;\n    for (i = 0; i < nPixels; i += 4) {\n        r = data[i + 0];\n        g = data[i + 1];\n        b = data[i + 2];\n        data[i + 0] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);\n        data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);\n        data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);\n    }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Solarize = function (imageData) {\n    var data = imageData.data, w = imageData.width, h = imageData.height, w4 = w * 4, y = h;\n    do {\n        var offsetY = (y - 1) * w4;\n        var x = w;\n        do {\n            var offset = offsetY + (x - 1) * 4;\n            var r = data[offset];\n            var g = data[offset + 1];\n            var b = data[offset + 2];\n            if (r > 127) {\n                r = 255 - r;\n            }\n            if (g > 127) {\n                g = 255 - g;\n            }\n            if (b > 127) {\n                b = 255 - b;\n            }\n            data[offset] = r;\n            data[offset + 1] = g;\n            data[offset + 2] = b;\n        } while (--x);\n    } while (--y);\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Validators_1 = require(\"../Validators\");\nexports.Threshold = function (imageData) {\n    var level = this.threshold() * 255, data = imageData.data, len = data.length, i;\n    for (i = 0; i < len; i += 1) {\n        data[i] = data[i] < level ? 0 : 255;\n    }\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'threshold', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar _CoreInternals_1 = require(\"./_CoreInternals\");\nvar Arc_1 = require(\"./shapes/Arc\");\nvar Arrow_1 = require(\"./shapes/Arrow\");\nvar Circle_1 = require(\"./shapes/Circle\");\nvar Ellipse_1 = require(\"./shapes/Ellipse\");\nvar Image_1 = require(\"./shapes/Image\");\nvar Label_1 = require(\"./shapes/Label\");\nvar Line_1 = require(\"./shapes/Line\");\nvar Path_1 = require(\"./shapes/Path\");\nvar Rect_1 = require(\"./shapes/Rect\");\nvar RegularPolygon_1 = require(\"./shapes/RegularPolygon\");\nvar Ring_1 = require(\"./shapes/Ring\");\nvar Sprite_1 = require(\"./shapes/Sprite\");\nvar Star_1 = require(\"./shapes/Star\");\nvar Text_1 = require(\"./shapes/Text\");\nvar TextPath_1 = require(\"./shapes/TextPath\");\nvar Transformer_1 = require(\"./shapes/Transformer\");\nvar Wedge_1 = require(\"./shapes/Wedge\");\nvar Blur_1 = require(\"./filters/Blur\");\nvar Brighten_1 = require(\"./filters/Brighten\");\nvar Contrast_1 = require(\"./filters/Contrast\");\nvar Emboss_1 = require(\"./filters/Emboss\");\nvar Enhance_1 = require(\"./filters/Enhance\");\nvar Grayscale_1 = require(\"./filters/Grayscale\");\nvar HSL_1 = require(\"./filters/HSL\");\nvar HSV_1 = require(\"./filters/HSV\");\nvar Invert_1 = require(\"./filters/Invert\");\nvar Kaleidoscope_1 = require(\"./filters/Kaleidoscope\");\nvar Mask_1 = require(\"./filters/Mask\");\nvar Noise_1 = require(\"./filters/Noise\");\nvar Pixelate_1 = require(\"./filters/Pixelate\");\nvar Posterize_1 = require(\"./filters/Posterize\");\nvar RGB_1 = require(\"./filters/RGB\");\nvar RGBA_1 = require(\"./filters/RGBA\");\nvar Sepia_1 = require(\"./filters/Sepia\");\nvar Solarize_1 = require(\"./filters/Solarize\");\nvar Threshold_1 = require(\"./filters/Threshold\");\nexports.Konva = _CoreInternals_1.Konva.Util._assign(_CoreInternals_1.Konva, {\n    Arc: Arc_1.Arc,\n    Arrow: Arrow_1.Arrow,\n    Circle: Circle_1.Circle,\n    Ellipse: Ellipse_1.Ellipse,\n    Image: Image_1.Image,\n    Label: Label_1.Label,\n    Tag: Label_1.Tag,\n    Line: Line_1.Line,\n    Path: Path_1.Path,\n    Rect: Rect_1.Rect,\n    RegularPolygon: RegularPolygon_1.RegularPolygon,\n    Ring: Ring_1.Ring,\n    Sprite: Sprite_1.Sprite,\n    Star: Star_1.Star,\n    Text: Text_1.Text,\n    TextPath: TextPath_1.TextPath,\n    Transformer: Transformer_1.Transformer,\n    Wedge: Wedge_1.Wedge,\n    Filters: {\n        Blur: Blur_1.Blur,\n        Brighten: Brighten_1.Brighten,\n        Contrast: Contrast_1.Contrast,\n        Emboss: Emboss_1.Emboss,\n        Enhance: Enhance_1.Enhance,\n        Grayscale: Grayscale_1.Grayscale,\n        HSL: HSL_1.HSL,\n        HSV: HSV_1.HSV,\n        Invert: Invert_1.Invert,\n        Kaleidoscope: Kaleidoscope_1.Kaleidoscope,\n        Mask: Mask_1.Mask,\n        Noise: Noise_1.Noise,\n        Pixelate: Pixelate_1.Pixelate,\n        Posterize: Posterize_1.Posterize,\n        RGB: RGB_1.RGB,\n        RGBA: RGBA_1.RGBA,\n        Sepia: Sepia_1.Sepia,\n        Solarize: Solarize_1.Solarize,\n        Threshold: Threshold_1.Threshold\n    }\n});\n","var Konva = require('./_FullInternals').Konva;\nKonva._injectGlobal(Konva);\nexports['default'] = Konva;\nmodule.exports = exports['default'];\n","/*jshint esversion: 6, browser: true*/\r\n\r\n//https://github.com/sappelhoff/eeg_positions\r\nexport const EEG2DPositions = {\r\n  Nz: [0.0, 1.0],\r\n  Iz: [0.0, -1.0],\r\n  Cz: [0.0, 0.0],\r\n  T9: [-1.0, 0.0],\r\n  T10: [1.0, 0.0],\r\n  NFpz: [0.0, 0.8541162227602905],\r\n  Fpz: [0.0, 0.726585179526356],\r\n  AFpz: [0.0, 0.6127922971114168],\r\n  AFz: [0.0, 0.5095100138556493],\r\n  AFFz: [0.0, 0.41421123542850447],\r\n  Fz: [0.0, 0.324930901050304],\r\n  FFCz: [0.0, 0.24008461131676362],\r\n  FCz: [0.0, 0.1583722002972682],\r\n  FCCz: [0.0, 0.07868390602203552],\r\n  CCPz: [0.0, -0.07868390602203552],\r\n  CPz: [0.0, -0.1583722002972682],\r\n  CPPz: [0.0, -0.24008461131676362],\r\n  Pz: [0.0, -0.324930901050304],\r\n  PPOz: [0.0, -0.41421123542850447],\r\n  POz: [0.0, -0.5095100138556493],\r\n  POOz: [0.0, -0.6127922971114168],\r\n  Oz: [0.0, -0.726585179526356],\r\n  OIz: [0.0, -0.8541162227602905],\r\n  N2h: [0.1564, 0.9877],\r\n  N2: [0.309, 0.9511],\r\n  AFp10: [0.454, 0.891],\r\n  AF10: [0.5878, 0.809],\r\n  AFF10: [0.7071, 0.7071],\r\n  F10: [0.809, 0.5878],\r\n  FFT10: [0.891, 0.454],\r\n  FT10: [0.9511, 0.309],\r\n  FTT10: [0.9877, 0.1564],\r\n  TTP10: [0.9877, -0.1564],\r\n  TP10: [0.9511, -0.309],\r\n  TPP10: [0.891, -0.454],\r\n  P10: [0.809, -0.5878],\r\n  PPO10: [0.7071, -0.7071],\r\n  PO10: [0.5878, -0.809],\r\n  POO10: [0.454, -0.891],\r\n  I2: [0.309, -0.9511],\r\n  I2h: [0.1564, -0.9877],\r\n  N1h: [-0.1564, 0.9877],\r\n  N1: [-0.309, 0.9511],\r\n  AFp9: [-0.454, 0.891],\r\n  AF9: [-0.5878, 0.809],\r\n  AFF9: [-0.7071, 0.7071],\r\n  F9: [-0.809, 0.5878],\r\n  FFT9: [-0.891, 0.454],\r\n  FT9: [-0.9511, 0.309],\r\n  FTT9: [-0.9877, 0.1564],\r\n  TTP9: [-0.9877, -0.1564],\r\n  TP9: [-0.9511, -0.309],\r\n  TPP9: [-0.891, -0.454],\r\n  P9: [-0.809, -0.5878],\r\n  PPO9: [-0.7071, -0.7071],\r\n  PO9: [-0.5878, -0.809],\r\n  POO9: [-0.454, -0.891],\r\n  I1: [-0.309, -0.9511],\r\n  I1h: [-0.1564, -0.9877],\r\n  T9h: [-0.8541162227602905, 0.0],\r\n  T7: [-0.726585179526356, 0.0],\r\n  T7h: [-0.6127922971114168, 0.0],\r\n  C5: [-0.5095100138556493, 0.0],\r\n  C5h: [-0.41421123542850447, 0.0],\r\n  C3: [-0.324930901050304, 0.0],\r\n  C3h: [-0.24008461131676362, 0.0],\r\n  C1: [-0.1583722002972682, 0.0],\r\n  C1h: [-0.07868390602203552, 0.0],\r\n  C2h: [0.07868390602203552, 0.0],\r\n  C2: [0.1583722002972682, 0.0],\r\n  C4h: [0.24008461131676362, 0.0],\r\n  C4: [0.324930901050304, 0.0],\r\n  C6h: [0.41421123542850447, 0.0],\r\n  C6: [0.5095100138556493, 0.0],\r\n  T8h: [0.6127922971114168, 0.0],\r\n  T8: [0.726585179526356, 0.0],\r\n  T10h: [0.8541162227602905, 0.0],\r\n  NFp2h: [0.13360428917329642, 0.8435662400553442],\r\n  NFp2: [0.26392251815980633, 0.8123486682808716],\r\n  AFp10h: [0.3877551020408163, 0.760982359045313],\r\n  AF10h: [0.5020754064337599, 0.6910238671739882],\r\n  AFF10h: [0.6039432722241439, 0.6039432722241439],\r\n  F10h: [0.6910238671739882, 0.5020754064337599],\r\n  FFT10h: [0.760982359045313, 0.3877551020408163],\r\n  FT10h: [0.8123486682808716, 0.26392251815980633],\r\n  FTT10h: [0.8435662400553442, 0.13360428917329642],\r\n  TTP10h: [0.8435662400553442, -0.13360428917329642],\r\n  TP10h: [0.8123486682808716, -0.26392251815980633],\r\n  TPP10h: [0.760982359045313, -0.3877551020408163],\r\n  P10h: [0.6910238671739882, -0.5020754064337599],\r\n  PPO10h: [0.6039432722241439, -0.6039432722241439],\r\n  PO10h: [0.5020754064337599, -0.6910238671739882],\r\n  POO10h: [0.3877551020408163, -0.760982359045313],\r\n  OI2: [0.26392251815980633, -0.8123486682808716],\r\n  OI2h: [0.13360428917329642, -0.8435662400553442],\r\n  NFp1h: [-0.13360428917329642, 0.8435662400553442],\r\n  NFp1: [-0.26392251815980633, 0.8123486682808716],\r\n  AFp9h: [-0.3877551020408163, 0.760982359045313],\r\n  AF9h: [-0.5020754064337599, 0.6910238671739882],\r\n  AFF9h: [-0.6039432722241439, 0.6039432722241439],\r\n  F9h: [-0.6910238671739882, 0.5020754064337599],\r\n  FFT9h: [-0.760982359045313, 0.3877551020408163],\r\n  FT9h: [-0.8123486682808716, 0.26392251815980633],\r\n  FTT9h: [-0.8435662400553442, 0.13360428917329642],\r\n  TTP9h: [-0.8435662400553442, -0.13360428917329642],\r\n  TP9h: [-0.8123486682808716, -0.26392251815980633],\r\n  TPP9h: [-0.760982359045313, -0.3877551020408163],\r\n  P9h: [-0.6910238671739882, -0.5020754064337599],\r\n  PPO9h: [-0.6039432722241439, -0.6039432722241439],\r\n  PO9h: [-0.5020754064337599, -0.6910238671739882],\r\n  POO9h: [-0.3877551020408163, -0.760982359045313],\r\n  OI1: [-0.26392251815980633, -0.8123486682808716],\r\n  OI1h: [-0.13360428917329642, -0.8435662400553442],\r\n  Fp2h: [0.11367456073338426, 0.7176470588235295],\r\n  Fp2: [0.2245225362872422, 0.6909854851031322],\r\n  AFp8: [0.3298701298701299, 0.6473644003055768],\r\n  AF8: [0.42704354469060357, 0.5878533231474408],\r\n  AFF8: [0.5137509549274255, 0.5137509549274255],\r\n  F8: [0.5878533231474408, 0.42704354469060357],\r\n  FFT8: [0.6473644003055768, 0.3298701298701299],\r\n  FT8: [0.6909854851031322, 0.2245225362872422],\r\n  FTT8: [0.7176470588235295, 0.11367456073338426],\r\n  TTP8: [0.7176470588235295, -0.11367456073338426],\r\n  TP8: [0.6909854851031322, -0.2245225362872422],\r\n  TPP8: [0.6473644003055768, -0.3298701298701299],\r\n  P8: [0.5878533231474408, -0.42704354469060357],\r\n  PPO8: [0.5137509549274255, -0.5137509549274255],\r\n  PO8: [0.42704354469060357, -0.5878533231474408],\r\n  POO8: [0.3298701298701299, -0.6473644003055768],\r\n  O2: [0.2245225362872422, -0.6909854851031322],\r\n  O2h: [0.11367456073338426, -0.7176470588235295],\r\n  Fp1h: [-0.11367456073338426, 0.7176470588235295],\r\n  Fp1: [-0.2245225362872422, 0.6909854851031322],\r\n  AFp7: [-0.3298701298701299, 0.6473644003055768],\r\n  AF7: [-0.42704354469060357, 0.5878533231474408],\r\n  AFF7: [-0.5137509549274255, 0.5137509549274255],\r\n  F7: [-0.5878533231474408, 0.42704354469060357],\r\n  FFT7: [-0.6473644003055768, 0.3298701298701299],\r\n  FT7: [-0.6909854851031322, 0.2245225362872422],\r\n  FTT7: [-0.7176470588235295, 0.11367456073338426],\r\n  TTP7: [-0.7176470588235295, -0.11367456073338426],\r\n  TP7: [-0.6909854851031322, -0.2245225362872422],\r\n  TPP7: [-0.6473644003055768, -0.3298701298701299],\r\n  P7: [-0.5878533231474408, -0.42704354469060357],\r\n  PPO7: [-0.5137509549274255, -0.5137509549274255],\r\n  PO7: [-0.42704354469060357, -0.5878533231474408],\r\n  POO7: [-0.3298701298701299, -0.6473644003055768],\r\n  O1: [-0.2245225362872422, -0.6909854851031322],\r\n  O1h: [-0.11367456073338426, -0.7176470588235295],\r\n  AFp7h: [-0.28673621460506704, 0.638822652757079],\r\n  AFp5: [-0.24432937057836776, 0.6316825906206696],\r\n  AFp5h: [-0.20265042979942693, 0.6257879656160459],\r\n  AFp3: [-0.16150208230394578, 0.621020681866309],\r\n  AFp3h: [-0.12073417544839136, 0.6174192197641147],\r\n  AFp1: [-0.08029904471826112, 0.6148414786099959],\r\n  AFp1h: [-0.04009092787766067, 0.6132809809189226],\r\n  AFp2h: [0.04009092787766067, 0.6132809809189226],\r\n  AFp2: [0.08029904471826112, 0.6148414786099959],\r\n  AFp4h: [0.12073417544839136, 0.6174192197641147],\r\n  AFp4: [0.16150208230394578, 0.621020681866309],\r\n  AFp6h: [0.20265042979942693, 0.6257879656160459],\r\n  AFp6: [0.24432937057836776, 0.6316825906206696],\r\n  AFp8h: [0.28673621460506704, 0.638822652757079],\r\n  AF7h: [-0.36991098788851595, 0.5677805340726688],\r\n  AF5: [-0.31425766182761766, 0.5513009327442318],\r\n  AF5h: [-0.2599728629579376, 0.5379240162822253],\r\n  AF3: [-0.20670981376304318, 0.5274072117289658],\r\n  AF3h: [-0.1542591035508699, 0.5194360002587155],\r\n  AF1: [-0.10247259750191182, 0.5138924292633189],\r\n  AF1h: [-0.0511622031328954, 0.5105482566953006],\r\n  AF2h: [0.0511622031328954, 0.5105482566953006],\r\n  AF2: [0.10247259750191182, 0.5138924292633189],\r\n  AF4h: [0.1542591035508699, 0.5194360002587155],\r\n  AF4: [0.20670981376304318, 0.5274072117289658],\r\n  AF6h: [0.2599728629579376, 0.5379240162822253],\r\n  AF6: [0.31425766182761766, 0.5513009327442318],\r\n  AF8h: [0.36991098788851595, 0.5677805340726688],\r\n  AFF7h: [-0.4425571561671326, 0.4873503905970043],\r\n  AFF5: [-0.37430433012080905, 0.4661327541740193],\r\n  AFF5h: [-0.30841060890992805, 0.449257505998314],\r\n  AFF3: [-0.2444222236110243, 0.4360977438910068],\r\n  AFF3h: [-0.1820445848265808, 0.42628925469234036],\r\n  AFF1: [-0.1207214715161617, 0.4194892553128163],\r\n  AFF1h: [-0.06016585308474975, 0.4155149091336823],\r\n  AFF2h: [0.06016585308474975, 0.4155149091336823],\r\n  AFF2: [0.1207214715161617, 0.4194892553128163],\r\n  AFF4h: [0.1820445848265808, 0.42628925469234036],\r\n  AFF4: [0.2444222236110243, 0.4360977438910068],\r\n  AFF6h: [0.30841060890992805, 0.449257505998314],\r\n  AFF6: [0.37430433012080905, 0.4661327541740193],\r\n  AFF8h: [0.4425571561671326, 0.4873503905970043],\r\n  F7h: [-0.5032135037785155, 0.3991807331026203],\r\n  F5: [-0.42338949454905844, 0.3771390815989428],\r\n  F5h: [-0.3473559194899362, 0.3599199899987498],\r\n  F3: [-0.2744172145845786, 0.346682606096832],\r\n  F3h: [-0.20379995379995378, 0.33685608685608687],\r\n  F1: [-0.13492644986755342, 0.3301583723158429],\r\n  F1h: [-0.0672110203854913, 0.3262234072099095],\r\n  F2h: [0.0672110203854913, 0.3262234072099095],\r\n  F2: [0.13492644986755342, 0.3301583723158429],\r\n  F4h: [0.20379995379995378, 0.33685608685608687],\r\n  F4: [0.2744172145845786, 0.346682606096832],\r\n  F6h: [0.3473559194899362, 0.3599199899987498],\r\n  F6: [0.42338949454905844, 0.3771390815989428],\r\n  F8h: [0.5032135037785155, 0.3991807331026203],\r\n  FFT7h: [-0.55086224952873, 0.30475459051874604],\r\n  FFC5: [-0.46120996441281137, 0.28521514073115495],\r\n  FFC5h: [-0.37697448359659785, 0.2701701093560146],\r\n  FFC3: [-0.2969101934738666, 0.2586774473000289],\r\n  FFC3h: [-0.22004333092605968, 0.2502638742292095],\r\n  FFC1: [-0.14549778402334884, 0.24451410658307213],\r\n  FFC1h: [-0.07236282433007231, 0.24117396852403233],\r\n  FFC2h: [0.07236282433007231, 0.24117396852403233],\r\n  FFC2: [0.14549778402334884, 0.24451410658307213],\r\n  FFC4h: [0.22004333092605968, 0.2502638742292095],\r\n  FFC4: [0.2969101934738666, 0.2586774473000289],\r\n  FFC6h: [0.37697448359659785, 0.2701701093560146],\r\n  FFC6: [0.46120996441281137, 0.28521514073115495],\r\n  FFT8h: [0.55086224952873, 0.30475459051874604],\r\n  FT7h: [-0.5851969812365853, 0.20570518590320572],\r\n  FC5: [-0.4881438041815401, 0.19122896481387047],\r\n  FC5h: [-0.3978091325831994, 0.18015121747931176],\r\n  FC3: [-0.31264795400743994, 0.17179573892458574],\r\n  FC3h: [-0.23132634309804345, 0.1657118149389255],\r\n  FC1: [-0.15274425438136216, 0.16155945009969566],\r\n  FC1h: [-0.07593957828530185, 0.15914832190544928],\r\n  FC2h: [0.07593957828530185, 0.15914832190544928],\r\n  FC2: [0.15274425438136216, 0.16155945009969566],\r\n  FC4h: [0.23132634309804345, 0.1657118149389255],\r\n  FC4: [0.31264795400743994, 0.17179573892458574],\r\n  FC6h: [0.3978091325831994, 0.18015121747931176],\r\n  FC6: [0.4881438041815401, 0.19122896481387047],\r\n  FT8h: [0.5851969812365853, 0.20570518590320572],\r\n  FTT7h: [-0.6059249052704099, 0.10361694798484326],\r\n  FCC5: [-0.5042324699936829, 0.09595704358812382],\r\n  FCC5h: [-0.4101870368191977, 0.0901070462298553],\r\n  FCC3: [-0.32189079597844805, 0.08570793756596122],\r\n  FCC3h: [-0.23793066780093577, 0.08251807741386644],\r\n  FCC1: [-0.1569830386142187, 0.0803732535959169],\r\n  FCC1h: [-0.07799767171129218, 0.07911120109328339],\r\n  FCC2h: [0.07799767171129218, 0.07911120109328339],\r\n  FCC2: [0.1569830386142187, 0.0803732535959169],\r\n  FCC4h: [0.23793066780093577, 0.08251807741386644],\r\n  FCC4: [0.32189079597844805, 0.08570793756596122],\r\n  FCC6h: [0.4101870368191977, 0.0901070462298553],\r\n  FCC6: [0.5042324699936829, 0.09595704358812382],\r\n  FTT8h: [0.6059249052704099, 0.10361694798484326],\r\n  TTP7h: [-0.6059249052704099, -0.10361694798484326],\r\n  CCP5: [-0.5042324699936829, -0.09595704358812382],\r\n  CCP5h: [-0.4101870368191977, -0.0901070462298553],\r\n  CCP3: [-0.32189079597844805, -0.08570793756596122],\r\n  CCP3h: [-0.23793066780093577, -0.08251807741386644],\r\n  CCP1: [-0.1569830386142187, -0.0803732535959169],\r\n  CCP1h: [-0.07799767171129218, -0.07911120109328339],\r\n  CCP2h: [0.07799767171129218, -0.07911120109328339],\r\n  CCP2: [0.1569830386142187, -0.0803732535959169],\r\n  CCP4h: [0.23793066780093577, -0.08251807741386644],\r\n  CCP4: [0.32189079597844805, -0.08570793756596122],\r\n  CCP6h: [0.4101870368191977, -0.0901070462298553],\r\n  CCP6: [0.5042324699936829, -0.09595704358812382],\r\n  TTP8h: [0.6059249052704099, -0.10361694798484326],\r\n  TP7h: [-0.5851969812365853, -0.20570518590320572],\r\n  CP5: [-0.4881438041815401, -0.19122896481387047],\r\n  CP5h: [-0.3978091325831994, -0.18015121747931176],\r\n  CP3: [-0.31264795400743994, -0.17179573892458574],\r\n  CP3h: [-0.23132634309804345, -0.1657118149389255],\r\n  CP1: [-0.15274425438136216, -0.16155945009969566],\r\n  CP1h: [-0.07593957828530185, -0.15914832190544928],\r\n  CP2h: [0.07593957828530185, -0.15914832190544928],\r\n  CP2: [0.15274425438136216, -0.16155945009969566],\r\n  CP4h: [0.23132634309804345, -0.1657118149389255],\r\n  CP4: [0.31264795400743994, -0.17179573892458574],\r\n  CP6h: [0.3978091325831994, -0.18015121747931176],\r\n  CP6: [0.4881438041815401, -0.19122896481387047],\r\n  TP8h: [0.5851969812365853, -0.20570518590320572],\r\n  TPP7h: [-0.55086224952873, -0.30475459051874604],\r\n  CPP5: [-0.46120996441281137, -0.28521514073115495],\r\n  CPP5h: [-0.37697448359659785, -0.2701701093560146],\r\n  CPP3: [-0.2969101934738666, -0.2586774473000289],\r\n  CPP3h: [-0.22004333092605968, -0.2502638742292095],\r\n  CPP1: [-0.14549778402334884, -0.24451410658307213],\r\n  CPP1h: [-0.07236282433007231, -0.24117396852403233],\r\n  CPP2h: [0.07236282433007231, -0.24117396852403233],\r\n  CPP2: [0.14549778402334884, -0.24451410658307213],\r\n  CPP4h: [0.22004333092605968, -0.2502638742292095],\r\n  CPP4: [0.2969101934738666, -0.2586774473000289],\r\n  CPP6h: [0.37697448359659785, -0.2701701093560146],\r\n  CPP6: [0.46120996441281137, -0.28521514073115495],\r\n  TPP8h: [0.55086224952873, -0.30475459051874604],\r\n  P7h: [-0.5032135037785155, -0.3991807331026203],\r\n  P5: [-0.42338949454905844, -0.3771390815989428],\r\n  P5h: [-0.3473559194899362, -0.3599199899987498],\r\n  P3: [-0.2744172145845786, -0.346682606096832],\r\n  P3h: [-0.20379995379995378, -0.33685608685608687],\r\n  P1: [-0.13492644986755342, -0.3301583723158429],\r\n  P1h: [-0.0672110203854913, -0.3262234072099095],\r\n  P2h: [0.0672110203854913, -0.3262234072099095],\r\n  P2: [0.13492644986755342, -0.3301583723158429],\r\n  P4h: [0.20379995379995378, -0.33685608685608687],\r\n  P4: [0.2744172145845786, -0.346682606096832],\r\n  P6h: [0.3473559194899362, -0.3599199899987498],\r\n  P6: [0.42338949454905844, -0.3771390815989428],\r\n  P8h: [0.5032135037785155, -0.3991807331026203],\r\n  PPO7h: [-0.4425571561671326, -0.4873503905970043],\r\n  PPO5: [-0.37430433012080905, -0.4661327541740193],\r\n  PPO5h: [-0.30841060890992805, -0.449257505998314],\r\n  PPO3: [-0.2444222236110243, -0.4360977438910068],\r\n  PPO3h: [-0.1820445848265808, -0.42628925469234036],\r\n  PPO1: [-0.1207214715161617, -0.4194892553128163],\r\n  PPO1h: [-0.06016585308474975, -0.4155149091336823],\r\n  PPO2h: [0.06016585308474975, -0.4155149091336823],\r\n  PPO2: [0.1207214715161617, -0.4194892553128163],\r\n  PPO4h: [0.1820445848265808, -0.42628925469234036],\r\n  PPO4: [0.2444222236110243, -0.4360977438910068],\r\n  PPO6h: [0.30841060890992805, -0.449257505998314],\r\n  PPO6: [0.37430433012080905, -0.4661327541740193],\r\n  PPO8h: [0.4425571561671326, -0.4873503905970043],\r\n  PO7h: [-0.36991098788851595, -0.5677805340726688],\r\n  PO5: [-0.31425766182761766, -0.5513009327442318],\r\n  PO5h: [-0.2599728629579376, -0.5379240162822253],\r\n  PO3: [-0.20670981376304318, -0.5274072117289658],\r\n  PO3h: [-0.1542591035508699, -0.5194360002587155],\r\n  PO1: [-0.10247259750191182, -0.5138924292633189],\r\n  PO1h: [-0.0511622031328954, -0.5105482566953006],\r\n  PO2h: [0.0511622031328954, -0.5105482566953006],\r\n  PO2: [0.10247259750191182, -0.5138924292633189],\r\n  PO4h: [0.1542591035508699, -0.5194360002587155],\r\n  PO4: [0.20670981376304318, -0.5274072117289658],\r\n  PO6h: [0.2599728629579376, -0.5379240162822253],\r\n  PO6: [0.31425766182761766, -0.5513009327442318],\r\n  PO8h: [0.36991098788851595, -0.5677805340726688],\r\n  POO7h: [-0.28673621460506704, -0.638822652757079],\r\n  POO5: [-0.24432937057836776, -0.6316825906206696],\r\n  POO5h: [-0.20265042979942693, -0.6257879656160459],\r\n  POO3: [-0.16150208230394578, -0.621020681866309],\r\n  POO3h: [-0.12073417544839136, -0.6174192197641147],\r\n  POO1: [-0.08029904471826112, -0.6148414786099959],\r\n  POO1h: [-0.04009092787766067, -0.6132809809189226],\r\n  POO2h: [0.04009092787766067, -0.6132809809189226],\r\n  POO2: [0.08029904471826112, -0.6148414786099959],\r\n  POO4h: [0.12073417544839136, -0.6174192197641147],\r\n  POO4: [0.16150208230394578, -0.621020681866309],\r\n  POO6h: [0.20265042979942693, -0.6257879656160459],\r\n  POO6: [0.24432937057836776, -0.6316825906206696],\r\n  POO8h: [0.28673621460506704, -0.638822652757079]\r\n};\r\n\r\nexport const rescaledEEGLocations2D = ({ width, height, left, top }, invertY = true, zoom=0.9) => {\r\n  const adjWidth = zoom * width;\r\n  const adjHeight = zoom * height;\r\n  const rescaled = {};\r\n  Object.keys(EEG2DPositions).forEach(m => {\r\n    const v = EEG2DPositions[m];\r\n    rescaled[m] = [v[0] * adjWidth/2 + width / 2 + left, (invertY ? -1 : 1) * v[1] * adjHeight/2 + height / 2 + top];\r\n  });\r\n  return rescaled;\r\n};\r\n","module.exports={\n\t\"jet\":[{\"index\":0,\"rgb\":[0,0,131]},{\"index\":0.125,\"rgb\":[0,60,170]},{\"index\":0.375,\"rgb\":[5,255,255]},{\"index\":0.625,\"rgb\":[255,255,0]},{\"index\":0.875,\"rgb\":[250,0,0]},{\"index\":1,\"rgb\":[128,0,0]}],\n\n\t\"hsv\":[{\"index\":0,\"rgb\":[255,0,0]},{\"index\":0.169,\"rgb\":[253,255,2]},{\"index\":0.173,\"rgb\":[247,255,2]},{\"index\":0.337,\"rgb\":[0,252,4]},{\"index\":0.341,\"rgb\":[0,252,10]},{\"index\":0.506,\"rgb\":[1,249,255]},{\"index\":0.671,\"rgb\":[2,0,253]},{\"index\":0.675,\"rgb\":[8,0,253]},{\"index\":0.839,\"rgb\":[255,0,251]},{\"index\":0.843,\"rgb\":[255,0,245]},{\"index\":1,\"rgb\":[255,0,6]}],\n\n\t\"hot\":[{\"index\":0,\"rgb\":[0,0,0]},{\"index\":0.3,\"rgb\":[230,0,0]},{\"index\":0.6,\"rgb\":[255,210,0]},{\"index\":1,\"rgb\":[255,255,255]}],\n\n\t\"cool\":[{\"index\":0,\"rgb\":[0,255,255]},{\"index\":1,\"rgb\":[255,0,255]}],\n\n\t\"spring\":[{\"index\":0,\"rgb\":[255,0,255]},{\"index\":1,\"rgb\":[255,255,0]}],\n\n\t\"summer\":[{\"index\":0,\"rgb\":[0,128,102]},{\"index\":1,\"rgb\":[255,255,102]}],\n\n\t\"autumn\":[{\"index\":0,\"rgb\":[255,0,0]},{\"index\":1,\"rgb\":[255,255,0]}],\n\n\t\"winter\":[{\"index\":0,\"rgb\":[0,0,255]},{\"index\":1,\"rgb\":[0,255,128]}],\n\n\t\"bone\":[{\"index\":0,\"rgb\":[0,0,0]},{\"index\":0.376,\"rgb\":[84,84,116]},{\"index\":0.753,\"rgb\":[169,200,200]},{\"index\":1,\"rgb\":[255,255,255]}],\n\n\t\"copper\":[{\"index\":0,\"rgb\":[0,0,0]},{\"index\":0.804,\"rgb\":[255,160,102]},{\"index\":1,\"rgb\":[255,199,127]}],\n\n\t\"greys\":[{\"index\":0,\"rgb\":[0,0,0]},{\"index\":1,\"rgb\":[255,255,255]}],\n\n\t\"yignbu\":[{\"index\":0,\"rgb\":[8,29,88]},{\"index\":0.125,\"rgb\":[37,52,148]},{\"index\":0.25,\"rgb\":[34,94,168]},{\"index\":0.375,\"rgb\":[29,145,192]},{\"index\":0.5,\"rgb\":[65,182,196]},{\"index\":0.625,\"rgb\":[127,205,187]},{\"index\":0.75,\"rgb\":[199,233,180]},{\"index\":0.875,\"rgb\":[237,248,217]},{\"index\":1,\"rgb\":[255,255,217]}],\n\n\t\"greens\":[{\"index\":0,\"rgb\":[0,68,27]},{\"index\":0.125,\"rgb\":[0,109,44]},{\"index\":0.25,\"rgb\":[35,139,69]},{\"index\":0.375,\"rgb\":[65,171,93]},{\"index\":0.5,\"rgb\":[116,196,118]},{\"index\":0.625,\"rgb\":[161,217,155]},{\"index\":0.75,\"rgb\":[199,233,192]},{\"index\":0.875,\"rgb\":[229,245,224]},{\"index\":1,\"rgb\":[247,252,245]}],\n\n\t\"yiorrd\":[{\"index\":0,\"rgb\":[128,0,38]},{\"index\":0.125,\"rgb\":[189,0,38]},{\"index\":0.25,\"rgb\":[227,26,28]},{\"index\":0.375,\"rgb\":[252,78,42]},{\"index\":0.5,\"rgb\":[253,141,60]},{\"index\":0.625,\"rgb\":[254,178,76]},{\"index\":0.75,\"rgb\":[254,217,118]},{\"index\":0.875,\"rgb\":[255,237,160]},{\"index\":1,\"rgb\":[255,255,204]}],\n\n\t\"bluered\":[{\"index\":0,\"rgb\":[0,0,255]},{\"index\":1,\"rgb\":[255,0,0]}],\n\n\t\"rdbu\":[{\"index\":0,\"rgb\":[5,10,172]},{\"index\":0.35,\"rgb\":[106,137,247]},{\"index\":0.5,\"rgb\":[190,190,190]},{\"index\":0.6,\"rgb\":[220,170,132]},{\"index\":0.7,\"rgb\":[230,145,90]},{\"index\":1,\"rgb\":[178,10,28]}],\n\n\t\"picnic\":[{\"index\":0,\"rgb\":[0,0,255]},{\"index\":0.1,\"rgb\":[51,153,255]},{\"index\":0.2,\"rgb\":[102,204,255]},{\"index\":0.3,\"rgb\":[153,204,255]},{\"index\":0.4,\"rgb\":[204,204,255]},{\"index\":0.5,\"rgb\":[255,255,255]},{\"index\":0.6,\"rgb\":[255,204,255]},{\"index\":0.7,\"rgb\":[255,153,255]},{\"index\":0.8,\"rgb\":[255,102,204]},{\"index\":0.9,\"rgb\":[255,102,102]},{\"index\":1,\"rgb\":[255,0,0]}],\n\n\t\"rainbow\":[{\"index\":0,\"rgb\":[150,0,90]},{\"index\":0.125,\"rgb\":[0,0,200]},{\"index\":0.25,\"rgb\":[0,25,255]},{\"index\":0.375,\"rgb\":[0,152,255]},{\"index\":0.5,\"rgb\":[44,255,150]},{\"index\":0.625,\"rgb\":[151,255,0]},{\"index\":0.75,\"rgb\":[255,234,0]},{\"index\":0.875,\"rgb\":[255,111,0]},{\"index\":1,\"rgb\":[255,0,0]}],\n\n\t\"portland\":[{\"index\":0,\"rgb\":[12,51,131]},{\"index\":0.25,\"rgb\":[10,136,186]},{\"index\":0.5,\"rgb\":[242,211,56]},{\"index\":0.75,\"rgb\":[242,143,56]},{\"index\":1,\"rgb\":[217,30,30]}],\n\n\t\"blackbody\":[{\"index\":0,\"rgb\":[0,0,0]},{\"index\":0.2,\"rgb\":[230,0,0]},{\"index\":0.4,\"rgb\":[230,210,0]},{\"index\":0.7,\"rgb\":[255,255,255]},{\"index\":1,\"rgb\":[160,200,255]}],\n\n\t\"earth\":[{\"index\":0,\"rgb\":[0,0,130]},{\"index\":0.1,\"rgb\":[0,180,180]},{\"index\":0.2,\"rgb\":[40,210,40]},{\"index\":0.4,\"rgb\":[230,230,50]},{\"index\":0.6,\"rgb\":[120,70,20]},{\"index\":1,\"rgb\":[255,255,255]}],\n\n\t\"electric\":[{\"index\":0,\"rgb\":[0,0,0]},{\"index\":0.15,\"rgb\":[30,0,100]},{\"index\":0.4,\"rgb\":[120,0,100]},{\"index\":0.6,\"rgb\":[160,90,0]},{\"index\":0.8,\"rgb\":[230,200,0]},{\"index\":1,\"rgb\":[255,250,220]}],\n\n\t\"alpha\": [{\"index\":0, \"rgb\": [255,255,255,0]},{\"index\":1, \"rgb\": [255,255,255,1]}],\n\n\t\"viridis\": [{\"index\":0,\"rgb\":[68,1,84]},{\"index\":0.13,\"rgb\":[71,44,122]},{\"index\":0.25,\"rgb\":[59,81,139]},{\"index\":0.38,\"rgb\":[44,113,142]},{\"index\":0.5,\"rgb\":[33,144,141]},{\"index\":0.63,\"rgb\":[39,173,129]},{\"index\":0.75,\"rgb\":[92,200,99]},{\"index\":0.88,\"rgb\":[170,220,50]},{\"index\":1,\"rgb\":[253,231,37]}],\n\n\t\"inferno\": [{\"index\":0,\"rgb\":[0,0,4]},{\"index\":0.13,\"rgb\":[31,12,72]},{\"index\":0.25,\"rgb\":[85,15,109]},{\"index\":0.38,\"rgb\":[136,34,106]},{\"index\":0.5,\"rgb\":[186,54,85]},{\"index\":0.63,\"rgb\":[227,89,51]},{\"index\":0.75,\"rgb\":[249,140,10]},{\"index\":0.88,\"rgb\":[249,201,50]},{\"index\":1,\"rgb\":[252,255,164]}],\n\n\t\"magma\": [{\"index\":0,\"rgb\":[0,0,4]},{\"index\":0.13,\"rgb\":[28,16,68]},{\"index\":0.25,\"rgb\":[79,18,123]},{\"index\":0.38,\"rgb\":[129,37,129]},{\"index\":0.5,\"rgb\":[181,54,122]},{\"index\":0.63,\"rgb\":[229,80,100]},{\"index\":0.75,\"rgb\":[251,135,97]},{\"index\":0.88,\"rgb\":[254,194,135]},{\"index\":1,\"rgb\":[252,253,191]}],\n\n\t\"plasma\": [{\"index\":0,\"rgb\":[13,8,135]},{\"index\":0.13,\"rgb\":[75,3,161]},{\"index\":0.25,\"rgb\":[125,3,168]},{\"index\":0.38,\"rgb\":[168,34,150]},{\"index\":0.5,\"rgb\":[203,70,121]},{\"index\":0.63,\"rgb\":[229,107,93]},{\"index\":0.75,\"rgb\":[248,148,65]},{\"index\":0.88,\"rgb\":[253,195,40]},{\"index\":1,\"rgb\":[240,249,33]}],\n\n\t\"warm\": [{\"index\":0,\"rgb\":[125,0,179]},{\"index\":0.13,\"rgb\":[172,0,187]},{\"index\":0.25,\"rgb\":[219,0,170]},{\"index\":0.38,\"rgb\":[255,0,130]},{\"index\":0.5,\"rgb\":[255,63,74]},{\"index\":0.63,\"rgb\":[255,123,0]},{\"index\":0.75,\"rgb\":[234,176,0]},{\"index\":0.88,\"rgb\":[190,228,0]},{\"index\":1,\"rgb\":[147,255,0]}],\n\n\t\"cool\": [{\"index\":0,\"rgb\":[125,0,179]},{\"index\":0.13,\"rgb\":[116,0,218]},{\"index\":0.25,\"rgb\":[98,74,237]},{\"index\":0.38,\"rgb\":[68,146,231]},{\"index\":0.5,\"rgb\":[0,204,197]},{\"index\":0.63,\"rgb\":[0,247,146]},{\"index\":0.75,\"rgb\":[0,255,88]},{\"index\":0.88,\"rgb\":[40,255,8]},{\"index\":1,\"rgb\":[147,255,0]}],\n\n\t\"rainbow-soft\": [{\"index\":0,\"rgb\":[125,0,179]},{\"index\":0.1,\"rgb\":[199,0,180]},{\"index\":0.2,\"rgb\":[255,0,121]},{\"index\":0.3,\"rgb\":[255,108,0]},{\"index\":0.4,\"rgb\":[222,194,0]},{\"index\":0.5,\"rgb\":[150,255,0]},{\"index\":0.6,\"rgb\":[0,255,55]},{\"index\":0.7,\"rgb\":[0,246,150]},{\"index\":0.8,\"rgb\":[50,167,222]},{\"index\":0.9,\"rgb\":[103,51,235]},{\"index\":1,\"rgb\":[124,0,186]}],\n\n\t\"bathymetry\": [{\"index\":0,\"rgb\":[40,26,44]},{\"index\":0.13,\"rgb\":[59,49,90]},{\"index\":0.25,\"rgb\":[64,76,139]},{\"index\":0.38,\"rgb\":[63,110,151]},{\"index\":0.5,\"rgb\":[72,142,158]},{\"index\":0.63,\"rgb\":[85,174,163]},{\"index\":0.75,\"rgb\":[120,206,163]},{\"index\":0.88,\"rgb\":[187,230,172]},{\"index\":1,\"rgb\":[253,254,204]}],\n\n\t\"cdom\": [{\"index\":0,\"rgb\":[47,15,62]},{\"index\":0.13,\"rgb\":[87,23,86]},{\"index\":0.25,\"rgb\":[130,28,99]},{\"index\":0.38,\"rgb\":[171,41,96]},{\"index\":0.5,\"rgb\":[206,67,86]},{\"index\":0.63,\"rgb\":[230,106,84]},{\"index\":0.75,\"rgb\":[242,149,103]},{\"index\":0.88,\"rgb\":[249,193,135]},{\"index\":1,\"rgb\":[254,237,176]}],\n\n\t\"chlorophyll\": [{\"index\":0,\"rgb\":[18,36,20]},{\"index\":0.13,\"rgb\":[25,63,41]},{\"index\":0.25,\"rgb\":[24,91,59]},{\"index\":0.38,\"rgb\":[13,119,72]},{\"index\":0.5,\"rgb\":[18,148,80]},{\"index\":0.63,\"rgb\":[80,173,89]},{\"index\":0.75,\"rgb\":[132,196,122]},{\"index\":0.88,\"rgb\":[175,221,162]},{\"index\":1,\"rgb\":[215,249,208]}],\n\n\t\"density\": [{\"index\":0,\"rgb\":[54,14,36]},{\"index\":0.13,\"rgb\":[89,23,80]},{\"index\":0.25,\"rgb\":[110,45,132]},{\"index\":0.38,\"rgb\":[120,77,178]},{\"index\":0.5,\"rgb\":[120,113,213]},{\"index\":0.63,\"rgb\":[115,151,228]},{\"index\":0.75,\"rgb\":[134,185,227]},{\"index\":0.88,\"rgb\":[177,214,227]},{\"index\":1,\"rgb\":[230,241,241]}],\n\n\t\"freesurface-blue\": [{\"index\":0,\"rgb\":[30,4,110]},{\"index\":0.13,\"rgb\":[47,14,176]},{\"index\":0.25,\"rgb\":[41,45,236]},{\"index\":0.38,\"rgb\":[25,99,212]},{\"index\":0.5,\"rgb\":[68,131,200]},{\"index\":0.63,\"rgb\":[114,156,197]},{\"index\":0.75,\"rgb\":[157,181,203]},{\"index\":0.88,\"rgb\":[200,208,216]},{\"index\":1,\"rgb\":[241,237,236]}],\n\n\t\"freesurface-red\": [{\"index\":0,\"rgb\":[60,9,18]},{\"index\":0.13,\"rgb\":[100,17,27]},{\"index\":0.25,\"rgb\":[142,20,29]},{\"index\":0.38,\"rgb\":[177,43,27]},{\"index\":0.5,\"rgb\":[192,87,63]},{\"index\":0.63,\"rgb\":[205,125,105]},{\"index\":0.75,\"rgb\":[216,162,148]},{\"index\":0.88,\"rgb\":[227,199,193]},{\"index\":1,\"rgb\":[241,237,236]}],\n\n\t\"oxygen\": [{\"index\":0,\"rgb\":[64,5,5]},{\"index\":0.13,\"rgb\":[106,6,15]},{\"index\":0.25,\"rgb\":[144,26,7]},{\"index\":0.38,\"rgb\":[168,64,3]},{\"index\":0.5,\"rgb\":[188,100,4]},{\"index\":0.63,\"rgb\":[206,136,11]},{\"index\":0.75,\"rgb\":[220,174,25]},{\"index\":0.88,\"rgb\":[231,215,44]},{\"index\":1,\"rgb\":[248,254,105]}],\n\n\t\"par\": [{\"index\":0,\"rgb\":[51,20,24]},{\"index\":0.13,\"rgb\":[90,32,35]},{\"index\":0.25,\"rgb\":[129,44,34]},{\"index\":0.38,\"rgb\":[159,68,25]},{\"index\":0.5,\"rgb\":[182,99,19]},{\"index\":0.63,\"rgb\":[199,134,22]},{\"index\":0.75,\"rgb\":[212,171,35]},{\"index\":0.88,\"rgb\":[221,210,54]},{\"index\":1,\"rgb\":[225,253,75]}],\n\n\t\"phase\": [{\"index\":0,\"rgb\":[145,105,18]},{\"index\":0.13,\"rgb\":[184,71,38]},{\"index\":0.25,\"rgb\":[186,58,115]},{\"index\":0.38,\"rgb\":[160,71,185]},{\"index\":0.5,\"rgb\":[110,97,218]},{\"index\":0.63,\"rgb\":[50,123,164]},{\"index\":0.75,\"rgb\":[31,131,110]},{\"index\":0.88,\"rgb\":[77,129,34]},{\"index\":1,\"rgb\":[145,105,18]}],\n\n\t\"salinity\": [{\"index\":0,\"rgb\":[42,24,108]},{\"index\":0.13,\"rgb\":[33,50,162]},{\"index\":0.25,\"rgb\":[15,90,145]},{\"index\":0.38,\"rgb\":[40,118,137]},{\"index\":0.5,\"rgb\":[59,146,135]},{\"index\":0.63,\"rgb\":[79,175,126]},{\"index\":0.75,\"rgb\":[120,203,104]},{\"index\":0.88,\"rgb\":[193,221,100]},{\"index\":1,\"rgb\":[253,239,154]}],\n\n\t\"temperature\": [{\"index\":0,\"rgb\":[4,35,51]},{\"index\":0.13,\"rgb\":[23,51,122]},{\"index\":0.25,\"rgb\":[85,59,157]},{\"index\":0.38,\"rgb\":[129,79,143]},{\"index\":0.5,\"rgb\":[175,95,130]},{\"index\":0.63,\"rgb\":[222,112,101]},{\"index\":0.75,\"rgb\":[249,146,66]},{\"index\":0.88,\"rgb\":[249,196,65]},{\"index\":1,\"rgb\":[232,250,91]}],\n\n\t\"turbidity\": [{\"index\":0,\"rgb\":[34,31,27]},{\"index\":0.13,\"rgb\":[65,50,41]},{\"index\":0.25,\"rgb\":[98,69,52]},{\"index\":0.38,\"rgb\":[131,89,57]},{\"index\":0.5,\"rgb\":[161,112,59]},{\"index\":0.63,\"rgb\":[185,140,66]},{\"index\":0.75,\"rgb\":[202,174,88]},{\"index\":0.88,\"rgb\":[216,209,126]},{\"index\":1,\"rgb\":[233,246,171]}],\n\n\t\"velocity-blue\": [{\"index\":0,\"rgb\":[17,32,64]},{\"index\":0.13,\"rgb\":[35,52,116]},{\"index\":0.25,\"rgb\":[29,81,156]},{\"index\":0.38,\"rgb\":[31,113,162]},{\"index\":0.5,\"rgb\":[50,144,169]},{\"index\":0.63,\"rgb\":[87,173,176]},{\"index\":0.75,\"rgb\":[149,196,189]},{\"index\":0.88,\"rgb\":[203,221,211]},{\"index\":1,\"rgb\":[254,251,230]}],\n\n\t\"velocity-green\": [{\"index\":0,\"rgb\":[23,35,19]},{\"index\":0.13,\"rgb\":[24,64,38]},{\"index\":0.25,\"rgb\":[11,95,45]},{\"index\":0.38,\"rgb\":[39,123,35]},{\"index\":0.5,\"rgb\":[95,146,12]},{\"index\":0.63,\"rgb\":[152,165,18]},{\"index\":0.75,\"rgb\":[201,186,69]},{\"index\":0.88,\"rgb\":[233,216,137]},{\"index\":1,\"rgb\":[255,253,205]}],\n\n\t\"cubehelix\": [{\"index\":0,\"rgb\":[0,0,0]},{\"index\":0.07,\"rgb\":[22,5,59]},{\"index\":0.13,\"rgb\":[60,4,105]},{\"index\":0.2,\"rgb\":[109,1,135]},{\"index\":0.27,\"rgb\":[161,0,147]},{\"index\":0.33,\"rgb\":[210,2,142]},{\"index\":0.4,\"rgb\":[251,11,123]},{\"index\":0.47,\"rgb\":[255,29,97]},{\"index\":0.53,\"rgb\":[255,54,69]},{\"index\":0.6,\"rgb\":[255,85,46]},{\"index\":0.67,\"rgb\":[255,120,34]},{\"index\":0.73,\"rgb\":[255,157,37]},{\"index\":0.8,\"rgb\":[241,191,57]},{\"index\":0.87,\"rgb\":[224,220,93]},{\"index\":0.93,\"rgb\":[218,241,142]},{\"index\":1,\"rgb\":[227,253,198]}]\n};\n","function lerp(v0, v1, t) {\n    return v0*(1-t)+v1*t\n}\nmodule.exports = lerp","/*\n * Ben Postlethwaite\n * January 2013\n * License MIT\n */\n'use strict';\n\nvar colorScale = require('./colorScale');\nvar lerp = require('lerp')\n\nmodule.exports = createColormap;\n\nfunction createColormap (spec) {\n    /*\n     * Default Options\n     */\n    var indicies, fromrgba, torgba,\n        nsteps, cmap, colormap, format,\n        nshades, colors, alpha, i;\n\n    if ( !spec ) spec = {};\n\n    nshades = (spec.nshades || 72) - 1;\n    format = spec.format || 'hex';\n\n    colormap = spec.colormap;\n    if (!colormap) colormap = 'jet';\n\n    if (typeof colormap === 'string') {\n        colormap = colormap.toLowerCase();\n\n        if (!colorScale[colormap]) {\n            throw Error(colormap + ' not a supported colorscale');\n        }\n\n        cmap = colorScale[colormap];\n\n    } else if (Array.isArray(colormap)) {\n        cmap = colormap.slice();\n\n    } else {\n        throw Error('unsupported colormap option', colormap);\n    }\n\n    if (cmap.length > nshades + 1) {\n        throw new Error(\n            colormap+' map requires nshades to be at least size '+cmap.length\n        );\n    }\n\n    if (!Array.isArray(spec.alpha)) {\n\n        if (typeof spec.alpha === 'number') {\n            alpha = [spec.alpha, spec.alpha];\n\n        } else {\n            alpha = [1, 1];\n        }\n\n    } else if (spec.alpha.length !== 2) {\n        alpha = [1, 1];\n\n    } else {\n        alpha = spec.alpha.slice();\n    }\n\n    // map index points from 0..1 to 0..n-1\n    indicies = cmap.map(function(c) {\n        return Math.round(c.index * nshades);\n    });\n\n    // Add alpha channel to the map\n    alpha[0] = Math.min(Math.max(alpha[0], 0), 1);\n    alpha[1] = Math.min(Math.max(alpha[1], 0), 1);\n\n    var steps = cmap.map(function(c, i) {\n        var index = cmap[i].index\n\n        var rgba = cmap[i].rgb.slice();\n\n        // if user supplies their own map use it\n        if (rgba.length === 4 && rgba[3] >= 0 && rgba[3] <= 1) {\n            return rgba\n        }\n        rgba[3] = alpha[0] + (alpha[1] - alpha[0])*index;\n\n        return rgba\n    })\n\n\n    /*\n     * map increasing linear values between indicies to\n     * linear steps in colorvalues\n     */\n    var colors = []\n    for (i = 0; i < indicies.length-1; ++i) {\n        nsteps = indicies[i+1] - indicies[i];\n        fromrgba = steps[i];\n        torgba = steps[i+1];\n\n        for (var j = 0; j < nsteps; j++) {\n            var amt = j / nsteps\n            colors.push([\n                Math.round(lerp(fromrgba[0], torgba[0], amt)),\n                Math.round(lerp(fromrgba[1], torgba[1], amt)),\n                Math.round(lerp(fromrgba[2], torgba[2], amt)),\n                lerp(fromrgba[3], torgba[3], amt)\n            ])\n        }\n    }\n\n    //add 1 step as last value\n    colors.push(cmap[cmap.length - 1].rgb.concat(alpha[1]))\n\n    if (format === 'hex') colors = colors.map( rgb2hex );\n    else if (format === 'rgbaString') colors = colors.map( rgbaStr );\n    else if (format === 'float') colors = colors.map( rgb2float );\n\n    return colors;\n};\n\nfunction rgb2float (rgba) {\n    return [\n        rgba[0] / 255,\n        rgba[1] / 255,\n        rgba[2] / 255,\n        rgba[3]\n    ]\n}\n\nfunction rgb2hex (rgba) {\n    var dig, hex = '#';\n    for (var i = 0; i < 3; ++i) {\n        dig = rgba[i];\n        dig = dig.toString(16);\n        hex += ('00' + dig).substr( dig.length );\n    }\n    return hex;\n}\n\nfunction rgbaStr (rgba) {\n    return 'rgba(' + rgba.join(',') + ')';\n}\n","import colormap from \"colormap\";\r\n\r\nexport const to_bin_hex = (hex_string) => {\r\n  if (Number.isSafeInteger(hex_string))\r\n    return hex_string;\r\n  if (hex_string.startsWith(\"#\"))\r\n    hex_string = hex_string.substr(1);\r\n  return parseInt(hex_string, 16);\r\n}\r\nwindow.colormap = colormap\r\nexport const color_scale = (cmap, { levels = 20, max = 100, min = -100 }) => {\r\n  const true_cmap = cmap.replace(/_r$/, \"\")\r\n  //levels -= 1\r\n  if(levels < 6){\r\n    levels = 10 * levels;\r\n  }\r\n  //max += (max - min) * 0.1\r\n  //min -= (max - min) * 0.1\r\n  let my_colormap = colormap({\r\n    colormap: true_cmap,\r\n    nshades: levels,\r\n    format: 'hex'\r\n  });\r\n  console.log(\"===========\")\r\n  console.log(my_colormap)\r\n  if(cmap.endsWith(\"_r\")){\r\n    my_colormap = my_colormap.reverse();\r\n  }\r\n  console.log(my_colormap)\r\n  const getInt = (v) => {\r\n    v = getScale(v);\r\n    return to_bin_hex(my_colormap[v]);\r\n  }\r\n  const getHex = (v) => {\r\n    v = getScale(v);\r\n    return my_colormap[v];\r\n  }\r\n  const getScale = (v) => {\r\n    return Math.max(0, Math.min(levels - 1, \r\n      Math.floor(levels * (v - min) / (max - min))\r\n     ));\r\n    //v = Math.max(0, Math.min(levels - 1, Math.ceil(levels * (v - min) / (max - min))));\r\n    v = Math.ceil((levels - 1) * (v - min) / (max - min));\r\n    return v;\r\n  }\r\n  return {getInt, getHex, getScale};\r\n}\r\nwindow.color_scale = color_scale\r\n\r\n","import Konva from \"konva\";\r\nimport { color_scale, to_bin_hex } from \"./color_utils\";\r\n\r\nconst has_layers = (app) => app.getLayers().length > 0\r\n// Before: 283MB, CPU 0% GPU 23%\r\n// After: 280-370MB, CPU 103% GPU 43%\r\nexport const drawPointsEEG = (locations,\r\n  app, {\r\n    border_color = \"gray\",\r\n    fill_color = \"orange\",\r\n    radius = 2,\r\n    alpha = 1,\r\n  } = {}) => {\r\n  let layer = has_layers(app) ? app.getLayers()[0] : new Konva.Layer();\r\n  Object.keys(locations).forEach(m => {\r\n    const v = locations[m];\r\n    let circle = new Konva.Circle({\r\n      x: v[0],\r\n      y: v[1],\r\n      radius: radius,\r\n      perfectDrawEnabled: false,\r\n      opacity: alpha,\r\n      //zIndex: 0,\r\n    });\r\n    circle.fill(fill_color);\r\n    circle.stroke(border_color);\r\n    circle.strokeWidth(1);\r\n    layer.add(circle);\r\n  });\r\n  if (!has_layers(app)) app.add(layer);\r\n};\r\n\r\nexport const drawLabelsEEG = (data_positions,\r\n  app, {\r\n    border_color = \"gray\",\r\n    fill_color = \"orange\",\r\n    radius = 2\r\n  } = {}) => {\r\n  let layer = has_layers(app) ? app.getLayers()[0] : new Konva.Layer();\r\n  for (let i = 0; i < data_positions.length; i++) {\r\n    const [x, y, m] = data_positions[i];\r\n    let circle = new Konva.Circle({\r\n      x,\r\n      y,\r\n      radius: radius,\r\n      perfectDrawEnabled: false,\r\n      //zIndex: 0,\r\n    });\r\n    circle.fill(fill_color);\r\n    circle.stroke(border_color);\r\n    circle.strokeWidth(1);\r\n    layer.add(circle);\r\n    let text = new Konva.Text({\r\n      x: x + 3,\r\n      y: y,\r\n      text: m.toUpperCase(),\r\n      //fontSize: 8,\r\n      fontSize: 14,\r\n      fontFamily: 'Calibri',\r\n      fill: border_color,\r\n      opacity: 0.5,\r\n      perfectDrawEnabled: false,\r\n      //zIndex: 0,\r\n    });\r\n    layer.add(text);\r\n  }\r\n  if (!has_layers(app)) app.add(layer);\r\n};\r\n\r\n\r\nexport const drawMatrix = (matrix,\r\n  app,\r\n  layout = null,\r\n  data_positions = [],\r\n  title = \"\", {\r\n    cmap = \"viridis\",\r\n    cmap_levels = 20,\r\n    cmap_max = 10,\r\n    cmap_min = 0,\r\n    cmap_autolevel = true,\r\n    size = 120,\r\n    pos_x = 20,\r\n    pos_y = 450,\r\n    border_color = \"black\",\r\n    border_width = 0.1,\r\n    label_color = \"black\",\r\n    replace_diagonals = true,\r\n  } = {}) => {\r\n  let is_new_layout = false;\r\n  let layer = null;\r\n  if (!layout) {\r\n    //console.log(\"NO\")\r\n    layout = [...Array(matrix.length)].map(() => null);\r\n    /////layout.\r\n    layer = has_layers(app) ? app.getLayers()[0] : new Konva.Layer();\r\n    is_new_layout = true;\r\n  } else {\r\n    //console.log(\"YES\")\r\n  }\r\n  let p = Math.round(Math.sqrt(matrix.length));\r\n  if(replace_diagonals && false){\r\n    //let max_val = Math.max(...matrix.flat(2).filter((v, i) => i % 4 == 3));\r\n    //let mean_val = matrix.filter((v, i) => v[0] != v[1]).map(v => v[3]).reduce((a,b) => a+b) / matrix.length;\r\n    //let sd_val = Math.sqrt(matrix.filter((v, i) => v[0] != v[1]).map(v => v[3]*v[3]).reduce((a,b) => a+b) / matrix.length - mean_val * mean_val);\r\n    //const restrict = (x) => Math.max(mean_val - 3 * sd_val, Math.min(mean_val + 3 * sd_val, x))\r\n    //console.log(mean_val, sd_val)\r\n    const ordered_matrix = matrix.copyWithin().sort((a, b) => a[3] - b[3])\r\n    const percentile_95 = ordered_matrix[Math.ceil(ordered_matrix.length * 0.95)][3]\r\n    const percentile_5 = ordered_matrix[Math.ceil(ordered_matrix.length * 0.05)][3]\r\n    const restrict = (x) => Math.max(percentile_5, Math.min(percentile_95, x))\r\n    matrix = matrix.map((v, i) => v[0] == v[1]? [v[0], v[1], v[2], NaN]: [v[0], v[1], v[2], restrict(v[3])]);\r\n    window.__matrix = matrix\r\n    cmap_max = percentile_95;\r\n    cmap_min = percentile_5;\r\n  }else{\r\n    if(cmap_autolevel){\r\n      //cmap_max = Math.max(...matrix.flat(2).filter((v, i) => i % 4 == 3).filter(isFinite))\r\n      //cmap_min = Math.min(...matrix.flat(2).filter((v, i) => i % 4 == 3).filter(isFinite))\r\n      cmap_max = Math.max(...matrix.filter(v => v[0] != v[1]).map(m => m[3]));\r\n      cmap_min = Math.min(...matrix.filter(v => v[0] != v[1]).map(m => m[3]));\r\n    }\r\n  }\r\n  const colscale = color_scale(cmap, {\r\n    levels: cmap_levels,\r\n    max: cmap_max,\r\n    min: cmap_min\r\n  });\r\n  window.colscale_ = {cmap_levels, cmap_max, cmap_min}\r\n  window.colscale_matrix = matrix.filter(v => v[3] >= (cmap_max - 0.1 * (cmap_max - cmap_min)))\r\n  //let total_width = Math.ceil(size / p);\r\n  let total_width = Math.floor(size / p);\r\n  let cell_width = total_width > 1 ? total_width - border_width : total_width;\r\n  let cell_border_width = total_width > 1 ? border_width : 0;\r\n  for (let k = 0; k < matrix.length; k++) {\r\n    let j = matrix[k][0];\r\n    let i = matrix[k][1];\r\n    let val = matrix[k][3];\r\n    let x0 = pos_x + total_width * i;\r\n    let y0 = pos_y + total_width * j;\r\n    let rect;\r\n    if (is_new_layout) {\r\n      //rect = app.makeRectangle(x0, y0, cell_width, cell_width);\r\n      rect = new Konva.Rect({\r\n        x: x0,\r\n        y: y0,\r\n        width: cell_width,\r\n        height: cell_width,\r\n        perfectDrawEnabled: false,\r\n        //zIndex: 0,\r\n      });\r\n      layout[k] = rect;\r\n      //////layout.\r\n      layer.add(layout[k]);\r\n    } else {\r\n      rect = layout[k];\r\n      //rect.draw();\r\n    }\r\n    ///console.log(val, colscale.getHex(val))\r\n    if(i == j){\r\n      rect.fill(\"#FF0000\");\r\n      rect.opacity(0);\r\n    }else{\r\n      rect.fill(colscale.getHex(val));\r\n      rect.opacity(1);\r\n    }\r\n    if (border_width > 0) {\r\n      rect.stroke(border_color);\r\n      rect.strokeWidth(border_width);\r\n    } else {\r\n      rect.strokeWidth(0);\r\n    }\r\n  }\r\n  if (is_new_layout) {\r\n    let text_height = Math.min(14, cell_width);\r\n    for (let i = 0; i < p; i++) {\r\n      let x = pos_x + total_width * p + 2;\r\n      let y = pos_y + total_width * i + (total_width - text_height) / 2;\r\n      let text = new Konva.Text({\r\n        x: x,\r\n        y: y,\r\n        text: data_positions[i][2],\r\n        fontSize: text_height,\r\n        fontFamily: 'Calibri',\r\n        fill: label_color,\r\n        perfectDrawEnabled: false,\r\n        //zIndex: 0,\r\n      });\r\n      layer.add(text);\r\n    }\r\n    for (let j = 0; j < p; j++) {\r\n      let x = pos_x + total_width * (j) + text_height + (total_width - text_height) / 2;\r\n      let y = pos_y + total_width * (p) + 2;\r\n      let text = new Konva.Text({\r\n        x: x,\r\n        y: y,\r\n        text: data_positions[j][2],\r\n        fontSize: text_height,\r\n        fontFamily: 'Calibri',\r\n        rotation: 90,\r\n        fill: label_color,\r\n        perfectDrawEnabled: false,\r\n        //zIndex: 0,\r\n      });\r\n      layer.add(text);\r\n    } {\r\n      let x = pos_x + 1;\r\n      let y = pos_y - Math.max(14, text_height + 2) - 1;\r\n      let title_text = new Konva.Text({\r\n        x: x,\r\n        y: y,\r\n        text: title,\r\n        fontSize: Math.max(14, text_height + 2),\r\n        fontFamily: 'Calibri',\r\n        fill: label_color,\r\n        fontStyle: \"bold\",\r\n        fontVariant: \"small-caps\",\r\n        perfectDrawEnabled: false,\r\n        //zIndex: 0,\r\n      });\r\n      layer.add(title_text);\r\n    }\r\n    ///\r\n    if (!has_layers(app)) app.add(layer);\r\n  }\r\n  return layout;\r\n}\r\n\r\nexport const drawMatrices = (matrices, app,\r\n  layouts = null,\r\n  data_positions = [], titles = [], {\r\n    cmap = \"viridis\",\r\n    cmap_levels = 20,\r\n    cmap_max = 10,\r\n    cmap_min = 0,\r\n    cmap_autolevel = true,\r\n    size = 120,\r\n    pos_x = 20,\r\n    pos_y = 450,\r\n    shift_x = 20,\r\n    border_color = \"#000000\",\r\n    border_width = 0.1,\r\n    label_color = \"black\",\r\n  } = {}) => {\r\n  if (!layouts) {\r\n    layouts = [...Array(matrices.length)].map(() => null);\r\n  }\r\n  const update = (k, new_matrix) => {\r\n    let x0 = pos_x + (size + shift_x) * k;\r\n    layouts[k] = drawMatrix(new_matrix, app, layouts[k], data_positions, titles[k], {\r\n      cmap,\r\n      cmap_levels,\r\n      cmap_max,\r\n      cmap_min,\r\n      cmap_autolevel,\r\n      size,\r\n      pos_x: x0,\r\n      pos_y: pos_y,\r\n      border_color,\r\n      border_width,\r\n      label_color\r\n    })\r\n    let layer = has_layers(app) ? app.getLayers()[0] : new Konva.Layer();\r\n    layer.batchDraw();\r\n  };\r\n  for (let k = 0; k < matrices.length; k++) {\r\n    update(k, matrices[k]);\r\n  }\r\n  return { update, layouts }\r\n}\r\n\r\n//\r\nexport const drawLine = (y,\r\n  layout = null, {\r\n    line_color = \"black\",\r\n    max_points = 100,\r\n    scale_x = 5,\r\n    scale_y = 1,\r\n    pos_x = 300,\r\n    pos_y = 10,\r\n    line_width = 1,\r\n    alpha = 1,\r\n    spline_tension = 0.5,\r\n  } = {}) => {\r\n  if (!layout) {\r\n    let points = [...Array(2 * max_points)].map((m, i) => i % 2 == 0 ? Math.floor(i / 2) * scale_x : NaN);\r\n    layout = new Konva.Line({\r\n      points,\r\n      perfectDrawEnabled: false,\r\n      //zIndex: 0,\r\n    });\r\n    layout._true_points = points.map((m) => NaN);\r\n    layout.move({ x: pos_x, y: pos_y });\r\n    layout.stroke(line_color);\r\n    layout.strokeWidth(line_width);\r\n    layout.opacity(alpha);\r\n    layout.tension(spline_tension);\r\n  }\r\n\r\n  let true_points = layout._true_points;\r\n  let points = layout.points();\r\n\r\n  let mean_y = 0;\r\n  let mean2_y = 0;\r\n  for (let t = 0; t < max_points; t++) {\r\n    mean_y += true_points[2 * t + 1] || 0;\r\n    mean2_y += (true_points[2 * t + 1] * true_points[2 * t + 1]) || 0;\r\n  }\r\n  mean_y = mean_y / (max_points);\r\n  mean2_y = mean2_y / (max_points);\r\n  //\r\n  let std_y = ((mean2_y - mean_y * mean_y) * max_points / (max_points - 1)) || 1e-4;\r\n  for (let t = 0; t < max_points - 1; t++) {\r\n    layout._true_points[2 * t + 1] = layout._true_points[2 * (t + 1) + 1];\r\n  }\r\n  layout._true_points[2 * max_points - 1] = y * scale_y;\r\n  //\r\n  for (let t = 0; t < max_points; t++) {\r\n    //points[2 * t + 1] = (layout._true_points[2 * t + 1] - mean_y) / std_y;\r\n    points[2 * t + 1] = (layout._true_points[2 * t + 1] - mean_y);\r\n  }\r\n  //\r\n  /*\r\n  //let ref_val = points[1] || points[2 * max_points - 1] || 0;\r\n  for(let t = 0; t < max_points - 1; t++){\r\n    points[2 * t + 1] = points[2 * (t + 1) + 1];\r\n  }\r\n  points[2 * max_points - 1] = y * scale_y;*/\r\n  layout.points(points);\r\n  return layout;\r\n}\r\n\r\n\r\nexport const drawLines = (signal_timepoint, app,\r\n  layouts = null,\r\n  labels = [], {\r\n    cmap = \"viridis\",\r\n    max_points = 100,\r\n    scale_y = 1,\r\n    pos_x = 300,\r\n    pos_y = 10,\r\n    width = 100,\r\n    height = 400,\r\n    line_width = 1,\r\n    alpha = 1,\r\n    spline_tension = 0.5,\r\n  } = {}) => {\r\n  let is_new_layout = false;\r\n  let layer = null;\r\n  if (!layouts) {\r\n    layouts = [...Array(signal_timepoint.length)].map(() => null);\r\n    layer = has_layers(app) ? app.getLayers()[0] : new Konva.Layer();\r\n    is_new_layout = true;\r\n  }\r\n  const colscale = color_scale(cmap, {\r\n    levels: Math.max(10, signal_timepoint.length),\r\n    max: signal_timepoint.length + 1,\r\n    min: 0\r\n  });\r\n  const shift_y = height / signal_timepoint.length;\r\n  const scale_x = width / max_points;\r\n  const update = (k, timepoint) => {\r\n    let is_new = layouts[k] == null;\r\n    layouts[k] = drawLine(timepoint,\r\n      layouts[k], {\r\n        line_color: colscale.getHex(k),\r\n        max_points,\r\n        scale_x,\r\n        scale_y,\r\n        pos_x,\r\n        pos_y: pos_y + k * shift_y,\r\n        line_width,\r\n        alpha,\r\n        spline_tension,\r\n      })\r\n    if (is_new) {\r\n      ////console.log(pos_x + width + 3, pos_y, labels[k])\r\n      let title_text = new Konva.Text({\r\n        x: pos_x + width + 3,\r\n        y: pos_y + k * shift_y,\r\n        text: labels[k],\r\n        fontSize: 12,\r\n        fontFamily: 'Calibri',\r\n        fill: colscale.getHex(k),\r\n        fontStyle: \"bold\",\r\n        //fontVariant: \"small-caps\",\r\n        perfectDrawEnabled: false,\r\n        //zIndex: 0,\r\n      });\r\n      layer.add(title_text);\r\n      layer.add(layouts[k]);\r\n    }\r\n  };\r\n  const update_all = (multitimepoint) => {\r\n    for (let k = 0; k < multitimepoint.length; k++) {\r\n      update(k, multitimepoint[k]);\r\n    }\r\n    if (is_new_layout) {\r\n      if (!has_layers(app)) app.add(layer);\r\n    } else {\r\n      layer.batchDraw();\r\n    }\r\n    is_new_layout = false;\r\n  };\r\n  update_all(signal_timepoint);\r\n  return { update, update_all, layouts };\r\n}\r\n\r\nexport const drawArrow = (link, positions, app,\r\n  layout = null, {\r\n    cmap = \"viridis\",\r\n    value_levels = 20,\r\n    value_max = 10,\r\n    value_min = 0,\r\n    line_width_max = 5,\r\n    line_width_min = 0.1,\r\n    //alpha = 1,\r\n    alpha_max = 1,\r\n    alpha_min = 0.1,\r\n  } = {}) => {\r\n  if (!layout) {\r\n    /////console.log(\"new!\")\r\n    layout = new Konva.Arrow({\r\n      perfectDrawEnabled: false,\r\n      tension: 0.5,\r\n      //zIndex: 0,\r\n    });\r\n  }\r\n\r\n  const colscale = color_scale(cmap, {\r\n    levels: value_levels,\r\n    max: value_max,\r\n    min: value_min\r\n  });\r\n\r\n  let [src, dst, lag, val] = link;\r\n  let [x0, y0, n0] = positions[src];\r\n  let [x1, y1, n1] = positions[dst];\r\n  let line_color = colscale.getHex(val);\r\n  //let relative_val = (colscale.getScale(val) / value_levels);\r\n  //let relative_val = (value_max - val) / (value_max - value_min);\r\n  let relative_val = (val) / (value_max - value_min);\r\n  ////relative_val = relative_val * relative_val;\r\n  ///relative_val = 1 - relative_val;\r\n  //let line_width = 1;\r\n  //relative_val = 1 - relative_val;\r\n  let line_width = relative_val * (line_width_max - line_width_min) + line_width_min;\r\n  //relative_val = 1 - relative_val;\r\n  let alpha = relative_val * (alpha_max - alpha_min) + alpha_min;\r\n  /*\r\n  line_width = 1\r\n  alpha = 1\r\n  line_color = \"white\"\r\n  */\r\n  \r\n  layout.opacity(alpha);\r\n  layout.x(x0);\r\n  layout.y(y0);\r\n  //layout.points([0, 0, x1 - x0, y1 - y0]);\r\n  layout.points([0, 0, (x1 - x0)*0.4, (y1 - y0 )*0.7, x1 - x0, y1 - y0]);\r\n  layout.pointerLength(10);\r\n  layout.pointerWidth(10);\r\n  layout.fill(line_color);\r\n  layout.stroke(line_color);\r\n  layout.strokeWidth(line_width);\r\n\r\n  return layout;\r\n}\r\n\r\nexport const drawArrows = (links, positions, app,\r\n  layouts = null, {\r\n    cmap = \"viridis\",\r\n    value_levels = 20,\r\n    value_max = 10,\r\n    value_min = 0,\r\n    value_autolevel = false,\r\n    line_width_max = 1,\r\n    line_width_min = 0.1,\r\n    alpha_max = 0.9,\r\n    alpha_min = 0.1,\r\n  } = {}) => {\r\n  let is_new_layout = false;\r\n  let layer = null;\r\n  let link_number = links.length;\r\n  if (!layouts) {\r\n    layouts = [...Array(link_number * 2)].map(() => null);\r\n    layer = has_layers(app) ? app.getLayers()[0] : new Konva.Layer();\r\n    is_new_layout = true;\r\n  }\r\n\r\n  const animate = (link) => {\r\n    link.opacity(0.2);\r\n    link.strokeWidth(4);\r\n    //const points = link.points();\r\n    let anim = new Konva.Animation(function(frame) {\r\n      link.opacity(0.2);\r\n      const points = link._base_points;\r\n      let period = 1000;\r\n      let w = Math.cos((frame.time * 2 * Math.PI) / period);\r\n      let k = (-0.5 * w + 0.5);\r\n      //let k = Math.max(frame.time, period) / period;\r\n      link.points([\r\n        0, 0,\r\n        k * points[2],\r\n        k * points[3],\r\n      ]);\r\n      //if(k >= 1) anim.stop();\r\n    }, layer);\r\n    anim.start();\r\n  }\r\n  const update = (k, new_link, total_links=null) => {\r\n    total_links = total_links == null? links.length: total_links;\r\n    let is_new = layouts[k] == null;\r\n    layouts[k] = drawArrow(new_link, positions, app, layouts[k], {\r\n      cmap,\r\n      value_levels,\r\n      value_max,\r\n      value_min,\r\n      value_autolevel,\r\n      line_width_max,\r\n      line_width_min,\r\n      //alpha: 0.3,\r\n      alpha_max,\r\n      alpha_min,\r\n    })\r\n    layouts[k]._base_points = layouts[k].points();\r\n    // fixed\r\n    layouts[k + total_links] = drawArrow(new_link, positions, app, layouts[k + total_links], {\r\n      cmap,\r\n      value_levels,\r\n      value_max,\r\n      value_min,\r\n      line_width_max,\r\n      line_width_min,\r\n      alpha_max: 0.9,\r\n      alpha_min: 0.1,\r\n    })\r\n    if (is_new) {\r\n      layer.add(layouts[k]);\r\n      layer.add(layouts[k + total_links]);\r\n      animate(layouts[k]);\r\n    } else {\r\n      //layouts[k].draw();\r\n    }\r\n  };\r\n  const update_all = (new_links, filter_links=true) => {\r\n    const L = (2 * new_links.length - layouts.length);\r\n    console.log(\"###\", 2 * new_links.length, layouts.length, \"::\", L)\r\n    for (let k = 0; k < L; k++) {\r\n      layouts.push(null);// = [...Array(link_number * 2)].map(() => null);\r\n      layouts.push(null);// = [...Array(link_number * 2)].map(() => null);\r\n    }\r\n    //\r\n    if(value_autolevel){\r\n      //value_max = Math.max(...new_links.flat(2).filter((v, i) => i % 4 == 3))\r\n      //value_min = Math.min(...new_links.flat(2).filter((v, i) => i % 4 == 3))\r\n      value_max = Math.max(...new_links.filter(v => v[0] != v[1]).map((v, i) => v[3]))\r\n      value_min = Math.min(...new_links.filter(v => v[0] != v[1]).map((v, i) => v[3]))\r\n    }\r\n    window._new_links = new_links;\r\n    window._new_links_a = {new_links, value_max, value_min};\r\n    if(filter_links){\r\n      const ordered_matrix = new_links.copyWithin().sort((a, b) => a[3] - b[3])\r\n      //const percentile_95 = ordered_matrix[Math.ceil(ordered_matrix.length * 0.95)][3]\r\n      //const percentile_5 = ordered_matrix[Math.ceil(ordered_matrix.length * 0.05)][3]\r\n      /////const percentile_80 = ordered_matrix[Math.ceil(ordered_matrix.length * 0.80)][3]\r\n      const percentile_threshold = ordered_matrix[Math.ceil(ordered_matrix.length * 0.80)][3]\r\n      new_links = new_links.filter(v => v[0] != v[1] && v[3] > percentile_threshold).map((v, i) => [v[0], v[1], v[2], v[3]]);\r\n      value_max = Math.max(...new_links.filter(v => v[0] != v[1]).map((v, i) => v[3]))\r\n      value_min = Math.min(...new_links.filter(v => v[0] != v[1]).map((v, i) => v[3]))\r\n    }\r\n    window._new_links_a = {new_links, value_max, value_min};\r\n    //\r\n    //\r\n    //\r\n    for (let k = 0; k < layouts.length; k++) {\r\n      if(layouts[k] != null){\r\n        layouts[k].opacity(0);\r\n      }\r\n    }\r\n    for (let k = 0; k < new_links.length; k++) {\r\n      update(k, new_links[k], new_links.length);\r\n    }\r\n    if (is_new_layout) {\r\n      if (!has_layers(app)) app.add(layer);\r\n    } else {\r\n      layer.batchDraw();\r\n    }\r\n    is_new_layout = false;\r\n  };\r\n\r\n  update_all(links);\r\n  return { update, update_all, layouts };\r\n}\r\n\r\nexport const drawScale = (app,\r\n  layout = null, {\r\n    cmap = \"viridis\",\r\n    cmap_levels = 20,\r\n    cmap_max = 10,\r\n    cmap_min = 0,\r\n    height = 120,\r\n    width = 10,\r\n    pos_x = 20,\r\n    pos_y = 450,\r\n    border_color = \"black\",\r\n    border_width = 0.1,\r\n    label_color = \"black\",\r\n  } = {}) => {\r\n  let is_new_layout = false;\r\n  let layer = null;\r\n  if (!layout) {\r\n    layout = [...Array(cmap_levels)].map(() => null);\r\n    layer = has_layers(app) ? app.getLayers()[0] : new Konva.Layer();\r\n    is_new_layout = true;\r\n  }\r\n  //let colscale_levels = Math.max(10, cmap_levels);\r\n  let colscale_levels = 6 * cmap_levels;\r\n  const colscale = color_scale(cmap, {\r\n    levels: colscale_levels,\r\n    max: cmap_levels,\r\n    min: 0\r\n  });\r\n  let cell_height = height / cmap_levels;\r\n\r\n  if (is_new_layout) {\r\n    for (let val = 0; val < cmap_levels; val++) {\r\n      let col = colscale.getHex(cmap_levels - 1 - val);\r\n      let x0 = pos_x;\r\n      let y0 = pos_y + cell_height * val;\r\n      let rect;\r\n      rect = new Konva.Rect({\r\n        x: x0,\r\n        y: y0,\r\n        width: width,\r\n        height: cell_height,\r\n        perfectDrawEnabled: false,\r\n        fill: col,\r\n        //zIndex: 0,\r\n      });\r\n      layout[val] = rect;\r\n      layer.add(layout[val]);\r\n      if (border_width > 0) {\r\n        rect.stroke(border_color);\r\n        rect.strokeWidth(border_width);\r\n      } else {\r\n        rect.strokeWidth(0);\r\n      }\r\n    }\r\n  }\r\n  let text_height = Math.max(6, Math.min(14, cell_height));\r\n\r\n  let min_label, max_label;\r\n  {\r\n    let x = pos_x + 2;\r\n    let y = pos_y - text_height;// + (cell_height - text_height) / 2;\r\n    max_label = new Konva.Text({\r\n      x: x,\r\n      y: y,\r\n      text: `${cmap_max}`,\r\n      fontSize: text_height,\r\n      fontFamily: 'Calibri',\r\n      fill: label_color,\r\n      perfectDrawEnabled: false,\r\n      //zIndex: 0,\r\n    });\r\n    layer.add(max_label);\r\n  } {\r\n    let x = pos_x + 2;\r\n    let y = pos_y + cell_height * cmap_levels// - (cell_height - text_height) / 2;\r\n    min_label = new Konva.Text({\r\n      x: x,\r\n      y: y,\r\n      text: `${cmap_min}`,\r\n      fontSize: text_height,\r\n      fontFamily: 'Calibri',\r\n      fill: label_color,\r\n      perfectDrawEnabled: false,\r\n      //zIndex: 0,\r\n    });\r\n    layer.add(min_label);\r\n  }\r\n  ///\r\n  if (!has_layers(app)) app.add(layer);\r\n\r\n  const update_range = (cmap_max, cmap_min, {to_scientific_notation=true, shift=0} = {}) => {\r\n    if(to_scientific_notation){\r\n      min_label.text(`${(cmap_min + shift).toExponential(2)}`);\r\n      max_label.text(`${(cmap_max + shift).toExponential(2)}`);\r\n    }else{\r\n      min_label.text(`${(cmap_min + shift)}`);\r\n      max_label.text(`${(cmap_max + shift)}`);\r\n    }\r\n    layer.batchDraw();\r\n  }\r\n  update_range(cmap_max, cmap_min);\r\n\r\n  return { layout, update_range };\r\n}","import jStat from \"jstat\";\r\nimport Konva from \"konva\";\r\nimport { rescaledEEGLocations2D } from \"../opc-eeg-positions@1.0.0/eeg2D.js\";\r\nimport { drawLabelsEEG, drawPointsEEG, drawMatrices, drawArrows, drawLines, drawScale } from \"./basic_layout\";\r\n\r\nexport const zero_matrix = (M) => {\r\n  let matrix2 = [];\r\n  for(let i = 0; i < M; i++){\r\n    for(let j = 0; j < M; j++){\r\n      matrix2.push([i, j, 0, 0]);\r\n    }\r\n  }\r\n  return matrix2;\r\n}\r\n\r\nexport const random_matrix = (M) => {\r\n  let matrix2 = [];\r\n  for(let i = 0; i < M; i++){\r\n    for(let j = 0; j < M; j++){\r\n      matrix2.push([i, j, 0, jStat.normal.sample(0, 50)]);\r\n      //matrix2.push([i, j, 0, i*j]);\r\n      if(i == j && i == 0){\r\n        matrix2[matrix2.length - 1][3] = 0;\r\n      }\r\n    }\r\n  }\r\n  return matrix2;\r\n}\r\n\r\nexport const random_point = (M) => {\r\n  let matrix2 = [];\r\n  for(let i = 0; i < M; i++){\r\n    matrix2.push(jStat.normal.sample(0, 2));\r\n  }\r\n  return matrix2;\r\n}\r\n\r\nexport const random_links = (M, number_links) => {\r\n  const links = [...Array(number_links)].map((v) => [\r\n    Math.floor(jStat.uniform.sample(0, M)),\r\n    Math.floor(jStat.uniform.sample(0, M)),\r\n    -1,\r\n    jStat.normal.sample(0, 2),\r\n  ])\r\n  return links;\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n/**\r\n * From https://stackoverflow.com/a/44779316\r\n *\r\n * @param {Function} fn Callback function\r\n * @param {Boolean|undefined} [throttle] Optionally throttle callback\r\n * @return {Function} Bound function\r\n *\r\n * @example\r\n * //generate rAFed function\r\n * jQuery.fn.addClassRaf = bindRaf(jQuery.fn.addClass);\r\n *\r\n * //use rAFed function\r\n * $('div').addClassRaf('is-stuck');\r\n */\r\nconst bindRaf = (fn, throttle=true) => {\r\n  let isRunning = false, that, args;\r\n  const run = () => {\r\n    //isRunning = false;\r\n    fn.apply(that, args);\r\n  };\r\n  return function() {\r\n    that = this;\r\n    args = arguments;\r\n    if (isRunning && throttle) {\r\n      return;\r\n    }\r\n    isRunning = true;\r\n    requestAnimationFrame(run);\r\n  };\r\n}\r\n\r\nconst create_links = (links, link_arrows, app, data_positions, settings) => {\r\n  const number_links = settings.animation.mainmap_number_links;\r\n  const update = (new_links) => {\r\n    if(!link_arrows){\r\n      link_arrows = drawArrows(new_links, data_positions, app, null, {\r\n        cmap: settings.animation.arrow_cmap,\r\n        value_levels: settings.animation.arrow_value_levels,\r\n        value_max: settings.animation.arrow_value_max,\r\n        value_min: settings.animation.arrow_value_min,\r\n        value_autolevel: true,\r\n        line_width_max: settings.animation.arrow_line_width_max,\r\n        line_width_min: settings.animation.arrow_line_width_min,\r\n        alpha_max: settings.animation.arrow_line_alpha_max,\r\n        alpha_min: settings.animation.arrow_line_alpha_min,\r\n      });\r\n    }else{\r\n      link_arrows.update_all(new_links)\r\n    }\r\n  }\r\n  update(links);\r\n  return {update};\r\n}\r\n\r\nconst create_lines = (new_timepoint, app, settings, channels) => {\r\n  let lines = drawLines(new_timepoint, app, null, channels, {\r\n      cmap: settings.animation.timeseries_cmap,\r\n      max_points: settings.animation.timeseries_max_points,\r\n      scale_y: settings.animation.timeseries_scale_y,\r\n      pos_x: settings.animation.timeseries_pos_x,\r\n      pos_y: settings.animation.timeseries_pos_y,\r\n      width: settings.animation.timeseries_width,\r\n      height: settings.animation.timeseries_height,\r\n      line_width: settings.animation.timeseries_line_width,\r\n      alpha: settings.animation.timeseries_alpha,\r\n      spline_tension: settings.animation.timeseries_spline_tension,\r\n    });\r\n   return lines;\r\n}\r\n\r\n// https://stackoverflow.com/questions/12539574/whats-the-best-way-most-efficient-to-turn-all-the-keys-of-an-object-to-lower\r\nconst objectKeysToLowerCase = (obj) => {\r\n  let key, keys = Object.keys(obj);\r\n  let n = keys.length;\r\n  const newobj = {};\r\n  while (n--) {\r\n    key = keys[n];\r\n    newobj[key.toLowerCase()] = obj[key];\r\n  }\r\n  return newobj;\r\n}\r\n\r\nconst getMinMaxInMatrix = (link_matrix) => {\r\n  return {\r\n    //max: Math.max(...link_matrix.flat(2).filter((v, i) => i % 4 == 3)),\r\n    //min: Math.min(...link_matrix.flat(2).filter((v, i) => i % 4 == 3)),\r\n    max: Math.max(...link_matrix.filter(v => v[0] != v[1]).map(m => m[3])),\r\n    min: Math.min(...link_matrix.filter(v => v[0] != v[1]).map(m => m[3])),\r\n  };\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\nexport const draw_animation = (canvas_element, canvas_params, settings, channels) => {\r\n  const M = channels.length;\r\n  ///////////////////////////////////////////////////////////////////////////////\r\n\r\n  const app = new Konva.Stage({\r\n    container: canvas_element,\r\n    width: canvas_params.width,\r\n    height: canvas_params.height,\r\n    //pixelRatio: 2,\r\n  });\r\n  window._app = app\r\n\r\n  //\r\n  let image_background = window.getComputedStyle(app.container().querySelector('[role=\"presentation\"]')).backgroundImage.replace(/(^\\s*url\\s*\\(\\s*|\\s*\\)\\s*|\"|')/g, \"\")\r\n  console.log(\"image_background:\", image_background)\r\n\r\n  //\r\n  //Konva.Image.fromURL(image_background, function(imgNode)\r\n  {\r\n  //  window._imgNode = imgNode;\r\n    const has_layers = (app) => app.getLayers().length > 0\r\n    let had_layer = has_layers(app);\r\n    let layer = had_layer? app.getLayers()[0]: new Konva.Layer();\r\n    let shape = new Konva.Rect({\r\n      x: 0,\r\n      y: 0,\r\n      width: app.width(),\r\n      height: app.height(),\r\n      //fill: 'rgba(255, 255, 255, 0.2)',\r\n      //stroke: 'black',\r\n      strokeWidth: 0,\r\n      //shadowBlur : 40,\r\n      //fillPatternImage: _imgNode.image(),\r\n      //zIndex: -1000,\r\n      //opacity : 0.5,\r\n    });\r\n    window._shape = shape;\r\n    console.log(shape)\r\n    layer.add(shape);\r\n    if(!had_layer) app.add(layer);\r\n    Konva.Image.fromURL(image_background, (imgNode) => {\r\n      shape.fillPatternImage(imgNode.image());\r\n    });\r\n  }\r\n  /*Konva.Image.fromURL(image_background, function(imgNode) {\r\n    const has_layers = (app) => app.getLayers().length > 0\r\n    window._imgNode = imgNode;\r\n    let layer = has_layers(app)? app.getLayers()[0]: new Konva.Layer();\r\n    imgNode.setAttrs({\r\n      x: 0,\r\n      y: 0,\r\n      scaleX: app.width() / imgNode.width(),\r\n      scaleY: app.width() / imgNode.width(),\r\n    });\r\n    layer.add(imgNode);\r\n    //layer.batchDraw();\r\n    app.add(layer);\r\n  });\r\n  */\r\n\r\n  //\r\n  /*\r\n  {\r\n    const has_layers = (app) => app.getLayers().length > 0\r\n    let layer = has_layers(app)? app.getLayers()[0]: new Konva.Layer();\r\n    let shape = new Konva.Rect({\r\n      x: 20,\r\n      y: 20,\r\n      width: app.width(),\r\n      height: app.height(),\r\n      fill: 'red',\r\n      stroke: 'black',\r\n      strokeWidth: 4,\r\n      shadowBlur : 40,\r\n      //opacity : 0.5,\r\n    });\r\n    window._shape = shape;\r\n    console.log(shape)\r\n    layer.add(shape);\r\n    app.add(layer);\r\n  }\r\n  */\r\n\r\n  const eeg_locations = objectKeysToLowerCase(rescaledEEGLocations2D({\r\n      width: settings.animation.brain_width,\r\n      height: settings.animation.brain_height,\r\n      top: settings.animation.brain_top,\r\n      left: settings.animation.brain_left\r\n    }, true));\r\n\r\n  const timeseries = create_lines(random_point(M), app, settings, channels);\r\n\r\n  const data_positions = channels.map((k) => [...eeg_locations[k.toLowerCase()], k])\r\n  window._data_positions = data_positions\r\n\r\n  drawPointsEEG(eeg_locations, app, {\r\n    border_color: settings.animation.brain_nodes_border_color,\r\n    fill_color: settings.animation.brain_nodes_fill_color,\r\n    radius: settings.animation.brain_nodes_radius,\r\n    alpha: 0.2,\r\n  });\r\n  \r\n  drawLabelsEEG(data_positions, app, {\r\n    border_color: settings.animation.brain_nodes_border_color,\r\n    fill_color: settings.animation.brain_nodes_fill_color,\r\n    radius: settings.animation.brain_nodes_radius\r\n  });\r\n\r\n  ///////////////////////////////////////////////////////////////////////////////\r\n  const connectivity_matrix = drawMatrices([random_matrix(M)], app, null, data_positions, [\"Maximum cross-lag connectivity (PDC)\"], {\r\n    cmap: settings.animation.mainmap_cmap,\r\n    cmap_levels: settings.animation.mainmap_cmap_levels,\r\n    cmap_max: settings.animation.mainmap_cmap_max,\r\n    cmap_min: settings.animation.mainmap_cmap_min,\r\n    cmap_autolevel: true,\r\n    size: settings.animation.mainmap_size,\r\n    pos_x: settings.animation.mainmap_left,\r\n    pos_y: settings.animation.mainmap_top,\r\n    shift_x: 0,\r\n    border_color: settings.animation.mainmap_border_color,\r\n    border_width: settings.animation.mainmap_border_width,\r\n    label_color: settings.animation.mainmap_label_color,\r\n  });\r\n\r\n  const connectivity_matrix_scale = drawScale(app, null, {\r\n    cmap: settings.animation.mainmap_cmap,\r\n    cmap_levels: settings.animation.mainmap_cmap_levels,\r\n    cmap_max: settings.animation.mainmap_cmap_max,\r\n    cmap_min: settings.animation.mainmap_cmap_min,\r\n    height: settings.animation.mainmap_size,\r\n    width: 10,\r\n    pos_x: settings.animation.mainmap_left + settings.animation.mainmap_size * 1.1,\r\n    pos_y: settings.animation.mainmap_top,\r\n    border_color: settings.animation.mainmap_border_color,\r\n    border_width: settings.animation.mainmap_border_width,\r\n    label_color: settings.animation.mainmap_label_color,\r\n  });\r\n\r\n  const lag_dependency_matrix = drawMatrices([random_matrix(M)], app, null, data_positions, [\"Maximum lag\"], {\r\n    cmap: settings.animation.lagmap_cmap,\r\n    cmap_levels: settings.animation.lagmap_cmap_levels,\r\n    cmap_max: settings.animation.lagmap_cmap_max,\r\n    cmap_min: settings.animation.lagmap_cmap_min,\r\n    cmap_autolevel: false,\r\n    size: settings.animation.lagmap_size,\r\n    pos_x: settings.animation.lagmap_left,\r\n    pos_y: settings.animation.lagmap_top,\r\n    shift_x: 0,\r\n    border_color: settings.animation.lagmap_border_color,\r\n    border_width: settings.animation.lagmap_border_width,\r\n    label_color: settings.animation.lagmap_label_color,\r\n  });\r\n\r\n  const lag_dependency_matrix_scale = drawScale(app, null, {\r\n    cmap: settings.animation.lagmap_cmap,\r\n    cmap_levels: settings.animation.lagmap_cmap_levels,\r\n    cmap_max: settings.animation.lagmap_cmap_max,\r\n    cmap_min: settings.animation.lagmap_cmap_min,\r\n    height: settings.animation.lagmap_size,\r\n    width: 10,\r\n    pos_x: settings.animation.lagmap_left + settings.animation.lagmap_size * 1.1,\r\n    pos_y: settings.animation.lagmap_top,\r\n    border_color: settings.animation.lagmap_border_color,\r\n    border_width: settings.animation.lagmap_border_width,\r\n    label_color: settings.animation.lagmap_label_color,\r\n  });\r\n  lag_dependency_matrix_scale.update_range(settings.animation.lagmap_cmap_levels, 1, {to_scientific_notation: false, shift: 0});\r\n\r\n\r\n  const spectral_connectivity_matrices = drawMatrices([\r\n      random_matrix(M),\r\n      random_matrix(M),\r\n      random_matrix(M),\r\n      random_matrix(M),\r\n      random_matrix(M),\r\n     ], app, null, data_positions, [\"Delta [0-4Hz]\", \"Theta [4-8Hz]\", \"Alpha [8-12Hz]\", \"Beta [12-30Hz]\", \"Gamma [30-50Hz]\"], {\r\n    cmap: settings.animation.minimap_cmap,\r\n    cmap_levels: settings.animation.minimap_cmap_levels,\r\n    cmap_max: settings.animation.minimap_cmap_max,\r\n    cmap_min: settings.animation.minimap_cmap_min,\r\n    size: settings.animation.minimap_size,\r\n    pos_x: settings.animation.minimap_left + 0,\r\n    pos_y: settings.animation.minimap_top + 0,\r\n    shift_x: settings.animation.minimap_separation_x,\r\n    border_color: settings.animation.minimap_border_color,\r\n    border_width: settings.animation.minimap_border_width,\r\n    label_color: settings.animation.minimap_label_color,\r\n  });\r\n\r\n  //const connectivity_arrows = create_links(random_links(M, settings.animation.mainmap_number_links), null, app, data_positions, settings);\r\n  const connectivity_arrows = drawArrows(\r\n    random_links(M, settings.animation.mainmap_number_links), \r\n    data_positions, \r\n    app, \r\n    null, {\r\n        cmap: settings.animation.arrow_cmap,\r\n        value_levels: settings.animation.arrow_value_levels,\r\n        value_max: settings.animation.arrow_value_max,\r\n        value_min: settings.animation.arrow_value_min,\r\n        value_autolevel: true,\r\n        line_width_max: settings.animation.arrow_line_width_max,\r\n        line_width_min: settings.animation.arrow_line_width_min,\r\n      });\r\n  \r\n  const connectivity_arrows_scale = drawScale(app, null, {\r\n    cmap: settings.animation.arrow_cmap,\r\n    cmap_levels: settings.animation.arrow_value_levels,\r\n    cmap_max: settings.animation.arrow_value_max,\r\n    cmap_min: settings.animation.arrow_value_min,\r\n    height: settings.animation.brain_height,\r\n    width: 10,\r\n    pos_x: settings.animation.brain_left - 15,\r\n    pos_y: settings.animation.brain_top,\r\n    border_color: \"white\",\r\n    border_width: 0,\r\n    label_color: settings.animation.mainmap_label_color, // NOTE: It derives the label color from mainmap\r\n  });\r\n  //return {app, connectivity_matrix, lag_dependency_matrix, spectral_connectivity_matrices, timeseries, connectivity_arrows};\r\n  ///////////////////////////////////////////////////////////////////////////////\r\n  const fill_matrix = (X) => {\r\n    //console.log(X)\r\n    let X1 = zero_matrix(M);\r\n    for(let k = 0; k < X.length; k++){\r\n      let i = X[k][0];\r\n      let j = X[k][1];\r\n      X1[i * M + j][2] = X[k][2];\r\n      X1[i * M + j][3] = X[k][3];\r\n    }\r\n    return X1;\r\n  }\r\n  const update_connectivity = (X) => {\r\n    connectivity_matrix.update(0, fill_matrix(X));\r\n    const ranges = getMinMaxInMatrix(X);\r\n    connectivity_matrix_scale.update_range(ranges.max, ranges.min, {to_scientific_notation: true, shift: 0});\r\n  }\r\n  const update_lag_dependency = (X) => {\r\n    lag_dependency_matrix.update(0, fill_matrix(X));\r\n    //const ranges = getMinMaxInMatrix(X);\r\n    //lag_dependency_matrix_scale.update_range(ranges.max, ranges.min, {to_scientific_notation: false, shift: 1});\r\n  }\r\n  const update_connectivity_delta = (X) => spectral_connectivity_matrices.update(0, fill_matrix(X))\r\n  const update_connectivity_theta = (X) => spectral_connectivity_matrices.update(1, fill_matrix(X))\r\n  const update_connectivity_alpha = (X) => spectral_connectivity_matrices.update(2, fill_matrix(X))\r\n  const update_connectivity_beta = (X) => spectral_connectivity_matrices.update(3, fill_matrix(X))\r\n  const update_connectivity_gamma = (X) => spectral_connectivity_matrices.update(4, fill_matrix(X))\r\n  const update_connectivity_arrows = (X) => {\r\n    //connectivity_arrows.update(X)\r\n    connectivity_arrows.update_all(X)\r\n    const ranges = getMinMaxInMatrix(X);\r\n    connectivity_arrows_scale.update_range(ranges.max, ranges.min, {to_scientific_notation: true, shift: 0});\r\n  }\r\n  const update_timeseries = (X) => timeseries.update_all(X)\r\n  \r\n\r\n  //\r\n  \r\n  //\r\n  return {app,\r\n    update_connectivity,\r\n    update_lag_dependency,\r\n    update_connectivity_delta,\r\n    update_connectivity_theta, \r\n    update_connectivity_alpha,\r\n    update_connectivity_beta,\r\n    update_connectivity_gamma,\r\n    update_connectivity_arrows,\r\n    update_timeseries,\r\n  };\r\n}\r\n","import Kefir from \"kefir\";\r\nimport jStat from \"jstat\";\r\nimport { dataprovider, random_connection, websocket_connection } from \"./dataprovider\";\r\nimport Konva from \"konva\";\r\nimport { rescaledEEGLocations2D } from \"../opc-eeg-positions@1.0.0/eeg2D.js\";\r\n\r\n// ffmpeg -i recordings.webm -movflags faststart -profile:v high -level 4.2 video.mp4\r\n\r\nKonva.showWarnings = false;\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\nconst settings = {\r\n  animation: {\r\n    brain_width: 300,\r\n    brain_height: 400,\r\n    brain_top: 50,\r\n    brain_left: 20,\r\n    brain_nodes_border_color: \"#feeb77\",\r\n    brain_nodes_fill_color: \"#650a5a\",\r\n    brain_nodes_radius: 2,\r\n    //\r\n    mainmap_size: 350,\r\n    mainmap_top: 50,\r\n    mainmap_left: 850,\r\n    mainmap_cmap: \"viridis\",\r\n    mainmap_cmap_levels: 20,\r\n    mainmap_cmap_max: 0.01,\r\n    mainmap_cmap_min: 0,\r\n    //mainmap_border_width: 0.1,\r\n    mainmap_border_width: 0,\r\n    mainmap_border_color: \"#DDDDDD\",\r\n    mainmap_label_color: \"#FFFFFF\",\r\n    mainmap_number_links: 6,\r\n    //\r\n    lagmap_size: 240,\r\n    lagmap_top: 440,\r\n    lagmap_left: 890,\r\n    lagmap_cmap: \"RdBu\",\r\n    lagmap_cmap_levels: 20,\r\n    lagmap_cmap_max: 10,\r\n    lagmap_cmap_min: 0,\r\n    lagmap_border_width: 0.1,\r\n    lagmap_border_color: \"#DDDDDD\",\r\n    lagmap_label_color: \"#FFFFFF\",\r\n    //\r\n    minimap_size: 130,\r\n    minimap_top: 550,\r\n    minimap_left: 20,\r\n    minimap_separation_x: 30,\r\n    minimap_cmap: \"viridis\",\r\n    minimap_cmap_levels: 20,\r\n    minimap_cmap_max: 0.01,\r\n    minimap_cmap_min: 0,\r\n    //minimap_border_width: 0.1,\r\n    minimap_border_width: 0,\r\n    minimap_border_color: \"#DDDDDD\",\r\n    minimap_label_color: \"#FFFFFF\",\r\n    //\r\n    //arrow_cmap: \"hot_r\",\r\n    //arrow_cmap: \"par_r\",\r\n    arrow_cmap: \"viridis\",\r\n    arrow_value_levels: 20,\r\n    arrow_value_max: 0.01,\r\n    arrow_value_min: -0.01,\r\n    arrow_line_width_max: 1,\r\n    arrow_line_width_min: 0.1,\r\n    arrow_line_alpha_max: 0.7,\r\n    arrow_line_alpha_min: 0.1,\r\n    //\r\n    timeseries_cmap: \"phase_r\",\r\n    timeseries_max_points: 100,\r\n    timeseries_scale_y: 1e8,\r\n    timeseries_pos_x: 340,\r\n    timeseries_pos_y: 50,\r\n    timeseries_width: 460,\r\n    timeseries_height: 450,\r\n    timeseries_line_width: 1,\r\n    timeseries_alpha: 1,\r\n    timeseries_spline_tension: 0, // reduce memory load from ~150MB/110%CPU to 85MB/90%CPU\r\n    //\r\n  }\r\n}\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\nimport {draw_animation, random_point, random_matrix, random_links} from \"./eeg_layout\";\r\n\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\nconst server_settings = {\r\n  server: \"localhost\",\r\n  port: 9120\r\n};\r\n\r\nconst server_config = {\r\n  \"numpy-file\": \"NatEEG-S061-01--24-A.npy\",\r\n  //\"numpy-file\": \"NatEEG-S061-01--26.npy\",\r\n  //\"numpy-file\": \"Nathan-example.npy\",\r\n  //\r\n  \"amplitude-factor\": 1e-8,\r\n  \"lags\": 128,\r\n  //\"lags\": 2,\r\n  //\r\n  //\"lags\": 64,\r\n  //\"lags\": 16,\r\n  //\"batch\": 2,\r\n  \"batch-general-pdc\": 5,\r\n  \"batch-region-pdc\": 15,\r\n  \"batch-connectivity\": 5,\r\n  \"batch-link-arrows\": 4,\r\n  \"batch-timeseries\": 1,\r\n  //\r\n  \"sampling-frequency\": 256,\r\n  \"pdc-number-evaluation-points\": 20,\r\n  //\r\n  \"max-representative-values\": 50,\r\n};\r\n\r\nsettings.animation.mainmap_number_links = server_config[\"max-representative-values\"];\r\nsettings.animation.lagmap_cmap_levels = server_config[\"lags\"];\r\n\r\nlet channels = null;\r\nlet animation = null;\r\n\r\nconst app_provider = dataprovider(websocket_connection(server_settings), server_config).subscribe(\r\n  \"channels\", (v) => {\r\n    channels = v;\r\n    console.log(channels)\r\n    animation = draw_animation(document.getElementById(\"app\"), {width: 1300, height: 700}, settings, channels);\r\n    window._animation = animation\r\n  }).subscribe(\r\n  \"timepoints\", (v) => {\r\n    document.title = `<<T>> ${Math.min(...v)} ${Math.max(...v)}`\r\n    if(animation){\r\n      animation.update_timeseries(v)\r\n    }\r\n  }).subscribe(\r\n  //\"maximum-values\", (v) => {\r\n  //  document.title = \"<<MV>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n  //  if(animation){\r\n  //    animation.update_connectivity(v)\r\n  //  }\r\n  //}).subscribe(\r\n  \"pdc-total\", (v) => {\r\n  //\"maximum-values\", (v) => {\r\n    document.title = \"<<PDC-000>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    if(animation){\r\n      window.connectivity = v;\r\n      animation.update_connectivity(v)\r\n      animation.update_connectivity_arrows(v)\r\n    }\r\n  }).subscribe(\r\n  \"pdc-delta\", (v) => {\r\n    document.title = \"<<PDC-D>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    if(animation){\r\n      animation.update_connectivity_delta(v)\r\n    }\r\n  }).subscribe(\r\n  \"pdc-theta\", (v) => {\r\n    document.title = \"<<PDC-T>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    if(animation){\r\n      animation.update_connectivity_theta(v)\r\n    }\r\n  }).subscribe(\r\n  \"pdc-alpha\", (v) => {\r\n    document.title = \"<<PDC-A>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    if(animation){\r\n      animation.update_connectivity_alpha(v)\r\n    }\r\n  }).subscribe(\r\n  \"pdc-beta\", (v) => {\r\n    document.title = \"<<PDC-B>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    if(animation){\r\n      animation.update_connectivity_beta(v)\r\n    }\r\n  }).subscribe(\r\n  \"pdc-gamma\", (v) => {\r\n    document.title = \"<<PDC-G>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    if(animation){\r\n      animation.update_connectivity_gamma(v)\r\n    }\r\n  }).subscribe(\r\n  \"maximum-lags\", (v) => {\r\n    document.title = \"<<ML>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    if(animation){\r\n      animation.update_lag_dependency(v)\r\n    }\r\n  }).subscribe(\r\n  /*\"relevant-links\", (v) => {\r\n    document.title = \"<<RL>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    //console.log(\"SS\", v.length.toString() + \",\" + v[0].length.toString())\r\n    if(animation) animation.update_connectivity_arrows(v)\r\n  }).subscribe(*/\r\n  \"pdc-relevant-links\", (v) => {\r\n    document.title = \"<<PRL>>\" + v.length.toString() + \",\" + v[0].length.toString()\r\n    //console.log(\"SS\", v.length.toString() + \",\" + v[0].length.toString())\r\n    window._links = v;\r\n    //if(animation) animation.update_connectivity_arrows(v.filter((v, i) => Math.abs(v[3]) > 0))\r\n    //////\r\n    ///if(animation) animation.update_connectivity_arrows(v)\r\n  });\r\n\r\n\r\nconst export_canvas_animation = (layer, {target_element=document.body, show_video=true} = {}) => {\r\n  let canvas = layer.canvas._canvas;\r\n  let rec = null;\r\n  const stop = () => {\r\n    rec.stop();\r\n  };\r\n  const start = () => {\r\n    const chunks = []; // here we will store our recorded media chunks (Blobs)\r\n    const stream = canvas.captureStream(); // grab our canvas MediaStream\r\n    rec = new MediaRecorder(stream); // init the recorder\r\n    // every time the recorder has new data, we will store it in our array\r\n    rec.ondataavailable = e => chunks.push(e.data);\r\n    // only when the recorder stops, we construct a complete Blob from all the chunks\r\n    rec.onstop = e => show(new Blob(chunks, {type: 'video/webm'}));\r\n    rec.start();\r\n  };\r\n  const show = (blob) => {\r\n    target_element.classList.remove(\"hidden\");\r\n    const vid = document.createElement('video');\r\n    vid.src = URL.createObjectURL(blob);\r\n    vid.controls = true;\r\n    const a = document.createElement('a');\r\n    a.classList.add(\"download-link\")\r\n    a.download = 'animation_video.webm';\r\n    a.href = vid.src;\r\n    a.textContent = 'Download this sequence as a .webm video';\r\n    target_element.appendChild(vid);\r\n    target_element.appendChild(a);\r\n  }\r\n  return {start, stop, show};\r\n}\r\n\r\nlet video_recording = null;\r\nsetTimeout(() => {\r\n  video_recording = export_canvas_animation(\r\n    animation.app.getLayers()[0],\r\n    {\r\n      target_element: document.querySelector(\"#video-container\"),\r\n      show_video: false,\r\n    }\r\n  );\r\n  video_recording.start();\r\n}, 3000);\r\nsetTimeout(() => {\r\n  app_provider.execute(\"stop\");\r\n  setTimeout(() => {\r\n    video_recording.stop();\r\n  }, 10000)\r\n}, 3000*2*20)\r\n\r\n/*\r\nconst _channels = [\"Nz\",\"Iz\",\"Cz\",\"T9\",\"T10\",\"NFpz\",\"Fpz\",\"AFpz\",\"AFz\",\"AFFz\",\"Fz\",\"FFCz\",\"FCz\",\"FCCz\",\"CCPz\",\"CPz\",\"CPPz\",\"Pz\",\"PPOz\",\"POz\",\r\n\"POOz\",\"Oz\",\"OIz\",\"N2h\",\"N2\",\"AFp10\",\"AF10\",\"AFF10\",\"F10\",\"FFT10\",\"FT10\",\"FTT10\",\"TTP10\",\"TP10\",\"TPP10\",\"P10\",\"PPO10\",\r\n\"PO10\",\"POO10\",\"I2\",\"I2h\",\"N1h\",\"N1\",\"AFp9\",\"AF9\",\"AFF9\",\"F9\",\"FFT9\",\"FT9\",\"FTT9\",\"TTP9\",\"TP9\",\"TPP9\",\"P9\",\"PPO9\",\"PO9\",\r\n\"POO9\",\"I1\",\"I1h\",\"T9h\",\"T7\",\"T7h\",\"C5\",\"C5h\",\"C3\",\"C3h\",\"C1\",\"C1h\",\"C2h\",\"C2\",\"C4h\",\"C4\",\"C6h\",\"C6\",\"T8h\",\"T8\",\"T10h\",\r\n\"NFp2h\",\"NFp2\",\"AFp10h\",\"AF10h\",\"AFF10h\",\"F10h\",\"FFT10h\",\"FT10h\",\"FTT10h\",\"TTP10h\",\"TP10h\",\"TPP10h\",\"P10h\",\"PPO10h\",\r\n\"PO10h\",\"POO10h\",\"OI2\",\"OI2h\",\"NFp1h\",\"NFp1\",\"AFp9h\",\"AF9h\",\"AFF9h\",\"F9h\",\"FFT9h\",\"FT9h\",\"FTT9h\",\"TTP9h\",\"TP9h\",\"TPP9h\",\r\n\"P9h\",\"PPO9h\",\"PO9h\",\"POO9h\",\"OI1\",\"OI1h\",\"Fp2h\",\"Fp2\",\"AFp8\",\"AF8\",\"AFF8\",\"F8\",\"FFT8\",\"FT8\",\"FTT8\",\"TTP8\",\"TP8\",\"TPP8\",\r\n\"P8\",\"PPO8\",\"PO8\",\"POO8\",\"O2\",\"O2h\",\"Fp1h\",\"Fp1\",\"AFp7\",\"AF7\",\"AFF7\",\"F7\",\"FFT7\",\"FT7\",\"FTT7\",\"TTP7\",\"TP7\",\"TPP7\",\"P7\",\r\n\"PPO7\",\"PO7\",\"POO7\",\"O1\",\"O1h\",\"AFp7h\",\"AFp5\",\"AFp5h\",\"AFp3\",\"AFp3h\",\"AFp1\",\"AFp1h\",\"AFp2h\",\"AFp2\",\"AFp4h\",\"AFp4\",\"AFp6h\",\r\n\"AFp6\",\"AFp8h\",\"AF7h\",\"AF5\",\"AF5h\",\"AF3\",\"AF3h\",\"AF1\",\"AF1h\",\"AF2h\",\"AF2\",\"AF4h\",\"AF4\",\"AF6h\",\"AF6\",\"AF8h\",\"AFF7h\",\"AFF5\",\r\n\"AFF5h\",\"AFF3\",\"AFF3h\",\"AFF1\",\"AFF1h\",\"AFF2h\",\"AFF2\",\"AFF4h\",\"AFF4\",\"AFF6h\",\"AFF6\",\"AFF8h\",\"F7h\",\"F5\",\"F5h\",\"F3\",\"F3h\",\r\n\"F1\",\"F1h\",\"F2h\",\"F2\",\"F4h\",\"F4\",\"F6h\",\"F6\",\"F8h\",\"FFT7h\",\"FFC5\",\"FFC5h\",\"FFC3\",\"FFC3h\",\"FFC1\",\"FFC1h\",\"FFC2h\",\"FFC2\",\r\n\"FFC4h\",\"FFC4\",\"FFC6h\",\"FFC6\",\"FFT8h\",\"FT7h\",\"FC5\",\"FC5h\",\"FC3\",\"FC3h\",\"FC1\",\"FC1h\",\"FC2h\",\"FC2\",\"FC4h\",\"FC4\",\"FC6h\",\r\n\"FC6\",\"FT8h\",\"FTT7h\",\"FCC5\",\"FCC5h\",\"FCC3\",\"FCC3h\",\"FCC1\",\"FCC1h\",\"FCC2h\",\"FCC2\",\"FCC4h\",\"FCC4\",\"FCC6h\",\"FCC6\",\"FTT8h\",\r\n\"TTP7h\",\"CCP5\",\"CCP5h\",\"CCP3\",\"CCP3h\",\"CCP1\",\"CCP1h\",\"CCP2h\",\"CCP2\",\"CCP4h\",\"CCP4\",\"CCP6h\",\"CCP6\",\"TTP8h\",\"TP7h\",\"CP5\",\r\n\"CP5h\",\"CP3\",\"CP3h\",\"CP1\",\"CP1h\",\"CP2h\",\"CP2\",\"CP4h\",\"CP4\",\"CP6h\",\"CP6\",\"TP8h\",\"TPP7h\",\"CPP5\",\"CPP5h\",\"CPP3\",\"CPP3h\",\r\n\"CPP1\",\"CPP1h\",\"CPP2h\",\"CPP2\",\"CPP4h\",\"CPP4\",\"CPP6h\",\"CPP6\",\"TPP8h\",\"P7h\",\"P5\",\"P5h\",\"P3\",\"P3h\",\"P1\",\"P1h\",\"P2h\",\"P2\",\r\n\"P4h\",\"P4\",\"P6h\",\"P6\",\"P8h\",\"PPO7h\",\"PPO5\",\"PPO5h\",\"PPO3\",\"PPO3h\",\"PPO1\",\"PPO1h\",\"PPO2h\",\"PPO2\",\"PPO4h\",\"PPO4\",\"PPO6h\",\r\n\"PPO6\",\"PPO8h\",\"PO7h\",\"PO5\",\"PO5h\",\"PO3\",\"PO3h\",\"PO1\",\"PO1h\",\"PO2h\",\"PO2\",\"PO4h\",\"PO4\",\"PO6h\",\"PO6\",\"PO8h\",\"POO7h\",\r\n\"POO5\",\"POO5h\",\"POO3\",\"POO3h\",\"POO1\",\"POO1h\",\"POO2h\",\"POO2\",\"POO4h\",\"POO4\",\"POO6h\",\"POO6\",\"POO8h\"].slice(0, 64);\r\nconst __channels = [\"O2\", \"O1\", \"F3\", \"F4\"];\r\nconst c3hannels = [\"O2\", \"O1\", \"F3\", \"F4\", \"C5\", \"C6\", \"AF7\", \"AF8\"];\r\nconst channels = [\"Fp1\", \"Fpz\", \"Fp2\", \"AF7\", \"AF3\", \"AF4\", \"AF8\", \"F7\", \"F5\", \"F3\", \"F1\", \"Fz\", \"F2\", \"F4\", \"F6\", \"F8\", \"FT7\", \"FC5\", \"FC3\", \"FC1\", \"FCz\", \"FC2\", \"FC4\", \"FC6\", \"FT8\", \"T7\", \"C5\", \"C3\", \"C1\", \"Cz\", \"C2\", \"C4\", \"C6\", \"T8\", \"TP7\", \"CP5\", \"CP3\", \"CP1\", \"CPz\", \"CP2\", \"CP4\", \"CP6\", \"TP8\", \"P7\", \"P5\", \"P3\", \"P1\", \"Pz\", \"P2\", \"P4\", \"P6\", \"P8\", \"PO7\", \"PO3\", \"Poz\", \"PO4\", \"PO8\", \"O1\", \"Oz\", \"O2\", \"TP9\", \"TP10\"];\r\nwindow.eeg = rescaledEEGLocations2D({\r\n    width: 100,\r\n    height: 100,\r\n    top: 0,\r\n    left: 0,\r\n  }, true);\r\nwindow.ch =channels\r\nconst animation = draw_animation(document.getElementById(\"app\"), {width: 1300, height: 700}, settings, channels);\r\n\r\nsetInterval(() => {\r\n  animation.update_timeseries(random_point(channels.length))\r\n  animation.update_connectivity_delta(random_matrix(channels.length))\r\n  animation.update_connectivity_theta(random_matrix(channels.length))\r\n  animation.update_connectivity_alpha(random_matrix(channels.length))\r\n  animation.update_connectivity_beta(random_matrix(channels.length))\r\n  animation.update_connectivity_gamma(random_matrix(channels.length))\r\n  animation.update_connectivity(random_matrix(channels.length))\r\n  animation.update_lag_dependency(random_matrix(channels.length))\r\n  animation.update_connectivity_arrows(random_links(channels.length, settings.animation.mainmap_number_links))\r\n}, 100)\r\n\r\n*/\r\n\r\n\r\n\r\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}